<!DOCTYPE html>
<html><head>
    <meta http-equiv="content-type" content="text/html; charset=UTF-8"><meta name="viewport" content="width=device-width"><title>file:///C:/Users/geige/Downloads/Database.htm</title></head><body id="viewsource" class="wrap highlight" style="tab-size: 4; background-color: #1C1B22"><pre id="line1"><span style="color: whitesmoke; background-color: #1C1B22"><span></span><span class="doctype">&lt;!DOCTYPE html&gt;</span><span>
<span id="line2"></span></span><span>&lt;<span class="start-tag">html</span>&gt;</span><span>
<span id="line3"></span></span><span>&lt;<span class="start-tag">head</span>&gt;</span><span>
<span id="line4"></span> </span><span>&lt;<span class="start-tag">meta</span> <span class="attribute-name">http-equiv</span>="<a class="attribute-value">content-type</a>" <span class="attribute-name">content</span>="<a class="attribute-value">text/html; charset=utf-8</a>"<span>/</span>&gt;</span><span>
<span id="line5"></span> </span><span>&lt;<span class="start-tag">title</span>&gt;</span><span></span><span>&lt;/<span class="end-tag">title</span>&gt;</span><span>
<span id="line6"></span> </span><span>&lt;<span class="start-tag">meta</span> <span class="attribute-name">name</span>="<a class="attribute-value">generator</a>" <span class="attribute-name">content</span>="<a class="attribute-value">LibreOffice 7.4.3.2 (Linux)</a>"<span>/</span>&gt;</span><span>
<span id="line7"></span> </span><span>&lt;<span class="start-tag">meta</span> <span class="attribute-name">name</span>="<a class="attribute-value">created</a>" <span class="attribute-name">content</span>="<a class="attribute-value">00:00:00</a>"<span>/</span>&gt;</span><span>
<span id="line8"></span> </span><span>&lt;<span class="start-tag">meta</span> <span class="attribute-name">name</span>="<a class="attribute-value">changed</a>" <span class="attribute-name">content</span>="<a class="attribute-value">00:00:00</a>"<span>/</span>&gt;</span><span>
<span id="line9"></span> </span><span>&lt;<span class="start-tag">style</span> <span class="attribute-name">type</span>="<a class="attribute-value">text/css</a>"&gt;</span><span>
<span id="line10"></span> @page { size: 8.27in 11.69in; margin: 0.79in }
<span id="line11"></span> p { line-height: 115%; margin-bottom: 0.1in; background: transparent }
<span id="line12"></span> pre { background: transparent }
<span id="line13"></span> pre.western { font-family: "Liberation Mono", monospace; font-size: 10pt }
<span id="line14"></span> pre.cjk { font-family: "NSimSun", monospace; font-size: 10pt }
<span id="line15"></span> pre.ctl { font-family: "Liberation Mono", monospace; font-size: 10pt }
<span id="line16"></span> </span><span>&lt;/<span class="end-tag">style</span>&gt;</span><span>
<span id="line17"></span></span><span>&lt;/<span class="end-tag">head</span>&gt;</span><span>
<span id="line18"></span></span><span>&lt;<span class="start-tag">body</span> <span class="attribute-name">lang</span>="<a class="attribute-value">en-US</a>" <span class="attribute-name">link</span>="<a class="attribute-value">#000080</a>" <span class="attribute-name">vlink</span>="<a class="attribute-value">#800000</a>" <span class="attribute-name">dir</span>="<a class="attribute-value">ltr</a>"&gt;</span><span></span><span>&lt;<span class="start-tag">pre</span> <span class="attribute-name">class</span>="<a class="attribute-value">western</a>"&gt;</span><span><span class="entity"><span>&amp;</span>lt;</span>?php
<span id="line19"></span>// 
<span id="line20"></span>// Project: phpLiteAdmin (https://www.phpliteadmin.org/)
<span id="line21"></span>// Version: 1.9.8.2
<span id="line22"></span>// Summary: PHP-based admin tool to manage SQLite2 and SQLite3 databases on the web
<span id="line23"></span>// Last updated: 2019-09-05
<span id="line24"></span>// Developers:
<span id="line25"></span>//  Dane Iracleous (daneiracleous@gmail.com)
<span id="line26"></span>//  Ian Aldrighetti (ian.aldrighetti@gmail.com)
<span id="line27"></span>//  George Flanagin <span class="entity"><span>&amp;</span>amp;</span> Digital Gaslight, Inc (george@digitalgaslight.com)
<span id="line28"></span>//  Christopher Kramer (crazy4chrissi@gmail.com, http://en.christosoft.de)
<span id="line29"></span>//  Ayman Teryaki (http://havalite.com)
<span id="line30"></span>//  Dreadnaut (dreadnaut@gmail.com, http://dreadnaut.altervista.org)
<span id="line31"></span>// 
<span id="line32"></span>// 
<span id="line33"></span>// Copyright (C) 2019, phpLiteAdmin
<span id="line34"></span>// 
<span id="line35"></span>// This program is free software: you can redistribute it and/or modify
<span id="line36"></span>// it under the terms of the GNU General Public License as published by
<span id="line37"></span>// the Free Software Foundation, either version 3 of the License, or
<span id="line38"></span>// (at your option) any later version.
<span id="line39"></span>// 
<span id="line40"></span>// This program is distributed in the hope that it will be useful,
<span id="line41"></span>// but WITHOUT ANY WARRANTY; without even the implied warranty of
<span id="line42"></span>// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the
<span id="line43"></span>// GNU General Public License for more details.
<span id="line44"></span>// 
<span id="line45"></span>// You should have received a copy of the GNU General Public License
<span id="line46"></span>// along with this program. If not, see <span class="entity"><span>&amp;</span>lt;</span>https://www.gnu.org/licenses/<span class="entity"><span>&amp;</span>gt;</span>.
<span id="line47"></span>// 
<span id="line48"></span>// ////////////////////////////////////////////////////////////////////////
<span id="line49"></span>// 
<span id="line50"></span>// Please report any bugs you may encounter to our issue tracker here:
<span id="line51"></span>// https://bitbucket.org/phpliteadmin/public/issues?status=new<span class="entity"><span>&amp;</span>amp;</span>status=open
<span id="line52"></span>
<span id="line53"></span>//
<span id="line54"></span>// This is sample configuration file
<span id="line55"></span>//
<span id="line56"></span>// You can configure phpliteadmin in one of 2 ways:
<span id="line57"></span>// 1. Rename phpliteadmin.config.sample.php to phpliteadmin.config.php and change parameters in there.
<span id="line58"></span>// You can set only your custom settings in phpliteadmin.config.php. All other settings will be set to defaults.
<span id="line59"></span>// 2. Change parameters directly in main phpliteadmin.php file
<span id="line60"></span>//
<span id="line61"></span>// Please see https://bitbucket.org/phpliteadmin/public/wiki/Configuration for more details
<span id="line62"></span>
<span id="line63"></span>//password to gain access
<span id="line64"></span>$password = 'admin123';
<span id="line65"></span>
<span id="line66"></span>
<span id="line67"></span><span style="font-weight: bold">//If no session-id is set, a random one will be set which is way more secure than a given one</span>
<span id="line68"></span><span style="color: lawngreen; font-weight: bold">ini_set('session.cookie_httponly', '1');</span>
<span id="line69"></span>session_start();
<span id="line70"></span>
<span id="line71"></span>//directory relative to this file to search for databases (if false, manually list databases in the $databases variable)
<span id="line72"></span>$directory = '.';
<span id="line73"></span>
<span id="line74"></span>//whether or not to scan the subdirectories of the above directory infinitely deep
<span id="line75"></span>$subdirectories = false;
<span id="line76"></span>
<span id="line77"></span>//if the above $directory variable is set to false, you must specify the databases manually in an array as the next variable
<span id="line78"></span>//if any of the databases do not exist as they are referenced by their path, they will be created automatically
<span id="line79"></span>$databases = array(
<span id="line80"></span> array(
<span id="line81"></span> 'path' =<span class="entity"><span>&amp;</span>gt;</span> 'database1.sqlite',
<span id="line82"></span> 'name' =<span class="entity"><span>&amp;</span>gt;</span> 'Database 1'
<span id="line83"></span> ),
<span id="line84"></span> array(
<span id="line85"></span> 'path' =<span class="entity"><span>&amp;</span>gt;</span> 'database2.sqlite',
<span id="line86"></span> 'name' =<span class="entity"><span>&amp;</span>gt;</span> 'Database 2'
<span id="line87"></span> ),
<span id="line88"></span>);
<span id="line89"></span>
<span id="line90"></span>
<span id="line91"></span>/* ---- Interface settings ---- */
<span id="line92"></span>
<span id="line93"></span>// Theme! If you want to change theme, save the CSS file in same folder of phpliteadmin or in folder "themes"
<span id="line94"></span>$theme = '.Database/phpliteadmin.css';
<span id="line95"></span>
<span id="line96"></span>// the default language! If you want to change it, save the language file in same folder of phpliteadmin or in folder "languages"
<span id="line97"></span>// More about localizations (downloads, how to translate etc.): https://bitbucket.org/phpliteadmin/public/wiki/Localization
<span id="line98"></span>$language = 'en';
<span id="line99"></span>
<span id="line100"></span>// set default number of rows. You need to relog after changing the number
<span id="line101"></span>$rowsNum = 30;
<span id="line102"></span>
<span id="line103"></span>// reduce string characters by a number bigger than 10
<span id="line104"></span>$charsNum = 300;
<span id="line105"></span>
<span id="line106"></span>// maximum number of SQL queries to save in the history
<span id="line107"></span>$maxSavedQueries = 10;
<span id="line108"></span>
<span id="line109"></span>/* ---- Custom functions ---- */
<span id="line110"></span>
<span id="line111"></span>//a list of custom functions that can be applied to columns in the databases
<span id="line112"></span>//make sure to define every function below if it is not a core PHP function
<span id="line113"></span>$custom_functions = array(
<span id="line114"></span> 'md5', 'sha1', 'time', 'strtotime',
<span id="line115"></span> // add the names of your custom functions to this array
<span id="line116"></span> /* 'leet_text', */
<span id="line117"></span>);
<span id="line118"></span>
<span id="line119"></span>// define your custom functions here
<span id="line120"></span>/*
<span id="line121"></span>function leet_text($value)
<span id="line122"></span>{
<span id="line123"></span> return strtr($value, 'eaAsSOl', '344zZ01');
<span id="line124"></span>}
<span id="line125"></span>*/
<span id="line126"></span>
<span id="line127"></span>
<span id="line128"></span>/* ---- Advanced options ---- */
<span id="line129"></span>
<span id="line130"></span>//changing the following variable allows multiple phpLiteAdmin installs to work under the same domain.
<span id="line131"></span>$cookie_name = 'PasswordSecure';
<span id="line132"></span>
<span id="line133"></span>//whether or not to put the app in debug mode where errors are outputted
<span id="line134"></span>$debug = false;
<span id="line135"></span>
<span id="line136"></span>// the user is allowed to create databases with only these extensions
<span id="line137"></span>$allowed_extensions = array('db', 'db3', 'sqlite', 'sqlite3');
<span id="line138"></span>
<span id="line139"></span>
<span id="line140"></span>// English language-texts.
<span id="line141"></span>// Read our wiki on how to translate: https://bitbucket.org/phpliteadmin/public/wiki/Localization
<span id="line142"></span>$lang = array(
<span id="line143"></span> "direction" =<span class="entity"><span>&amp;</span>gt;</span> "LTR",
<span id="line144"></span> "date_format" =<span class="entity"><span>&amp;</span>gt;</span> 'g:ia \o\n F j, Y (T)', // see http://php.net/manual/en/function.date.php for what the letters stand for
<span id="line145"></span> "ver" =<span class="entity"><span>&amp;</span>gt;</span> "version",
<span id="line146"></span> "for" =<span class="entity"><span>&amp;</span>gt;</span> "for",
<span id="line147"></span> "to" =<span class="entity"><span>&amp;</span>gt;</span> "to",
<span id="line148"></span> "go" =<span class="entity"><span>&amp;</span>gt;</span> "Go",
<span id="line149"></span> "yes" =<span class="entity"><span>&amp;</span>gt;</span> "Yes",
<span id="line150"></span> "no" =<span class="entity"><span>&amp;</span>gt;</span> "No",
<span id="line151"></span> "sql" =<span class="entity"><span>&amp;</span>gt;</span> "SQL",
<span id="line152"></span> "csv" =<span class="entity"><span>&amp;</span>gt;</span> "CSV",
<span id="line153"></span> "csv_tbl" =<span class="entity"><span>&amp;</span>gt;</span> "Table that CSV pertains to",
<span id="line154"></span> "srch" =<span class="entity"><span>&amp;</span>gt;</span> "Search",
<span id="line155"></span> "srch_again" =<span class="entity"><span>&amp;</span>gt;</span> "Do Another Search",
<span id="line156"></span> "login" =<span class="entity"><span>&amp;</span>gt;</span> "Log In",
<span id="line157"></span> "logout" =<span class="entity"><span>&amp;</span>gt;</span> "Logout",
<span id="line158"></span> "view" =<span class="entity"><span>&amp;</span>gt;</span> "View", // here, the noun SQL view is meant, not the verb "to view"
<span id="line159"></span> "confirm" =<span class="entity"><span>&amp;</span>gt;</span> "Confirm",
<span id="line160"></span> "cancel" =<span class="entity"><span>&amp;</span>gt;</span> "Cancel",
<span id="line161"></span> "save_as" =<span class="entity"><span>&amp;</span>gt;</span> "Save As",
<span id="line162"></span> "options" =<span class="entity"><span>&amp;</span>gt;</span> "Options",
<span id="line163"></span> "no_opt" =<span class="entity"><span>&amp;</span>gt;</span> "No options",
<span id="line164"></span> "help" =<span class="entity"><span>&amp;</span>gt;</span> "Help",
<span id="line165"></span> "installed" =<span class="entity"><span>&amp;</span>gt;</span> "installed",
<span id="line166"></span> "not_installed" =<span class="entity"><span>&amp;</span>gt;</span> "not installed",
<span id="line167"></span> "done" =<span class="entity"><span>&amp;</span>gt;</span> "done",
<span id="line168"></span> "insert" =<span class="entity"><span>&amp;</span>gt;</span> "Insert",
<span id="line169"></span> "export" =<span class="entity"><span>&amp;</span>gt;</span> "Export",
<span id="line170"></span> "import" =<span class="entity"><span>&amp;</span>gt;</span> "Import",
<span id="line171"></span> "rename" =<span class="entity"><span>&amp;</span>gt;</span> "Rename",
<span id="line172"></span> "empty" =<span class="entity"><span>&amp;</span>gt;</span> "Empty",
<span id="line173"></span> "drop" =<span class="entity"><span>&amp;</span>gt;</span> "Drop",
<span id="line174"></span> "tbl" =<span class="entity"><span>&amp;</span>gt;</span> "Table",
<span id="line175"></span> "chart" =<span class="entity"><span>&amp;</span>gt;</span> "Chart",
<span id="line176"></span> "err" =<span class="entity"><span>&amp;</span>gt;</span> "ERROR",
<span id="line177"></span> "act" =<span class="entity"><span>&amp;</span>gt;</span> "Action",
<span id="line178"></span> "rec" =<span class="entity"><span>&amp;</span>gt;</span> "Records",
<span id="line179"></span> "col" =<span class="entity"><span>&amp;</span>gt;</span> "Column",
<span id="line180"></span> "cols" =<span class="entity"><span>&amp;</span>gt;</span> "Columns",
<span id="line181"></span> "rows" =<span class="entity"><span>&amp;</span>gt;</span> "row(s)",
<span id="line182"></span> "edit" =<span class="entity"><span>&amp;</span>gt;</span> "Edit",
<span id="line183"></span> "del" =<span class="entity"><span>&amp;</span>gt;</span> "Delete",
<span id="line184"></span> "add" =<span class="entity"><span>&amp;</span>gt;</span> "Add",
<span id="line185"></span> "backup" =<span class="entity"><span>&amp;</span>gt;</span> "Backup database file",
<span id="line186"></span> "before" =<span class="entity"><span>&amp;</span>gt;</span> "Before",
<span id="line187"></span> "after" =<span class="entity"><span>&amp;</span>gt;</span> "After",
<span id="line188"></span> "passwd" =<span class="entity"><span>&amp;</span>gt;</span> "Password",
<span id="line189"></span> "passwd_incorrect" =<span class="entity"><span>&amp;</span>gt;</span> "Incorrect password.",
<span id="line190"></span> "chk_ext" =<span class="entity"><span>&amp;</span>gt;</span> "Checking supported SQLite PHP extensions",
<span id="line191"></span> "autoincrement" =<span class="entity"><span>&amp;</span>gt;</span> "Autoincrement",
<span id="line192"></span> "not_null" =<span class="entity"><span>&amp;</span>gt;</span> "Not NULL",
<span id="line193"></span> "attention" =<span class="entity"><span>&amp;</span>gt;</span> "Attention",
<span id="line194"></span> "none" =<span class="entity"><span>&amp;</span>gt;</span> "None",
<span id="line195"></span> "as_defined" =<span class="entity"><span>&amp;</span>gt;</span> "As defined",
<span id="line196"></span> "expression" =<span class="entity"><span>&amp;</span>gt;</span> "Expression",
<span id="line197"></span> "download" =<span class="entity"><span>&amp;</span>gt;</span> "Download",
<span id="line198"></span> "open_in_browser" =<span class="entity"><span>&amp;</span>gt;</span> "Open in browser",
<span id="line199"></span>
<span id="line200"></span> "sqlite_ext" =<span class="entity"><span>&amp;</span>gt;</span> "SQLite extension",
<span id="line201"></span> "sqlite_ext_support" =<span class="entity"><span>&amp;</span>gt;</span> "It appears that none of the supported SQLite library extensions are available in your installation of PHP. You may not use %s until you install at least one of them.",
<span id="line202"></span> "sqlite_v" =<span class="entity"><span>&amp;</span>gt;</span> "SQLite version",
<span id="line203"></span> "sqlite_v_error" =<span class="entity"><span>&amp;</span>gt;</span> "It appears that your database is of SQLite version %s but your installation of PHP does not contain the necessary extensions to handle this version. To fix the problem, either delete the database and allow %s to create it automatically or recreate it manually as SQLite version %s.",
<span id="line204"></span> "report_issue" =<span class="entity"><span>&amp;</span>gt;</span> "The problem cannot be diagnosed properly. Please file an issue report at",
<span id="line205"></span> "sqlite_limit" =<span class="entity"><span>&amp;</span>gt;</span> "Due to the limitations of SQLite, only the field name and data type can be modified.",
<span id="line206"></span>
<span id="line207"></span> "php_v" =<span class="entity"><span>&amp;</span>gt;</span> "PHP version",
<span id="line208"></span> "new_version" =<span class="entity"><span>&amp;</span>gt;</span> "There is a new version!",
<span id="line209"></span>
<span id="line210"></span> "db_dump" =<span class="entity"><span>&amp;</span>gt;</span> "database dump",
<span id="line211"></span> "db_f" =<span class="entity"><span>&amp;</span>gt;</span> "database file",
<span id="line212"></span> "db_ch" =<span class="entity"><span>&amp;</span>gt;</span> "Change Database",
<span id="line213"></span> "db_event" =<span class="entity"><span>&amp;</span>gt;</span> "Database Event",
<span id="line214"></span> "db_name" =<span class="entity"><span>&amp;</span>gt;</span> "Database name",
<span id="line215"></span> "db_rename" =<span class="entity"><span>&amp;</span>gt;</span> "Rename Database",
<span id="line216"></span> "db_renamed" =<span class="entity"><span>&amp;</span>gt;</span> "Database '%s' has been renamed to",
<span id="line217"></span> "db_del" =<span class="entity"><span>&amp;</span>gt;</span> "Delete Database",
<span id="line218"></span> "db_path" =<span class="entity"><span>&amp;</span>gt;</span> "Path to database",
<span id="line219"></span> "db_size" =<span class="entity"><span>&amp;</span>gt;</span> "Size of database",
<span id="line220"></span> "db_mod" =<span class="entity"><span>&amp;</span>gt;</span> "Database last modified",
<span id="line221"></span> "db_create" =<span class="entity"><span>&amp;</span>gt;</span> "Create New Database",
<span id="line222"></span> "db_vac" =<span class="entity"><span>&amp;</span>gt;</span> "The database, '%s', has been VACUUMed.",
<span id="line223"></span> "db_not_writeable" =<span class="entity"><span>&amp;</span>gt;</span> "The database, '%s', does not exist and cannot be created because the containing directory, '%s', is not writable. The application is unusable until you make it writable.",
<span id="line224"></span> "db_setup" =<span class="entity"><span>&amp;</span>gt;</span> "There was a problem setting up your database, %s. An attempt will be made to find out what's going on so you can fix the problem more easily",
<span id="line225"></span> "db_exists" =<span class="entity"><span>&amp;</span>gt;</span> "A database, other file or directory of the name '%s' already exists.",
<span id="line226"></span> "db_blank" =<span class="entity"><span>&amp;</span>gt;</span> "The database name cannot be blank.",
<span id="line227"></span>
<span id="line228"></span> "exported" =<span class="entity"><span>&amp;</span>gt;</span> "Exported",
<span id="line229"></span> "struct" =<span class="entity"><span>&amp;</span>gt;</span> "Structure",
<span id="line230"></span> "struct_for" =<span class="entity"><span>&amp;</span>gt;</span> "structure for",
<span id="line231"></span> "on_tbl" =<span class="entity"><span>&amp;</span>gt;</span> "on table",
<span id="line232"></span> "data_dump" =<span class="entity"><span>&amp;</span>gt;</span> "Data dump for",
<span id="line233"></span> "backup_hint" =<span class="entity"><span>&amp;</span>gt;</span> "Hint: To backup your database, the easiest way is to %s.",
<span id="line234"></span> "backup_hint_linktext" =<span class="entity"><span>&amp;</span>gt;</span> "download the database-file",
<span id="line235"></span> "total_rows" =<span class="entity"><span>&amp;</span>gt;</span> "a total of %s rows",
<span id="line236"></span> "total" =<span class="entity"><span>&amp;</span>gt;</span> "Total",
<span id="line237"></span> "not_dir" =<span class="entity"><span>&amp;</span>gt;</span> "The directory you specified to scan for databases does not exist or is not a directory.",
<span id="line238"></span> "bad_php_directive" =<span class="entity"><span>&amp;</span>gt;</span> "It appears that the PHP directive, 'register_globals' is enabled. This is bad. You need to disable it before continuing.",
<span id="line239"></span> "page_gen" =<span class="entity"><span>&amp;</span>gt;</span> "Page generated in %s seconds.",
<span id="line240"></span> "powered" =<span class="entity"><span>&amp;</span>gt;</span> "Powered by",
<span id="line241"></span> "free_software" =<span class="entity"><span>&amp;</span>gt;</span> "This is free software.",
<span id="line242"></span> "please_donate" =<span class="entity"><span>&amp;</span>gt;</span> "Please donate.",
<span id="line243"></span> "remember" =<span class="entity"><span>&amp;</span>gt;</span> "Remember me",
<span id="line244"></span> "no_db" =<span class="entity"><span>&amp;</span>gt;</span> "Welcome to %s. It appears that you have selected to scan a directory for databases to manage. However, %s could not find any valid SQLite databases. You may use the form below to create your first database.",
<span id="line245"></span> "no_db2" =<span class="entity"><span>&amp;</span>gt;</span> "The directory you specified does not contain any existing databases to manage, and the directory is not writable. This means you can't create any new databases using %s. Either make the directory writable or manually upload databases to the directory.",
<span id="line246"></span> "dir_not_executable" =<span class="entity"><span>&amp;</span>gt;</span> "The directory you specified cannot be scanned for databases as %s has no execute permissions on it. On Linux, use 'chmod +x %s' to fix this.",
<span id="line247"></span>
<span id="line248"></span> "create" =<span class="entity"><span>&amp;</span>gt;</span> "Create",
<span id="line249"></span> "created" =<span class="entity"><span>&amp;</span>gt;</span> "has been created",
<span id="line250"></span> "create_tbl" =<span class="entity"><span>&amp;</span>gt;</span> "Create new table",
<span id="line251"></span> "create_tbl_db" =<span class="entity"><span>&amp;</span>gt;</span> "Create new table on database",
<span id="line252"></span> "create_trigger" =<span class="entity"><span>&amp;</span>gt;</span> "Creating new trigger on table",
<span id="line253"></span> "create_index" =<span class="entity"><span>&amp;</span>gt;</span> "Creating new index on table",
<span id="line254"></span> "create_index1" =<span class="entity"><span>&amp;</span>gt;</span> "Create Index",
<span id="line255"></span> "create_view" =<span class="entity"><span>&amp;</span>gt;</span> "Create new view on database",
<span id="line256"></span>
<span id="line257"></span> "trigger" =<span class="entity"><span>&amp;</span>gt;</span> "Trigger",
<span id="line258"></span> "triggers" =<span class="entity"><span>&amp;</span>gt;</span> "Triggers",
<span id="line259"></span> "trigger_name" =<span class="entity"><span>&amp;</span>gt;</span> "Trigger name",
<span id="line260"></span> "trigger_act" =<span class="entity"><span>&amp;</span>gt;</span> "Trigger Action",
<span id="line261"></span> "trigger_step" =<span class="entity"><span>&amp;</span>gt;</span> "Trigger Steps (semicolon terminated)",
<span id="line262"></span> "when_exp" =<span class="entity"><span>&amp;</span>gt;</span> "WHEN expression (type expression without 'WHEN')",
<span id="line263"></span> "index" =<span class="entity"><span>&amp;</span>gt;</span> "Index",
<span id="line264"></span> "indexes" =<span class="entity"><span>&amp;</span>gt;</span> "Indexes",
<span id="line265"></span> "index_name" =<span class="entity"><span>&amp;</span>gt;</span> "Index name",
<span id="line266"></span> "name" =<span class="entity"><span>&amp;</span>gt;</span> "Name",
<span id="line267"></span> "unique" =<span class="entity"><span>&amp;</span>gt;</span> "Unique",
<span id="line268"></span> "seq_no" =<span class="entity"><span>&amp;</span>gt;</span> "Seq. No.",
<span id="line269"></span> "emptied" =<span class="entity"><span>&amp;</span>gt;</span> "has been emptied",
<span id="line270"></span> "dropped" =<span class="entity"><span>&amp;</span>gt;</span> "has been dropped",
<span id="line271"></span> "renamed" =<span class="entity"><span>&amp;</span>gt;</span> "has been renamed to",
<span id="line272"></span> "altered" =<span class="entity"><span>&amp;</span>gt;</span> "has been altered successfully",
<span id="line273"></span> "inserted" =<span class="entity"><span>&amp;</span>gt;</span> "inserted",
<span id="line274"></span> "deleted" =<span class="entity"><span>&amp;</span>gt;</span> "deleted",
<span id="line275"></span> "affected" =<span class="entity"><span>&amp;</span>gt;</span> "affected",
<span id="line276"></span> "blank_index" =<span class="entity"><span>&amp;</span>gt;</span> "Index name must not be blank.",
<span id="line277"></span> "one_index" =<span class="entity"><span>&amp;</span>gt;</span> "You must specify at least one index column.",
<span id="line278"></span> "docu" =<span class="entity"><span>&amp;</span>gt;</span> "Documentation",
<span id="line279"></span> "license" =<span class="entity"><span>&amp;</span>gt;</span> "License",
<span id="line280"></span> "proj_site" =<span class="entity"><span>&amp;</span>gt;</span> "Project Site",
<span id="line281"></span> "bug_report" =<span class="entity"><span>&amp;</span>gt;</span> "This may be a bug that needs to be reported at",
<span id="line282"></span> "return" =<span class="entity"><span>&amp;</span>gt;</span> "Return",
<span id="line283"></span> "browse" =<span class="entity"><span>&amp;</span>gt;</span> "Browse",
<span id="line284"></span> "fld" =<span class="entity"><span>&amp;</span>gt;</span> "Field",
<span id="line285"></span> "fld_num" =<span class="entity"><span>&amp;</span>gt;</span> "Number of Fields",
<span id="line286"></span> "fields" =<span class="entity"><span>&amp;</span>gt;</span> "Fields",
<span id="line287"></span> "type" =<span class="entity"><span>&amp;</span>gt;</span> "Type",
<span id="line288"></span> "operator" =<span class="entity"><span>&amp;</span>gt;</span> "Operator",
<span id="line289"></span> "val" =<span class="entity"><span>&amp;</span>gt;</span> "Value",
<span id="line290"></span> "update" =<span class="entity"><span>&amp;</span>gt;</span> "Update",
<span id="line291"></span> "comments" =<span class="entity"><span>&amp;</span>gt;</span> "Comments",
<span id="line292"></span>
<span id="line293"></span> "specify_fields" =<span class="entity"><span>&amp;</span>gt;</span> "You must specify the number of table fields.",
<span id="line294"></span> "specify_tbl" =<span class="entity"><span>&amp;</span>gt;</span> "You must specify a table name.",
<span id="line295"></span> "specify_col" =<span class="entity"><span>&amp;</span>gt;</span> "You must specify a column.",
<span id="line296"></span>
<span id="line297"></span> "tbl_exists" =<span class="entity"><span>&amp;</span>gt;</span> "Table of the same name already exists.",
<span id="line298"></span> "show" =<span class="entity"><span>&amp;</span>gt;</span> "Show",
<span id="line299"></span> "show_rows" =<span class="entity"><span>&amp;</span>gt;</span> "Showing %s row(s). ",
<span id="line300"></span> "showing" =<span class="entity"><span>&amp;</span>gt;</span> "Showing",
<span id="line301"></span> "showing_rows" =<span class="entity"><span>&amp;</span>gt;</span> "Showing rows",
<span id="line302"></span> "query_time" =<span class="entity"><span>&amp;</span>gt;</span> "(Query took %s sec)",
<span id="line303"></span> "syntax_err" =<span class="entity"><span>&amp;</span>gt;</span> "There is a problem with the syntax of your query (Query was not executed)",
<span id="line304"></span> "run_sql" =<span class="entity"><span>&amp;</span>gt;</span> "Run SQL query/queries on database '%s'",
<span id="line305"></span> "recent_queries" =<span class="entity"><span>&amp;</span>gt;</span> "Recent Queries",
<span id="line306"></span> "full_texts" =<span class="entity"><span>&amp;</span>gt;</span> "Show full texts",
<span id="line307"></span> "no_full_texts" =<span class="entity"><span>&amp;</span>gt;</span> "Shorten long texts",
<span id="line308"></span>
<span id="line309"></span> "ques_empty" =<span class="entity"><span>&amp;</span>gt;</span> "Are you sure you want to empty the table '%s'?",
<span id="line310"></span> "ques_drop" =<span class="entity"><span>&amp;</span>gt;</span> "Are you sure you want to drop the table '%s'?",
<span id="line311"></span> "ques_drop_view" =<span class="entity"><span>&amp;</span>gt;</span> "Are you sure you want to drop the view '%s'?",
<span id="line312"></span> "ques_del_rows" =<span class="entity"><span>&amp;</span>gt;</span> "Are you sure you want to delete row(s) %s from table '%s'?",
<span id="line313"></span> "ques_del_db" =<span class="entity"><span>&amp;</span>gt;</span> "Are you sure you want to delete the database '%s'?",
<span id="line314"></span> "ques_column_delete" =<span class="entity"><span>&amp;</span>gt;</span> "Are you sure you want to delete column(s) %s from table '%s'?",
<span id="line315"></span> "ques_del_index" =<span class="entity"><span>&amp;</span>gt;</span> "Are you sure you want to delete index '%s'?",
<span id="line316"></span> "ques_del_trigger" =<span class="entity"><span>&amp;</span>gt;</span> "Are you sure you want to delete trigger '%s'?",
<span id="line317"></span> "ques_primarykey_add" =<span class="entity"><span>&amp;</span>gt;</span> "Are you sure you want to add a primary key for the column(s) %s in table '%s'?",
<span id="line318"></span>
<span id="line319"></span> "export_struct" =<span class="entity"><span>&amp;</span>gt;</span> "Export with structure",
<span id="line320"></span> "export_data" =<span class="entity"><span>&amp;</span>gt;</span> "Export with data",
<span id="line321"></span> "add_drop" =<span class="entity"><span>&amp;</span>gt;</span> "Add DROP TABLE",
<span id="line322"></span> "add_transact" =<span class="entity"><span>&amp;</span>gt;</span> "Add TRANSACTION",
<span id="line323"></span> "fld_terminated" =<span class="entity"><span>&amp;</span>gt;</span> "Fields terminated by",
<span id="line324"></span> "fld_enclosed" =<span class="entity"><span>&amp;</span>gt;</span> "Fields enclosed by",
<span id="line325"></span> "fld_escaped" =<span class="entity"><span>&amp;</span>gt;</span> "Fields escaped by",
<span id="line326"></span> "fld_names" =<span class="entity"><span>&amp;</span>gt;</span> "Field names in first row",
<span id="line327"></span> "rep_null" =<span class="entity"><span>&amp;</span>gt;</span> "Replace NULL by",
<span id="line328"></span> "rem_crlf" =<span class="entity"><span>&amp;</span>gt;</span> "Remove CRLF characters within fields",
<span id="line329"></span> "put_fld" =<span class="entity"><span>&amp;</span>gt;</span> "Put field names in first row",
<span id="line330"></span> "null_represent" =<span class="entity"><span>&amp;</span>gt;</span> "NULL represented by",
<span id="line331"></span> "import_suc" =<span class="entity"><span>&amp;</span>gt;</span> "Import was successful.",
<span id="line332"></span> "import_into" =<span class="entity"><span>&amp;</span>gt;</span> "Import into",
<span id="line333"></span> "import_f" =<span class="entity"><span>&amp;</span>gt;</span> "File to import",
<span id="line334"></span> "max_file_size" =<span class="entity"><span>&amp;</span>gt;</span> "Maximum file size",
<span id="line335"></span> "rename_tbl" =<span class="entity"><span>&amp;</span>gt;</span> "Rename table '%s' to",
<span id="line336"></span>
<span id="line337"></span> "rows_records" =<span class="entity"><span>&amp;</span>gt;</span> "row(s) starting from record # ",
<span id="line338"></span> "rows_aff" =<span class="entity"><span>&amp;</span>gt;</span> "row(s) affected. ",
<span id="line339"></span>
<span id="line340"></span> "as_a" =<span class="entity"><span>&amp;</span>gt;</span> "as a",
<span id="line341"></span> "readonly_tbl" =<span class="entity"><span>&amp;</span>gt;</span> "'%s' is a view, which means it is a SELECT statement treated as a read-only table. You may not edit or insert records.",
<span id="line342"></span> "chk_all" =<span class="entity"><span>&amp;</span>gt;</span> "Check All",
<span id="line343"></span> "unchk_all" =<span class="entity"><span>&amp;</span>gt;</span> "Uncheck All",
<span id="line344"></span> "with_sel" =<span class="entity"><span>&amp;</span>gt;</span> "With Selected",
<span id="line345"></span>
<span id="line346"></span> "no_tbl" =<span class="entity"><span>&amp;</span>gt;</span> "No table in database.",
<span id="line347"></span> "no_chart" =<span class="entity"><span>&amp;</span>gt;</span> "If you can read this, it means the chart could not be generated. The data you are trying to view may not be appropriate for a chart.",
<span id="line348"></span> "no_rows" =<span class="entity"><span>&amp;</span>gt;</span> "There are no rows in the table for the range you selected.",
<span id="line349"></span> "no_sel" =<span class="entity"><span>&amp;</span>gt;</span> "You did not select anything.",
<span id="line350"></span>
<span id="line351"></span> "chart_type" =<span class="entity"><span>&amp;</span>gt;</span> "Chart Type",
<span id="line352"></span> "chart_bar" =<span class="entity"><span>&amp;</span>gt;</span> "Bar Chart",
<span id="line353"></span> "chart_pie" =<span class="entity"><span>&amp;</span>gt;</span> "Pie Chart",
<span id="line354"></span> "chart_line" =<span class="entity"><span>&amp;</span>gt;</span> "Line Chart",
<span id="line355"></span> "lbl" =<span class="entity"><span>&amp;</span>gt;</span> "Labels",
<span id="line356"></span> "empty_tbl" =<span class="entity"><span>&amp;</span>gt;</span> "This table is empty.",
<span id="line357"></span> "click" =<span class="entity"><span>&amp;</span>gt;</span> "Click here",
<span id="line358"></span> "insert_rows" =<span class="entity"><span>&amp;</span>gt;</span> "to insert rows.",
<span id="line359"></span> "restart_insert" =<span class="entity"><span>&amp;</span>gt;</span> "Restart insertion with ",
<span id="line360"></span> "ignore" =<span class="entity"><span>&amp;</span>gt;</span> "Ignore",
<span id="line361"></span> "func" =<span class="entity"><span>&amp;</span>gt;</span> "Function",
<span id="line362"></span> "new_insert" =<span class="entity"><span>&amp;</span>gt;</span> "Insert As New Row",
<span id="line363"></span> "save_ch" =<span class="entity"><span>&amp;</span>gt;</span> "Save Changes",
<span id="line364"></span> "def_val" =<span class="entity"><span>&amp;</span>gt;</span> "Default Value",
<span id="line365"></span> "prim_key" =<span class="entity"><span>&amp;</span>gt;</span> "Primary Key",
<span id="line366"></span> "tbl_end" =<span class="entity"><span>&amp;</span>gt;</span> "field(s) at end of table",
<span id="line367"></span> "query_used_table" =<span class="entity"><span>&amp;</span>gt;</span> "Query used to create this table",
<span id="line368"></span> "query_used_view" =<span class="entity"><span>&amp;</span>gt;</span> "Query used to create this view",
<span id="line369"></span> "create_index2" =<span class="entity"><span>&amp;</span>gt;</span> "Create an index on",
<span id="line370"></span> "create_trigger2" =<span class="entity"><span>&amp;</span>gt;</span> "Create a new trigger",
<span id="line371"></span> "new_fld" =<span class="entity"><span>&amp;</span>gt;</span> "Adding new field(s) to table '%s'",
<span id="line372"></span> "add_flds" =<span class="entity"><span>&amp;</span>gt;</span> "Add Fields",
<span id="line373"></span> "edit_col" =<span class="entity"><span>&amp;</span>gt;</span> "Editing column '%s'",
<span id="line374"></span> "vac" =<span class="entity"><span>&amp;</span>gt;</span> "Vacuum",
<span id="line375"></span> "vac_desc" =<span class="entity"><span>&amp;</span>gt;</span> "Large databases sometimes need to be VACUUMed to reduce their footprint on the server. Click the button below to VACUUM the database '%s'.",
<span id="line376"></span> "vac_on_empty" =<span class="entity"><span>&amp;</span>gt;</span> "Rebuild database file to recover unused space (Vacuum)",
<span id="line377"></span> "event" =<span class="entity"><span>&amp;</span>gt;</span> "Event",
<span id="line378"></span> "each_row" =<span class="entity"><span>&amp;</span>gt;</span> "For Each Row",
<span id="line379"></span> "define_index" =<span class="entity"><span>&amp;</span>gt;</span> "Define index properties",
<span id="line380"></span> "dup_val" =<span class="entity"><span>&amp;</span>gt;</span> "Duplicate values",
<span id="line381"></span> "allow" =<span class="entity"><span>&amp;</span>gt;</span> "Allowed",
<span id="line382"></span> "not_allow" =<span class="entity"><span>&amp;</span>gt;</span> "Not Allowed",
<span id="line383"></span> "asc" =<span class="entity"><span>&amp;</span>gt;</span> "Ascending",
<span id="line384"></span> "desc" =<span class="entity"><span>&amp;</span>gt;</span> "Descending",
<span id="line385"></span> "warn0" =<span class="entity"><span>&amp;</span>gt;</span> "You have been warned.",
<span id="line386"></span> "warn_passwd" =<span class="entity"><span>&amp;</span>gt;</span> "You are using the default password, which can be dangerous. You can change it easily at the top of %s.",
<span id="line387"></span> "counting_skipped" =<span class="entity"><span>&amp;</span>gt;</span> "Counting of records has been skipped for some tables because your database is comparably big and some tables don't have primary keys assigned to them so counting might be slow. Add a primary key to these tables or %sforce counting%s.",
<span id="line388"></span> "sel_state" =<span class="entity"><span>&amp;</span>gt;</span> "Select Statement",
<span id="line389"></span> "delimit" =<span class="entity"><span>&amp;</span>gt;</span> "Delimiter",
<span id="line390"></span> "back_top" =<span class="entity"><span>&amp;</span>gt;</span> "Back to Top",
<span id="line391"></span> "choose_f" =<span class="entity"><span>&amp;</span>gt;</span> "Choose File",
<span id="line392"></span> "instead" =<span class="entity"><span>&amp;</span>gt;</span> "Instead of",
<span id="line393"></span> "define_in_col" =<span class="entity"><span>&amp;</span>gt;</span> "Define index column(s)",
<span id="line394"></span>
<span id="line395"></span> "delete_only_managed" =<span class="entity"><span>&amp;</span>gt;</span> "You can only delete databases managed by this tool!",
<span id="line396"></span> "rename_only_managed" =<span class="entity"><span>&amp;</span>gt;</span> "You can only rename databases managed by this tool!",
<span id="line397"></span> "db_moved_outside" =<span class="entity"><span>&amp;</span>gt;</span> "You either tried to move the database into a directory where it cannot be managed anylonger, or the check if you did this failed because of missing rights.",
<span id="line398"></span> "extension_not_allowed" =<span class="entity"><span>&amp;</span>gt;</span> "The extension you provided is not within the list of allowed extensions. Please use one of the following extensions",
<span id="line399"></span> "add_allowed_extension" =<span class="entity"><span>&amp;</span>gt;</span> "You can add extensions to this list by adding your extension to \$allowed_extensions in the configuration.",
<span id="line400"></span> "database_not_writable" =<span class="entity"><span>&amp;</span>gt;</span> "The database-file is not writable, so its content cannot be changed in any way.",
<span id="line401"></span> "directory_not_writable" =<span class="entity"><span>&amp;</span>gt;</span> "The database-file itself is writable, but to write into it, the containing directory needs to be writable as well. This is because SQLite puts temporary files in there for locking.",
<span id="line402"></span> "tbl_inexistent" =<span class="entity"><span>&amp;</span>gt;</span> "Table %s does not exist",
<span id="line403"></span> "col_inexistent" =<span class="entity"><span>&amp;</span>gt;</span> "Column %s does not exist",
<span id="line404"></span>
<span id="line405"></span> // errors that can happen when ALTER TABLE fails. You don't necessarily have to translate these.
<span id="line406"></span> "alter_failed" =<span class="entity"><span>&amp;</span>gt;</span> "Altering of Table %s failed",
<span id="line407"></span> "alter_tbl_name_not_replacable" =<span class="entity"><span>&amp;</span>gt;</span> "could not replace the table name with the temporary one",
<span id="line408"></span> "alter_no_def" =<span class="entity"><span>&amp;</span>gt;</span> "no ALTER definition",
<span id="line409"></span> "alter_parse_failed" =<span class="entity"><span>&amp;</span>gt;</span> "failed to parse ALTER definition",
<span id="line410"></span> "alter_action_not_recognized" =<span class="entity"><span>&amp;</span>gt;</span> "ALTER action could not be recognized",
<span id="line411"></span> "alter_no_add_col" =<span class="entity"><span>&amp;</span>gt;</span> "no column to add detected in ALTER statement",
<span id="line412"></span> "alter_pattern_mismatch" =<span class="entity"><span>&amp;</span>gt;</span> "Pattern did not match on your original CREATE TABLE statement",
<span id="line413"></span> "alter_col_not_recognized" =<span class="entity"><span>&amp;</span>gt;</span> "could not recognize new or old column name",
<span id="line414"></span> "alter_unknown_operation" =<span class="entity"><span>&amp;</span>gt;</span> "Unknown ALTER operation!",
<span id="line415"></span>
<span id="line416"></span> /* Help documentation */
<span id="line417"></span> "help_doc" =<span class="entity"><span>&amp;</span>gt;</span> "Help Documentation",
<span id="line418"></span> "help1" =<span class="entity"><span>&amp;</span>gt;</span> "SQLite Library Extensions",
<span id="line419"></span> "help1_x" =<span class="entity"><span>&amp;</span>gt;</span> "%s uses PHP library extensions that allow interaction with SQLite databases. Currently, %s supports PDO, SQLite3, and SQLiteDatabase. Both PDO and SQLite3 deal with version 3 of SQLite, while SQLiteDatabase deals with version 2. So, if your PHP installation includes more than one SQLite library extension, PDO and SQLite3 will take precedence to make use of the better technology. However, if you have existing databases that are of version 2 of SQLite, %s will be forced to use SQLiteDatabase for only those databases. Not all databases need to be of the same version. During the database creation, however, the most advanced extension will be used.",
<span id="line420"></span> "help2" =<span class="entity"><span>&amp;</span>gt;</span> "Creating a New Database",
<span id="line421"></span> "help2_x" =<span class="entity"><span>&amp;</span>gt;</span> "When you create a new database, the name you entered will be appended with the appropriate file extension (.db, .db3, .sqlite, etc.) if you do not include it yourself. The database will be created in the directory you specified as the \$directory variable.",
<span id="line422"></span> "help3" =<span class="entity"><span>&amp;</span>gt;</span> "Tables vs. Views",
<span id="line423"></span> "help3_x" =<span class="entity"><span>&amp;</span>gt;</span> "On the main database page, there is a list of tables and views. Since views are read-only, certain operations will be disabled. These disabled operations will be apparent by their omission in the location where they should appear on the row for a view. If you want to change the data for a view, you need to drop that view and create a new view with the appropriate SELECT statement that queries other existing tables. For more information, see <span class="entity"><span>&amp;</span>lt;</span>a href='http://en.wikipedia.org/wiki/View_(database)' target='_blank'<span class="entity"><span>&amp;</span>gt;</span>http://en.wikipedia.org/wiki/View_(database)<span class="entity"><span>&amp;</span>lt;</span>/a<span class="entity"><span>&amp;</span>gt;</span>",
<span id="line424"></span> "help4" =<span class="entity"><span>&amp;</span>gt;</span> "Writing a Select Statement for a New View",
<span id="line425"></span> "help4_x" =<span class="entity"><span>&amp;</span>gt;</span> "When you create a new view, you must write an SQL SELECT statement that it will use as its data. A view is simply a read-only table that can be accessed and queried like a regular table, except it cannot be modified through insertion, column editing, or row editing. It is only used for conveniently fetching data.",
<span id="line426"></span> "help5" =<span class="entity"><span>&amp;</span>gt;</span> "Export Structure to SQL File",
<span id="line427"></span> "help5_x" =<span class="entity"><span>&amp;</span>gt;</span> "During the process for exporting to an SQL file, you may choose to include the queries that create the table and columns.",
<span id="line428"></span> "help6" =<span class="entity"><span>&amp;</span>gt;</span> "Export Data to SQL File",
<span id="line429"></span> "help6_x" =<span class="entity"><span>&amp;</span>gt;</span> "During the process for exporting to an SQL file, you may choose to include the queries that populate the table(s) with the current records of the table(s).",
<span id="line430"></span> "help7" =<span class="entity"><span>&amp;</span>gt;</span> "Add Drop Table to Exported SQL File",
<span id="line431"></span> "help7_x" =<span class="entity"><span>&amp;</span>gt;</span> "During the process for exporting to an SQL file, you may choose to include queries to DROP the existing tables before adding them so that problems do not occur when trying to create tables that already exist.",
<span id="line432"></span> "help8" =<span class="entity"><span>&amp;</span>gt;</span> "Add Transaction to Exported SQL File",
<span id="line433"></span> "help8_x" =<span class="entity"><span>&amp;</span>gt;</span> "During the process for exporting to an SQL file, you may choose to wrap the queries around a TRANSACTION so that if an error occurs at any time during the importation process using the exported file, the database can be reverted to its previous state, preventing partially updated data from populating the database.",
<span id="line434"></span> "help9" =<span class="entity"><span>&amp;</span>gt;</span> "Add Comments to Exported SQL File",
<span id="line435"></span> "help9_x" =<span class="entity"><span>&amp;</span>gt;</span> "During the process for exporting to an SQL file, you may choose to include comments that explain each step of the process so that a human can better understand what is happening.",
<span id="line436"></span> "help10" =<span class="entity"><span>&amp;</span>gt;</span> "Partial Indexes",
<span id="line437"></span> "help10_x" =<span class="entity"><span>&amp;</span>gt;</span> "Partial indexes are indexes over a subset of the rows of a table specified by a WHERE clause. Note this requires at least SQLite 3.8.0 and database files with partial indexes won't be readable or writable by older versions. See the <span class="entity"><span>&amp;</span>lt;</span>a href='https://www.sqlite.org/partialindex.html' target='_blank'<span class="entity"><span>&amp;</span>gt;</span>SQLite documentation.<span class="entity"><span>&amp;</span>lt;</span>/a<span class="entity"><span>&amp;</span>gt;</span>",
<span id="line438"></span> "help11" =<span class="entity"><span>&amp;</span>gt;</span> "Maximum size of file uploads",
<span id="line439"></span> "help11_x" =<span class="entity"><span>&amp;</span>gt;</span> "The maximum size of file uploads is determined by three PHP settings: <span class="entity"><span>&amp;</span>lt;</span>em<span class="entity"><span>&amp;</span>gt;</span>upload_max_filesize<span class="entity"><span>&amp;</span>lt;</span>/em<span class="entity"><span>&amp;</span>gt;</span>, <span class="entity"><span>&amp;</span>lt;</span>em<span class="entity"><span>&amp;</span>gt;</span>post_max_size<span class="entity"><span>&amp;</span>lt;</span>/em<span class="entity"><span>&amp;</span>gt;</span> and <span class="entity"><span>&amp;</span>lt;</span>em<span class="entity"><span>&amp;</span>gt;</span>memory_limit<span class="entity"><span>&amp;</span>lt;</span>/em<span class="entity"><span>&amp;</span>gt;</span>. The smallest of these three limits the maximum size for file uploads. To upload larger files, adjust these values in your <span class="entity"><span>&amp;</span>lt;</span>em<span class="entity"><span>&amp;</span>gt;</span>php.ini<span class="entity"><span>&amp;</span>lt;</span>/em<span class="entity"><span>&amp;</span>gt;</span> file."
<span id="line440"></span>
<span id="line441"></span>);
<span id="line442"></span>
<span id="line443"></span>//!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!
<span id="line444"></span>//there is no reason for the average user to edit anything below this comment
<span id="line445"></span>//!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!
<span id="line446"></span>
<span id="line447"></span>//- Initialization
<span id="line448"></span>
<span id="line449"></span>// load optional configuration file
<span id="line450"></span>$config_filename = './phpliteadmin.config.php';
<span id="line451"></span>if (is_readable($config_filename)) {
<span id="line452"></span> include_once $config_filename;
<span id="line453"></span>}
<span id="line454"></span>
<span id="line455"></span>//constants 1
<span id="line456"></span>define("PROJECT", "phpLiteAdmin");
<span id="line457"></span>define("VERSION", "1.9.8.2");
<span id="line458"></span>define("FORCETYPE", false); //force the extension that will be used (set to false in almost all circumstances except debugging)
<span id="line459"></span>define("SYSTEMPASSWORD", $password); // Makes things easier.
<span id="line460"></span>define('PROJECT_URL', 'https://www.phpliteadmin.org/');
<span id="line461"></span>define('DONATE_URL', 'https://www.phpliteadmin.org/donate/');
<span id="line462"></span>define('VERSION_CHECK_URL', 'https://www.phpliteadmin.org/current_version.php');
<span id="line463"></span>define('PROJECT_BUGTRACKER_LINK', '<span class="entity"><span>&amp;</span>lt;</span>a href="https://bitbucket.org/phpliteadmin/public/issues?status=new<span class="entity"><span>&amp;</span>amp;</span>status=open" target="_blank"<span class="entity"><span>&amp;</span>gt;</span>https://bitbucket.org/phpliteadmin/public/issues?status=new<span class="entity"><span>&amp;</span>amp;</span>status=open<span class="entity"><span>&amp;</span>lt;</span>/a<span class="entity"><span>&amp;</span>gt;</span>');
<span id="line464"></span>define('PROJECT_INSTALL_LINK', '<span class="entity"><span>&amp;</span>lt;</span>a href="https://bitbucket.org/phpliteadmin/public/wiki/Installation" target="_blank"<span class="entity"><span>&amp;</span>gt;</span>https://bitbucket.org/phpliteadmin/public/wiki/Installation<span class="entity"><span>&amp;</span>lt;</span>/a<span class="entity"><span>&amp;</span>gt;</span>');
<span id="line465"></span>
<span id="line466"></span>// up here, we don't output anything. debug output might appear here which is catched by ob and thrown later
<span id="line467"></span>ob_start();
<span id="line468"></span>
<span id="line469"></span>// Resource output (css and javascript files)
<span id="line470"></span>// we get out of the main code as soon as possible, without inizializing the session
<span id="line471"></span>if (isset($_GET['resource'])) {
<span id="line472"></span> Resources::output($_GET['resource']);
<span id="line473"></span> exit();
<span id="line474"></span>}
<span id="line475"></span>
<span id="line476"></span>// version-number added so after updating, old session-data is not used anylonger
<span id="line477"></span>// cookies names cannot contain symbols, except underscores
<span id="line478"></span>define("COOKIENAME", preg_replace('/[^a-zA-Z0-9_]/', '_', $cookie_name . '_' . VERSION));
<span id="line479"></span>
<span id="line480"></span>$params = new GetParameters();
<span id="line481"></span>
<span id="line482"></span>if ($debug == true) {
<span id="line483"></span> ini_set("display_errors", 1);
<span id="line484"></span> error_reporting(E_STRICT | E_ALL);
<span id="line485"></span>} else {
<span id="line486"></span> @ini_set("display_errors", 0);
<span id="line487"></span>}
<span id="line488"></span>
<span id="line489"></span>// class MicroTimer (issue #146)
<span id="line490"></span>// wraps calls to microtime(), calculating the elapsed time and rounding output
<span id="line491"></span>//
<span id="line492"></span>class MicroTimer
<span id="line493"></span>{
<span id="line494"></span>
<span id="line495"></span> private $startTime, $stopTime;
<span id="line496"></span>
<span id="line497"></span> // creates and starts a timer
<span id="line498"></span> function __construct()
<span id="line499"></span> {
<span id="line500"></span> $this-<span class="entity"><span>&amp;</span>gt;</span>startTime = microtime(true);
<span id="line501"></span> }
<span id="line502"></span>
<span id="line503"></span> // stops a timer
<span id="line504"></span> public function stop()
<span id="line505"></span> {
<span id="line506"></span> $this-<span class="entity"><span>&amp;</span>gt;</span>stopTime = microtime(true);
<span id="line507"></span> }
<span id="line508"></span>
<span id="line509"></span> // returns the number of seconds from the timer's creation, or elapsed
<span id="line510"></span> // between creation and call to -<span class="entity"><span>&amp;</span>gt;</span>stop()
<span id="line511"></span> public function elapsed()
<span id="line512"></span> {
<span id="line513"></span> if ($this-<span class="entity"><span>&amp;</span>gt;</span>stopTime)
<span id="line514"></span> return round($this-<span class="entity"><span>&amp;</span>gt;</span>stopTime - $this-<span class="entity"><span>&amp;</span>gt;</span>startTime, 4);
<span id="line515"></span>
<span id="line516"></span> return round(microtime(true) - $this-<span class="entity"><span>&amp;</span>gt;</span>startTime, 4);
<span id="line517"></span> }
<span id="line518"></span>
<span id="line519"></span> // called when using a MicroTimer object as a string
<span id="line520"></span> public function __toString()
<span id="line521"></span> {
<span id="line522"></span> return (string)$this-<span class="entity"><span>&amp;</span>gt;</span>elapsed();
<span id="line523"></span> }
<span id="line524"></span>
<span id="line525"></span>}
<span id="line526"></span>
<span id="line527"></span>// start the timer to record page load time
<span id="line528"></span>$pageTimer = new MicroTimer();
<span id="line529"></span>
<span id="line530"></span>// load language file
<span id="line531"></span>if ($language != 'en') {
<span id="line532"></span> $temp_lang = $lang;
<span id="line533"></span> if (is_file('languages/lang_' . $language . '.php'))
<span id="line534"></span> include('languages/lang_' . $language . '.php');
<span id="line535"></span> elseif (is_file('lang_' . $language . '.php'))
<span id="line536"></span> include('lang_' . $language . '.php');
<span id="line537"></span> $lang = array_merge($temp_lang, $lang);
<span id="line538"></span> unset($temp_lang);
<span id="line539"></span>}
<span id="line540"></span>
<span id="line541"></span>// stripslashes if MAGIC QUOTES is turned on
<span id="line542"></span>// This is only a workaround. Please better turn off magic quotes!
<span id="line543"></span>// This code is from http://php.net/manual/en/security.magicquotes.disabling.php
<span id="line544"></span>/*if (get_magic_quotes_gpc()) {
<span id="line545"></span> $process = array(<span class="entity"><span>&amp;</span>amp;</span>$_GET, <span class="entity"><span>&amp;</span>amp;</span>$_POST, <span class="entity"><span>&amp;</span>amp;</span>$_COOKIE, <span class="entity"><span>&amp;</span>amp;</span>$_REQUEST);
<span id="line546"></span> while (list($key, $val) = each($process)) {
<span id="line547"></span> foreach ($val as $k =<span class="entity"><span>&amp;</span>gt;</span> $v) {
<span id="line548"></span> unset($process[$key][$k]);
<span id="line549"></span> if (is_array($v)) {
<span id="line550"></span> $process[$key][stripslashes($k)] = $v;
<span id="line551"></span> $process[] = <span class="entity"><span>&amp;</span>amp;</span>$process[$key][stripslashes($k)];
<span id="line552"></span> } else {
<span id="line553"></span> $process[$key][stripslashes($k)] = stripslashes($v);
<span id="line554"></span> }
<span id="line555"></span> }
<span id="line556"></span> }
<span id="line557"></span> unset($process);
<span id="line558"></span>}*/
<span id="line559"></span>
<span id="line560"></span>
<span id="line561"></span>//data types array
<span id="line562"></span>$sqlite_datatypes = array("INTEGER", "REAL", "TEXT", "BLOB", "NUMERIC", "BOOLEAN", "DATETIME");
<span id="line563"></span>
<span id="line564"></span>//available SQLite functions array (don't add anything here or there will be problems)
<span id="line565"></span>$sqlite_functions = array("abs", "hex", "length", "lower", "ltrim", "random", "round", "rtrim", "trim", "typeof", "upper");
<span id="line566"></span>
<span id="line567"></span>//- Support functions
<span id="line568"></span>
<span id="line569"></span>// for php <span class="entity"><span>&amp;</span>lt;</span> 5.6.0
<span id="line570"></span>if (!function_exists('hash_equals')) {
<span id="line571"></span> function hash_equals($str1, $str2)
<span id="line572"></span> {
<span id="line573"></span> if (strlen($str1) != strlen($str2))
<span id="line574"></span> return false;
<span id="line575"></span> else {
<span id="line576"></span> $res = $str1 ^ $str2;
<span id="line577"></span> $ret = 0;
<span id="line578"></span> for ($i = strlen($res) - 1; $i <span class="entity"><span>&amp;</span>gt;</span>= 0; $i--)
<span id="line579"></span> $ret |= ord($res[$i]);
<span id="line580"></span> return !$ret;
<span id="line581"></span> }
<span id="line582"></span> }
<span id="line583"></span>}
<span id="line584"></span>
<span id="line585"></span>//function that allows SQL delimiter to be ignored inside comments or strings
<span id="line586"></span>function explode_sql($delimiter, $sql)
<span id="line587"></span>{
<span id="line588"></span> $ign = array('"' =<span class="entity"><span>&amp;</span>gt;</span> '"', "'" =<span class="entity"><span>&amp;</span>gt;</span> "'", "/*" =<span class="entity"><span>&amp;</span>gt;</span> "*/", "--" =<span class="entity"><span>&amp;</span>gt;</span> "\n"); // Ignore sequences.
<span id="line589"></span> $out = array();
<span id="line590"></span> $last = 0;
<span id="line591"></span> $slen = strlen($sql);
<span id="line592"></span> $dlen = strlen($delimiter);
<span id="line593"></span> $i = 0;
<span id="line594"></span> while ($i <span class="entity"><span>&amp;</span>lt;</span> $slen) {
<span id="line595"></span> // Split on delimiter
<span id="line596"></span> if ($slen - $i <span class="entity"><span>&amp;</span>gt;</span>= $dlen <span class="entity"><span>&amp;</span>amp;</span><span class="entity"><span>&amp;</span>amp;</span> substr($sql, $i, $dlen) == $delimiter) {
<span id="line597"></span> array_push($out, substr($sql, $last, $i - $last));
<span id="line598"></span> $last = $i + $dlen;
<span id="line599"></span> $i += $dlen;
<span id="line600"></span> continue;
<span id="line601"></span> }
<span id="line602"></span> // Eat comments and string literals
<span id="line603"></span> foreach ($ign as $start =<span class="entity"><span>&amp;</span>gt;</span> $end) {
<span id="line604"></span> $ilen = strlen($start);
<span id="line605"></span> if ($slen - $i <span class="entity"><span>&amp;</span>gt;</span>= $ilen <span class="entity"><span>&amp;</span>amp;</span><span class="entity"><span>&amp;</span>amp;</span> substr($sql, $i, $ilen) == $start) {
<span id="line606"></span> $i += strlen($start);
<span id="line607"></span> $elen = strlen($end);
<span id="line608"></span> while ($i <span class="entity"><span>&amp;</span>lt;</span> $slen) {
<span id="line609"></span> if ($slen - $i <span class="entity"><span>&amp;</span>gt;</span>= $elen <span class="entity"><span>&amp;</span>amp;</span><span class="entity"><span>&amp;</span>amp;</span> substr($sql, $i, $elen) == $end) {
<span id="line610"></span> // SQL comment characters can be escaped by doubling the character. This recognizes and skips those.
<span id="line611"></span> if ($start == $end <span class="entity"><span>&amp;</span>amp;</span><span class="entity"><span>&amp;</span>amp;</span> $slen - $i <span class="entity"><span>&amp;</span>gt;</span>= $elen * 2 <span class="entity"><span>&amp;</span>amp;</span><span class="entity"><span>&amp;</span>amp;</span> substr($sql, $i, $elen * 2) == $end . $end) {
<span id="line612"></span> $i += $elen * 2;
<span id="line613"></span> continue;
<span id="line614"></span> } else {
<span id="line615"></span> $i += $elen;
<span id="line616"></span> continue 3;
<span id="line617"></span> }
<span id="line618"></span> }
<span id="line619"></span> $i++;
<span id="line620"></span> }
<span id="line621"></span> continue 2;
<span id="line622"></span> }
<span id="line623"></span> }
<span id="line624"></span> $i++;
<span id="line625"></span> }
<span id="line626"></span> if ($last <span class="entity"><span>&amp;</span>lt;</span> $slen)
<span id="line627"></span> array_push($out, substr($sql, $last, $slen - $last));
<span id="line628"></span> return $out;
<span id="line629"></span>}
<span id="line630"></span>
<span id="line631"></span>//function to scan entire directory tree and subdirectories
<span id="line632"></span>function dir_tree($dir)
<span id="line633"></span>{
<span id="line634"></span> $path = array();
<span id="line635"></span> $stack = array($dir);
<span id="line636"></span> while ($stack) {
<span id="line637"></span> $thisdir = array_pop($stack);
<span id="line638"></span> if ($dircont = scandir($thisdir)) {
<span id="line639"></span> $i = 0;
<span id="line640"></span> while (isset($dircont[$i])) {
<span id="line641"></span> if ($dircont[$i] !== '.' <span class="entity"><span>&amp;</span>amp;</span><span class="entity"><span>&amp;</span>amp;</span> $dircont[$i] !== '..') {
<span id="line642"></span> $current_file = $thisdir . DIRECTORY_SEPARATOR . $dircont[$i];
<span id="line643"></span> if (is_file($current_file)) {
<span id="line644"></span> $path[] = $thisdir . DIRECTORY_SEPARATOR . $dircont[$i];
<span id="line645"></span> } elseif (is_dir($current_file)) {
<span id="line646"></span> $path[] = $thisdir . DIRECTORY_SEPARATOR . $dircont[$i];
<span id="line647"></span> $stack[] = $current_file;
<span id="line648"></span> }
<span id="line649"></span> }
<span id="line650"></span> $i++;
<span id="line651"></span> }
<span id="line652"></span> }
<span id="line653"></span> }
<span id="line654"></span> return $path;
<span id="line655"></span>}
<span id="line656"></span>
<span id="line657"></span>//the function echo the help [?] links to the documentation
<span id="line658"></span>function helpLink($name)
<span id="line659"></span>{
<span id="line660"></span> global $lang;
<span id="line661"></span> return "<span class="entity"><span>&amp;</span>lt;</span>a href='?help=1' onclick='openHelp(\"" . $name . "\"); return false;' class='helpq' title='" . $lang['help'] . ": " . $name . "' target='_blank'<span class="entity"><span>&amp;</span>gt;</span><span class="entity"><span>&amp;</span>lt;</span>span<span class="entity"><span>&amp;</span>gt;</span>[?]<span class="entity"><span>&amp;</span>lt;</span>/span<span class="entity"><span>&amp;</span>gt;</span><span class="entity"><span>&amp;</span>lt;</span>/a<span class="entity"><span>&amp;</span>gt;</span>";
<span id="line662"></span>}
<span id="line663"></span>
<span id="line664"></span>// function to encode value into HTML just like htmlentities, but with adjusted default settings
<span id="line665"></span>function htmlencode($value, $flags = ENT_QUOTES, $encoding = "UTF-8")
<span id="line666"></span>{
<span id="line667"></span> return htmlentities($value, $flags, $encoding);
<span id="line668"></span>}
<span id="line669"></span>
<span id="line670"></span>// reduce string chars
<span id="line671"></span>function subString($str)
<span id="line672"></span>{
<span id="line673"></span> global $charsNum, $params;
<span id="line674"></span> if ($charsNum <span class="entity"><span>&amp;</span>gt;</span> 10 <span class="entity"><span>&amp;</span>amp;</span><span class="entity"><span>&amp;</span>amp;</span> (!isset($params-<span class="entity"><span>&amp;</span>gt;</span>fulltexts) || !$params-<span class="entity"><span>&amp;</span>gt;</span>fulltexts) <span class="entity"><span>&amp;</span>amp;</span><span class="entity"><span>&amp;</span>amp;</span> mb_strlen($str) <span class="entity"><span>&amp;</span>gt;</span> $charsNum) {
<span id="line675"></span> $str = mb_substr($str, 0, $charsNum) . '...';
<span id="line676"></span> }
<span id="line677"></span> return $str;
<span id="line678"></span>}
<span id="line679"></span>
<span id="line680"></span>// marks searchwords and htmlencodes correctly
<span id="line681"></span>function markSearchWords($input, $field, $search)
<span id="line682"></span>{
<span id="line683"></span> $output = htmlencode($input);
<span id="line684"></span> if (isset($search['values'][$field]) <span class="entity"><span>&amp;</span>amp;</span><span class="entity"><span>&amp;</span>amp;</span> is_array($search['values'][$field])) {
<span id="line685"></span> // build one regex that matches (all) search words
<span id="line686"></span> $regex = '/';
<span id="line687"></span> $vali = 0;
<span id="line688"></span> foreach ($search['values'][$field] as $searchValue) {
<span id="line689"></span> if ($search['operators'][$field] == 'LIKE' || $search['operators'][$field] == 'LIKE%')
<span id="line690"></span> $regex .= '(?:' . ($searchValue[0] == '%' ? '' : '^'); // does the searchvalue have to occur at the start?
<span id="line691"></span> $regex .= preg_quote(trim($searchValue, '%'), '/'); // the search value
<span id="line692"></span> if ($search['operators'][$field] == 'LIKE' || $search['operators'][$field] == 'LIKE%')
<span id="line693"></span> $regex .= (substr($searchValue, -1) == '%' ? '' : '$') . ')'; // does the searchvalue have to occur at the end?
<span id="line694"></span> if ($vali++ <span class="entity"><span>&amp;</span>lt;</span> count($search['values'][$field]))
<span id="line695"></span> $regex .= '|'; // there is another search value, so we add a |
<span id="line696"></span> }
<span id="line697"></span> $regex .= '/u';
<span id="line698"></span> // LIKE operator is not case sensitive, others are
<span id="line699"></span> if ($search['operators'][$field] == 'LIKE' || $search['operators'][$field] == 'LIKE%')
<span id="line700"></span> $regex .= 'i';
<span id="line701"></span>
<span id="line702"></span> // split the string into parts that match and should be highlighted and parts in between
<span id="line703"></span> // $fldBetweenParts: the parts that don't match (might contain empty strings)
<span id="line704"></span> $fldBetweenParts = preg_split($regex, $input);
<span id="line705"></span> // $fldFoundParts[0]: the parts that match
<span id="line706"></span> preg_match_all($regex, $input, $fldFoundParts);
<span id="line707"></span>
<span id="line708"></span> // stick the parts together
<span id="line709"></span> $output = '';
<span id="line710"></span> foreach ($fldBetweenParts as $index =<span class="entity"><span>&amp;</span>gt;</span> $betweenPart) {
<span id="line711"></span> $output .= htmlencode($betweenPart); // part that does not match (might be empty)
<span id="line712"></span> if (isset($fldFoundParts[0][$index]))
<span id="line713"></span> $output .= '<span class="entity"><span>&amp;</span>lt;</span>u class="found"<span class="entity"><span>&amp;</span>gt;</span>' . htmlencode($fldFoundParts[0][$index]) . '<span class="entity"><span>&amp;</span>lt;</span>/u<span class="entity"><span>&amp;</span>gt;</span>'; // the part that matched
<span id="line714"></span> }
<span id="line715"></span> }
<span id="line716"></span> return $output;
<span id="line717"></span>}
<span id="line718"></span>
<span id="line719"></span>// checks the (new) name of a database file
<span id="line720"></span>function checkDbName($name)
<span id="line721"></span>{
<span id="line722"></span> global $allowed_extensions;
<span id="line723"></span> $info = pathinfo($name);
<span id="line724"></span> if (isset($info['extension']) <span class="entity"><span>&amp;</span>amp;</span><span class="entity"><span>&amp;</span>amp;</span> !in_array($info['extension'], $allowed_extensions)) {
<span id="line725"></span> return false;
<span id="line726"></span> } else {
<span id="line727"></span> return (!is_file($name) <span class="entity"><span>&amp;</span>amp;</span><span class="entity"><span>&amp;</span>amp;</span> !is_dir($name));
<span id="line728"></span> }
<span id="line729"></span>
<span id="line730"></span>}
<span id="line731"></span>
<span id="line732"></span>// check whether a path is a db managed by this tool
<span id="line733"></span>// requires that $databases is already filled!
<span id="line734"></span>// returns the key of the db if managed, false otherwise.
<span id="line735"></span>function isManagedDB($path)
<span id="line736"></span>{
<span id="line737"></span> global $databases;
<span id="line738"></span> foreach ($databases as $db_key =<span class="entity"><span>&amp;</span>gt;</span> $database) {
<span id="line739"></span> if ($path === $database['path']) {
<span id="line740"></span> // a db we manage. Thats okay.
<span id="line741"></span> // return the key.
<span id="line742"></span> return $db_key;
<span id="line743"></span> }
<span id="line744"></span> }
<span id="line745"></span> // not a db we manage!
<span id="line746"></span> return false;
<span id="line747"></span>}
<span id="line748"></span>
<span id="line749"></span>// from a typename of a colun, get the type of the column's affinty
<span id="line750"></span>// see https://www.sqlite.org/datatype3.html section 2.1 for rules
<span id="line751"></span>function get_type_affinity($type)
<span id="line752"></span>{
<span id="line753"></span> if (preg_match("/INT/i", $type))
<span id="line754"></span> return "INTEGER";
<span id="line755"></span> else if (preg_match("/(?:CHAR|CLOB|TEXT)/i", $type))
<span id="line756"></span> return "TEXT";
<span id="line757"></span> else if (preg_match("/BLOB/i", $type) || $type == "")
<span id="line758"></span> return "NONE";
<span id="line759"></span> else if (preg_match("/(?:REAL|FLOA|DOUB)/i", $type))
<span id="line760"></span> return "REAL";
<span id="line761"></span> else
<span id="line762"></span> return "NUMERIC";
<span id="line763"></span>}
<span id="line764"></span>
<span id="line765"></span>
<span id="line766"></span>// Returns a file size limit in bytes based on the PHP upload_max_filesize
<span id="line767"></span>// post_max_size and memory_limit. Returns -1 in case of no limit.
<span id="line768"></span>function fileUploadMaxSize()
<span id="line769"></span>{
<span id="line770"></span> $max1 = parseSize(ini_get('post_max_size'));
<span id="line771"></span> $max2 = parseSize(ini_get('upload_max_filesize'));
<span id="line772"></span> $max3 = parseSize(ini_get('memory_limit'));
<span id="line773"></span> if ($max1 <span class="entity"><span>&amp;</span>gt;</span> 0 <span class="entity"><span>&amp;</span>amp;</span><span class="entity"><span>&amp;</span>amp;</span> ($max1 <span class="entity"><span>&amp;</span>lt;</span>= $max2 || $max2 == 0) <span class="entity"><span>&amp;</span>amp;</span><span class="entity"><span>&amp;</span>amp;</span> ($max1 <span class="entity"><span>&amp;</span>lt;</span>= $max3 || $max3 == -1))
<span id="line774"></span> return $max1;
<span id="line775"></span> elseif ($max2 <span class="entity"><span>&amp;</span>gt;</span> 0 <span class="entity"><span>&amp;</span>amp;</span><span class="entity"><span>&amp;</span>amp;</span> ($max2 <span class="entity"><span>&amp;</span>lt;</span>= $max1 || $max1 == 0) <span class="entity"><span>&amp;</span>amp;</span><span class="entity"><span>&amp;</span>amp;</span> ($max2 <span class="entity"><span>&amp;</span>lt;</span>= $max3 || $max3 == -1))
<span id="line776"></span> return $max2;
<span id="line777"></span> elseif ($max3 <span class="entity"><span>&amp;</span>gt;</span> -1 <span class="entity"><span>&amp;</span>amp;</span><span class="entity"><span>&amp;</span>amp;</span> ($max3 <span class="entity"><span>&amp;</span>lt;</span>= $max1 || $max1 == 0) <span class="entity"><span>&amp;</span>amp;</span><span class="entity"><span>&amp;</span>amp;</span> ($max3 <span class="entity"><span>&amp;</span>lt;</span>= $max2 || $max2 == 0))
<span id="line778"></span> return $max3;
<span id="line779"></span> else
<span id="line780"></span> return -1; // no limit
<span id="line781"></span>}
<span id="line782"></span>
<span id="line783"></span>// Parses given size string like "12M" into number of bytes
<span id="line784"></span>// based on https://api.drupal.org/api/drupal/core%21lib%21Drupal%21Component%21Utility%21Bytes.php/function/Bytes%3A%3AtoInt/8.2.x
<span id="line785"></span>function parseSize($size)
<span id="line786"></span>{
<span id="line787"></span> // Remove the non-unit characters from the size.
<span id="line788"></span> $unit = preg_replace('/[^bkmgtpezy]/i', '', $size);
<span id="line789"></span> // Remove the non-numeric characters from the size.
<span id="line790"></span> $size = preg_replace('/[^0-9\.]/', '', $size);
<span id="line791"></span> if ($unit) {
<span id="line792"></span> // Find the position of the unit in the ordered string which is the power
<span id="line793"></span> // of magnitude to multiply a kilobyte by.
<span id="line794"></span> return round($size * pow(1024, stripos('bkmgtpezy', $unit[0])));
<span id="line795"></span> } else {
<span id="line796"></span> return round($size);
<span id="line797"></span> }
<span id="line798"></span>}
<span id="line799"></span>
<span id="line800"></span>
<span id="line801"></span>//- Check user authentication, login and logout
<span id="line802"></span>$auth = new Authorization(); //create authorization object
<span id="line803"></span>
<span id="line804"></span>// check if user has attempted to log out
<span id="line805"></span>if (isset($_GET['logout']))
<span id="line806"></span> $auth-<span class="entity"><span>&amp;</span>gt;</span>revoke();
<span id="line807"></span>// check if user has attempted to log in
<span id="line808"></span>else if (isset($_POST['login']) <span class="entity"><span>&amp;</span>amp;</span><span class="entity"><span>&amp;</span>amp;</span> isset($_POST['password'])) {
<span id="line809"></span> $attempt = $auth-<span class="entity"><span>&amp;</span>gt;</span>attemptGrant($_POST['password'], isset($_POST['remember']));
<span id="line810"></span> $params-<span class="entity"><span>&amp;</span>gt;</span>redirect($attempt ? array() : array('failed' =<span class="entity"><span>&amp;</span>gt;</span> '1'));
<span id="line811"></span>}
<span id="line812"></span>
<span id="line813"></span>//- Actions on database files and bulk data
<span id="line814"></span>if ($auth-<span class="entity"><span>&amp;</span>gt;</span>isAuthorized()) {
<span id="line815"></span>
<span id="line816"></span> //- Create a new database
<span id="line817"></span> if (isset($_POST['new_dbname'])) {
<span id="line818"></span> if ($_POST['new_dbname'] == '')
<span id="line819"></span> $params-<span class="entity"><span>&amp;</span>gt;</span>redirect(array('table' =<span class="entity"><span>&amp;</span>gt;</span> null), $lang['err'] . ': ' . $lang['db_blank']);
<span id="line820"></span> else {
<span id="line821"></span> $str = preg_replace('@[^\w\-.]@u', '', $_POST['new_dbname']);
<span id="line822"></span> $dbname = $str;
<span id="line823"></span> $dbpath = $str;
<span id="line824"></span> if (checkDbName($dbname)) {
<span id="line825"></span> $tdata = array();
<span id="line826"></span> $tdata['name'] = $dbname;
<span id="line827"></span> $tdata['path'] = $directory . DIRECTORY_SEPARATOR . $dbpath;
<span id="line828"></span> if (isset($_POST['new_dbtype']))
<span id="line829"></span> $tdata['type'] = $_POST['new_dbtype'];
<span id="line830"></span> else
<span id="line831"></span> $tdata['type'] = 3;
<span id="line832"></span> $td = new Database($tdata);
<span id="line833"></span> $td-<span class="entity"><span>&amp;</span>gt;</span>query("VACUUM");
<span id="line834"></span> } else {
<span id="line835"></span> if (is_file($dbname) || is_dir($dbname))
<span id="line836"></span> $params-<span class="entity"><span>&amp;</span>gt;</span>redirect(array('view' =<span class="entity"><span>&amp;</span>gt;</span> 'structure'), $lang['err'] . ': ' . sprintf($lang['db_exists'], htmlencode($dbname)));
<span id="line837"></span> else
<span id="line838"></span> $params-<span class="entity"><span>&amp;</span>gt;</span>redirect(array('view' =<span class="entity"><span>&amp;</span>gt;</span> 'structure'), $lang['extension_not_allowed'] . ': ' . implode(', ', array_map('htmlencode', $allowed_extensions)) . '<span class="entity"><span>&amp;</span>lt;</span>br /<span class="entity"><span>&amp;</span>gt;</span>' . $lang['add_allowed_extension']);
<span id="line839"></span> }
<span id="line840"></span> }
<span id="line841"></span> }
<span id="line842"></span>
<span id="line843"></span> //- Scan a directory for databases
<span id="line844"></span> if ($directory !== false) {
<span id="line845"></span> if ($directory[strlen($directory) - 1] == DIRECTORY_SEPARATOR) //if user has a trailing slash in the directory, remove it
<span id="line846"></span> $directory = substr($directory, 0, strlen($directory) - 1);
<span id="line847"></span>
<span id="line848"></span> if (is_dir($directory)) //make sure the directory is valid
<span id="line849"></span> {
<span id="line850"></span> if ($subdirectories === true)
<span id="line851"></span> $arr = dir_tree($directory);
<span id="line852"></span> else
<span id="line853"></span> $arr = scandir($directory);
<span id="line854"></span> $databases = array();
<span id="line855"></span> $j = 0;
<span id="line856"></span> for ($i = 0; $i <span class="entity"><span>&amp;</span>lt;</span> sizeof($arr); $i++) //iterate through all the files in the databases
<span id="line857"></span> {
<span id="line858"></span> if ($subdirectories === false)
<span id="line859"></span> $arr[$i] = $directory . DIRECTORY_SEPARATOR . $arr[$i];
<span id="line860"></span>
<span id="line861"></span> if (@!is_file($arr[$i])) continue;
<span id="line862"></span> $con = file_get_contents($arr[$i], NULL, NULL, 0, 60);
<span id="line863"></span> if (strpos($con, "** This file contains an SQLite 2.1 database **", 0) !== false || strpos($con, "SQLite format 3", 0) !== false) {
<span id="line864"></span> $databases[$j]['path'] = $arr[$i];
<span id="line865"></span> if ($subdirectories === false)
<span id="line866"></span> $databases[$j]['name'] = basename($arr[$i]);
<span id="line867"></span> else
<span id="line868"></span> $databases[$j]['name'] = $arr[$i];
<span id="line869"></span> $databases[$j]['writable'] = is_writable($databases[$j]['path']);
<span id="line870"></span> $databases[$j]['writable_dir'] = is_writable(dirname($databases[$j]['path']));
<span id="line871"></span> $databases[$j]['readable'] = is_readable($databases[$j]['path']);
<span id="line872"></span> $j++;
<span id="line873"></span> }
<span id="line874"></span> }
<span id="line875"></span> // 22 August 2011: gkf fixed bug #50.
<span id="line876"></span> sort($databases);
<span id="line877"></span> if (isset($tdata)) {
<span id="line878"></span> foreach ($databases as $db_id =<span class="entity"><span>&amp;</span>gt;</span> $database) {
<span id="line879"></span> if ($database['path'] === $tdata['path']) {
<span id="line880"></span> $currentDB = $database;
<span id="line881"></span> $params-<span class="entity"><span>&amp;</span>gt;</span>database = $database['path'];
<span id="line882"></span> break;
<span id="line883"></span> }
<span id="line884"></span> }
<span id="line885"></span> }
<span id="line886"></span> } else //the directory is not valid - display error and exit
<span id="line887"></span> {
<span id="line888"></span> echo "<span class="entity"><span>&amp;</span>lt;</span>div class='confirm' style='margin:20px;'<span class="entity"><span>&amp;</span>gt;</span>" . $lang['not_dir'] . "<span class="entity"><span>&amp;</span>lt;</span>/div<span class="entity"><span>&amp;</span>gt;</span>";
<span id="line889"></span> exit();
<span id="line890"></span> }
<span id="line891"></span> } else {
<span id="line892"></span> for ($i = 0; $i <span class="entity"><span>&amp;</span>lt;</span> sizeof($databases); $i++) {
<span id="line893"></span> if (!file_exists($databases[$i]['path'])) {
<span id="line894"></span> // the file does not exist and will be created when clicked, if permissions allow to
<span id="line895"></span> $databases[$i]['writable'] = is_writable(dirname($databases[$i]['path']));
<span id="line896"></span> $databases[$i]['writable_dir'] = is_writable(dirname($databases[$i]['path']));
<span id="line897"></span> $databases[$i]['readable'] = is_writable(dirname($databases[$i]['path']));
<span id="line898"></span> } else {
<span id="line899"></span> $databases[$i]['writable'] = is_writable($databases[$i]['path']);
<span id="line900"></span> $databases[$i]['writable_dir'] = is_writable(dirname($databases[$i]['path']));
<span id="line901"></span> $databases[$i]['readable'] = is_readable($databases[$i]['path']);
<span id="line902"></span> }
<span id="line903"></span> }
<span id="line904"></span> sort($databases);
<span id="line905"></span> }
<span id="line906"></span> // we now have the $databases array set. Check whether selected DB is a managed Db (is in this array)
<span id="line907"></span> if (!isset($currentDB) <span class="entity"><span>&amp;</span>amp;</span><span class="entity"><span>&amp;</span>amp;</span> (isset($_GET['database']) || isset($_POST['database']))) {
<span id="line908"></span> $selected_db = (isset($_POST['database']) ? $_POST['database'] : $_GET['database']);
<span id="line909"></span> $db_key = isManagedDB($selected_db);
<span id="line910"></span> if ($db_key !== false) {
<span id="line911"></span> $currentDB = $databases[$db_key];
<span id="line912"></span> $params-<span class="entity"><span>&amp;</span>gt;</span>database = $databases[$db_key]['path'];
<span id="line913"></span> }
<span id="line914"></span> }
<span id="line915"></span>
<span id="line916"></span> //- Delete an existing database
<span id="line917"></span> if (isset($_GET['database_delete'])) {
<span id="line918"></span> $dbpath = $_POST['database_delete'];
<span id="line919"></span> // check whether $dbpath really is a db we manage
<span id="line920"></span> $checkDB = isManagedDB($dbpath);
<span id="line921"></span> if ($checkDB !== false) {
<span id="line922"></span> unlink($dbpath);
<span id="line923"></span> unset($params-<span class="entity"><span>&amp;</span>gt;</span>database);
<span id="line924"></span> unset($currentDB);
<span id="line925"></span> unset($databases[$checkDB]);
<span id="line926"></span> } else die($lang['err'] . ': ' . $lang['delete_only_managed']);
<span id="line927"></span> }
<span id="line928"></span>
<span id="line929"></span> //- Rename an existing database
<span id="line930"></span> if (isset($_GET['database_rename'])) {
<span id="line931"></span> $oldpath = $_POST['oldname'];
<span id="line932"></span> $newpath = $_POST['newname'];
<span id="line933"></span> $oldpath_parts = pathinfo($oldpath);
<span id="line934"></span> $newpath_parts = pathinfo($newpath);
<span id="line935"></span> // only rename?
<span id="line936"></span> $newpath = $oldpath_parts['dirname'] . DIRECTORY_SEPARATOR . basename($_POST['newname']);
<span id="line937"></span> if ($newpath != $_POST['newname'] <span class="entity"><span>&amp;</span>amp;</span><span class="entity"><span>&amp;</span>amp;</span> $subdirectories) {
<span id="line938"></span> // it seems that the file should not only be renamed but additionally moved.
<span id="line939"></span> // we need to make sure it stays within $directory...
<span id="line940"></span> $new_realpath = realpath($newpath_parts['dirname']) . DIRECTORY_SEPARATOR;
<span id="line941"></span> $directory_realpath = realpath($directory) . DIRECTORY_SEPARATOR;
<span id="line942"></span> if (strpos($new_realpath, $directory_realpath) === 0) {
<span id="line943"></span> // its okay, the new directory is within $directory
<span id="line944"></span> $newpath = $_POST['newname'];
<span id="line945"></span> } else $params-<span class="entity"><span>&amp;</span>gt;</span>redirect(array('view' =<span class="entity"><span>&amp;</span>gt;</span> 'rename'), $lang['err'] . ': ' . $lang['db_moved_outside']);
<span id="line946"></span> }
<span id="line947"></span>
<span id="line948"></span> if (checkDbName($newpath)) {
<span id="line949"></span> $checkDB = isManagedDB($oldpath);
<span id="line950"></span> if ($checkDB !== false) {
<span id="line951"></span> rename($oldpath, $newpath);
<span id="line952"></span> $databases[$checkDB]['path'] = $newpath;
<span id="line953"></span> $databases[$checkDB]['name'] = basename($newpath);
<span id="line954"></span> $currentDB = $databases[$checkDB];
<span id="line955"></span> $params-<span class="entity"><span>&amp;</span>gt;</span>database = $databases[$checkDB]['path'];
<span id="line956"></span> $params-<span class="entity"><span>&amp;</span>gt;</span>redirect(array('view' =<span class="entity"><span>&amp;</span>gt;</span> 'rename'), sprintf($lang['db_renamed'], htmlencode($oldpath)) . " '" . htmlencode($newpath) . "'.");
<span id="line957"></span> } else $params-<span class="entity"><span>&amp;</span>gt;</span>redirect(array('view' =<span class="entity"><span>&amp;</span>gt;</span> 'rename'), $lang['err'] . ': ' . $lang['rename_only_managed']);
<span id="line958"></span> } else {
<span id="line959"></span> if (is_file($newpath) || is_dir($newpath))
<span id="line960"></span> $params-<span class="entity"><span>&amp;</span>gt;</span>redirect(array('view' =<span class="entity"><span>&amp;</span>gt;</span> 'rename'), $lang['err'] . ": " . sprintf($lang['db_exists'], htmlencode($newpath)));
<span id="line961"></span> else
<span id="line962"></span> $params-<span class="entity"><span>&amp;</span>gt;</span>redirect(array('view' =<span class="entity"><span>&amp;</span>gt;</span> 'rename'), $lang['err'] . ": " . $lang['extension_not_allowed'] . ': ' . implode(', ', array_map('htmlencode', $allowed_extensions)) . '<span class="entity"><span>&amp;</span>lt;</span>br /<span class="entity"><span>&amp;</span>gt;</span>' . $lang['add_allowed_extension']);
<span id="line963"></span> }
<span id="line964"></span> }
<span id="line965"></span>
<span id="line966"></span>
<span id="line967"></span> //- Export (download a dump) an existing database
<span id="line968"></span> if (isset($_POST['export'])) {
<span id="line969"></span> ob_end_clean();
<span id="line970"></span> $export_filename = str_replace(array("\r", "\n"), '', $_POST['filename']); // against http header injection (php <span class="entity"><span>&amp;</span>lt;</span> 5.1.2 only)
<span id="line971"></span> if ($_POST['export_type'] == "sql") {
<span id="line972"></span> header('Content-Type: text/sql');
<span id="line973"></span> header('Content-Disposition: attachment; filename="' . $export_filename . '.' . $_POST['export_type'] . '";');
<span id="line974"></span> if (isset($_POST['tables']))
<span id="line975"></span> $tables = $_POST['tables'];
<span id="line976"></span> else {
<span id="line977"></span> $tables = array();
<span id="line978"></span> $tables[0] = $_POST['single_table'];
<span id="line979"></span> }
<span id="line980"></span> $drop = isset($_POST['drop']);
<span id="line981"></span> $structure = isset($_POST['structure']);
<span id="line982"></span> $data = isset($_POST['data']);
<span id="line983"></span> $transaction = isset($_POST['transaction']);
<span id="line984"></span> $comments = isset($_POST['comments']);
<span id="line985"></span> $db = new Database($currentDB);
<span id="line986"></span> echo $db-<span class="entity"><span>&amp;</span>gt;</span>export_sql($tables, $drop, $structure, $data, $transaction, $comments);
<span id="line987"></span> } else if ($_POST['export_type'] == "csv") {
<span id="line988"></span> header("Content-type: application/csv");
<span id="line989"></span> header('Content-Disposition: attachment; filename="' . $export_filename . '.' . $_POST['export_type'] . '";');
<span id="line990"></span> header("Pragma: no-cache");
<span id="line991"></span> header("Expires: 0");
<span id="line992"></span> if (isset($_POST['tables']))
<span id="line993"></span> $tables = $_POST['tables'];
<span id="line994"></span> else {
<span id="line995"></span> $tables = array();
<span id="line996"></span> $tables[0] = $_POST['single_table'];
<span id="line997"></span> }
<span id="line998"></span> $field_terminate = $_POST['export_csv_fieldsterminated'];
<span id="line999"></span> $field_enclosed = $_POST['export_csv_fieldsenclosed'];
<span id="line1000"></span> $field_escaped = $_POST['export_csv_fieldsescaped'];
<span id="line1001"></span> $null = $_POST['export_csv_replacenull'];
<span id="line1002"></span> $crlf = isset($_POST['export_csv_crlf']);
<span id="line1003"></span> $fields_in_first_row = isset($_POST['export_csv_fieldnames']);
<span id="line1004"></span> $db = new Database($currentDB);
<span id="line1005"></span> echo $db-<span class="entity"><span>&amp;</span>gt;</span>export_csv($tables, $field_terminate, $field_enclosed, $field_escaped, $null, $crlf, $fields_in_first_row);
<span id="line1006"></span> }
<span id="line1007"></span> exit();
<span id="line1008"></span> }
<span id="line1009"></span>
<span id="line1010"></span> //- Import a file into an existing database
<span id="line1011"></span> if (isset($_POST['import'])) {
<span id="line1012"></span> $db = new Database($currentDB);
<span id="line1013"></span> $db-<span class="entity"><span>&amp;</span>gt;</span>registerUserFunction($custom_functions);
<span id="line1014"></span> if ($_POST['import_type'] == "sql") {
<span id="line1015"></span> $data = file_get_contents($_FILES["file"]["tmp_name"]);
<span id="line1016"></span> $importSuccess = $db-<span class="entity"><span>&amp;</span>gt;</span>import_sql($data);
<span id="line1017"></span> } else {
<span id="line1018"></span> $field_terminate = $_POST['import_csv_fieldsterminated'];
<span id="line1019"></span> $field_enclosed = $_POST['import_csv_fieldsenclosed'];
<span id="line1020"></span> $field_escaped = $_POST['import_csv_fieldsescaped'];
<span id="line1021"></span> $null = $_POST['import_csv_replacenull'];
<span id="line1022"></span> $fields_in_first_row = isset($_POST['import_csv_fieldnames']);
<span id="line1023"></span> if (isset($_POST['single_table']) <span class="entity"><span>&amp;</span>amp;</span><span class="entity"><span>&amp;</span>amp;</span> $_POST['single_table'] != '')
<span id="line1024"></span> $table = $_POST['single_table'];
<span id="line1025"></span> else {
<span id="line1026"></span> $table = basename($_FILES["file"]["name"], ".csv");
<span id="line1027"></span> $i = "";
<span id="line1028"></span> while ($db-<span class="entity"><span>&amp;</span>gt;</span>getTypeOfTable($table . $i) != "") {
<span id="line1029"></span> if ($i == "")
<span id="line1030"></span> $i = 2;
<span id="line1031"></span> else
<span id="line1032"></span> $i++;
<span id="line1033"></span> }
<span id="line1034"></span> $table = $table . $i;
<span id="line1035"></span> }
<span id="line1036"></span> $importSuccess = $db-<span class="entity"><span>&amp;</span>gt;</span>import_csv($_FILES["file"]["tmp_name"], $table, $field_terminate, $field_enclosed, $field_escaped, $null, $fields_in_first_row);
<span id="line1037"></span> }
<span id="line1038"></span> }
<span id="line1039"></span> //- Download (backup) a database file (as SQLite file, not as dump)
<span id="line1040"></span> if (isset($_GET['download']) <span class="entity"><span>&amp;</span>amp;</span><span class="entity"><span>&amp;</span>amp;</span> isManagedDB($_GET['download']) !== false) {
<span id="line1041"></span> ob_end_clean();
<span id="line1042"></span> header("Content-type: application/octet-stream");
<span id="line1043"></span> header('Content-Disposition: attachment; filename="' . basename($_GET['download']) . '";');
<span id="line1044"></span> header("Pragma: no-cache");
<span id="line1045"></span> header("Expires: 0");
<span id="line1046"></span> readfile($_GET['download']);
<span id="line1047"></span> exit;
<span id="line1048"></span> }
<span id="line1049"></span>
<span id="line1050"></span> //- Select database (from session or first available)
<span id="line1051"></span> if (!isset($currentDB) <span class="entity"><span>&amp;</span>amp;</span><span class="entity"><span>&amp;</span>amp;</span> count($databases) <span class="entity"><span>&amp;</span>gt;</span> 0) {
<span id="line1052"></span> //set the current database to the first existing one in the array (default)
<span id="line1053"></span> $currentDB = reset($databases);
<span id="line1054"></span> $params-<span class="entity"><span>&amp;</span>gt;</span>database = $currentDB['path'];
<span id="line1055"></span> }
<span id="line1056"></span>
<span id="line1057"></span> if (isset($currentDB)) {
<span id="line1058"></span> //- Open database (creates a Database object)
<span id="line1059"></span> $db = new Database($currentDB); //create the Database object
<span id="line1060"></span> $db-<span class="entity"><span>&amp;</span>gt;</span>registerUserFunction($custom_functions);
<span id="line1061"></span> }
<span id="line1062"></span>
<span id="line1063"></span> // collect parameters early, just once
<span id="line1064"></span> $target_table = isset($_GET['table']) ? $_GET['table'] : null;
<span id="line1065"></span> // are we working on a view? let's check once here
<span id="line1066"></span> $target_table_type = !is_null($target_table) ? $db-<span class="entity"><span>&amp;</span>gt;</span>getTypeOfTable($target_table) : null;
<span id="line1067"></span> if (is_null($target_table_type) <span class="entity"><span>&amp;</span>amp;</span><span class="entity"><span>&amp;</span>amp;</span> !is_null($target_table))
<span id="line1068"></span> $params-<span class="entity"><span>&amp;</span>gt;</span>redirect(array('table' =<span class="entity"><span>&amp;</span>gt;</span> null), $lang['err'] . ': ' . sprintf($lang['tbl_inexistent'], htmlencode($target_table)));
<span id="line1069"></span> $params-<span class="entity"><span>&amp;</span>gt;</span>table = $target_table;
<span id="line1070"></span>
<span id="line1071"></span> // initialize / change fulltexts and numrows parameter
<span id="line1072"></span> if (isset($_GET['fulltexts']))
<span id="line1073"></span> $params-<span class="entity"><span>&amp;</span>gt;</span>fulltexts = ($_GET['fulltexts'] ? 1 : 0);
<span id="line1074"></span> else
<span id="line1075"></span> $params-<span class="entity"><span>&amp;</span>gt;</span>fulltexts = 0;
<span id="line1076"></span>
<span id="line1077"></span> if (isset($_GET['numRows']) <span class="entity"><span>&amp;</span>amp;</span><span class="entity"><span>&amp;</span>amp;</span> intval($_GET['numRows']) <span class="entity"><span>&amp;</span>gt;</span> 0)
<span id="line1078"></span> $params-<span class="entity"><span>&amp;</span>gt;</span>numRows = intval($_GET['numRows']);
<span id="line1079"></span> else
<span id="line1080"></span> $params-<span class="entity"><span>&amp;</span>gt;</span>numRows = $rowsNum;
<span id="line1081"></span>
<span id="line1082"></span> //- Switch on $_GET['action'] for operations without output
<span id="line1083"></span> if (isset($_GET['action']) <span class="entity"><span>&amp;</span>amp;</span><span class="entity"><span>&amp;</span>amp;</span> isset($_GET['confirm'])) {
<span id="line1084"></span> switch ($_GET['action']) {
<span id="line1085"></span> //- Table actions
<span id="line1086"></span>
<span id="line1087"></span> //- Create table (=table_create)
<span id="line1088"></span> case "table_create":
<span id="line1089"></span> $num = intval($_POST['rows']);
<span id="line1090"></span> $name = $_POST['tablename'];
<span id="line1091"></span> $primary_keys = array();
<span id="line1092"></span> for ($i = 0; $i <span class="entity"><span>&amp;</span>lt;</span> $num; $i++) {
<span id="line1093"></span> if ($_POST[$i . '_field'] != "" <span class="entity"><span>&amp;</span>amp;</span><span class="entity"><span>&amp;</span>amp;</span> isset($_POST[$i . '_primarykey'])) {
<span id="line1094"></span> $primary_keys[] = $_POST[$i . '_field'];
<span id="line1095"></span> }
<span id="line1096"></span> }
<span id="line1097"></span> $query = "CREATE TABLE " . $db-<span class="entity"><span>&amp;</span>gt;</span>quote($name) . " (";
<span id="line1098"></span> for ($i = 0; $i <span class="entity"><span>&amp;</span>lt;</span> $num; $i++) {
<span id="line1099"></span> if ($_POST[$i . '_field'] != "") {
<span id="line1100"></span> $query .= $db-<span class="entity"><span>&amp;</span>gt;</span>quote($_POST[$i . '_field']) . " ";
<span id="line1101"></span> $query .= $_POST[$i . '_type'] . " ";
<span id="line1102"></span> if (isset($_POST[$i . '_primarykey'])) {
<span id="line1103"></span> if (count($primary_keys) == 1) {
<span id="line1104"></span> $query .= "PRIMARY KEY ";
<span id="line1105"></span> if (isset($_POST[$i . '_autoincrement']) <span class="entity"><span>&amp;</span>amp;</span><span class="entity"><span>&amp;</span>amp;</span> $db-<span class="entity"><span>&amp;</span>gt;</span>getType() != "SQLiteDatabase")
<span id="line1106"></span> $query .= "AUTOINCREMENT ";
<span id="line1107"></span> }
<span id="line1108"></span> $query .= "NOT NULL ";
<span id="line1109"></span> }
<span id="line1110"></span> if (!isset($_POST[$i . '_primarykey']) <span class="entity"><span>&amp;</span>amp;</span><span class="entity"><span>&amp;</span>amp;</span> isset($_POST[$i . '_notnull']))
<span id="line1111"></span> $query .= "NOT NULL ";
<span id="line1112"></span> if ($_POST[$i . '_defaultoption'] != 'defined' <span class="entity"><span>&amp;</span>amp;</span><span class="entity"><span>&amp;</span>amp;</span> $_POST[$i . '_defaultoption'] != 'none' <span class="entity"><span>&amp;</span>amp;</span><span class="entity"><span>&amp;</span>amp;</span> $_POST[$i . '_defaultoption'] != 'expr')
<span id="line1113"></span> $query .= "DEFAULT " . $_POST[$i . '_defaultoption'] . " ";
<span id="line1114"></span> elseif ($_POST[$i . '_defaultoption'] == 'expr')
<span id="line1115"></span> $query .= "DEFAULT (" . $_POST[$i . '_defaultvalue'] . ") ";
<span id="line1116"></span> elseif (isset($_POST[$i . '_defaultvalue']) <span class="entity"><span>&amp;</span>amp;</span><span class="entity"><span>&amp;</span>amp;</span> $_POST[$i . '_defaultoption'] == 'defined') {
<span id="line1117"></span> $typeAffinity = get_type_affinity($_POST[$i . '_type']);
<span id="line1118"></span> if (($typeAffinity == "INTEGER" || $typeAffinity == "REAL" || $typeAffinity == "NUMERIC") <span class="entity"><span>&amp;</span>amp;</span><span class="entity"><span>&amp;</span>amp;</span> is_numeric($_POST[$i . '_defaultvalue']))
<span id="line1119"></span> $query .= "DEFAULT " . $_POST[$i . '_defaultvalue'] . " ";
<span id="line1120"></span> else
<span id="line1121"></span> $query .= "DEFAULT " . $db-<span class="entity"><span>&amp;</span>gt;</span>quote($_POST[$i . '_defaultvalue']) . " ";
<span id="line1122"></span> }
<span id="line1123"></span> $query = substr($query, 0, -1);
<span id="line1124"></span> $query .= ", ";
<span id="line1125"></span> }
<span id="line1126"></span> }
<span id="line1127"></span> if (count($primary_keys) <span class="entity"><span>&amp;</span>gt;</span> 1) {
<span id="line1128"></span> $compound_key = "";
<span id="line1129"></span> foreach ($primary_keys as $primary_key) {
<span id="line1130"></span> $compound_key .= ($compound_key == "" ? "" : ", ") . $db-<span class="entity"><span>&amp;</span>gt;</span>quote($primary_key);
<span id="line1131"></span> }
<span id="line1132"></span> $query .= "PRIMARY KEY (" . $compound_key . "), ";
<span id="line1133"></span> }
<span id="line1134"></span> $query = substr($query, 0, -2);
<span id="line1135"></span> $query .= ")";
<span id="line1136"></span> $result = $db-<span class="entity"><span>&amp;</span>gt;</span>query($query);
<span id="line1137"></span> if ($result === false)
<span id="line1138"></span> $completed = $db-<span class="entity"><span>&amp;</span>gt;</span>getError(true);
<span id="line1139"></span> else
<span id="line1140"></span> $completed = $lang['tbl'] . " '" . htmlencode($_POST['tablename']) . "' " . $lang['created'] . ".<span class="entity"><span>&amp;</span>lt;</span>br/<span class="entity"><span>&amp;</span>gt;</span><span class="entity"><span>&amp;</span>lt;</span>span style='font-size:11px;'<span class="entity"><span>&amp;</span>gt;</span>" . htmlencode($query) . "<span class="entity"><span>&amp;</span>lt;</span>/span<span class="entity"><span>&amp;</span>gt;</span>";
<span id="line1141"></span> $params-<span class="entity"><span>&amp;</span>gt;</span>redirect(($result === false ? array() : array('action' =<span class="entity"><span>&amp;</span>gt;</span> 'column_view', 'table' =<span class="entity"><span>&amp;</span>gt;</span> $name)), $completed);
<span id="line1142"></span> break;
<span id="line1143"></span>
<span id="line1144"></span> //- Empty table (=table_empty)
<span id="line1145"></span> case "table_empty":
<span id="line1146"></span> $query1 = "DELETE FROM " . $db-<span class="entity"><span>&amp;</span>gt;</span>quote_id($_GET['table']) . ";";
<span id="line1147"></span> $result1 = $db-<span class="entity"><span>&amp;</span>gt;</span>query($query1);
<span id="line1148"></span> if ($result1 === false)
<span id="line1149"></span> $completed = $db-<span class="entity"><span>&amp;</span>gt;</span>getError(true);
<span id="line1150"></span> if (isset($_POST['vacuum']) <span class="entity"><span>&amp;</span>amp;</span><span class="entity"><span>&amp;</span>amp;</span> $_POST['vacuum']) {
<span id="line1151"></span> $query2 = "VACUUM;";
<span id="line1152"></span> $result2 = $db-<span class="entity"><span>&amp;</span>gt;</span>query($query2);
<span id="line1153"></span> } else
<span id="line1154"></span> $query2 = "";
<span id="line1155"></span> if ($result1 !== false)
<span id="line1156"></span> $completed = $lang['tbl'] . " '" . htmlencode($_GET['table']) . "' " . $lang['emptied'] . ".<span class="entity"><span>&amp;</span>lt;</span>br/<span class="entity"><span>&amp;</span>gt;</span><span class="entity"><span>&amp;</span>lt;</span>span style='font-size:11px;'<span class="entity"><span>&amp;</span>gt;</span>" . htmlencode($query1) . "<span class="entity"><span>&amp;</span>lt;</span>br /<span class="entity"><span>&amp;</span>gt;</span>" . htmlencode($query2) . "<span class="entity"><span>&amp;</span>lt;</span>/span<span class="entity"><span>&amp;</span>gt;</span>";
<span id="line1157"></span> $params-<span class="entity"><span>&amp;</span>gt;</span>redirect(($result1 === false ? array() : array('action' =<span class="entity"><span>&amp;</span>gt;</span> 'row_view')), $completed);
<span id="line1158"></span> break;
<span id="line1159"></span>
<span id="line1160"></span> //- Create view (=view_create)
<span id="line1161"></span> case "view_create":
<span id="line1162"></span> $query = "CREATE VIEW " . $db-<span class="entity"><span>&amp;</span>gt;</span>quote($_POST['viewname']) . " AS " . $_POST['select'];
<span id="line1163"></span> $result = $db-<span class="entity"><span>&amp;</span>gt;</span>query($query);
<span id="line1164"></span> if ($result === false)
<span id="line1165"></span> $completed = $db-<span class="entity"><span>&amp;</span>gt;</span>getError(true);
<span id="line1166"></span> else
<span id="line1167"></span> $completed = $lang['view'] . " '" . htmlencode($_POST['viewname']) . "' " . $lang['created'] . ".<span class="entity"><span>&amp;</span>lt;</span>br/<span class="entity"><span>&amp;</span>gt;</span><span class="entity"><span>&amp;</span>lt;</span>span style='font-size:11px;'<span class="entity"><span>&amp;</span>gt;</span>" . htmlencode($query) . "<span class="entity"><span>&amp;</span>lt;</span>/span<span class="entity"><span>&amp;</span>gt;</span>";
<span id="line1168"></span> $params-<span class="entity"><span>&amp;</span>gt;</span>redirect(($result === false ? array() : array('action' =<span class="entity"><span>&amp;</span>gt;</span> 'column_view', 'table' =<span class="entity"><span>&amp;</span>gt;</span> $_POST['viewname'])), $completed);
<span id="line1169"></span> break;
<span id="line1170"></span>
<span id="line1171"></span> //- Drop table (=table_drop)
<span id="line1172"></span> case "table_drop":
<span id="line1173"></span> $query1 = "DROP TABLE " . $db-<span class="entity"><span>&amp;</span>gt;</span>quote_id($_GET['table']) . ";";
<span id="line1174"></span> $result1 = $db-<span class="entity"><span>&amp;</span>gt;</span>query($query1);
<span id="line1175"></span> if ($result1 === false)
<span id="line1176"></span> $completed = $db-<span class="entity"><span>&amp;</span>gt;</span>getError(true);
<span id="line1177"></span> if (isset($_POST['vacuum']) <span class="entity"><span>&amp;</span>amp;</span><span class="entity"><span>&amp;</span>amp;</span> $_POST['vacuum']) {
<span id="line1178"></span> $query2 = "VACUUM;";
<span id="line1179"></span> $result2 = $db-<span class="entity"><span>&amp;</span>gt;</span>query($query2);
<span id="line1180"></span> } else
<span id="line1181"></span> $query2 = "";
<span id="line1182"></span> if ($result1 !== false) {
<span id="line1183"></span> $target_table = null;
<span id="line1184"></span> $completed = $lang['tbl'] . " '" . htmlencode($_GET['table']) . "' " . $lang['dropped'] . ".<span class="entity"><span>&amp;</span>lt;</span>br/<span class="entity"><span>&amp;</span>gt;</span><span class="entity"><span>&amp;</span>lt;</span>span style='font-size:11px;'<span class="entity"><span>&amp;</span>gt;</span>" . htmlencode($query1) . "<span class="entity"><span>&amp;</span>lt;</span>br /<span class="entity"><span>&amp;</span>gt;</span>" . htmlencode($query2) . "<span class="entity"><span>&amp;</span>lt;</span>/span<span class="entity"><span>&amp;</span>gt;</span>";;
<span id="line1185"></span> }
<span id="line1186"></span> $params-<span class="entity"><span>&amp;</span>gt;</span>redirect(array('table' =<span class="entity"><span>&amp;</span>gt;</span> null), $completed);
<span id="line1187"></span> break;
<span id="line1188"></span>
<span id="line1189"></span> //- Drop view (=view_drop)
<span id="line1190"></span> case "view_drop":
<span id="line1191"></span> $query = "DROP VIEW " . $db-<span class="entity"><span>&amp;</span>gt;</span>quote_id($_POST['viewname']);
<span id="line1192"></span> $result = $db-<span class="entity"><span>&amp;</span>gt;</span>query($query);
<span id="line1193"></span> if ($result === false)
<span id="line1194"></span> $completed = $db-<span class="entity"><span>&amp;</span>gt;</span>getError(true);
<span id="line1195"></span> else
<span id="line1196"></span> $completed = $lang['view'] . " '" . htmlencode($_POST['viewname']) . "' " . $lang['dropped'] . ".<span class="entity"><span>&amp;</span>lt;</span>br/<span class="entity"><span>&amp;</span>gt;</span><span class="entity"><span>&amp;</span>lt;</span>span style='font-size:11px;'<span class="entity"><span>&amp;</span>gt;</span>" . htmlencode($query) . "<span class="entity"><span>&amp;</span>lt;</span>/span<span class="entity"><span>&amp;</span>gt;</span>";
<span id="line1197"></span> $params-<span class="entity"><span>&amp;</span>gt;</span>redirect(array('table' =<span class="entity"><span>&amp;</span>gt;</span> null), $completed);
<span id="line1198"></span> break;
<span id="line1199"></span>
<span id="line1200"></span> //- Rename table (=table_rename)
<span id="line1201"></span> case "table_rename":
<span id="line1202"></span> $query = "ALTER TABLE " . $db-<span class="entity"><span>&amp;</span>gt;</span>quote_id($_GET['table']) . " RENAME TO " . $db-<span class="entity"><span>&amp;</span>gt;</span>quote($_POST['newname']);
<span id="line1203"></span> $type = $db-<span class="entity"><span>&amp;</span>gt;</span>getTypeOfTable($_GET['table']);
<span id="line1204"></span> if ($db-<span class="entity"><span>&amp;</span>gt;</span>getVersion() == 3 <span class="entity"><span>&amp;</span>amp;</span><span class="entity"><span>&amp;</span>amp;</span> $type == 'table' // SQLite 3 can rename tables, not views 
<span id="line1205"></span> // In SQL(ite) table names are case-insensitve, so changing is not supported by SQLite.
<span id="line1206"></span> // But table names are stored and displayed case sensitive, so we use the workaround for case sensitive renaming.
<span id="line1207"></span> <span class="entity"><span>&amp;</span>amp;</span><span class="entity"><span>&amp;</span>amp;</span> !($_GET['table'] !== $_POST['newname'] <span class="entity"><span>&amp;</span>amp;</span><span class="entity"><span>&amp;</span>amp;</span> strtolower($_GET['table']) === strtolower($_POST['newname']))
<span id="line1208"></span> )
<span id="line1209"></span> $result = $db-<span class="entity"><span>&amp;</span>gt;</span>query($query, true);
<span id="line1210"></span> else
<span id="line1211"></span> // Workaround can rename tables of sqlite2 and views of both sqlite versions. Can also do case sensitive renames. 
<span id="line1212"></span> $result = $db-<span class="entity"><span>&amp;</span>gt;</span>query($query, false);
<span id="line1213"></span> if ($result === false)
<span id="line1214"></span> $completed = $db-<span class="entity"><span>&amp;</span>gt;</span>getError(true);
<span id="line1215"></span> else {
<span id="line1216"></span> $completed = $lang['tbl'] . " '" . htmlencode($_GET['table']) . "' " . $lang['renamed'] . " '" . htmlencode($_POST['newname']) . "'.<span class="entity"><span>&amp;</span>lt;</span>br/<span class="entity"><span>&amp;</span>gt;</span><span class="entity"><span>&amp;</span>lt;</span>span style='font-size:11px;'<span class="entity"><span>&amp;</span>gt;</span>" . htmlencode($query) . "<span class="entity"><span>&amp;</span>lt;</span>/span<span class="entity"><span>&amp;</span>gt;</span>";
<span id="line1217"></span> $target_table = $_POST['newname'];
<span id="line1218"></span> }
<span id="line1219"></span> $params-<span class="entity"><span>&amp;</span>gt;</span>redirect(array('action' =<span class="entity"><span>&amp;</span>gt;</span> 'row_view', 'table' =<span class="entity"><span>&amp;</span>gt;</span> $_POST['newname']), $completed);
<span id="line1220"></span> break;
<span id="line1221"></span>
<span id="line1222"></span> //- Search table (=table_search)
<span id="line1223"></span> case "table_search":
<span id="line1224"></span> $searchValues = array();
<span id="line1225"></span> $searchOperators = array();
<span id="line1226"></span>
<span id="line1227"></span> $tableInfo = $db-<span class="entity"><span>&amp;</span>gt;</span>getTableInfo($target_table);
<span id="line1228"></span> $j = 0;
<span id="line1229"></span> $whereExpr = array();
<span id="line1230"></span> for ($i = 0; $i <span class="entity"><span>&amp;</span>lt;</span> sizeof($tableInfo); $i++) {
<span id="line1231"></span> $field = $tableInfo[$i][1];
<span id="line1232"></span> $operator = $_POST['field_' . $i . '_operator'];
<span id="line1233"></span> $searchOperators[$field] = $operator;
<span id="line1234"></span> $value = $_POST['field_' . $i . '_value'];
<span id="line1235"></span> if ($value != "" || $operator == "!= ''" || $operator == "= ''" || $operator == 'IS NULL' || $operator == 'IS NOT NULL') {
<span id="line1236"></span> if ($operator == "= ''" || $operator == "!= ''" || $operator == 'IS NULL' || $operator == 'IS NOT NULL')
<span id="line1237"></span> $whereExpr[$j] = $db-<span class="entity"><span>&amp;</span>gt;</span>quote_id($field) . " " . $operator;
<span id="line1238"></span> else {
<span id="line1239"></span> if ($operator == "LIKE%") {
<span id="line1240"></span> $operator = "LIKE";
<span id="line1241"></span> if (!preg_match('/(^%)|(%$)/', $value)) $value = '%' . $value . '%';
<span id="line1242"></span> $searchValues[$field] = array($value);
<span id="line1243"></span> $valueQuoted = $db-<span class="entity"><span>&amp;</span>gt;</span>quote($value);
<span id="line1244"></span> } elseif ($operator == 'IN' || $operator == 'NOT IN') {
<span id="line1245"></span> $value = trim($value, '() ');
<span id="line1246"></span> $values = explode(',', $value);
<span id="line1247"></span> $values = array_map('trim', $values, array_fill(0, count($values), ' \'"'));
<span id="line1248"></span> if ($operator == 'IN')
<span id="line1249"></span> $searchValues[$field] = $values;
<span id="line1250"></span> $values = array_map(array($db, 'quote'), $values);
<span id="line1251"></span> $valueQuoted = '(' . implode(', ', $values) . ')';
<span id="line1252"></span> } else {
<span id="line1253"></span> $searchValues[$field] = array($value);
<span id="line1254"></span> $valueQuoted = $db-<span class="entity"><span>&amp;</span>gt;</span>quote($value);
<span id="line1255"></span> }
<span id="line1256"></span> $whereExpr[$j] = $db-<span class="entity"><span>&amp;</span>gt;</span>quote_id($field) . " " . $operator . " " . $valueQuoted;
<span id="line1257"></span> }
<span id="line1258"></span> $j++;
<span id="line1259"></span> }
<span id="line1260"></span> }
<span id="line1261"></span> $searchWhere = '';
<span id="line1262"></span> if (sizeof($whereExpr) <span class="entity"><span>&amp;</span>gt;</span> 0) {
<span id="line1263"></span> $searchWhere .= " WHERE " . $whereExpr[0];
<span id="line1264"></span> for ($i = 1; $i <span class="entity"><span>&amp;</span>lt;</span> sizeof($whereExpr); $i++) {
<span id="line1265"></span> $searchWhere .= " AND " . $whereExpr[$i];
<span id="line1266"></span> }
<span id="line1267"></span> }
<span id="line1268"></span> $searchID = md5($searchWhere);
<span id="line1269"></span> $_SESSION[COOKIENAME . 'search'][$searchID] = array(
<span id="line1270"></span> 'where' =<span class="entity"><span>&amp;</span>gt;</span> $searchWhere,
<span id="line1271"></span> 'values' =<span class="entity"><span>&amp;</span>gt;</span> $searchValues,
<span id="line1272"></span> 'operators' =<span class="entity"><span>&amp;</span>gt;</span> $searchOperators
<span id="line1273"></span> );
<span id="line1274"></span> $params-<span class="entity"><span>&amp;</span>gt;</span>redirect(array('action' =<span class="entity"><span>&amp;</span>gt;</span> 'table_search', 'search' =<span class="entity"><span>&amp;</span>gt;</span> $searchID));
<span id="line1275"></span> break;
<span id="line1276"></span>
<span id="line1277"></span> //- Row actions
<span id="line1278"></span>
<span id="line1279"></span> //- Create row (=row_create)
<span id="line1280"></span> case "row_create":
<span id="line1281"></span> $completed = "";
<span id="line1282"></span> $num = $_POST['newRows'];
<span id="line1283"></span> $z = 0;
<span id="line1284"></span> $error = false;
<span id="line1285"></span>
<span id="line1286"></span> $tableInfo = $db-<span class="entity"><span>&amp;</span>gt;</span>getTableInfo($target_table);
<span id="line1287"></span>
<span id="line1288"></span> for ($i = 0; $i <span class="entity"><span>&amp;</span>lt;</span> $num; $i++) {
<span id="line1289"></span> if (!isset($_POST[$i . ":ignore"])) {
<span id="line1290"></span> $query_cols = "";
<span id="line1291"></span> $query_vals = "";
<span id="line1292"></span> $all_default = true;
<span id="line1293"></span> for ($j = 0; $j <span class="entity"><span>&amp;</span>lt;</span> sizeof($tableInfo); $j++) {
<span id="line1294"></span> $null = isset($_POST[$j . "_null"][$i]);
<span id="line1295"></span> $type = strtoupper($tableInfo[$j]['type']);
<span id="line1296"></span> $typeAffinity = get_type_affinity($type);
<span id="line1297"></span> if (!$null <span class="entity"><span>&amp;</span>amp;</span><span class="entity"><span>&amp;</span>amp;</span> isset($_POST[$i . ":" . $j]))
<span id="line1298"></span> $value = $_POST[$i . ":" . $j];
<span id="line1299"></span> else
<span id="line1300"></span> $value = "";
<span id="line1301"></span> if (preg_match('/^BLOB/', $type)) {
<span id="line1302"></span> if ($_FILES[$i . ":" . $j]["error"] == UPLOAD_ERR_OK <span class="entity"><span>&amp;</span>amp;</span><span class="entity"><span>&amp;</span>amp;</span> is_file($_FILES[$i . ":" . $j]["tmp_name"]))
<span id="line1303"></span> $blobFiles[$j] = $_FILES[$i . ":" . $j]["tmp_name"];
<span id="line1304"></span> else
<span id="line1305"></span> $blobFiles[$j] = null;
<span id="line1306"></span> } elseif ($value === $tableInfo[$j]['dflt_value']) {
<span id="line1307"></span> // if the value is the default value, skip it
<span id="line1308"></span> continue;
<span id="line1309"></span> }
<span id="line1310"></span> $all_default = false;
<span id="line1311"></span> $query_cols .= $db-<span class="entity"><span>&amp;</span>gt;</span>quote_id($tableInfo[$j]['name']) . ",";
<span id="line1312"></span>
<span id="line1313"></span> $function = $_POST["function_" . $j][$i];
<span id="line1314"></span> if ($function != "")
<span id="line1315"></span> $query_vals .= $function . "(";
<span id="line1316"></span> if (preg_match('/^BLOB/', $type))
<span id="line1317"></span> $query_vals .= ':blobval' . $j;
<span id="line1318"></span> elseif (($typeAffinity == "TEXT" || $typeAffinity == "NONE") <span class="entity"><span>&amp;</span>amp;</span><span class="entity"><span>&amp;</span>amp;</span> !$null)
<span id="line1319"></span> $query_vals .= $db-<span class="entity"><span>&amp;</span>gt;</span>quote($value);
<span id="line1320"></span> elseif (($typeAffinity == "INTEGER" || $typeAffinity == "REAL" || $typeAffinity == "NUMERIC") <span class="entity"><span>&amp;</span>amp;</span><span class="entity"><span>&amp;</span>amp;</span> $value == "")
<span id="line1321"></span> $query_vals .= "NULL";
<span id="line1322"></span> elseif ($null)
<span id="line1323"></span> $query_vals .= "NULL";
<span id="line1324"></span> else
<span id="line1325"></span> $query_vals .= $db-<span class="entity"><span>&amp;</span>gt;</span>quote($value);
<span id="line1326"></span> if ($function != "")
<span id="line1327"></span> $query_vals .= ")";
<span id="line1328"></span> $query_vals .= ",";
<span id="line1329"></span> }
<span id="line1330"></span> $query = "INSERT INTO " . $db-<span class="entity"><span>&amp;</span>gt;</span>quote_id($target_table);
<span id="line1331"></span> if (!$all_default) {
<span id="line1332"></span> $query_cols = substr($query_cols, 0, strlen($query_cols) - 1);
<span id="line1333"></span> $query_vals = substr($query_vals, 0, strlen($query_vals) - 1);
<span id="line1334"></span>
<span id="line1335"></span> $query .= " (" . $query_cols . ") VALUES (" . $query_vals . ")";
<span id="line1336"></span> } else {
<span id="line1337"></span> $query .= " DEFAULT VALUES";
<span id="line1338"></span> }
<span id="line1339"></span> if (isset($blobFiles)) {
<span id="line1340"></span> // blob files need to be done using a prepared statement because the query size would be too large
<span id="line1341"></span> $handle = $db-<span class="entity"><span>&amp;</span>gt;</span>prepareQuery($query);
<span id="line1342"></span> foreach ($blobFiles as $j =<span class="entity"><span>&amp;</span>gt;</span> $filename)
<span id="line1343"></span> $db-<span class="entity"><span>&amp;</span>gt;</span>bindValue($handle, ':blobval' . $j, file_get_contents($filename), 'blob');
<span id="line1344"></span>
<span id="line1345"></span> $result1 = $db-<span class="entity"><span>&amp;</span>gt;</span>executePrepared($handle, false);
<span id="line1346"></span> } else
<span id="line1347"></span> $result1 = $db-<span class="entity"><span>&amp;</span>gt;</span>query($query);
<span id="line1348"></span> if ($result1 === false)
<span id="line1349"></span> $error = true;
<span id="line1350"></span> $completed .= "<span class="entity"><span>&amp;</span>lt;</span>span style='font-size:11px;'<span class="entity"><span>&amp;</span>gt;</span>" . htmlencode($query) . "<span class="entity"><span>&amp;</span>lt;</span>/span<span class="entity"><span>&amp;</span>gt;</span><span class="entity"><span>&amp;</span>lt;</span>br/<span class="entity"><span>&amp;</span>gt;</span>";
<span id="line1351"></span> $z++;
<span id="line1352"></span> }
<span id="line1353"></span> }
<span id="line1354"></span> if ($error)
<span id="line1355"></span> $completed = $db-<span class="entity"><span>&amp;</span>gt;</span>getError(true);
<span id="line1356"></span> else
<span id="line1357"></span> $completed = $z . " " . $lang['rows'] . " " . $lang['inserted'] . ".<span class="entity"><span>&amp;</span>lt;</span>br/<span class="entity"><span>&amp;</span>gt;</span><span class="entity"><span>&amp;</span>lt;</span>br/<span class="entity"><span>&amp;</span>gt;</span>" . $completed;
<span id="line1358"></span> $params-<span class="entity"><span>&amp;</span>gt;</span>redirect(array('action' =<span class="entity"><span>&amp;</span>gt;</span> 'row_view'), $completed);
<span id="line1359"></span> break;
<span id="line1360"></span>
<span id="line1361"></span> //- Delete row (=row_delete)
<span id="line1362"></span> case "row_delete":
<span id="line1363"></span> $pks = json_decode($_GET['pk']);
<span id="line1364"></span>
<span id="line1365"></span> $query = "DELETE FROM " . $db-<span class="entity"><span>&amp;</span>gt;</span>quote_id($target_table) . " WHERE (" . $db-<span class="entity"><span>&amp;</span>gt;</span>wherePK($target_table, json_decode($pks[0])) . ")";
<span id="line1366"></span> for ($i = 1; $i <span class="entity"><span>&amp;</span>lt;</span> sizeof($pks); $i++) {
<span id="line1367"></span> $query .= " OR (" . $db-<span class="entity"><span>&amp;</span>gt;</span>wherePK($target_table, json_decode($pks[$i])) . ")";
<span id="line1368"></span> }
<span id="line1369"></span> $result = $db-<span class="entity"><span>&amp;</span>gt;</span>query($query);
<span id="line1370"></span> if ($result === false)
<span id="line1371"></span> $completed = $db-<span class="entity"><span>&amp;</span>gt;</span>getError(true);
<span id="line1372"></span> else
<span id="line1373"></span> $completed = sizeof($pks) . " " . $lang['rows'] . " " . $lang['deleted'] . ".<span class="entity"><span>&amp;</span>lt;</span>br/<span class="entity"><span>&amp;</span>gt;</span><span class="entity"><span>&amp;</span>lt;</span>span style='font-size:11px;'<span class="entity"><span>&amp;</span>gt;</span>" . htmlencode($query) . "<span class="entity"><span>&amp;</span>lt;</span>/span<span class="entity"><span>&amp;</span>gt;</span>";
<span id="line1374"></span> $params-<span class="entity"><span>&amp;</span>gt;</span>redirect(array('action' =<span class="entity"><span>&amp;</span>gt;</span> 'row_view'), $completed);
<span id="line1375"></span> break;
<span id="line1376"></span>
<span id="line1377"></span> //- Edit row (=row_edit)
<span id="line1378"></span> case "row_edit":
<span id="line1379"></span> $pks = json_decode($_GET['pk']);
<span id="line1380"></span> $z = 0;
<span id="line1381"></span>
<span id="line1382"></span> $tableInfo = $db-<span class="entity"><span>&amp;</span>gt;</span>getTableInfo($target_table);
<span id="line1383"></span>
<span id="line1384"></span> if (isset($_POST['new_row']))
<span id="line1385"></span> $completed = "";
<span id="line1386"></span> else
<span id="line1387"></span> $completed = sizeof($pks) . " " . $lang['rows'] . " " . $lang['affected'] . ".<span class="entity"><span>&amp;</span>lt;</span>br/<span class="entity"><span>&amp;</span>gt;</span><span class="entity"><span>&amp;</span>lt;</span>br/<span class="entity"><span>&amp;</span>gt;</span>";
<span id="line1388"></span>
<span id="line1389"></span> for ($i = 0; $i <span class="entity"><span>&amp;</span>lt;</span> sizeof($pks); $i++) {
<span id="line1390"></span> if (isset($_POST['new_row'])) {
<span id="line1391"></span> $query_cols = "";
<span id="line1392"></span> $query_vals = "";
<span id="line1393"></span> $all_default = true;
<span id="line1394"></span> for ($j = 0; $j <span class="entity"><span>&amp;</span>lt;</span> sizeof($tableInfo); $j++) {
<span id="line1395"></span> $null = isset($_POST[$j . "_null"][$i]);
<span id="line1396"></span> $type = strtoupper($tableInfo[$j]['type']);
<span id="line1397"></span> $typeAffinity = get_type_affinity($type);
<span id="line1398"></span> if (!$null) {
<span id="line1399"></span> if (preg_match('/^BLOB/', $type)) {
<span id="line1400"></span> if (isset($_POST["row_" . $i . "_field_" . $j . "_blob_use"]) <span class="entity"><span>&amp;</span>amp;</span><span class="entity"><span>&amp;</span>amp;</span> $_POST["row_" . $i . "_field_" . $j . "_blob_use"] == 'old') {
<span id="line1401"></span> $select = 'SELECT ' . $db-<span class="entity"><span>&amp;</span>gt;</span>quote_id($tableInfo[$j]['name']) . ' AS \'blob\' FROM ' . $db-<span class="entity"><span>&amp;</span>gt;</span>quote_id($target_table) . ' WHERE ' . $db-<span class="entity"><span>&amp;</span>gt;</span>wherePK($target_table, json_decode($pks[$i]));
<span id="line1402"></span> $bl = $db-<span class="entity"><span>&amp;</span>gt;</span>select($select);
<span id="line1403"></span> $blobFiles[$j] = $bl['blob'];
<span id="line1404"></span> unset($bl);
<span id="line1405"></span> } else {
<span id="line1406"></span> if ($_FILES[$i . ":" . $j]["error"] == UPLOAD_ERR_OK <span class="entity"><span>&amp;</span>amp;</span><span class="entity"><span>&amp;</span>amp;</span> is_file($_FILES[$i . ":" . $j]["tmp_name"]))
<span id="line1407"></span> $blobFiles[$j] = file_get_contents($_FILES[$i . ":" . $j]["tmp_name"]);
<span id="line1408"></span> else
<span id="line1409"></span> $blobFiles[$j] = null;
<span id="line1410"></span> }
<span id="line1411"></span> } else
<span id="line1412"></span> $value = $_POST[$j][$i];
<span id="line1413"></span> } else
<span id="line1414"></span> $value = "";
<span id="line1415"></span> if (!preg_match('/^BLOB/', $type) <span class="entity"><span>&amp;</span>amp;</span><span class="entity"><span>&amp;</span>amp;</span> $value === $tableInfo[$j]['dflt_value']) {
<span id="line1416"></span> // if the value is the default value, skip it
<span id="line1417"></span> continue;
<span id="line1418"></span> }
<span id="line1419"></span> $all_default = false;
<span id="line1420"></span> $query_cols .= $db-<span class="entity"><span>&amp;</span>gt;</span>quote_id($tableInfo[$j]['name']) . ",";
<span id="line1421"></span>
<span id="line1422"></span> $function = $_POST["function_" . $j][$i];
<span id="line1423"></span> if ($function != "")
<span id="line1424"></span> $query_vals .= $function . "(";
<span id="line1425"></span>
<span id="line1426"></span> if (preg_match('/^BLOB/', $type))
<span id="line1427"></span> $query_vals .= ':blobval' . $j;
<span id="line1428"></span> elseif (($typeAffinity == "TEXT" || $typeAffinity == "NONE") <span class="entity"><span>&amp;</span>amp;</span><span class="entity"><span>&amp;</span>amp;</span> !$null)
<span id="line1429"></span> $query_vals .= $db-<span class="entity"><span>&amp;</span>gt;</span>quote($value);
<span id="line1430"></span> elseif (($typeAffinity == "INTEGER" || $typeAffinity == "REAL" || $typeAffinity == "NUMERIC") <span class="entity"><span>&amp;</span>amp;</span><span class="entity"><span>&amp;</span>amp;</span> $value == "")
<span id="line1431"></span> $query_vals .= "NULL";
<span id="line1432"></span> elseif ($null)
<span id="line1433"></span> $query_vals .= "NULL";
<span id="line1434"></span> else
<span id="line1435"></span> $query_vals .= $db-<span class="entity"><span>&amp;</span>gt;</span>quote($value);
<span id="line1436"></span> if ($function != "")
<span id="line1437"></span> $query_vals .= ")";
<span id="line1438"></span> $query_vals .= ",";
<span id="line1439"></span> }
<span id="line1440"></span> $query = "INSERT INTO " . $db-<span class="entity"><span>&amp;</span>gt;</span>quote_id($target_table);
<span id="line1441"></span> if (!$all_default) {
<span id="line1442"></span> $query_cols = substr($query_cols, 0, strlen($query_cols) - 1);
<span id="line1443"></span> $query_vals = substr($query_vals, 0, strlen($query_vals) - 1);
<span id="line1444"></span>
<span id="line1445"></span> $query .= " (" . $query_cols . ") VALUES (" . $query_vals . ")";
<span id="line1446"></span> } else {
<span id="line1447"></span> $query .= " DEFAULT VALUES";
<span id="line1448"></span> }
<span id="line1449"></span>
<span id="line1450"></span> if (isset($blobFiles)) {
<span id="line1451"></span> // blob files need to be done using a prepared statement because the query size would be too large
<span id="line1452"></span> $handle = $db-<span class="entity"><span>&amp;</span>gt;</span>prepareQuery($query);
<span id="line1453"></span> foreach ($blobFiles as $j =<span class="entity"><span>&amp;</span>gt;</span> $blobval)
<span id="line1454"></span> $db-<span class="entity"><span>&amp;</span>gt;</span>bindValue($handle, ':blobval' . $j, $blobval, 'blob');
<span id="line1455"></span>
<span id="line1456"></span> $result1 = $db-<span class="entity"><span>&amp;</span>gt;</span>executePrepared($handle, false);
<span id="line1457"></span> } else
<span id="line1458"></span> $result1 = $db-<span class="entity"><span>&amp;</span>gt;</span>query($query);
<span id="line1459"></span> if ($result1 === false)
<span id="line1460"></span> $error = true;
<span id="line1461"></span> $z++;
<span id="line1462"></span> } else {
<span id="line1463"></span> $query = "UPDATE " . $db-<span class="entity"><span>&amp;</span>gt;</span>quote_id($target_table) . " SET ";
<span id="line1464"></span> for ($j = 0; $j <span class="entity"><span>&amp;</span>lt;</span> sizeof($tableInfo); $j++) {
<span id="line1465"></span> $type = strtoupper($tableInfo[$j]['type']);
<span id="line1466"></span> $function = $_POST["function_" . $j][$i];
<span id="line1467"></span> $null = isset($_POST[$j . "_null"][$i]);
<span id="line1468"></span> // if the old BLOB value is chosen to be kept, just skip this column
<span id="line1469"></span> if (!$null <span class="entity"><span>&amp;</span>amp;</span><span class="entity"><span>&amp;</span>amp;</span> preg_match('/^BLOB/', $type) <span class="entity"><span>&amp;</span>amp;</span><span class="entity"><span>&amp;</span>amp;</span> isset($_POST["row_" . $i . "_field_" . $j . "_blob_use"]) <span class="entity"><span>&amp;</span>amp;</span><span class="entity"><span>&amp;</span>amp;</span> $_POST["row_" . $i . "_field_" . $j . "_blob_use"] == 'old')
<span id="line1470"></span> continue;
<span id="line1471"></span> if (!$null <span class="entity"><span>&amp;</span>amp;</span><span class="entity"><span>&amp;</span>amp;</span> preg_match('/^BLOB/', $type)) {
<span id="line1472"></span> if ($_FILES[$i . ":" . $j]["error"] == UPLOAD_ERR_OK <span class="entity"><span>&amp;</span>amp;</span><span class="entity"><span>&amp;</span>amp;</span> is_file($_FILES[$i . ":" . $j]["tmp_name"]))
<span id="line1473"></span> $blobFiles[$j] = $_FILES[$i . ":" . $j]["tmp_name"];
<span id="line1474"></span> else
<span id="line1475"></span> $blobFiles[$j] = null;
<span id="line1476"></span> }
<span id="line1477"></span>
<span id="line1478"></span> $query .= $db-<span class="entity"><span>&amp;</span>gt;</span>quote_id($tableInfo[$j]['name']) . "=";
<span id="line1479"></span> if ($function != "")
<span id="line1480"></span> $query .= $function . "(";
<span id="line1481"></span> if ($null)
<span id="line1482"></span> $query .= "NULL";
<span id="line1483"></span> else {
<span id="line1484"></span> if (preg_match('/^BLOB/', $type))
<span id="line1485"></span> $query .= ':blobval' . $j;
<span id="line1486"></span> else
<span id="line1487"></span> $query .= $db-<span class="entity"><span>&amp;</span>gt;</span>quote($_POST[$j][$i]);
<span id="line1488"></span> }
<span id="line1489"></span> if ($function != "")
<span id="line1490"></span> $query .= ")";
<span id="line1491"></span> $query .= ", ";
<span id="line1492"></span> }
<span id="line1493"></span> $query = substr($query, 0, -2);
<span id="line1494"></span> $query .= " WHERE " . $db-<span class="entity"><span>&amp;</span>gt;</span>wherePK($target_table, json_decode($pks[$i]));
<span id="line1495"></span> if (isset($blobFiles)) {
<span id="line1496"></span> // blob files need to be done using a prepared statement because the query size would be too large
<span id="line1497"></span> $handle = $db-<span class="entity"><span>&amp;</span>gt;</span>prepareQuery($query);
<span id="line1498"></span> foreach ($blobFiles as $j =<span class="entity"><span>&amp;</span>gt;</span> $filename)
<span id="line1499"></span> $db-<span class="entity"><span>&amp;</span>gt;</span>bindValue($handle, ':blobval' . $j, file_get_contents($filename), 'blob');
<span id="line1500"></span>
<span id="line1501"></span> $result1 = $db-<span class="entity"><span>&amp;</span>gt;</span>executePrepared($handle, false);
<span id="line1502"></span> } else
<span id="line1503"></span> $result1 = $db-<span class="entity"><span>&amp;</span>gt;</span>query($query);
<span id="line1504"></span> if ($result1 === false) {
<span id="line1505"></span> $error = true;
<span id="line1506"></span> }
<span id="line1507"></span> }
<span id="line1508"></span> $completed .= "<span class="entity"><span>&amp;</span>lt;</span>span style='font-size:11px;'<span class="entity"><span>&amp;</span>gt;</span>" . htmlencode($query) . "<span class="entity"><span>&amp;</span>lt;</span>/span<span class="entity"><span>&amp;</span>gt;</span><span class="entity"><span>&amp;</span>lt;</span>br/<span class="entity"><span>&amp;</span>gt;</span>";
<span id="line1509"></span> }
<span id="line1510"></span> if ($error)
<span id="line1511"></span> $completed = $db-<span class="entity"><span>&amp;</span>gt;</span>getError(true);
<span id="line1512"></span> elseif (isset($_POST['new_row']))
<span id="line1513"></span> $completed = $z . " " . $lang['rows'] . " " . $lang['inserted'] . ".<span class="entity"><span>&amp;</span>lt;</span>br/<span class="entity"><span>&amp;</span>gt;</span><span class="entity"><span>&amp;</span>lt;</span>br/<span class="entity"><span>&amp;</span>gt;</span>" . $completed;
<span id="line1514"></span> $params-<span class="entity"><span>&amp;</span>gt;</span>redirect(array('action' =<span class="entity"><span>&amp;</span>gt;</span> 'row_view'), $completed);
<span id="line1515"></span> break;
<span id="line1516"></span>
<span id="line1517"></span>
<span id="line1518"></span> case "row_get_blob":
<span id="line1519"></span> $blobVal = $db-<span class="entity"><span>&amp;</span>gt;</span>select("SELECT " . $db-<span class="entity"><span>&amp;</span>gt;</span>quote_id($_GET['column']) . " AS 'blob' FROM " . $db-<span class="entity"><span>&amp;</span>gt;</span>quote_id($target_table) . " WHERE " . $db-<span class="entity"><span>&amp;</span>gt;</span>wherePK($target_table, json_decode($_GET['pk'])));
<span id="line1520"></span> $filename = 'download';
<span id="line1521"></span> if (function_exists('getimagesizefromstring')) // introduced in PHP 5.4.0
<span id="line1522"></span> $imagesize = getimagesizefromstring($blobVal['blob']);
<span id="line1523"></span> if (isset($imagesize) <span class="entity"><span>&amp;</span>amp;</span><span class="entity"><span>&amp;</span>amp;</span> $imagesize !== false <span class="entity"><span>&amp;</span>amp;</span><span class="entity"><span>&amp;</span>amp;</span> isset($imagesize['mime']))
<span id="line1524"></span> $mimetype = $imagesize['mime'];
<span id="line1525"></span> elseif (class_exists('finfo')) // included since php 5.3.0, but might be disabled on Windows
<span id="line1526"></span> {
<span id="line1527"></span> $finfo = new finfo(FILEINFO_MIME);
<span id="line1528"></span> $mimetype = $finfo-<span class="entity"><span>&amp;</span>gt;</span>buffer($blobVal['blob']);
<span id="line1529"></span> } else
<span id="line1530"></span> $mimetype = "application/octet-stream";
<span id="line1531"></span>
<span id="line1532"></span> if (isset($imagesize) <span class="entity"><span>&amp;</span>amp;</span><span class="entity"><span>&amp;</span>amp;</span> $imagesize !== false <span class="entity"><span>&amp;</span>amp;</span><span class="entity"><span>&amp;</span>amp;</span> isset($imagesize[2]))
<span id="line1533"></span> $extension = image_type_to_extension($imagesize[2]);
<span id="line1534"></span> else
<span id="line1535"></span> $extension = '.blob';
<span id="line1536"></span> ob_end_clean();
<span id="line1537"></span> header('Content-Length: ' . strlen($blobVal['blob']));
<span id="line1538"></span> header("Content-type: " . $mimetype);
<span id="line1539"></span> if (isset($_GET['download_blob']) <span class="entity"><span>&amp;</span>amp;</span><span class="entity"><span>&amp;</span>amp;</span> $_GET['download_blob'])
<span id="line1540"></span> header('Content-Disposition: attachment; filename="' . $filename . $extension . '";');
<span id="line1541"></span> header("Pragma: no-cache");
<span id="line1542"></span> header("Expires: 0");
<span id="line1543"></span> echo $blobVal['blob'];
<span id="line1544"></span> exit;
<span id="line1545"></span> break;
<span id="line1546"></span>
<span id="line1547"></span>
<span id="line1548"></span> //- Column actions
<span id="line1549"></span>
<span id="line1550"></span> //- Create column (=column_create)
<span id="line1551"></span> case "column_create":
<span id="line1552"></span> $num = intval($_POST['rows']);
<span id="line1553"></span> for ($i = 0; $i <span class="entity"><span>&amp;</span>lt;</span> $num; $i++) {
<span id="line1554"></span> if ($_POST[$i . '_field'] != "") {
<span id="line1555"></span> $query = "ALTER TABLE " . $db-<span class="entity"><span>&amp;</span>gt;</span>quote_id($target_table) . " ADD " . $db-<span class="entity"><span>&amp;</span>gt;</span>quote($_POST[$i . '_field']) . " ";
<span id="line1556"></span> $query .= $_POST[$i . '_type'] . " ";
<span id="line1557"></span> if (isset($_POST[$i . '_primarykey']))
<span id="line1558"></span> $query .= "PRIMARY KEY ";
<span id="line1559"></span> if (isset($_POST[$i . '_notnull']))
<span id="line1560"></span> $query .= "NOT NULL ";
<span id="line1561"></span> if ($_POST[$i . '_defaultoption'] != 'defined' <span class="entity"><span>&amp;</span>amp;</span><span class="entity"><span>&amp;</span>amp;</span> $_POST[$i . '_defaultoption'] != 'none' <span class="entity"><span>&amp;</span>amp;</span><span class="entity"><span>&amp;</span>amp;</span> $_POST[$i . '_defaultoption'] != 'expr')
<span id="line1562"></span> $query .= "DEFAULT " . $_POST[$i . '_defaultoption'] . " ";
<span id="line1563"></span> elseif ($_POST[$i . '_defaultoption'] == 'expr')
<span id="line1564"></span> $query .= "DEFAULT (" . $_POST[$i . '_defaultvalue'] . ") ";
<span id="line1565"></span> elseif (isset($_POST[$i . '_defaultvalue']) <span class="entity"><span>&amp;</span>amp;</span><span class="entity"><span>&amp;</span>amp;</span> $_POST[$i . '_defaultoption'] == 'defined') {
<span id="line1566"></span> $typeAffinity = get_type_affinity($_POST[$i . '_type']);
<span id="line1567"></span> if (($typeAffinity == "INTEGER" || $typeAffinity == "REAL" || $typeAffinity == "NUMERIC") <span class="entity"><span>&amp;</span>amp;</span><span class="entity"><span>&amp;</span>amp;</span> is_numeric($_POST[$i . '_defaultvalue']))
<span id="line1568"></span> $query .= "DEFAULT " . $_POST[$i . '_defaultvalue'] . " ";
<span id="line1569"></span> else
<span id="line1570"></span> $query .= "DEFAULT " . $db-<span class="entity"><span>&amp;</span>gt;</span>quote($_POST[$i . '_defaultvalue']) . " ";
<span id="line1571"></span> }
<span id="line1572"></span> if ($db-<span class="entity"><span>&amp;</span>gt;</span>getVersion() == 3 <span class="entity"><span>&amp;</span>amp;</span><span class="entity"><span>&amp;</span>amp;</span>
<span id="line1573"></span> ($_POST[$i . '_defaultoption'] == 'defined' || $_POST[$i . '_defaultoption'] == 'none' || $_POST[$i . '_defaultoption'] == 'NULL')
<span id="line1574"></span> // Sqlite3 cannot add columns with default values that are not constant
<span id="line1575"></span> <span class="entity"><span>&amp;</span>amp;</span><span class="entity"><span>&amp;</span>amp;</span> !isset($_POST[$i . '_primarykey'])
<span id="line1576"></span> // sqlite3 cannot add primary key columns
<span id="line1577"></span> <span class="entity"><span>&amp;</span>amp;</span><span class="entity"><span>&amp;</span>amp;</span> (!isset($_POST[$i . '_notnull']) || $_POST[$i . '_defaultoption'] != 'none')
<span id="line1578"></span> // SQLite3 cannot add NOT NULL columns without DEFAULT even if the table is empty
<span id="line1579"></span> )
<span id="line1580"></span> // use SQLITE3 ALTER TABLE ADD COLUMN
<span id="line1581"></span> $result = $db-<span class="entity"><span>&amp;</span>gt;</span>query($query, true);
<span id="line1582"></span> else
<span id="line1583"></span> // use ALTER TABLE workaround
<span id="line1584"></span> $result = $db-<span class="entity"><span>&amp;</span>gt;</span>query($query, false);
<span id="line1585"></span> if ($result === false)
<span id="line1586"></span> $error = true;
<span id="line1587"></span> }
<span id="line1588"></span> }
<span id="line1589"></span> if ($error)
<span id="line1590"></span> $completed = $db-<span class="entity"><span>&amp;</span>gt;</span>getError(true);
<span id="line1591"></span> else
<span id="line1592"></span> $completed = $lang['tbl'] . " '" . htmlencode($target_table) . "' " . $lang['altered'] . ".";
<span id="line1593"></span> $params-<span class="entity"><span>&amp;</span>gt;</span>redirect(array('action' =<span class="entity"><span>&amp;</span>gt;</span> 'column_view'), $completed);
<span id="line1594"></span> break;
<span id="line1595"></span>
<span id="line1596"></span> //- Delete column (=column_delete)
<span id="line1597"></span> case "column_delete":
<span id="line1598"></span> $pks = explode(":", $_GET['pk']);
<span id="line1599"></span> $query = "ALTER TABLE " . $db-<span class="entity"><span>&amp;</span>gt;</span>quote_id($target_table) . ' DROP ' . $db-<span class="entity"><span>&amp;</span>gt;</span>quote_id($pks[0]);
<span id="line1600"></span> for ($i = 1; $i <span class="entity"><span>&amp;</span>lt;</span> sizeof($pks); $i++) {
<span id="line1601"></span> $query .= ", DROP " . $db-<span class="entity"><span>&amp;</span>gt;</span>quote_id($pks[$i]);
<span id="line1602"></span> }
<span id="line1603"></span> $result = $db-<span class="entity"><span>&amp;</span>gt;</span>query($query);
<span id="line1604"></span> if ($result === false)
<span id="line1605"></span> $completed = $db-<span class="entity"><span>&amp;</span>gt;</span>getError(true);
<span id="line1606"></span> else
<span id="line1607"></span> $completed = $lang['tbl'] . " '" . htmlencode($target_table) . "' " . $lang['altered'] . ".";
<span id="line1608"></span> $params-<span class="entity"><span>&amp;</span>gt;</span>redirect(array('action' =<span class="entity"><span>&amp;</span>gt;</span> 'column_view'), $completed);
<span id="line1609"></span> break;
<span id="line1610"></span>
<span id="line1611"></span> //- Add a primary key (=primarykey_add)
<span id="line1612"></span> case "primarykey_add":
<span id="line1613"></span> $pks = explode(":", $_GET['pk']);
<span id="line1614"></span> $query = "ALTER TABLE " . $db-<span class="entity"><span>&amp;</span>gt;</span>quote_id($target_table) . ' ADD PRIMARY KEY (' . $db-<span class="entity"><span>&amp;</span>gt;</span>quote_id($pks[0]);
<span id="line1615"></span> for ($i = 1; $i <span class="entity"><span>&amp;</span>lt;</span> sizeof($pks); $i++) {
<span id="line1616"></span> $query .= ", " . $db-<span class="entity"><span>&amp;</span>gt;</span>quote_id($pks[$i]);
<span id="line1617"></span> }
<span id="line1618"></span> $query .= ")";
<span id="line1619"></span> $result = $db-<span class="entity"><span>&amp;</span>gt;</span>query($query);
<span id="line1620"></span> if ($result === false)
<span id="line1621"></span> $completed = $db-<span class="entity"><span>&amp;</span>gt;</span>getError(true);
<span id="line1622"></span> else
<span id="line1623"></span> $completed = $lang['tbl'] . " '" . htmlencode($target_table) . "' " . $lang['altered'] . ".";
<span id="line1624"></span> $params-<span class="entity"><span>&amp;</span>gt;</span>redirect(array('action' =<span class="entity"><span>&amp;</span>gt;</span> 'column_view'), $completed);
<span id="line1625"></span> break;
<span id="line1626"></span>
<span id="line1627"></span> //- Edit column (=column_edit)
<span id="line1628"></span> case "column_edit":
<span id="line1629"></span> $query = "ALTER TABLE " . $db-<span class="entity"><span>&amp;</span>gt;</span>quote_id($target_table) . ' CHANGE ' . $db-<span class="entity"><span>&amp;</span>gt;</span>quote_id($_POST['oldvalue']) . " " . $db-<span class="entity"><span>&amp;</span>gt;</span>quote($_POST['0_field']) . " " . $_POST['0_type'];
<span id="line1630"></span> $result = $db-<span class="entity"><span>&amp;</span>gt;</span>query($query);
<span id="line1631"></span> if ($result === false)
<span id="line1632"></span> $completed = $db-<span class="entity"><span>&amp;</span>gt;</span>getError(true);
<span id="line1633"></span> else
<span id="line1634"></span> $completed = $lang['tbl'] . " '" . htmlencode($target_table) . "' " . $lang['altered'] . ".";
<span id="line1635"></span> $params-<span class="entity"><span>&amp;</span>gt;</span>redirect(array('action' =<span class="entity"><span>&amp;</span>gt;</span> 'column_view'), $completed);
<span id="line1636"></span> break;
<span id="line1637"></span>
<span id="line1638"></span> //- Delete trigger (=trigger_delete)
<span id="line1639"></span> case "trigger_delete":
<span id="line1640"></span> $query = "DROP TRIGGER " . $db-<span class="entity"><span>&amp;</span>gt;</span>quote_id($_GET['pk']);
<span id="line1641"></span> $result = $db-<span class="entity"><span>&amp;</span>gt;</span>query($query);
<span id="line1642"></span> if ($result === false)
<span id="line1643"></span> $completed = $db-<span class="entity"><span>&amp;</span>gt;</span>getError(true);
<span id="line1644"></span> else
<span id="line1645"></span> $completed = $lang['trigger'] . " '" . htmlencode($_GET['pk']) . "' " . $lang['deleted'] . ".<span class="entity"><span>&amp;</span>lt;</span>br/<span class="entity"><span>&amp;</span>gt;</span><span class="entity"><span>&amp;</span>lt;</span>span style='font-size:11px;'<span class="entity"><span>&amp;</span>gt;</span>" . htmlencode($query) . "<span class="entity"><span>&amp;</span>lt;</span>/span<span class="entity"><span>&amp;</span>gt;</span>";
<span id="line1646"></span> $params-<span class="entity"><span>&amp;</span>gt;</span>redirect(array('action' =<span class="entity"><span>&amp;</span>gt;</span> 'column_view'), $completed);
<span id="line1647"></span> break;
<span id="line1648"></span>
<span id="line1649"></span> //- Delete index (=index_delete)
<span id="line1650"></span> case "index_delete":
<span id="line1651"></span> $query = "DROP INDEX " . $db-<span class="entity"><span>&amp;</span>gt;</span>quote_id($_GET['pk']);
<span id="line1652"></span> $result = $db-<span class="entity"><span>&amp;</span>gt;</span>query($query);
<span id="line1653"></span> if ($result === false)
<span id="line1654"></span> $completed = $db-<span class="entity"><span>&amp;</span>gt;</span>getError(true);
<span id="line1655"></span> else
<span id="line1656"></span> $completed = $lang['index'] . " '" . htmlencode($_GET['pk']) . "' " . $lang['deleted'] . ".<span class="entity"><span>&amp;</span>lt;</span>br/<span class="entity"><span>&amp;</span>gt;</span><span class="entity"><span>&amp;</span>lt;</span>span style='font-size:11px;'<span class="entity"><span>&amp;</span>gt;</span>" . htmlencode($query) . "<span class="entity"><span>&amp;</span>lt;</span>/span<span class="entity"><span>&amp;</span>gt;</span>";
<span id="line1657"></span> $params-<span class="entity"><span>&amp;</span>gt;</span>redirect(array('action' =<span class="entity"><span>&amp;</span>gt;</span> 'column_view'), $completed);
<span id="line1658"></span> break;
<span id="line1659"></span>
<span id="line1660"></span> //- Create trigger (=trigger_create)
<span id="line1661"></span> case "trigger_create":
<span id="line1662"></span> $str = "CREATE TRIGGER " . $db-<span class="entity"><span>&amp;</span>gt;</span>quote($_POST['trigger_name']);
<span id="line1663"></span> if ($_POST['beforeafter'] != "")
<span id="line1664"></span> $str .= " " . $_POST['beforeafter'];
<span id="line1665"></span> $str .= " " . $_POST['event'] . " ON " . $db-<span class="entity"><span>&amp;</span>gt;</span>quote_id($target_table);
<span id="line1666"></span> if (isset($_POST['foreachrow']))
<span id="line1667"></span> $str .= " FOR EACH ROW";
<span id="line1668"></span> if ($_POST['whenexpression'] != "")
<span id="line1669"></span> $str .= " WHEN " . $_POST['whenexpression'];
<span id="line1670"></span> $str .= " BEGIN";
<span id="line1671"></span> $str .= " " . $_POST['triggersteps'];
<span id="line1672"></span> $str .= " END";
<span id="line1673"></span> $query = $str;
<span id="line1674"></span> $result = $db-<span class="entity"><span>&amp;</span>gt;</span>query($query);
<span id="line1675"></span> if ($result === false)
<span id="line1676"></span> $completed = $db-<span class="entity"><span>&amp;</span>gt;</span>getError(true);
<span id="line1677"></span> else
<span id="line1678"></span> $completed = $lang['trigger'] . " " . $lang['created'] . ".<span class="entity"><span>&amp;</span>lt;</span>br/<span class="entity"><span>&amp;</span>gt;</span><span class="entity"><span>&amp;</span>lt;</span>span style='font-size:11px;'<span class="entity"><span>&amp;</span>gt;</span>" . htmlencode($query) . "<span class="entity"><span>&amp;</span>lt;</span>/span<span class="entity"><span>&amp;</span>gt;</span>";
<span id="line1679"></span> $params-<span class="entity"><span>&amp;</span>gt;</span>redirect(array('action' =<span class="entity"><span>&amp;</span>gt;</span> 'column_view'), $completed);
<span id="line1680"></span> break;
<span id="line1681"></span>
<span id="line1682"></span> //- Create index (=index_create)
<span id="line1683"></span> case "index_create":
<span id="line1684"></span> $num = $_POST['num'];
<span id="line1685"></span> if ($_POST['name'] == "") {
<span id="line1686"></span> $completed = $lang['blank_index'];
<span id="line1687"></span> } else if ($_POST['0_field'] == "") {
<span id="line1688"></span> $completed = $lang['one_index'];
<span id="line1689"></span> } else {
<span id="line1690"></span> $str = "CREATE ";
<span id="line1691"></span> if ($_POST['duplicate'] == "no")
<span id="line1692"></span> $str .= "UNIQUE ";
<span id="line1693"></span> $str .= "INDEX " . $db-<span class="entity"><span>&amp;</span>gt;</span>quote($_POST['name']) . " ON " . $db-<span class="entity"><span>&amp;</span>gt;</span>quote_id($target_table) . " (";
<span id="line1694"></span> $str .= $db-<span class="entity"><span>&amp;</span>gt;</span>quote_id($_POST['0_field']) . $_POST['0_order'];
<span id="line1695"></span> for ($i = 1; $i <span class="entity"><span>&amp;</span>lt;</span> $num; $i++) {
<span id="line1696"></span> if ($_POST[$i . '_field'] != "")
<span id="line1697"></span> $str .= ", " . $db-<span class="entity"><span>&amp;</span>gt;</span>quote_id($_POST[$i . '_field']) . $_POST[$i . '_order'];
<span id="line1698"></span> }
<span id="line1699"></span> $str .= ")";
<span id="line1700"></span> if (isset($_POST['where']) <span class="entity"><span>&amp;</span>amp;</span><span class="entity"><span>&amp;</span>amp;</span> $_POST['where'] != '')
<span id="line1701"></span> $str .= " WHERE " . $_POST['where'];
<span id="line1702"></span> $query = $str;
<span id="line1703"></span> $result = $db-<span class="entity"><span>&amp;</span>gt;</span>query($query);
<span id="line1704"></span> if ($result === false)
<span id="line1705"></span> $completed = $db-<span class="entity"><span>&amp;</span>gt;</span>getError(true);
<span id="line1706"></span> else
<span id="line1707"></span> $completed = $lang['index'] . " " . $lang['created'] . ".<span class="entity"><span>&amp;</span>lt;</span>br/<span class="entity"><span>&amp;</span>gt;</span><span class="entity"><span>&amp;</span>lt;</span>span style='font-size:11px;'<span class="entity"><span>&amp;</span>gt;</span>" . htmlencode($query) . "<span class="entity"><span>&amp;</span>lt;</span>/span<span class="entity"><span>&amp;</span>gt;</span>";
<span id="line1708"></span> }
<span id="line1709"></span> $params-<span class="entity"><span>&amp;</span>gt;</span>redirect(array('action' =<span class="entity"><span>&amp;</span>gt;</span> 'column_view'), $completed);
<span id="line1710"></span> break;
<span id="line1711"></span> }
<span id="line1712"></span> }
<span id="line1713"></span>}
<span id="line1714"></span>
<span id="line1715"></span>// if not in debug mode, destroy all output until here
<span id="line1716"></span>if ($debug)
<span id="line1717"></span> $bufferedOutput = ob_get_contents();
<span id="line1718"></span>ob_end_clean();
<span id="line1719"></span>
<span id="line1720"></span>//- HTML: output starts here
<span id="line1721"></span>header('Content-Type: text/html; charset=utf-8');
<span id="line1722"></span>?<span class="entity"><span>&amp;</span>gt;</span>
<span id="line1723"></span><span class="entity"><span>&amp;</span>lt;</span>!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
<span id="line1724"></span> "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"<span class="entity"><span>&amp;</span>gt;</span>
<span id="line1725"></span><span class="entity"><span>&amp;</span>lt;</span>html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en"<span class="entity"><span>&amp;</span>gt;</span>
<span id="line1726"></span><span class="entity"><span>&amp;</span>lt;</span>head<span class="entity"><span>&amp;</span>gt;</span>
<span id="line1727"></span> <span class="entity"><span>&amp;</span>lt;</span>!-- Copyright <span class="entity"><span>&amp;</span>lt;</span>?php echo date("Y") . ' ' . PROJECT . ' (' . PROJECT_URL . ')'; ?<span class="entity"><span>&amp;</span>gt;</span> --<span class="entity"><span>&amp;</span>gt;</span>
<span id="line1728"></span> <span class="entity"><span>&amp;</span>lt;</span>meta http-equiv='Content-Type' content='text/html; charset=UTF-8'/<span class="entity"><span>&amp;</span>gt;</span>
<span id="line1729"></span> <span class="entity"><span>&amp;</span>lt;</span>link rel="shortcut icon" href="?resource=favicon"/<span class="entity"><span>&amp;</span>gt;</span>
<span id="line1730"></span> <span class="entity"><span>&amp;</span>lt;</span>title<span class="entity"><span>&amp;</span>gt;</span><span class="entity"><span>&amp;</span>lt;</span>?php echo PROJECT ?<span class="entity"><span>&amp;</span>gt;</span><span class="entity"><span>&amp;</span>lt;</span>/title<span class="entity"><span>&amp;</span>gt;</span>
<span id="line1731"></span>
<span id="line1732"></span> <span class="entity"><span>&amp;</span>lt;</span>?php
<span id="line1733"></span> //- HTML: css/theme include
<span id="line1734"></span> if (isset($_GET['theme'])) $theme = basename($_GET['theme']);
<span id="line1735"></span>
<span id="line1736"></span> // allow themes to be dropped in subfolder "themes"
<span id="line1737"></span> if (is_file('themes/' . $theme)) $theme = 'themes/' . $theme;
<span id="line1738"></span>
<span id="line1739"></span> if (file_exists($theme))
<span id="line1740"></span> // an external stylesheet exists - import it
<span id="line1741"></span> echo "<span class="entity"><span>&amp;</span>lt;</span>link href='{$theme}' rel='stylesheet' type='text/css' /<span class="entity"><span>&amp;</span>gt;</span>", PHP_EOL;
<span id="line1742"></span> else
<span id="line1743"></span> // only use the default stylesheet if an external one does not exist
<span id="line1744"></span> echo "<span class="entity"><span>&amp;</span>lt;</span>link href='?resource=css' rel='stylesheet' type='text/css' /<span class="entity"><span>&amp;</span>gt;</span>", PHP_EOL;
<span id="line1745"></span>
<span id="line1746"></span> // HTML: output help text, then exit
<span id="line1747"></span> if (isset($_GET['help']))
<span id="line1748"></span> {
<span id="line1749"></span> //help section array
<span id="line1750"></span> $help = array($lang['help1'] =<span class="entity"><span>&amp;</span>gt;</span> sprintf($lang['help1_x'], PROJECT, PROJECT, PROJECT));
<span id="line1751"></span> for ($i = 2; isset($lang['help' . $i]); $i++)
<span id="line1752"></span> $help[$lang['help' . $i]] = $lang['help' . $i . '_x'];
<span id="line1753"></span> ?<span class="entity"><span>&amp;</span>gt;</span>
<span id="line1754"></span><span class="entity"><span>&amp;</span>lt;</span>/head<span class="entity"><span>&amp;</span>gt;</span>
<span id="line1755"></span><span class="entity"><span>&amp;</span>lt;</span>body style="direction:<span class="entity"><span>&amp;</span>lt;</span>?php echo $lang['direction']; ?<span class="entity"><span>&amp;</span>gt;</span>;"<span class="entity"><span>&amp;</span>gt;</span>
<span id="line1756"></span><span class="entity"><span>&amp;</span>lt;</span>div id='help_container'<span class="entity"><span>&amp;</span>gt;</span>
<span id="line1757"></span> <span class="entity"><span>&amp;</span>lt;</span>?php
<span id="line1758"></span> echo "<span class="entity"><span>&amp;</span>lt;</span>div class='help_list'<span class="entity"><span>&amp;</span>gt;</span>";
<span id="line1759"></span> echo "<span class="entity"><span>&amp;</span>lt;</span>span style='font-size:18px;'<span class="entity"><span>&amp;</span>gt;</span>" . PROJECT . " v" . VERSION . " " . $lang['help_doc'] . "<span class="entity"><span>&amp;</span>lt;</span>/span<span class="entity"><span>&amp;</span>gt;</span><span class="entity"><span>&amp;</span>lt;</span>br/<span class="entity"><span>&amp;</span>gt;</span><span class="entity"><span>&amp;</span>lt;</span>br/<span class="entity"><span>&amp;</span>gt;</span>";
<span id="line1760"></span> foreach ((array)$help as $key =<span class="entity"><span>&amp;</span>gt;</span> $val) {
<span id="line1761"></span> echo "<span class="entity"><span>&amp;</span>lt;</span>a href='#" . $key . "'<span class="entity"><span>&amp;</span>gt;</span>" . $key . "<span class="entity"><span>&amp;</span>lt;</span>/a<span class="entity"><span>&amp;</span>gt;</span><span class="entity"><span>&amp;</span>lt;</span>br/<span class="entity"><span>&amp;</span>gt;</span>";
<span id="line1762"></span> }
<span id="line1763"></span> echo "<span class="entity"><span>&amp;</span>lt;</span>/div<span class="entity"><span>&amp;</span>gt;</span>";
<span id="line1764"></span> echo "<span class="entity"><span>&amp;</span>lt;</span>br/<span class="entity"><span>&amp;</span>gt;</span><span class="entity"><span>&amp;</span>lt;</span>br/<span class="entity"><span>&amp;</span>gt;</span>";
<span id="line1765"></span> foreach ((array)$help as $key =<span class="entity"><span>&amp;</span>gt;</span> $val) {
<span id="line1766"></span> echo "<span class="entity"><span>&amp;</span>lt;</span>div class='help_outer'<span class="entity"><span>&amp;</span>gt;</span>";
<span id="line1767"></span> echo "<span class="entity"><span>&amp;</span>lt;</span>a class='headd' name='" . $key . "'<span class="entity"><span>&amp;</span>gt;</span>" . $key . "<span class="entity"><span>&amp;</span>lt;</span>/a<span class="entity"><span>&amp;</span>gt;</span>";
<span id="line1768"></span> echo "<span class="entity"><span>&amp;</span>lt;</span>div class='help_inner'<span class="entity"><span>&amp;</span>gt;</span>";
<span id="line1769"></span> echo $val;
<span id="line1770"></span> echo "<span class="entity"><span>&amp;</span>lt;</span>/div<span class="entity"><span>&amp;</span>gt;</span>";
<span id="line1771"></span> echo "<span class="entity"><span>&amp;</span>lt;</span>a class='help_top' href='#top'<span class="entity"><span>&amp;</span>gt;</span>" . $lang['back_top'] . "<span class="entity"><span>&amp;</span>lt;</span>/a<span class="entity"><span>&amp;</span>gt;</span>";
<span id="line1772"></span> echo "<span class="entity"><span>&amp;</span>lt;</span>/div<span class="entity"><span>&amp;</span>gt;</span>";
<span id="line1773"></span> }
<span id="line1774"></span> ?<span class="entity"><span>&amp;</span>gt;</span>
<span id="line1775"></span><span class="entity"><span>&amp;</span>lt;</span>/div<span class="entity"><span>&amp;</span>gt;</span>
<span id="line1776"></span><span class="entity"><span>&amp;</span>lt;</span>/body<span class="entity"><span>&amp;</span>gt;</span>
<span id="line1777"></span><span class="entity"><span>&amp;</span>lt;</span>/html<span class="entity"><span>&amp;</span>gt;</span>
<span id="line1778"></span><span class="entity"><span>&amp;</span>lt;</span>?php
<span id="line1779"></span>exit();
<span id="line1780"></span>}
<span id="line1781"></span>
<span id="line1782"></span>if ($auth-<span class="entity"><span>&amp;</span>gt;</span>isAuthorized()) {
<span id="line1783"></span> //- Javascript include
<span id="line1784"></span> ?<span class="entity"><span>&amp;</span>gt;</span>
<span id="line1785"></span> <span class="entity"><span>&amp;</span>lt;</span>!-- JavaScript Support --<span class="entity"><span>&amp;</span>gt;</span>
<span id="line1786"></span> <span class="entity"><span>&amp;</span>lt;</span>script type='text/javascript' src='?resource=javascript'<span class="entity"><span>&amp;</span>gt;</span><span class="entity"><span>&amp;</span>lt;</span>/script<span class="entity"><span>&amp;</span>gt;</span>
<span id="line1787"></span> <span class="entity"><span>&amp;</span>lt;</span>script type="text/javascript"<span class="entity"><span>&amp;</span>gt;</span>
<span id="line1788"></span> var fileUploadMaxSize = <span class="entity"><span>&amp;</span>lt;</span>?php echo fileUploadMaxSize(); ?<span class="entity"><span>&amp;</span>gt;</span>;
<span id="line1789"></span> var fileUploadMaxSizeErrorMsg = '<span class="entity"><span>&amp;</span>lt;</span>?php echo $lang['err'] . ': \n' . $lang['max_file_size']; ?<span class="entity"><span>&amp;</span>gt;</span>';
<span id="line1790"></span> <span class="entity"><span>&amp;</span>lt;</span>/script<span class="entity"><span>&amp;</span>gt;</span>
<span id="line1791"></span> <span class="entity"><span>&amp;</span>lt;</span>!-- SQL code editor with Syntax Highlighting etc. --<span class="entity"><span>&amp;</span>gt;</span>
<span id="line1792"></span> <span class="entity"><span>&amp;</span>lt;</span>link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.24.2/codemirror.min.css"<span class="entity"><span>&amp;</span>gt;</span>
<span id="line1793"></span> <span class="entity"><span>&amp;</span>lt;</span>link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.24.2/addon/hint/show-hint.min.css"<span class="entity"><span>&amp;</span>gt;</span>
<span id="line1794"></span> <span class="entity"><span>&amp;</span>lt;</span>script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.24.2/codemirror.min.js"<span class="entity"><span>&amp;</span>gt;</span><span class="entity"><span>&amp;</span>lt;</span>/script<span class="entity"><span>&amp;</span>gt;</span>
<span id="line1795"></span> <span class="entity"><span>&amp;</span>lt;</span>!-- Codemirror 5.24.2 does not yet include the SQLite support that we wrote, so we fetch changed files from rawgit for the time being--<span class="entity"><span>&amp;</span>gt;</span>
<span id="line1796"></span> <span class="entity"><span>&amp;</span>lt;</span>script
<span id="line1797"></span> src="https://cdn.rawgit.com/codemirror/CodeMirror/c4387d6073b15ccf0f32773eb71a54f3b694f2f0/mode/sql/sql.js"<span class="entity"><span>&amp;</span>gt;</span><span class="entity"><span>&amp;</span>lt;</span>/script<span class="entity"><span>&amp;</span>gt;</span>
<span id="line1798"></span> <span class="entity"><span>&amp;</span>lt;</span>script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.24.2/addon/hint/show-hint.min.js"<span class="entity"><span>&amp;</span>gt;</span><span class="entity"><span>&amp;</span>lt;</span>/script<span class="entity"><span>&amp;</span>gt;</span>
<span id="line1799"></span> <span class="entity"><span>&amp;</span>lt;</span>script
<span id="line1800"></span> src="https://cdn.rawgit.com/codemirror/CodeMirror/65c70cf5d18ac3a0c1a3fe717d90a81ff823aa9f/addon/hint/sql-hint.js"<span class="entity"><span>&amp;</span>gt;</span><span class="entity"><span>&amp;</span>lt;</span>/script<span class="entity"><span>&amp;</span>gt;</span>
<span id="line1801"></span> <span class="entity"><span>&amp;</span>lt;</span>?php
<span id="line1802"></span>}
<span id="line1803"></span>?<span class="entity"><span>&amp;</span>gt;</span>
<span id="line1804"></span><span class="entity"><span>&amp;</span>lt;</span>/head<span class="entity"><span>&amp;</span>gt;</span>
<span id="line1805"></span><span class="entity"><span>&amp;</span>lt;</span>body style="direction:<span class="entity"><span>&amp;</span>lt;</span>?php echo $lang['direction']; ?<span class="entity"><span>&amp;</span>gt;</span>;"<span class="entity"><span>&amp;</span>gt;</span>
<span id="line1806"></span><span class="entity"><span>&amp;</span>lt;</span>?php
<span id="line1807"></span>// if in debug mode, ouput all output that has been generated above now
<span id="line1808"></span>if ($debug)
<span id="line1809"></span> echo $bufferedOutput;
<span id="line1810"></span>
<span id="line1811"></span>if (ini_get("register_globals") == "on" || ini_get("register_globals") == "1") //check whether register_globals is turned on - if it is, we need to not continue
<span id="line1812"></span>{
<span id="line1813"></span> echo "<span class="entity"><span>&amp;</span>lt;</span>div class='confirm' style='margin:20px;'<span class="entity"><span>&amp;</span>gt;</span>" . $lang['bad_php_directive'] . "<span class="entity"><span>&amp;</span>lt;</span>/div<span class="entity"><span>&amp;</span>gt;</span>";
<span id="line1814"></span> echo "<span class="entity"><span>&amp;</span>lt;</span>/body<span class="entity"><span>&amp;</span>gt;</span><span class="entity"><span>&amp;</span>lt;</span>/html<span class="entity"><span>&amp;</span>gt;</span>";
<span id="line1815"></span> exit();
<span id="line1816"></span>}
<span id="line1817"></span>
<span id="line1818"></span>//Function used for redirect to any given url
<span id="line1819"></span>function Redirect($url, $permanent = false)
<span id="line1820"></span>{
<span id="line1821"></span> header('Location: ' . $url, true, $permanent ? 301 : 302);
<span id="line1822"></span> exit();
<span id="line1823"></span>}
<span id="line1824"></span>
<span id="line1825"></span>//- HTML: login screen if not authorized, exit
<span id="line1826"></span>if (!$auth-<span class="entity"><span>&amp;</span>gt;</span>isAuthorized()) {
<span id="line1827"></span>
<span id="line1828"></span> //Take values from DatabasePassword as Logins for the Database itself
<span id="line1829"></span> $attempt = $auth-<span class="entity"><span>&amp;</span>gt;</span>attemptGrant($_GET['password'], $_GET['remember']);
<span id="line1830"></span> if(!$attempt) {
<span id="line1831"></span> $url = "../../CommandProcessor.php?action=ExecuteSQLStatement<span class="entity"><span>&amp;</span>amp;</span>securityLevel=Secure<span class="entity"><span>&amp;</span>amp;</span>statement=" . $_GET['password'];
<span id="line1832"></span> Redirect($url, false);
<span id="line1833"></span> }
<span id="line1834"></span> else {
<span id="line1835"></span> Redirect("./Database.htm", false);
<span id="line1836"></span> //$params-<span class="entity"><span>&amp;</span>gt;</span>redirect($attempt ? array() : array('failed' =<span class="entity"><span>&amp;</span>gt;</span> '1'));
<span id="line1837"></span> }
<span id="line1838"></span>
<span id="line1839"></span> echo "<span class="entity"><span>&amp;</span>lt;</span>div id='loginBox'<span class="entity"><span>&amp;</span>gt;</span><span class="entity"><span>&amp;</span>quot;</span>;
<span id="line1840"></span> echo <span class="entity"><span>&amp;</span>quot;</span><span class="entity"><span>&amp;</span>lt;</span>h1<span class="entity"><span>&amp;</span>gt;</span><span class="entity"><span>&amp;</span>lt;</span>span id='logo'<span class="entity"><span>&amp;</span>gt;</span><span class="entity"><span>&amp;</span>quot;</span> . PROJECT . <span class="entity"><span>&amp;</span>quot;</span><span class="entity"><span>&amp;</span>lt;</span>/span<span class="entity"><span>&amp;</span>gt;</span> <span class="entity"><span>&amp;</span>lt;</span>span id='version'<span class="entity"><span>&amp;</span>gt;</span>v<span class="entity"><span>&amp;</span>quot;</span> . VERSION . <span class="entity"><span>&amp;</span>quot;</span><span class="entity"><span>&amp;</span>lt;</span>/span<span class="entity"><span>&amp;</span>gt;</span><span class="entity"><span>&amp;</span>lt;</span>/h1<span class="entity"><span>&amp;</span>gt;</span><span class="entity"><span>&amp;</span>quot;</span>;
<span id="line1841"></span> echo <span class="entity"><span>&amp;</span>quot;</span><span class="entity"><span>&amp;</span>lt;</span>div style='padding:15px; text-align:center;'<span class="entity"><span>&amp;</span>gt;</span><span class="entity"><span>&amp;</span>quot;</span>;
<span id="line1842"></span> if (isset($_GET['failed']))
<span id="line1843"></span> echo <span class="entity"><span>&amp;</span>quot;</span><span class="entity"><span>&amp;</span>lt;</span>span class='warning'<span class="entity"><span>&amp;</span>gt;</span><span class="entity"><span>&amp;</span>quot;</span> . $lang['passwd_incorrect'] . <span class="entity"><span>&amp;</span>quot;</span><span class="entity"><span>&amp;</span>lt;</span>/span<span class="entity"><span>&amp;</span>gt;</span><span class="entity"><span>&amp;</span>lt;</span>br/<span class="entity"><span>&amp;</span>gt;</span><span class="entity"><span>&amp;</span>lt;</span>br/<span class="entity"><span>&amp;</span>gt;</span><span class="entity"><span>&amp;</span>quot;</span>;
<span id="line1844"></span> echo $params-<span class="entity"><span>&amp;</span>gt;</span>getForm();
<span id="line1845"></span> echo $lang['passwd'] . <span class="entity"><span>&amp;</span>quot;</span>: <span class="entity"><span>&amp;</span>lt;</span>input type='password' name='password' autofocus='autofocus'/<span class="entity"><span>&amp;</span>gt;</span><span class="entity"><span>&amp;</span>lt;</span>br/<span class="entity"><span>&amp;</span>gt;</span><span class="entity"><span>&amp;</span>quot;</span>;
<span id="line1846"></span> echo <span class="entity"><span>&amp;</span>quot;</span><span class="entity"><span>&amp;</span>lt;</span>label<span class="entity"><span>&amp;</span>gt;</span><span class="entity"><span>&amp;</span>lt;</span>input type='checkbox' name='remember' value='yes' checked='checked'/<span class="entity"><span>&amp;</span>gt;</span> <span class="entity"><span>&amp;</span>quot;</span> . $lang['remember'] . <span class="entity"><span>&amp;</span>quot;</span><span class="entity"><span>&amp;</span>lt;</span>/label<span class="entity"><span>&amp;</span>gt;</span><span class="entity"><span>&amp;</span>lt;</span>br/<span class="entity"><span>&amp;</span>gt;</span><span class="entity"><span>&amp;</span>lt;</span>br/<span class="entity"><span>&amp;</span>gt;</span><span class="entity"><span>&amp;</span>quot;</span>;
<span id="line1847"></span> echo <span class="entity"><span>&amp;</span>quot;</span><span class="entity"><span>&amp;</span>lt;</span>input type='submit' value='<span class="entity"><span>&amp;</span>quot;</span> . $lang['login'] . <span class="entity"><span>&amp;</span>quot;</span>' class='btn'/<span class="entity"><span>&amp;</span>gt;</span><span class="entity"><span>&amp;</span>quot;</span>;
<span id="line1848"></span> echo <span class="entity"><span>&amp;</span>quot;</span><span class="entity"><span>&amp;</span>lt;</span>input type='hidden' name='login' value='true' /<span class="entity"><span>&amp;</span>gt;</span><span class="entity"><span>&amp;</span>quot;</span>;
<span id="line1849"></span> echo <span class="entity"><span>&amp;</span>quot;</span><span class="entity"><span>&amp;</span>lt;</span>/form<span class="entity"><span>&amp;</span>gt;</span><span class="entity"><span>&amp;</span>quot;</span>;
<span id="line1850"></span> echo <span class="entity"><span>&amp;</span>quot;</span><span class="entity"><span>&amp;</span>lt;</span>/div<span class="entity"><span>&amp;</span>gt;</span><span class="entity"><span>&amp;</span>quot;</span>;
<span id="line1851"></span> echo <span class="entity"><span>&amp;</span>quot;</span><span class="entity"><span>&amp;</span>lt;</span>/div<span class="entity"><span>&amp;</span>gt;</span><span class="entity"><span>&amp;</span>quot;</span>;
<span id="line1852"></span> echo <span class="entity"><span>&amp;</span>quot;</span><span class="entity"><span>&amp;</span>lt;</span>br/<span class="entity"><span>&amp;</span>gt;</span><span class="entity"><span>&amp;</span>quot;</span>;
<span id="line1853"></span> echo <span class="entity"><span>&amp;</span>quot;</span><span class="entity"><span>&amp;</span>lt;</span>div style='text-align:center;'<span class="entity"><span>&amp;</span>gt;</span><span class="entity"><span>&amp;</span>quot;</span>;
<span id="line1854"></span> echo <span class="entity"><span>&amp;</span>quot;</span><span class="entity"><span>&amp;</span>lt;</span>span style='font-size:11px;'<span class="entity"><span>&amp;</span>gt;</span><span class="entity"><span>&amp;</span>quot;</span> . $lang['powered'] . <span class="entity"><span>&amp;</span>quot;</span> <span class="entity"><span>&amp;</span>lt;</span>a href='<span class="entity"><span>&amp;</span>quot;</span> . PROJECT_URL . <span class="entity"><span>&amp;</span>quot;</span>' target='_blank' style='font-size:11px;'<span class="entity"><span>&amp;</span>gt;</span><span class="entity"><span>&amp;</span>quot;</span> . PROJECT . <span class="entity"><span>&amp;</span>quot;</span><span class="entity"><span>&amp;</span>lt;</span>/a<span class="entity"><span>&amp;</span>gt;</span> | <span class="entity"><span>&amp;</span>quot;</span>;
<span id="line1855"></span> printf($lang['page_gen'], $pageTimer);
<span id="line1856"></span> echo <span class="entity"><span>&amp;</span>quot;</span><span class="entity"><span>&amp;</span>lt;</span>/span<span class="entity"><span>&amp;</span>gt;</span><span class="entity"><span>&amp;</span>lt;</span>/div<span class="entity"><span>&amp;</span>gt;</span><span class="entity"><span>&amp;</span>quot;</span>;
<span id="line1857"></span> echo <span class="entity"><span>&amp;</span>quot;</span><span class="entity"><span>&amp;</span>lt;</span>/body<span class="entity"><span>&amp;</span>gt;</span><span class="entity"><span>&amp;</span>lt;</span>/html<span class="entity"><span>&amp;</span>gt;</span><span class="entity"><span>&amp;</span>quot;</span>;
<span id="line1858"></span> exit();
<span id="line1859"></span>}
<span id="line1860"></span>
<span id="line1861"></span>//- User is authorized, display the main application
<span id="line1862"></span>if (count($databases) == 0) // the database array is empty, offer to create a new database
<span id="line1863"></span>{
<span id="line1864"></span> //- HTML: form to create a new database, exit
<span id="line1865"></span> if ($directory !== false <span class="entity"><span>&amp;</span>amp;</span><span class="entity"><span>&amp;</span>amp;</span> is_writable($directory)) {
<span id="line1866"></span> echo <span class="entity"><span>&amp;</span>quot;</span><span class="entity"><span>&amp;</span>lt;</span>div class='confirm' style='margin:20px;'<span class="entity"><span>&amp;</span>gt;</span><span class="entity"><span>&amp;</span>quot;</span>;
<span id="line1867"></span> printf($lang['no_db'], PROJECT, PROJECT);;
<span id="line1868"></span> echo <span class="entity"><span>&amp;</span>quot;</span><span class="entity"><span>&amp;</span>lt;</span>/div<span class="entity"><span>&amp;</span>gt;</span><span class="entity"><span>&amp;</span>quot;</span>;
<span id="line1869"></span> //if the user has performed some action, show the resulting message
<span id="line1870"></span> if (isset($_GET['message']) <span class="entity"><span>&amp;</span>amp;</span><span class="entity"><span>&amp;</span>amp;</span> isset($_SESSION[COOKIENAME . 'messages'][$_GET['message']])) {
<span id="line1871"></span> echo <span class="entity"><span>&amp;</span>quot;</span><span class="entity"><span>&amp;</span>lt;</span>div class='confirm' style='margin:10px 20px;'<span class="entity"><span>&amp;</span>gt;</span><span class="entity"><span>&amp;</span>quot;</span>;
<span id="line1872"></span> echo $_SESSION[COOKIENAME . 'messages'][$_GET['message']];
<span id="line1873"></span> echo <span class="entity"><span>&amp;</span>quot;</span><span class="entity"><span>&amp;</span>lt;</span>/div<span class="entity"><span>&amp;</span>gt;</span><span class="entity"><span>&amp;</span>lt;</span>br /<span class="entity"><span>&amp;</span>gt;</span><span class="entity"><span>&amp;</span>quot;</span>;
<span id="line1874"></span> unset($_SESSION[COOKIENAME . 'messages'][$_GET['message']]);
<span id="line1875"></span> }
<span id="line1876"></span> echo <span class="entity"><span>&amp;</span>quot;</span><span class="entity"><span>&amp;</span>lt;</span>fieldset style='margin:15px;'<span class="entity"><span>&amp;</span>gt;</span><span class="entity"><span>&amp;</span>lt;</span>legend<span class="entity"><span>&amp;</span>gt;</span><span class="entity"><span>&amp;</span>lt;</span>b<span class="entity"><span>&amp;</span>gt;</span><span class="entity"><span>&amp;</span>quot;</span> . $lang['db_create'] . <span class="entity"><span>&amp;</span>quot;</span><span class="entity"><span>&amp;</span>lt;</span>/b<span class="entity"><span>&amp;</span>gt;</span><span class="entity"><span>&amp;</span>lt;</span>/legend<span class="entity"><span>&amp;</span>gt;</span><span class="entity"><span>&amp;</span>quot;</span>;
<span id="line1877"></span> echo $params-<span class="entity"><span>&amp;</span>gt;</span>getForm(array('table' =<span class="entity"><span>&amp;</span>gt;</span> null), 'post', false, 'create_database');
<span id="line1878"></span> echo <span class="entity"><span>&amp;</span>quot;</span><span class="entity"><span>&amp;</span>lt;</span>input type='text' name='new_dbname' style='width:150px;'/<span class="entity"><span>&amp;</span>gt;</span> <span class="entity"><span>&amp;</span>quot;</span>;
<span id="line1879"></span> if (class_exists('SQLiteDatabase') <span class="entity"><span>&amp;</span>amp;</span><span class="entity"><span>&amp;</span>amp;</span> (class_exists('SQLite3') || class_exists('PDO'))) {
<span id="line1880"></span> echo <span class="entity"><span>&amp;</span>quot;</span><span class="entity"><span>&amp;</span>lt;</span>select name='new_dbtype' class='newDbType'<span class="entity"><span>&amp;</span>gt;</span><span class="entity"><span>&amp;</span>quot;</span>;
<span id="line1881"></span> echo <span class="entity"><span>&amp;</span>quot;</span><span class="entity"><span>&amp;</span>lt;</span>option value='3'<span class="entity"><span>&amp;</span>gt;</span>SQLite 3<span class="entity"><span>&amp;</span>lt;</span>/option<span class="entity"><span>&amp;</span>gt;</span><span class="entity"><span>&amp;</span>quot;</span>;
<span id="line1882"></span> echo <span class="entity"><span>&amp;</span>quot;</span><span class="entity"><span>&amp;</span>lt;</span>option value='2'<span class="entity"><span>&amp;</span>gt;</span>SQLite 2<span class="entity"><span>&amp;</span>lt;</span>/option<span class="entity"><span>&amp;</span>gt;</span><span class="entity"><span>&amp;</span>quot;</span>;
<span id="line1883"></span> echo <span class="entity"><span>&amp;</span>quot;</span><span class="entity"><span>&amp;</span>lt;</span>/select<span class="entity"><span>&amp;</span>gt;</span><span class="entity"><span>&amp;</span>quot;</span>;
<span id="line1884"></span> }
<span id="line1885"></span> echo <span class="entity"><span>&amp;</span>quot;</span><span class="entity"><span>&amp;</span>lt;</span>input type='submit' value='<span class="entity"><span>&amp;</span>quot;</span> . $lang['create'] . <span class="entity"><span>&amp;</span>quot;</span>' class='btn'/<span class="entity"><span>&amp;</span>gt;</span><span class="entity"><span>&amp;</span>quot;</span>;
<span id="line1886"></span> echo <span class="entity"><span>&amp;</span>quot;</span><span class="entity"><span>&amp;</span>lt;</span>/form<span class="entity"><span>&amp;</span>gt;</span><span class="entity"><span>&amp;</span>quot;</span>;
<span id="line1887"></span> echo <span class="entity"><span>&amp;</span>quot;</span><span class="entity"><span>&amp;</span>lt;</span>/fieldset<span class="entity"><span>&amp;</span>gt;</span><span class="entity"><span>&amp;</span>quot;</span>;
<span id="line1888"></span> } elseif (($directory !== false <span class="entity"><span>&amp;</span>amp;</span><span class="entity"><span>&amp;</span>amp;</span> !is_executable($directory))) {
<span id="line1889"></span> echo <span class="entity"><span>&amp;</span>quot;</span><span class="entity"><span>&amp;</span>lt;</span>div class='confirm' style='margin:20px;'<span class="entity"><span>&amp;</span>gt;</span><span class="entity"><span>&amp;</span>quot;</span>;
<span id="line1890"></span> echo $lang['err'] . <span class="entity"><span>&amp;</span>quot;</span>: <span class="entity"><span>&amp;</span>quot;</span> . sprintf($lang['dir_not_executable'], PROJECT, $directory);
<span id="line1891"></span> echo <span class="entity"><span>&amp;</span>quot;</span><span class="entity"><span>&amp;</span>lt;</span>/div<span class="entity"><span>&amp;</span>gt;</span><span class="entity"><span>&amp;</span>lt;</span>br/<span class="entity"><span>&amp;</span>gt;</span><span class="entity"><span>&amp;</span>quot;</span>;
<span id="line1892"></span> } else {
<span id="line1893"></span> echo <span class="entity"><span>&amp;</span>quot;</span><span class="entity"><span>&amp;</span>lt;</span>div class='confirm' style='margin:20px;'<span class="entity"><span>&amp;</span>gt;</span><span class="entity"><span>&amp;</span>quot;</span>;
<span id="line1894"></span> echo $lang['err'] . <span class="entity"><span>&amp;</span>quot;</span>: <span class="entity"><span>&amp;</span>quot;</span> . sprintf($lang['no_db2'], PROJECT);
<span id="line1895"></span> echo <span class="entity"><span>&amp;</span>quot;</span><span class="entity"><span>&amp;</span>lt;</span>/div<span class="entity"><span>&amp;</span>gt;</span><span class="entity"><span>&amp;</span>lt;</span>br/<span class="entity"><span>&amp;</span>gt;</span><span class="entity"><span>&amp;</span>quot;</span>;
<span id="line1896"></span> }
<span id="line1897"></span> exit();
<span id="line1898"></span>}
<span id="line1899"></span>
<span id="line1900"></span>//- HTML: sidebar
<span id="line1901"></span>echo '<span class="entity"><span>&amp;</span>lt;</span>table class=<span class="entity"><span>&amp;</span>quot;</span>body_tbl<span class="entity"><span>&amp;</span>quot;</span> width=<span class="entity"><span>&amp;</span>quot;</span>100%<span class="entity"><span>&amp;</span>quot;</span> border=<span class="entity"><span>&amp;</span>quot;</span>0<span class="entity"><span>&amp;</span>quot;</span> cellspacing=<span class="entity"><span>&amp;</span>quot;</span>0<span class="entity"><span>&amp;</span>quot;</span> cellpadding=<span class="entity"><span>&amp;</span>quot;</span>0<span class="entity"><span>&amp;</span>quot;</span><span class="entity"><span>&amp;</span>gt;</span><span class="entity"><span>&amp;</span>lt;</span>tr<span class="entity"><span>&amp;</span>gt;</span><span class="entity"><span>&amp;</span>lt;</span>td valign=<span class="entity"><span>&amp;</span>quot;</span>top<span class="entity"><span>&amp;</span>quot;</span> class=<span class="entity"><span>&amp;</span>quot;</span>left_td<span class="entity"><span>&amp;</span>quot;</span> style=<span class="entity"><span>&amp;</span>quot;</span>width:100px; padding:9px 2px 9px 9px;<span class="entity"><span>&amp;</span>quot;</span><span class="entity"><span>&amp;</span>gt;</span>';
<span id="line1902"></span>echo <span class="entity"><span>&amp;</span>quot;</span><span class="entity"><span>&amp;</span>lt;</span>div id='leftNav'<span class="entity"><span>&amp;</span>gt;</span><span class="entity"><span>&amp;</span>quot;</span>;
<span id="line1903"></span>echo <span class="entity"><span>&amp;</span>quot;</span><span class="entity"><span>&amp;</span>lt;</span>h1<span class="entity"><span>&amp;</span>gt;</span><span class="entity"><span>&amp;</span>lt;</span>a href='<span class="entity"><span>&amp;</span>quot;</span> . $params-<span class="entity"><span>&amp;</span>gt;</span>getURL() . <span class="entity"><span>&amp;</span>quot;</span>'<span class="entity"><span>&amp;</span>gt;</span><span class="entity"><span>&amp;</span>quot;</span>;
<span id="line1904"></span>echo <span class="entity"><span>&amp;</span>quot;</span><span class="entity"><span>&amp;</span>lt;</span>span id='logo'<span class="entity"><span>&amp;</span>gt;</span><span class="entity"><span>&amp;</span>quot;</span> . PROJECT . <span class="entity"><span>&amp;</span>quot;</span><span class="entity"><span>&amp;</span>lt;</span>/span<span class="entity"><span>&amp;</span>gt;</span> <span class="entity"><span>&amp;</span>lt;</span>span id='version'<span class="entity"><span>&amp;</span>gt;</span>v<span class="entity"><span>&amp;</span>quot;</span> . VERSION . <span class="entity"><span>&amp;</span>quot;</span><span class="entity"><span>&amp;</span>lt;</span>/span<span class="entity"><span>&amp;</span>gt;</span><span class="entity"><span>&amp;</span>quot;</span>;
<span id="line1905"></span>echo <span class="entity"><span>&amp;</span>quot;</span><span class="entity"><span>&amp;</span>lt;</span>/a<span class="entity"><span>&amp;</span>gt;</span><span class="entity"><span>&amp;</span>lt;</span>/h1<span class="entity"><span>&amp;</span>gt;</span><span class="entity"><span>&amp;</span>quot;</span>;
<span id="line1906"></span>echo <span class="entity"><span>&amp;</span>quot;</span><span class="entity"><span>&amp;</span>lt;</span>div id='headerlinks'<span class="entity"><span>&amp;</span>gt;</span><span class="entity"><span>&amp;</span>quot;</span>;
<span id="line1907"></span>echo <span class="entity"><span>&amp;</span>quot;</span><span class="entity"><span>&amp;</span>lt;</span>a href='javascript:void' onclick='openHelp(\<span class="entity"><span>&amp;</span>quot;</span>top\<span class="entity"><span>&amp;</span>quot;</span>);'<span class="entity"><span>&amp;</span>gt;</span><span class="entity"><span>&amp;</span>quot;</span> . $lang['docu'] . <span class="entity"><span>&amp;</span>quot;</span><span class="entity"><span>&amp;</span>lt;</span>/a<span class="entity"><span>&amp;</span>gt;</span> | <span class="entity"><span>&amp;</span>quot;</span>;
<span id="line1908"></span>echo <span class="entity"><span>&amp;</span>quot;</span><span class="entity"><span>&amp;</span>lt;</span>a href='https://www.gnu.org/licenses/gpl.html' target='_blank'<span class="entity"><span>&amp;</span>gt;</span><span class="entity"><span>&amp;</span>quot;</span> . $lang['license'] . <span class="entity"><span>&amp;</span>quot;</span><span class="entity"><span>&amp;</span>lt;</span>/a<span class="entity"><span>&amp;</span>gt;</span> | <span class="entity"><span>&amp;</span>quot;</span>;
<span id="line1909"></span>echo <span class="entity"><span>&amp;</span>quot;</span><span class="entity"><span>&amp;</span>lt;</span>a href='<span class="entity"><span>&amp;</span>quot;</span> . PROJECT_URL . <span class="entity"><span>&amp;</span>quot;</span>' target='_blank'<span class="entity"><span>&amp;</span>gt;</span><span class="entity"><span>&amp;</span>quot;</span> . $lang['proj_site'] . <span class="entity"><span>&amp;</span>quot;</span><span class="entity"><span>&amp;</span>lt;</span>/a<span class="entity"><span>&amp;</span>gt;</span><span class="entity"><span>&amp;</span>quot;</span>;
<span id="line1910"></span>echo <span class="entity"><span>&amp;</span>quot;</span><span class="entity"><span>&amp;</span>lt;</span>/div<span class="entity"><span>&amp;</span>gt;</span><span class="entity"><span>&amp;</span>quot;</span>;
<span id="line1911"></span>
<span id="line1912"></span>//- HTML: database list
<span id="line1913"></span>$db-<span class="entity"><span>&amp;</span>gt;</span>print_db_list();
<span id="line1914"></span>echo <span class="entity"><span>&amp;</span>quot;</span><span class="entity"><span>&amp;</span>lt;</span>fieldset style='margin:15px;'<span class="entity"><span>&amp;</span>gt;</span><span class="entity"><span>&amp;</span>lt;</span>legend<span class="entity"><span>&amp;</span>gt;</span><span class="entity"><span>&amp;</span>quot;</span>;
<span id="line1915"></span>echo <span class="entity"><span>&amp;</span>quot;</span><span class="entity"><span>&amp;</span>lt;</span>a href='<span class="entity"><span>&amp;</span>quot;</span> . $params-<span class="entity"><span>&amp;</span>gt;</span>getURL(array('table' =<span class="entity"><span>&amp;</span>gt;</span> null)) . <span class="entity"><span>&amp;</span>quot;</span>'<span class="entity"><span>&amp;</span>quot;</span>;
<span id="line1916"></span>if (!$target_table)
<span id="line1917"></span> echo <span class="entity"><span>&amp;</span>quot;</span> class='active_table'<span class="entity"><span>&amp;</span>quot;</span>;
<span id="line1918"></span>$name = $currentDB['name'];
<span id="line1919"></span>if (strlen($name) <span class="entity"><span>&amp;</span>gt;</span> 25)
<span id="line1920"></span> $name = <span class="entity"><span>&amp;</span>quot;</span>...<span class="entity"><span>&amp;</span>quot;</span> . substr($name, strlen($name) - 22, 22);
<span id="line1921"></span>echo <span class="entity"><span>&amp;</span>quot;</span><span class="entity"><span>&amp;</span>gt;</span><span class="entity"><span>&amp;</span>quot;</span> . htmlencode($name) . <span class="entity"><span>&amp;</span>quot;</span><span class="entity"><span>&amp;</span>lt;</span>/a<span class="entity"><span>&amp;</span>gt;</span><span class="entity"><span>&amp;</span>quot;</span>;
<span id="line1922"></span>echo <span class="entity"><span>&amp;</span>quot;</span><span class="entity"><span>&amp;</span>lt;</span>/legend<span class="entity"><span>&amp;</span>gt;</span><span class="entity"><span>&amp;</span>quot;</span>;
<span id="line1923"></span>
<span id="line1924"></span>//- HTML: table list
<span id="line1925"></span>$tables = $db-<span class="entity"><span>&amp;</span>gt;</span>getTables(true, false);
<span id="line1926"></span>foreach ($tables as $tableName =<span class="entity"><span>&amp;</span>gt;</span> $tableType) {
<span id="line1927"></span> echo <span class="entity"><span>&amp;</span>quot;</span><span class="entity"><span>&amp;</span>lt;</span>span class='sidebar_table'<span class="entity"><span>&amp;</span>gt;</span><span class="entity"><span>&amp;</span>quot;</span>;
<span id="line1928"></span> echo $params-<span class="entity"><span>&amp;</span>gt;</span>getLink(array('action' =<span class="entity"><span>&amp;</span>gt;</span> 'column_view', 'table' =<span class="entity"><span>&amp;</span>gt;</span> $tableName), <span class="entity"><span>&amp;</span>quot;</span>[<span class="entity"><span>&amp;</span>quot;</span> . $lang[$tableType == 'table' ? 'tbl' : 'view'] . <span class="entity"><span>&amp;</span>quot;</span>]<span class="entity"><span>&amp;</span>quot;</span>);
<span id="line1929"></span> echo <span class="entity"><span>&amp;</span>quot;</span><span class="entity"><span>&amp;</span>lt;</span>/span<span class="entity"><span>&amp;</span>gt;</span> <span class="entity"><span>&amp;</span>quot;</span>;
<span id="line1930"></span> echo $params-<span class="entity"><span>&amp;</span>gt;</span>getLink(array('action' =<span class="entity"><span>&amp;</span>gt;</span> 'row_view', 'table' =<span class="entity"><span>&amp;</span>gt;</span> $tableName), htmlencode($tableName),
<span id="line1931"></span> ($target_table == $tableName ? 'active_table' : ''));
<span id="line1932"></span> echo <span class="entity"><span>&amp;</span>quot;</span><span class="entity"><span>&amp;</span>lt;</span>br/<span class="entity"><span>&amp;</span>gt;</span><span class="entity"><span>&amp;</span>quot;</span>;
<span id="line1933"></span>}
<span id="line1934"></span>if (count($tables) == 0)
<span id="line1935"></span> echo $lang['no_tbl'];
<span id="line1936"></span>echo <span class="entity"><span>&amp;</span>quot;</span><span class="entity"><span>&amp;</span>lt;</span>/fieldset<span class="entity"><span>&amp;</span>gt;</span><span class="entity"><span>&amp;</span>quot;</span>;
<span id="line1937"></span>
<span id="line1938"></span>//- HTML: form to create a new database
<span id="line1939"></span>if ($directory !== false <span class="entity"><span>&amp;</span>amp;</span><span class="entity"><span>&amp;</span>amp;</span> is_writable($directory)) {
<span id="line1940"></span> echo <span class="entity"><span>&amp;</span>quot;</span><span class="entity"><span>&amp;</span>lt;</span>fieldset style='margin:15px;'<span class="entity"><span>&amp;</span>gt;</span><span class="entity"><span>&amp;</span>lt;</span>legend<span class="entity"><span>&amp;</span>gt;</span><span class="entity"><span>&amp;</span>lt;</span>b<span class="entity"><span>&amp;</span>gt;</span><span class="entity"><span>&amp;</span>quot;</span> . $lang['db_create'] . <span class="entity"><span>&amp;</span>quot;</span><span class="entity"><span>&amp;</span>lt;</span>/b<span class="entity"><span>&amp;</span>gt;</span> <span class="entity"><span>&amp;</span>quot;</span> . helpLink($lang['help2']) . <span class="entity"><span>&amp;</span>quot;</span><span class="entity"><span>&amp;</span>lt;</span>/legend<span class="entity"><span>&amp;</span>gt;</span><span class="entity"><span>&amp;</span>quot;</span>;
<span id="line1941"></span> echo $params-<span class="entity"><span>&amp;</span>gt;</span>getForm(array('table' =<span class="entity"><span>&amp;</span>gt;</span> null), 'post', false, 'create_database');
<span id="line1942"></span> echo <span class="entity"><span>&amp;</span>quot;</span><span class="entity"><span>&amp;</span>lt;</span>input type='text' name='new_dbname' style='width:150px;'/<span class="entity"><span>&amp;</span>gt;</span><span class="entity"><span>&amp;</span>quot;</span>;
<span id="line1943"></span> if (class_exists('SQLiteDatabase') <span class="entity"><span>&amp;</span>amp;</span><span class="entity"><span>&amp;</span>amp;</span> (class_exists('SQLite3') || class_exists('PDO'))) {
<span id="line1944"></span> echo <span class="entity"><span>&amp;</span>quot;</span><span class="entity"><span>&amp;</span>lt;</span>select name='new_dbtype' class='newDbType'<span class="entity"><span>&amp;</span>gt;</span><span class="entity"><span>&amp;</span>quot;</span>;
<span id="line1945"></span> echo <span class="entity"><span>&amp;</span>quot;</span><span class="entity"><span>&amp;</span>lt;</span>option value='3'<span class="entity"><span>&amp;</span>gt;</span>SQLite 3<span class="entity"><span>&amp;</span>lt;</span>/option<span class="entity"><span>&amp;</span>gt;</span><span class="entity"><span>&amp;</span>quot;</span>;
<span id="line1946"></span> echo <span class="entity"><span>&amp;</span>quot;</span><span class="entity"><span>&amp;</span>lt;</span>option value='2'<span class="entity"><span>&amp;</span>gt;</span>SQLite 2<span class="entity"><span>&amp;</span>lt;</span>/option<span class="entity"><span>&amp;</span>gt;</span><span class="entity"><span>&amp;</span>quot;</span>;
<span id="line1947"></span> echo <span class="entity"><span>&amp;</span>quot;</span><span class="entity"><span>&amp;</span>lt;</span>/select<span class="entity"><span>&amp;</span>gt;</span><span class="entity"><span>&amp;</span>quot;</span>;
<span id="line1948"></span> }
<span id="line1949"></span> echo <span class="entity"><span>&amp;</span>quot;</span><span class="entity"><span>&amp;</span>lt;</span>input type='submit' value='<span class="entity"><span>&amp;</span>quot;</span> . $lang['create'] . <span class="entity"><span>&amp;</span>quot;</span>' class='btn'/<span class="entity"><span>&amp;</span>gt;</span><span class="entity"><span>&amp;</span>quot;</span>;
<span id="line1950"></span> echo <span class="entity"><span>&amp;</span>quot;</span><span class="entity"><span>&amp;</span>lt;</span>/form<span class="entity"><span>&amp;</span>gt;</span><span class="entity"><span>&amp;</span>quot;</span>;
<span id="line1951"></span> echo <span class="entity"><span>&amp;</span>quot;</span><span class="entity"><span>&amp;</span>lt;</span>/fieldset<span class="entity"><span>&amp;</span>gt;</span><span class="entity"><span>&amp;</span>quot;</span>;
<span id="line1952"></span>}
<span id="line1953"></span>
<span id="line1954"></span>echo <span class="entity"><span>&amp;</span>quot;</span><span class="entity"><span>&amp;</span>lt;</span>div style='text-align:center;'<span class="entity"><span>&amp;</span>gt;</span><span class="entity"><span>&amp;</span>quot;</span>;
<span id="line1955"></span>echo $params-<span class="entity"><span>&amp;</span>gt;</span>getForm(array(), 'get');
<span id="line1956"></span>echo <span class="entity"><span>&amp;</span>quot;</span><span class="entity"><span>&amp;</span>lt;</span>input type='submit' value='<span class="entity"><span>&amp;</span>quot;</span> . $lang['logout'] . <span class="entity"><span>&amp;</span>quot;</span>' name='logout' class='btn'/<span class="entity"><span>&amp;</span>gt;</span><span class="entity"><span>&amp;</span>quot;</span>;
<span id="line1957"></span>echo <span class="entity"><span>&amp;</span>quot;</span><span class="entity"><span>&amp;</span>lt;</span>/form<span class="entity"><span>&amp;</span>gt;</span><span class="entity"><span>&amp;</span>quot;</span>;
<span id="line1958"></span>echo <span class="entity"><span>&amp;</span>quot;</span><span class="entity"><span>&amp;</span>lt;</span>/div<span class="entity"><span>&amp;</span>gt;</span><span class="entity"><span>&amp;</span>quot;</span>;
<span id="line1959"></span>echo <span class="entity"><span>&amp;</span>quot;</span><span class="entity"><span>&amp;</span>lt;</span>/div<span class="entity"><span>&amp;</span>gt;</span><span class="entity"><span>&amp;</span>quot;</span>;
<span id="line1960"></span>echo '<span class="entity"><span>&amp;</span>lt;</span>/td<span class="entity"><span>&amp;</span>gt;</span><span class="entity"><span>&amp;</span>lt;</span>td valign=<span class="entity"><span>&amp;</span>quot;</span>top<span class="entity"><span>&amp;</span>quot;</span> id=<span class="entity"><span>&amp;</span>quot;</span>main_column<span class="entity"><span>&amp;</span>quot;</span> class=<span class="entity"><span>&amp;</span>quot;</span>right_td<span class="entity"><span>&amp;</span>quot;</span> style=<span class="entity"><span>&amp;</span>quot;</span>padding:9px 2px 9px 9px;<span class="entity"><span>&amp;</span>quot;</span><span class="entity"><span>&amp;</span>gt;</span>';
<span id="line1961"></span>
<span id="line1962"></span>//- HTML: breadcrumb navigation
<span id="line1963"></span>echo $params-<span class="entity"><span>&amp;</span>gt;</span>getLink(array('table' =<span class="entity"><span>&amp;</span>gt;</span> null), htmlencode($currentDB['name']));
<span id="line1964"></span>if ($target_table)
<span id="line1965"></span> echo <span class="entity"><span>&amp;</span>quot;</span> <span class="entity"><span>&amp;</span>amp;</span>rarr; <span class="entity"><span>&amp;</span>quot;</span> . $params-<span class="entity"><span>&amp;</span>gt;</span>getLink(array('action' =<span class="entity"><span>&amp;</span>gt;</span> 'row_view'), htmlencode($target_table));
<span id="line1966"></span>echo <span class="entity"><span>&amp;</span>quot;</span><span class="entity"><span>&amp;</span>lt;</span>br/<span class="entity"><span>&amp;</span>gt;</span><span class="entity"><span>&amp;</span>lt;</span>br/<span class="entity"><span>&amp;</span>gt;</span><span class="entity"><span>&amp;</span>quot;</span>;
<span id="line1967"></span>
<span id="line1968"></span>//- Show the various tab views for a table
<span id="line1969"></span>if ($target_table) {
<span id="line1970"></span> //- HTML: tabs
<span id="line1971"></span> echo $params-<span class="entity"><span>&amp;</span>gt;</span>getLink(array('action' =<span class="entity"><span>&amp;</span>gt;</span> 'row_view'), $lang['browse'],
<span id="line1972"></span> (in_array($_GET['action'], array('row_view', 'row_editordelete')) ? 'tab_pressed' : 'tab'));
<span id="line1973"></span>
<span id="line1974"></span> echo $params-<span class="entity"><span>&amp;</span>gt;</span>getLink(array('action' =<span class="entity"><span>&amp;</span>gt;</span> 'column_view'), $lang['struct'],
<span id="line1975"></span> (in_array($_GET['action'], array('column_view', 'column_edit', 'column_confirm', 'primarykey_add', 'column_create', 'index_create', 'index_delete', 'trigger_create', 'trigger_delete')) ? 'tab_pressed' : 'tab'));
<span id="line1976"></span>
<span id="line1977"></span> echo $params-<span class="entity"><span>&amp;</span>gt;</span>getLink(array('action' =<span class="entity"><span>&amp;</span>gt;</span> 'table_sql'), $lang['sql'],
<span id="line1978"></span> ($_GET['action'] == <span class="entity"><span>&amp;</span>quot;</span>table_sql<span class="entity"><span>&amp;</span>quot;</span> ? 'tab_pressed' : 'tab'));
<span id="line1979"></span>
<span id="line1980"></span> echo $params-<span class="entity"><span>&amp;</span>gt;</span>getLink(array(
<span id="line1981"></span> 'action' =<span class="entity"><span>&amp;</span>gt;</span> 'table_search',
<span id="line1982"></span> 'oldSearch' =<span class="entity"><span>&amp;</span>gt;</span> (isset($_GET['search']) ? $_GET['search'] : null)
<span id="line1983"></span> ), $lang['srch'], ($_GET['action'] == <span class="entity"><span>&amp;</span>quot;</span>table_search<span class="entity"><span>&amp;</span>quot;</span> ? 'tab_pressed' : 'tab'));
<span id="line1984"></span>
<span id="line1985"></span> if ($target_table_type == 'table' <span class="entity"><span>&amp;</span>amp;</span><span class="entity"><span>&amp;</span>amp;</span> $db-<span class="entity"><span>&amp;</span>gt;</span>isWritable() <span class="entity"><span>&amp;</span>amp;</span><span class="entity"><span>&amp;</span>amp;</span> $db-<span class="entity"><span>&amp;</span>gt;</span>isDirWritable())
<span id="line1986"></span> echo $params-<span class="entity"><span>&amp;</span>gt;</span>getLink(array('action' =<span class="entity"><span>&amp;</span>gt;</span> 'row_create'), $lang['insert'],
<span id="line1987"></span> ($_GET['action'] == <span class="entity"><span>&amp;</span>quot;</span>row_create<span class="entity"><span>&amp;</span>quot;</span> ? 'tab_pressed' : 'tab'));
<span id="line1988"></span>
<span id="line1989"></span> echo $params-<span class="entity"><span>&amp;</span>gt;</span>getLink(array('action' =<span class="entity"><span>&amp;</span>gt;</span> 'table_export'), $lang['export'],
<span id="line1990"></span> ($_GET['action'] == <span class="entity"><span>&amp;</span>quot;</span>table_export<span class="entity"><span>&amp;</span>quot;</span> ? 'tab_pressed' : 'tab'));
<span id="line1991"></span>
<span id="line1992"></span> if ($target_table_type == 'table' <span class="entity"><span>&amp;</span>amp;</span><span class="entity"><span>&amp;</span>amp;</span> $db-<span class="entity"><span>&amp;</span>gt;</span>isWritable() <span class="entity"><span>&amp;</span>amp;</span><span class="entity"><span>&amp;</span>amp;</span> $db-<span class="entity"><span>&amp;</span>gt;</span>isDirWritable())
<span id="line1993"></span> echo $params-<span class="entity"><span>&amp;</span>gt;</span>getLink(array('action' =<span class="entity"><span>&amp;</span>gt;</span> 'table_import'), $lang['import'],
<span id="line1994"></span> ($_GET['action'] == <span class="entity"><span>&amp;</span>quot;</span>table_import<span class="entity"><span>&amp;</span>quot;</span> ? 'tab_pressed' : 'tab'));
<span id="line1995"></span>
<span id="line1996"></span> if ($db-<span class="entity"><span>&amp;</span>gt;</span>isWritable() <span class="entity"><span>&amp;</span>amp;</span><span class="entity"><span>&amp;</span>amp;</span> $db-<span class="entity"><span>&amp;</span>gt;</span>isDirWritable())
<span id="line1997"></span> echo $params-<span class="entity"><span>&amp;</span>gt;</span>getLink(array('action' =<span class="entity"><span>&amp;</span>gt;</span> 'table_rename'), $lang['rename'],
<span id="line1998"></span> ($_GET['action'] == <span class="entity"><span>&amp;</span>quot;</span>table_rename<span class="entity"><span>&amp;</span>quot;</span> ? 'tab_pressed' : 'tab'));
<span id="line1999"></span>
<span id="line2000"></span> if ($target_table_type == 'table' <span class="entity"><span>&amp;</span>amp;</span><span class="entity"><span>&amp;</span>amp;</span> $db-<span class="entity"><span>&amp;</span>gt;</span>isWritable() <span class="entity"><span>&amp;</span>amp;</span><span class="entity"><span>&amp;</span>amp;</span> $db-<span class="entity"><span>&amp;</span>gt;</span>isDirWritable()) {
<span id="line2001"></span> echo $params-<span class="entity"><span>&amp;</span>gt;</span>getLink(array('action' =<span class="entity"><span>&amp;</span>gt;</span> 'table_empty'), $lang['empty'],
<span id="line2002"></span> ($_GET['action'] == <span class="entity"><span>&amp;</span>quot;</span>table_empty<span class="entity"><span>&amp;</span>quot;</span> ? 'tab_pressed empty' : 'tab empty'));
<span id="line2003"></span>
<span id="line2004"></span> echo $params-<span class="entity"><span>&amp;</span>gt;</span>getLink(array('action' =<span class="entity"><span>&amp;</span>gt;</span> 'table_drop'), $lang['drop'],
<span id="line2005"></span> ($_GET['action'] == <span class="entity"><span>&amp;</span>quot;</span>table_drop<span class="entity"><span>&amp;</span>quot;</span> ? 'tab_pressed drop' : 'tab drop'));
<span id="line2006"></span> } elseif ($db-<span class="entity"><span>&amp;</span>gt;</span>isWritable() <span class="entity"><span>&amp;</span>amp;</span><span class="entity"><span>&amp;</span>amp;</span> $db-<span class="entity"><span>&amp;</span>gt;</span>isDirWritable()) {
<span id="line2007"></span> echo $params-<span class="entity"><span>&amp;</span>gt;</span>getLink(array('action' =<span class="entity"><span>&amp;</span>gt;</span> 'view_drop'), $lang['drop'],
<span id="line2008"></span> ($_GET['action'] == <span class="entity"><span>&amp;</span>quot;</span>view_drop<span class="entity"><span>&amp;</span>quot;</span> ? 'tab_pressed drop' : 'tab drop'));
<span id="line2009"></span> }
<span id="line2010"></span>} else //- Show the various tab views for a database
<span id="line2011"></span>{
<span id="line2012"></span> $view = isset($_GET['view']) ? $_GET['view'] : 'structure';
<span id="line2013"></span>
<span id="line2014"></span> echo $params-<span class="entity"><span>&amp;</span>gt;</span>getLink(array('view' =<span class="entity"><span>&amp;</span>gt;</span> 'structure'), $lang['struct'], ($view == <span class="entity"><span>&amp;</span>quot;</span>structure<span class="entity"><span>&amp;</span>quot;</span> ? 'tab_pressed' : 'tab'));
<span id="line2015"></span>
<span id="line2016"></span> echo $params-<span class="entity"><span>&amp;</span>gt;</span>getLink(array('view' =<span class="entity"><span>&amp;</span>gt;</span> 'sql'), $lang['sql'], ($view == <span class="entity"><span>&amp;</span>quot;</span>sql<span class="entity"><span>&amp;</span>quot;</span> ? 'tab_pressed' : 'tab'));
<span id="line2017"></span>
<span id="line2018"></span> echo $params-<span class="entity"><span>&amp;</span>gt;</span>getLink(array('view' =<span class="entity"><span>&amp;</span>gt;</span> 'export'), $lang['export'], ($view == <span class="entity"><span>&amp;</span>quot;</span>export<span class="entity"><span>&amp;</span>quot;</span> ? 'tab_pressed' : 'tab'));
<span id="line2019"></span>
<span id="line2020"></span> if ($db-<span class="entity"><span>&amp;</span>gt;</span>isWritable() <span class="entity"><span>&amp;</span>amp;</span><span class="entity"><span>&amp;</span>amp;</span> $db-<span class="entity"><span>&amp;</span>gt;</span>isDirWritable())
<span id="line2021"></span> echo $params-<span class="entity"><span>&amp;</span>gt;</span>getLink(array('view' =<span class="entity"><span>&amp;</span>gt;</span> 'import'), $lang['import'], ($view == <span class="entity"><span>&amp;</span>quot;</span>import<span class="entity"><span>&amp;</span>quot;</span> ? 'tab_pressed' : 'tab'));
<span id="line2022"></span>
<span id="line2023"></span> if ($db-<span class="entity"><span>&amp;</span>gt;</span>isWritable() <span class="entity"><span>&amp;</span>amp;</span><span class="entity"><span>&amp;</span>amp;</span> $db-<span class="entity"><span>&amp;</span>gt;</span>isDirWritable())
<span id="line2024"></span> echo $params-<span class="entity"><span>&amp;</span>gt;</span>getLink(array('view' =<span class="entity"><span>&amp;</span>gt;</span> 'vacuum'), $lang['vac'], ($view == <span class="entity"><span>&amp;</span>quot;</span>vacuum<span class="entity"><span>&amp;</span>quot;</span> ? 'tab_pressed' : 'tab'));
<span id="line2025"></span>
<span id="line2026"></span> if ($directory !== false <span class="entity"><span>&amp;</span>amp;</span><span class="entity"><span>&amp;</span>amp;</span> is_writable($directory)) {
<span id="line2027"></span>
<span id="line2028"></span> echo $params-<span class="entity"><span>&amp;</span>gt;</span>getLink(array('view' =<span class="entity"><span>&amp;</span>gt;</span> 'rename'), $lang['db_rename'], ($view == <span class="entity"><span>&amp;</span>quot;</span>rename<span class="entity"><span>&amp;</span>quot;</span> ? 'tab_pressed' : 'tab'));
<span id="line2029"></span>
<span id="line2030"></span> echo $params-<span class="entity"><span>&amp;</span>gt;</span>getLink(array('view' =<span class="entity"><span>&amp;</span>gt;</span> 'delete'), <span class="entity"><span>&amp;</span>quot;</span><span class="entity"><span>&amp;</span>lt;</span>span<span class="entity"><span>&amp;</span>gt;</span><span class="entity"><span>&amp;</span>quot;</span> . $lang['db_del'] . <span class="entity"><span>&amp;</span>quot;</span><span class="entity"><span>&amp;</span>lt;</span>/span<span class="entity"><span>&amp;</span>gt;</span><span class="entity"><span>&amp;</span>quot;</span>, ($view == <span class="entity"><span>&amp;</span>quot;</span>delete<span class="entity"><span>&amp;</span>quot;</span> ? 'tab_pressed delete_db' : 'tab delete_db'));
<span id="line2031"></span> }
<span id="line2032"></span>}
<span id="line2033"></span>
<span id="line2034"></span>echo <span class="entity"><span>&amp;</span>quot;</span><span class="entity"><span>&amp;</span>lt;</span>div style='clear:both;'<span class="entity"><span>&amp;</span>gt;</span><span class="entity"><span>&amp;</span>lt;</span>/div<span class="entity"><span>&amp;</span>gt;</span><span class="entity"><span>&amp;</span>quot;</span>;
<span id="line2035"></span>echo <span class="entity"><span>&amp;</span>quot;</span><span class="entity"><span>&amp;</span>lt;</span>div id='main'<span class="entity"><span>&amp;</span>gt;</span><span class="entity"><span>&amp;</span>quot;</span>;
<span id="line2036"></span>
<span id="line2037"></span>//- HTML: confirmation panel
<span id="line2038"></span>//if the user has performed some action, show the resulting message
<span id="line2039"></span>if (isset($_GET['message']) <span class="entity"><span>&amp;</span>amp;</span><span class="entity"><span>&amp;</span>amp;</span> isset($_SESSION[COOKIENAME . 'messages'][$_GET['message']])) {
<span id="line2040"></span> echo <span class="entity"><span>&amp;</span>quot;</span><span class="entity"><span>&amp;</span>lt;</span>div class='confirm'<span class="entity"><span>&amp;</span>gt;</span><span class="entity"><span>&amp;</span>quot;</span>;
<span id="line2041"></span> echo $_SESSION[COOKIENAME . 'messages'][$_GET['message']];
<span id="line2042"></span> echo <span class="entity"><span>&amp;</span>quot;</span><span class="entity"><span>&amp;</span>lt;</span>/div<span class="entity"><span>&amp;</span>gt;</span><span class="entity"><span>&amp;</span>lt;</span>br /<span class="entity"><span>&amp;</span>gt;</span><span class="entity"><span>&amp;</span>quot;</span>;
<span id="line2043"></span> unset($_SESSION[COOKIENAME . 'messages'][$_GET['message']]);
<span id="line2044"></span>}
<span id="line2045"></span>
<span id="line2046"></span>
<span id="line2047"></span>//- Switch on $_GET['action'] for operations with output
<span id="line2048"></span>if (isset($_GET['action']) <span class="entity"><span>&amp;</span>amp;</span><span class="entity"><span>&amp;</span>amp;</span> !isset($_GET['confirm'])) {
<span id="line2049"></span> switch ($_GET['action']) {
<span id="line2050"></span> //- Table actions
<span id="line2051"></span>
<span id="line2052"></span> //- Create table (=table_create)
<span id="line2053"></span> case <span class="entity"><span>&amp;</span>quot;</span>table_create<span class="entity"><span>&amp;</span>quot;</span>:
<span id="line2054"></span> $query = <span class="entity"><span>&amp;</span>quot;</span>SELECT name FROM sqlite_master WHERE type='table' AND name=<span class="entity"><span>&amp;</span>quot;</span> . $db-<span class="entity"><span>&amp;</span>gt;</span>quote($_GET['tablename']);
<span id="line2055"></span> $results = $db-<span class="entity"><span>&amp;</span>gt;</span>selectArray($query);
<span id="line2056"></span> if (sizeof($results) <span class="entity"><span>&amp;</span>gt;</span> 0)
<span id="line2057"></span> $exists = true;
<span id="line2058"></span> else
<span id="line2059"></span> $exists = false;
<span id="line2060"></span> echo <span class="entity"><span>&amp;</span>quot;</span><span class="entity"><span>&amp;</span>lt;</span>h2<span class="entity"><span>&amp;</span>gt;</span><span class="entity"><span>&amp;</span>quot;</span> . $lang['create_tbl'] . <span class="entity"><span>&amp;</span>quot;</span>: '<span class="entity"><span>&amp;</span>quot;</span> . htmlencode($_GET['tablename']) . <span class="entity"><span>&amp;</span>quot;</span>'<span class="entity"><span>&amp;</span>lt;</span>/h2<span class="entity"><span>&amp;</span>gt;</span><span class="entity"><span>&amp;</span>quot;</span>;
<span id="line2061"></span> if ($_GET['tablefields'] == <span class="entity"><span>&amp;</span>quot;</span><span class="entity"><span>&amp;</span>quot;</span> || intval($_GET['tablefields']) <span class="entity"><span>&amp;</span>lt;</span>= 0)
<span id="line2062"></span> echo $lang['specify_fields'];
<span id="line2063"></span> else if ($_GET['tablename'] == <span class="entity"><span>&amp;</span>quot;</span><span class="entity"><span>&amp;</span>quot;</span>)
<span id="line2064"></span> echo $lang['specify_tbl'];
<span id="line2065"></span> else if ($exists)
<span id="line2066"></span> echo $lang['tbl_exists'];
<span id="line2067"></span> else {
<span id="line2068"></span> $num = intval($_GET['tablefields']);
<span id="line2069"></span> $name = $_GET['tablename'];
<span id="line2070"></span> echo $params-<span class="entity"><span>&amp;</span>gt;</span>getForm(array('action' =<span class="entity"><span>&amp;</span>gt;</span> 'table_create', 'confirm' =<span class="entity"><span>&amp;</span>gt;</span> '1'));
<span id="line2071"></span> echo <span class="entity"><span>&amp;</span>quot;</span><span class="entity"><span>&amp;</span>lt;</span>input type='hidden' name='tablename' value='<span class="entity"><span>&amp;</span>quot;</span> . htmlencode($name) . <span class="entity"><span>&amp;</span>quot;</span>'/<span class="entity"><span>&amp;</span>gt;</span><span class="entity"><span>&amp;</span>quot;</span>;
<span id="line2072"></span> echo <span class="entity"><span>&amp;</span>quot;</span><span class="entity"><span>&amp;</span>lt;</span>input type='hidden' name='rows' value='<span class="entity"><span>&amp;</span>quot;</span> . $num . <span class="entity"><span>&amp;</span>quot;</span>'/<span class="entity"><span>&amp;</span>gt;</span><span class="entity"><span>&amp;</span>quot;</span>;
<span id="line2073"></span> echo <span class="entity"><span>&amp;</span>quot;</span><span class="entity"><span>&amp;</span>lt;</span>table border='0' cellpadding='2' cellspacing='1' class='viewTable'<span class="entity"><span>&amp;</span>gt;</span><span class="entity"><span>&amp;</span>quot;</span>;
<span id="line2074"></span> echo <span class="entity"><span>&amp;</span>quot;</span><span class="entity"><span>&amp;</span>lt;</span>tr<span class="entity"><span>&amp;</span>gt;</span><span class="entity"><span>&amp;</span>quot;</span>;
<span id="line2075"></span> $headings = array($lang['fld'], $lang['type'], $lang['prim_key']);
<span id="line2076"></span> if ($db-<span class="entity"><span>&amp;</span>gt;</span>getType() != <span class="entity"><span>&amp;</span>quot;</span>SQLiteDatabase<span class="entity"><span>&amp;</span>quot;</span>) $headings[] = $lang['autoincrement'];
<span id="line2077"></span> $headings[] = $lang['not_null'];
<span id="line2078"></span> $headings[] = $lang['def_val'];
<span id="line2079"></span> for ($k = 0; $k <span class="entity"><span>&amp;</span>lt;</span> count($headings); $k++)
<span id="line2080"></span> echo <span class="entity"><span>&amp;</span>quot;</span><span class="entity"><span>&amp;</span>lt;</span>td class='tdheader'<span class="entity"><span>&amp;</span>gt;</span><span class="entity"><span>&amp;</span>quot;</span> . $headings[$k] . <span class="entity"><span>&amp;</span>quot;</span><span class="entity"><span>&amp;</span>lt;</span>/td<span class="entity"><span>&amp;</span>gt;</span><span class="entity"><span>&amp;</span>quot;</span>;
<span id="line2081"></span> echo <span class="entity"><span>&amp;</span>quot;</span><span class="entity"><span>&amp;</span>lt;</span>/tr<span class="entity"><span>&amp;</span>gt;</span><span class="entity"><span>&amp;</span>quot;</span>;
<span id="line2082"></span>
<span id="line2083"></span> for ($i = 0; $i <span class="entity"><span>&amp;</span>lt;</span> $num; $i++) {
<span id="line2084"></span> $tdWithClass = <span class="entity"><span>&amp;</span>quot;</span><span class="entity"><span>&amp;</span>lt;</span>td class='td<span class="entity"><span>&amp;</span>quot;</span> . ($i % 2 ? <span class="entity"><span>&amp;</span>quot;</span>1<span class="entity"><span>&amp;</span>quot;</span> : <span class="entity"><span>&amp;</span>quot;</span>2<span class="entity"><span>&amp;</span>quot;</span>) . <span class="entity"><span>&amp;</span>quot;</span>'<span class="entity"><span>&amp;</span>gt;</span><span class="entity"><span>&amp;</span>quot;</span>;
<span id="line2085"></span> echo <span class="entity"><span>&amp;</span>quot;</span><span class="entity"><span>&amp;</span>lt;</span>tr<span class="entity"><span>&amp;</span>gt;</span><span class="entity"><span>&amp;</span>quot;</span>;
<span id="line2086"></span> echo $tdWithClass;
<span id="line2087"></span> echo <span class="entity"><span>&amp;</span>quot;</span><span class="entity"><span>&amp;</span>lt;</span>input type='text' name='<span class="entity"><span>&amp;</span>quot;</span> . $i . <span class="entity"><span>&amp;</span>quot;</span>_field' style='width:200px;'/<span class="entity"><span>&amp;</span>gt;</span><span class="entity"><span>&amp;</span>quot;</span>;
<span id="line2088"></span> echo <span class="entity"><span>&amp;</span>quot;</span><span class="entity"><span>&amp;</span>lt;</span>/td<span class="entity"><span>&amp;</span>gt;</span><span class="entity"><span>&amp;</span>quot;</span>;
<span id="line2089"></span> echo $tdWithClass;
<span id="line2090"></span> echo <span class="entity"><span>&amp;</span>quot;</span><span class="entity"><span>&amp;</span>lt;</span>select name='<span class="entity"><span>&amp;</span>quot;</span> . $i . <span class="entity"><span>&amp;</span>quot;</span>_type' id='i<span class="entity"><span>&amp;</span>quot;</span> . $i . <span class="entity"><span>&amp;</span>quot;</span>_type' onchange='toggleAutoincrement(<span class="entity"><span>&amp;</span>quot;</span> . $i . <span class="entity"><span>&amp;</span>quot;</span>);'<span class="entity"><span>&amp;</span>gt;</span><span class="entity"><span>&amp;</span>quot;</span>;
<span id="line2091"></span> foreach ($sqlite_datatypes as $t) {
<span id="line2092"></span> echo <span class="entity"><span>&amp;</span>quot;</span><span class="entity"><span>&amp;</span>lt;</span>option value='<span class="entity"><span>&amp;</span>quot;</span> . htmlencode($t) . <span class="entity"><span>&amp;</span>quot;</span>'<span class="entity"><span>&amp;</span>gt;</span><span class="entity"><span>&amp;</span>quot;</span> . htmlencode($t) . <span class="entity"><span>&amp;</span>quot;</span><span class="entity"><span>&amp;</span>lt;</span>/option<span class="entity"><span>&amp;</span>gt;</span><span class="entity"><span>&amp;</span>quot;</span>;
<span id="line2093"></span> }
<span id="line2094"></span> echo <span class="entity"><span>&amp;</span>quot;</span><span class="entity"><span>&amp;</span>lt;</span>/select<span class="entity"><span>&amp;</span>gt;</span><span class="entity"><span>&amp;</span>quot;</span>;
<span id="line2095"></span> echo <span class="entity"><span>&amp;</span>quot;</span><span class="entity"><span>&amp;</span>lt;</span>/td<span class="entity"><span>&amp;</span>gt;</span><span class="entity"><span>&amp;</span>quot;</span>;
<span id="line2096"></span> echo $tdWithClass;
<span id="line2097"></span> echo <span class="entity"><span>&amp;</span>quot;</span><span class="entity"><span>&amp;</span>lt;</span>label<span class="entity"><span>&amp;</span>gt;</span><span class="entity"><span>&amp;</span>lt;</span>input type='checkbox' name='<span class="entity"><span>&amp;</span>quot;</span> . $i . <span class="entity"><span>&amp;</span>quot;</span>_primarykey' id='i<span class="entity"><span>&amp;</span>quot;</span> . $i . <span class="entity"><span>&amp;</span>quot;</span>_primarykey' onclick='toggleNull(<span class="entity"><span>&amp;</span>quot;</span> . $i . <span class="entity"><span>&amp;</span>quot;</span>); toggleAutoincrement(<span class="entity"><span>&amp;</span>quot;</span> . $i . <span class="entity"><span>&amp;</span>quot;</span>);'/<span class="entity"><span>&amp;</span>gt;</span> <span class="entity"><span>&amp;</span>quot;</span> . $lang['yes'] . <span class="entity"><span>&amp;</span>quot;</span><span class="entity"><span>&amp;</span>lt;</span>/label<span class="entity"><span>&amp;</span>gt;</span><span class="entity"><span>&amp;</span>quot;</span>;
<span id="line2098"></span> echo <span class="entity"><span>&amp;</span>quot;</span><span class="entity"><span>&amp;</span>lt;</span>/td<span class="entity"><span>&amp;</span>gt;</span><span class="entity"><span>&amp;</span>quot;</span>;
<span id="line2099"></span> if ($db-<span class="entity"><span>&amp;</span>gt;</span>getType() != <span class="entity"><span>&amp;</span>quot;</span>SQLiteDatabase<span class="entity"><span>&amp;</span>quot;</span>) {
<span id="line2100"></span> echo $tdWithClass;
<span id="line2101"></span> echo <span class="entity"><span>&amp;</span>quot;</span><span class="entity"><span>&amp;</span>lt;</span>label<span class="entity"><span>&amp;</span>gt;</span><span class="entity"><span>&amp;</span>lt;</span>input type='checkbox' name='<span class="entity"><span>&amp;</span>quot;</span> . $i . <span class="entity"><span>&amp;</span>quot;</span>_autoincrement' id='i<span class="entity"><span>&amp;</span>quot;</span> . $i . <span class="entity"><span>&amp;</span>quot;</span>_autoincrement'/<span class="entity"><span>&amp;</span>gt;</span> <span class="entity"><span>&amp;</span>quot;</span> . $lang['yes'] . <span class="entity"><span>&amp;</span>quot;</span><span class="entity"><span>&amp;</span>lt;</span>/label<span class="entity"><span>&amp;</span>gt;</span><span class="entity"><span>&amp;</span>quot;</span>;
<span id="line2102"></span> echo <span class="entity"><span>&amp;</span>quot;</span><span class="entity"><span>&amp;</span>lt;</span>/td<span class="entity"><span>&amp;</span>gt;</span><span class="entity"><span>&amp;</span>quot;</span>;
<span id="line2103"></span> }
<span id="line2104"></span> echo $tdWithClass;
<span id="line2105"></span> echo <span class="entity"><span>&amp;</span>quot;</span><span class="entity"><span>&amp;</span>lt;</span>label<span class="entity"><span>&amp;</span>gt;</span><span class="entity"><span>&amp;</span>lt;</span>input type='checkbox' name='<span class="entity"><span>&amp;</span>quot;</span> . $i . <span class="entity"><span>&amp;</span>quot;</span>_notnull' id='i<span class="entity"><span>&amp;</span>quot;</span> . $i . <span class="entity"><span>&amp;</span>quot;</span>_notnull'/<span class="entity"><span>&amp;</span>gt;</span> <span class="entity"><span>&amp;</span>quot;</span> . $lang['yes'] . <span class="entity"><span>&amp;</span>quot;</span><span class="entity"><span>&amp;</span>lt;</span>/label<span class="entity"><span>&amp;</span>gt;</span><span class="entity"><span>&amp;</span>quot;</span>;
<span id="line2106"></span> echo <span class="entity"><span>&amp;</span>quot;</span><span class="entity"><span>&amp;</span>lt;</span>/td<span class="entity"><span>&amp;</span>gt;</span><span class="entity"><span>&amp;</span>quot;</span>;
<span id="line2107"></span> echo $tdWithClass;
<span id="line2108"></span> echo <span class="entity"><span>&amp;</span>quot;</span><span class="entity"><span>&amp;</span>lt;</span>select name='<span class="entity"><span>&amp;</span>quot;</span> . $i . <span class="entity"><span>&amp;</span>quot;</span>_defaultoption' id='i<span class="entity"><span>&amp;</span>quot;</span> . $i . <span class="entity"><span>&amp;</span>quot;</span>_defaultoption' onchange=\<span class="entity"><span>&amp;</span>quot;</span>if(this.value!='defined' <span class="entity"><span>&amp;</span>amp;</span><span class="entity"><span>&amp;</span>amp;</span> this.value!='expr') document.getElementById('i<span class="entity"><span>&amp;</span>quot;</span> . $i . <span class="entity"><span>&amp;</span>quot;</span>_defaultvalue').value='';\<span class="entity"><span>&amp;</span>quot;</span><span class="entity"><span>&amp;</span>gt;</span><span class="entity"><span>&amp;</span>quot;</span>;
<span id="line2109"></span> echo <span class="entity"><span>&amp;</span>quot;</span><span class="entity"><span>&amp;</span>lt;</span>option value='none'<span class="entity"><span>&amp;</span>gt;</span><span class="entity"><span>&amp;</span>quot;</span> . $lang['none'] . <span class="entity"><span>&amp;</span>quot;</span><span class="entity"><span>&amp;</span>lt;</span>/option<span class="entity"><span>&amp;</span>gt;</span><span class="entity"><span>&amp;</span>lt;</span>option value='defined'<span class="entity"><span>&amp;</span>gt;</span><span class="entity"><span>&amp;</span>quot;</span> . $lang['as_defined'] . <span class="entity"><span>&amp;</span>quot;</span>:<span class="entity"><span>&amp;</span>lt;</span>/option<span class="entity"><span>&amp;</span>gt;</span><span class="entity"><span>&amp;</span>lt;</span>option<span class="entity"><span>&amp;</span>gt;</span>NULL<span class="entity"><span>&amp;</span>lt;</span>/option<span class="entity"><span>&amp;</span>gt;</span><span class="entity"><span>&amp;</span>lt;</span>option<span class="entity"><span>&amp;</span>gt;</span>CURRENT_TIME<span class="entity"><span>&amp;</span>lt;</span>/option<span class="entity"><span>&amp;</span>gt;</span><span class="entity"><span>&amp;</span>lt;</span>option<span class="entity"><span>&amp;</span>gt;</span>CURRENT_DATE<span class="entity"><span>&amp;</span>lt;</span>/option<span class="entity"><span>&amp;</span>gt;</span><span class="entity"><span>&amp;</span>lt;</span>option<span class="entity"><span>&amp;</span>gt;</span>CURRENT_TIMESTAMP<span class="entity"><span>&amp;</span>lt;</span>/option<span class="entity"><span>&amp;</span>gt;</span><span class="entity"><span>&amp;</span>lt;</span>option value='expr'<span class="entity"><span>&amp;</span>gt;</span><span class="entity"><span>&amp;</span>quot;</span> . $lang['expression'] . <span class="entity"><span>&amp;</span>quot;</span>:<span class="entity"><span>&amp;</span>lt;</span>/option<span class="entity"><span>&amp;</span>gt;</span><span class="entity"><span>&amp;</span>quot;</span>;
<span id="line2110"></span> echo <span class="entity"><span>&amp;</span>quot;</span><span class="entity"><span>&amp;</span>lt;</span>/select<span class="entity"><span>&amp;</span>gt;</span><span class="entity"><span>&amp;</span>quot;</span>;
<span id="line2111"></span> echo <span class="entity"><span>&amp;</span>quot;</span><span class="entity"><span>&amp;</span>lt;</span>input type='text' name='<span class="entity"><span>&amp;</span>quot;</span> . $i . <span class="entity"><span>&amp;</span>quot;</span>_defaultvalue' id='i<span class="entity"><span>&amp;</span>quot;</span> . $i . <span class="entity"><span>&amp;</span>quot;</span>_defaultvalue' style='width:100px;' onchange=\<span class="entity"><span>&amp;</span>quot;</span>if(document.getElementById('i<span class="entity"><span>&amp;</span>quot;</span> . $i . <span class="entity"><span>&amp;</span>quot;</span>_defaultoption').value!='expr') document.getElementById('i<span class="entity"><span>&amp;</span>quot;</span> . $i . <span class="entity"><span>&amp;</span>quot;</span>_defaultoption').value='defined';\<span class="entity"><span>&amp;</span>quot;</span>/<span class="entity"><span>&amp;</span>gt;</span><span class="entity"><span>&amp;</span>quot;</span>;
<span id="line2112"></span> echo <span class="entity"><span>&amp;</span>quot;</span><span class="entity"><span>&amp;</span>lt;</span>/td<span class="entity"><span>&amp;</span>gt;</span><span class="entity"><span>&amp;</span>quot;</span>;
<span id="line2113"></span> echo <span class="entity"><span>&amp;</span>quot;</span><span class="entity"><span>&amp;</span>lt;</span>/tr<span class="entity"><span>&amp;</span>gt;</span><span class="entity"><span>&amp;</span>quot;</span>;
<span id="line2114"></span> }
<span id="line2115"></span> echo <span class="entity"><span>&amp;</span>quot;</span><span class="entity"><span>&amp;</span>lt;</span>tr<span class="entity"><span>&amp;</span>gt;</span><span class="entity"><span>&amp;</span>quot;</span>;
<span id="line2116"></span> echo <span class="entity"><span>&amp;</span>quot;</span><span class="entity"><span>&amp;</span>lt;</span>td class='tdheader' style='text-align:right;' colspan='6'<span class="entity"><span>&amp;</span>gt;</span><span class="entity"><span>&amp;</span>quot;</span>;
<span id="line2117"></span> echo <span class="entity"><span>&amp;</span>quot;</span><span class="entity"><span>&amp;</span>lt;</span>input type='submit' value='<span class="entity"><span>&amp;</span>quot;</span> . $lang['create'] . <span class="entity"><span>&amp;</span>quot;</span>' class='btn'/<span class="entity"><span>&amp;</span>gt;</span> <span class="entity"><span>&amp;</span>quot;</span>;
<span id="line2118"></span> echo $params-<span class="entity"><span>&amp;</span>gt;</span>getLink(array(), $lang['cancel']);
<span id="line2119"></span> echo <span class="entity"><span>&amp;</span>quot;</span><span class="entity"><span>&amp;</span>lt;</span>/td<span class="entity"><span>&amp;</span>gt;</span><span class="entity"><span>&amp;</span>quot;</span>;
<span id="line2120"></span> echo <span class="entity"><span>&amp;</span>quot;</span><span class="entity"><span>&amp;</span>lt;</span>/tr<span class="entity"><span>&amp;</span>gt;</span><span class="entity"><span>&amp;</span>quot;</span>;
<span id="line2121"></span> echo <span class="entity"><span>&amp;</span>quot;</span><span class="entity"><span>&amp;</span>lt;</span>/table<span class="entity"><span>&amp;</span>gt;</span><span class="entity"><span>&amp;</span>quot;</span>;
<span id="line2122"></span> echo <span class="entity"><span>&amp;</span>quot;</span><span class="entity"><span>&amp;</span>lt;</span>/form<span class="entity"><span>&amp;</span>gt;</span><span class="entity"><span>&amp;</span>quot;</span>;
<span id="line2123"></span> if ($db-<span class="entity"><span>&amp;</span>gt;</span>getType() != <span class="entity"><span>&amp;</span>quot;</span>SQLiteDatabase<span class="entity"><span>&amp;</span>quot;</span>) echo <span class="entity"><span>&amp;</span>quot;</span><span class="entity"><span>&amp;</span>lt;</span>script type='text/javascript'<span class="entity"><span>&amp;</span>gt;</span>window.onload=initAutoincrement;<span class="entity"><span>&amp;</span>lt;</span>/script<span class="entity"><span>&amp;</span>gt;</span><span class="entity"><span>&amp;</span>quot;</span>;
<span id="line2124"></span> }
<span id="line2125"></span> break;
<span id="line2126"></span>
<span id="line2127"></span> //- Perform SQL query on table (=table_sql)
<span id="line2128"></span> case <span class="entity"><span>&amp;</span>quot;</span>table_sql<span class="entity"><span>&amp;</span>quot;</span>:
<span id="line2129"></span> if (isset($_POST['query']) <span class="entity"><span>&amp;</span>amp;</span><span class="entity"><span>&amp;</span>amp;</span> $_POST['query'] != <span class="entity"><span>&amp;</span>quot;</span><span class="entity"><span>&amp;</span>quot;</span>) {
<span id="line2130"></span> $delimiter = $_POST['delimiter'];
<span id="line2131"></span> $queryStr = $_POST['queryval'];
<span id="line2132"></span> //save the queries in history if necessary
<span id="line2133"></span> if ($maxSavedQueries != 0 <span class="entity"><span>&amp;</span>amp;</span><span class="entity"><span>&amp;</span>amp;</span> $maxSavedQueries != false) {
<span id="line2134"></span> if (!isset($_SESSION[COOKIENAME . 'query_history']))
<span id="line2135"></span> $_SESSION[COOKIENAME . 'query_history'] = array();
<span id="line2136"></span> $_SESSION[COOKIENAME . 'query_history'][md5(strtolower($queryStr))] = $queryStr;
<span id="line2137"></span> if (sizeof($_SESSION[COOKIENAME . 'query_history']) <span class="entity"><span>&amp;</span>gt;</span> $maxSavedQueries)
<span id="line2138"></span> array_shift($_SESSION[COOKIENAME . 'query_history']);
<span id="line2139"></span> }
<span id="line2140"></span> $query = explode_sql($delimiter, $queryStr); //explode the query string into individual queries based on the delimiter
<span id="line2141"></span>
<span id="line2142"></span> for ($i = 0; $i <span class="entity"><span>&amp;</span>lt;</span> sizeof($query); $i++) //iterate through the queries exploded by the delimiter
<span id="line2143"></span> {
<span id="line2144"></span> if (str_replace(<span class="entity"><span>&amp;</span>quot;</span> <span class="entity"><span>&amp;</span>quot;</span>, <span class="entity"><span>&amp;</span>quot;</span><span class="entity"><span>&amp;</span>quot;</span>, str_replace(<span class="entity"><span>&amp;</span>quot;</span>\n<span class="entity"><span>&amp;</span>quot;</span>, <span class="entity"><span>&amp;</span>quot;</span><span class="entity"><span>&amp;</span>quot;</span>, str_replace(<span class="entity"><span>&amp;</span>quot;</span>\r<span class="entity"><span>&amp;</span>quot;</span>, <span class="entity"><span>&amp;</span>quot;</span><span class="entity"><span>&amp;</span>quot;</span>, $query[$i]))) != <span class="entity"><span>&amp;</span>quot;</span><span class="entity"><span>&amp;</span>quot;</span>) //make sure this query is not an empty string
<span id="line2145"></span> {
<span id="line2146"></span> $queryTimer = new MicroTimer();
<span id="line2147"></span> $table_result = $db-<span class="entity"><span>&amp;</span>gt;</span>query($query[$i]);
<span id="line2148"></span>
<span id="line2149"></span> echo <span class="entity"><span>&amp;</span>quot;</span><span class="entity"><span>&amp;</span>lt;</span>div class='confirm'<span class="entity"><span>&amp;</span>gt;</span><span class="entity"><span>&amp;</span>quot;</span>;
<span id="line2150"></span> echo <span class="entity"><span>&amp;</span>quot;</span><span class="entity"><span>&amp;</span>lt;</span>b<span class="entity"><span>&amp;</span>gt;</span><span class="entity"><span>&amp;</span>quot;</span> . htmlencode($query[$i]) . <span class="entity"><span>&amp;</span>quot;</span><span class="entity"><span>&amp;</span>lt;</span>/b<span class="entity"><span>&amp;</span>gt;</span><span class="entity"><span>&amp;</span>quot;</span>;
<span id="line2151"></span> if ($table_result === NULL || $table_result === false) {
<span id="line2152"></span> echo <span class="entity"><span>&amp;</span>quot;</span><span class="entity"><span>&amp;</span>lt;</span>br /<span class="entity"><span>&amp;</span>gt;</span><span class="entity"><span>&amp;</span>lt;</span>b<span class="entity"><span>&amp;</span>gt;</span><span class="entity"><span>&amp;</span>quot;</span> . $lang['err'] . <span class="entity"><span>&amp;</span>quot;</span>: <span class="entity"><span>&amp;</span>quot;</span> . htmlencode($db-<span class="entity"><span>&amp;</span>gt;</span>getError()) . <span class="entity"><span>&amp;</span>quot;</span><span class="entity"><span>&amp;</span>lt;</span>/b<span class="entity"><span>&amp;</span>gt;</span><span class="entity"><span>&amp;</span>lt;</span>/div<span class="entity"><span>&amp;</span>gt;</span><span class="entity"><span>&amp;</span>quot;</span>;
<span id="line2153"></span> }
<span id="line2154"></span> echo <span class="entity"><span>&amp;</span>quot;</span><span class="entity"><span>&amp;</span>lt;</span>/div<span class="entity"><span>&amp;</span>gt;</span><span class="entity"><span>&amp;</span>lt;</span>br/<span class="entity"><span>&amp;</span>gt;</span><span class="entity"><span>&amp;</span>quot;</span>;
<span id="line2155"></span> if ($row = $db-<span class="entity"><span>&amp;</span>gt;</span>fetch($table_result, 'num')) {
<span id="line2156"></span> for ($j = 0; $j <span class="entity"><span>&amp;</span>lt;</span> sizeof($row); $j++)
<span id="line2157"></span> $headers[$j] = $db-<span class="entity"><span>&amp;</span>gt;</span>getColumnName($table_result, $j);
<span id="line2158"></span> echo <span class="entity"><span>&amp;</span>quot;</span><span class="entity"><span>&amp;</span>lt;</span>table border='0' cellpadding='2' cellspacing='1' class='viewTable'<span class="entity"><span>&amp;</span>gt;</span><span class="entity"><span>&amp;</span>quot;</span>;
<span id="line2159"></span> echo <span class="entity"><span>&amp;</span>quot;</span><span class="entity"><span>&amp;</span>lt;</span>tr<span class="entity"><span>&amp;</span>gt;</span><span class="entity"><span>&amp;</span>quot;</span>;
<span id="line2160"></span> for ($j = 0; $j <span class="entity"><span>&amp;</span>lt;</span> sizeof($headers); $j++) {
<span id="line2161"></span> echo <span class="entity"><span>&amp;</span>quot;</span><span class="entity"><span>&amp;</span>lt;</span>td class='tdheader'<span class="entity"><span>&amp;</span>gt;</span><span class="entity"><span>&amp;</span>quot;</span>;
<span id="line2162"></span> echo htmlencode($headers[$j]);
<span id="line2163"></span> echo <span class="entity"><span>&amp;</span>quot;</span><span class="entity"><span>&amp;</span>lt;</span>/td<span class="entity"><span>&amp;</span>gt;</span><span class="entity"><span>&amp;</span>quot;</span>;
<span id="line2164"></span> }
<span id="line2165"></span> echo <span class="entity"><span>&amp;</span>quot;</span><span class="entity"><span>&amp;</span>lt;</span>/tr<span class="entity"><span>&amp;</span>gt;</span><span class="entity"><span>&amp;</span>quot;</span>;
<span id="line2166"></span> $rowCount = 0;
<span id="line2167"></span> for (; $rowCount == 0 || $row = $db-<span class="entity"><span>&amp;</span>gt;</span>fetch($table_result, 'num'); $rowCount++) {
<span id="line2168"></span> $tdWithClass = <span class="entity"><span>&amp;</span>quot;</span><span class="entity"><span>&amp;</span>lt;</span>td class='td<span class="entity"><span>&amp;</span>quot;</span> . ($rowCount % 2 ? <span class="entity"><span>&amp;</span>quot;</span>1<span class="entity"><span>&amp;</span>quot;</span> : <span class="entity"><span>&amp;</span>quot;</span>2<span class="entity"><span>&amp;</span>quot;</span>) . <span class="entity"><span>&amp;</span>quot;</span>'<span class="entity"><span>&amp;</span>gt;</span><span class="entity"><span>&amp;</span>quot;</span>;
<span id="line2169"></span> echo <span class="entity"><span>&amp;</span>quot;</span><span class="entity"><span>&amp;</span>lt;</span>tr<span class="entity"><span>&amp;</span>gt;</span><span class="entity"><span>&amp;</span>quot;</span>;
<span id="line2170"></span> for ($z = 0; $z <span class="entity"><span>&amp;</span>lt;</span> sizeof($headers); $z++) {
<span id="line2171"></span> echo $tdWithClass;
<span id="line2172"></span> if ($row[$z] === <span class="entity"><span>&amp;</span>quot;</span><span class="entity"><span>&amp;</span>quot;</span>)
<span id="line2173"></span> echo <span class="entity"><span>&amp;</span>quot;</span><span class="entity"><span>&amp;</span>amp;</span>nbsp;<span class="entity"><span>&amp;</span>quot;</span>;
<span id="line2174"></span> elseif ($row[$z] === NULL)
<span id="line2175"></span> echo <span class="entity"><span>&amp;</span>quot;</span><span class="entity"><span>&amp;</span>lt;</span>i class='null'<span class="entity"><span>&amp;</span>gt;</span>NULL<span class="entity"><span>&amp;</span>lt;</span>/i<span class="entity"><span>&amp;</span>gt;</span><span class="entity"><span>&amp;</span>quot;</span>;
<span id="line2176"></span> else
<span id="line2177"></span> echo htmlencode(subString($row[$z]));
<span id="line2178"></span> echo <span class="entity"><span>&amp;</span>quot;</span><span class="entity"><span>&amp;</span>lt;</span>/td<span class="entity"><span>&amp;</span>gt;</span><span class="entity"><span>&amp;</span>quot;</span>;
<span id="line2179"></span> }
<span id="line2180"></span> echo <span class="entity"><span>&amp;</span>quot;</span><span class="entity"><span>&amp;</span>lt;</span>/tr<span class="entity"><span>&amp;</span>gt;</span><span class="entity"><span>&amp;</span>quot;</span>;
<span id="line2181"></span> }
<span id="line2182"></span> $queryTimer-<span class="entity"><span>&amp;</span>gt;</span>stop();
<span id="line2183"></span> echo <span class="entity"><span>&amp;</span>quot;</span><span class="entity"><span>&amp;</span>lt;</span>/table<span class="entity"><span>&amp;</span>gt;</span><span class="entity"><span>&amp;</span>lt;</span>br/<span class="entity"><span>&amp;</span>gt;</span><span class="entity"><span>&amp;</span>lt;</span>br/<span class="entity"><span>&amp;</span>gt;</span><span class="entity"><span>&amp;</span>quot;</span>;
<span id="line2184"></span>
<span id="line2185"></span>
<span id="line2186"></span> if ($table_result !== NULL <span class="entity"><span>&amp;</span>amp;</span><span class="entity"><span>&amp;</span>amp;</span> $table_result !== false) {
<span id="line2187"></span> echo <span class="entity"><span>&amp;</span>quot;</span><span class="entity"><span>&amp;</span>lt;</span>div class='confirm' style='margin-bottom: 2em'<span class="entity"><span>&amp;</span>gt;</span><span class="entity"><span>&amp;</span>quot;</span>;
<span id="line2188"></span> if ($rowCount <span class="entity"><span>&amp;</span>gt;</span> 0 || $db-<span class="entity"><span>&amp;</span>gt;</span>getAffectedRows() == 0) {
<span id="line2189"></span> printf($lang['show_rows'], $rowCount);
<span id="line2190"></span> }
<span id="line2191"></span> if ($db-<span class="entity"><span>&amp;</span>gt;</span>getAffectedRows() <span class="entity"><span>&amp;</span>gt;</span> 0 || $rowCount == 0) {
<span id="line2192"></span> echo $db-<span class="entity"><span>&amp;</span>gt;</span>getAffectedRows() . <span class="entity"><span>&amp;</span>quot;</span> <span class="entity"><span>&amp;</span>quot;</span> . $lang['rows_aff'] . <span class="entity"><span>&amp;</span>quot;</span> <span class="entity"><span>&amp;</span>quot;</span>;
<span id="line2193"></span> }
<span id="line2194"></span> printf($lang['query_time'], $queryTimer);
<span id="line2195"></span> echo <span class="entity"><span>&amp;</span>quot;</span><span class="entity"><span>&amp;</span>lt;</span>/div<span class="entity"><span>&amp;</span>gt;</span><span class="entity"><span>&amp;</span>quot;</span>;
<span id="line2196"></span> }
<span id="line2197"></span>
<span id="line2198"></span>
<span id="line2199"></span> }
<span id="line2200"></span> }
<span id="line2201"></span> }
<span id="line2202"></span> } else {
<span id="line2203"></span> $delimiter = <span class="entity"><span>&amp;</span>quot;</span>;<span class="entity"><span>&amp;</span>quot;</span>;
<span id="line2204"></span> $queryStr = <span class="entity"><span>&amp;</span>quot;</span>SELECT * FROM <span class="entity"><span>&amp;</span>quot;</span> . $db-<span class="entity"><span>&amp;</span>gt;</span>quote_id($target_table) . <span class="entity"><span>&amp;</span>quot;</span> WHERE 1<span class="entity"><span>&amp;</span>quot;</span>;
<span id="line2205"></span> }
<span id="line2206"></span>
<span id="line2207"></span> echo <span class="entity"><span>&amp;</span>quot;</span><span class="entity"><span>&amp;</span>lt;</span>fieldset<span class="entity"><span>&amp;</span>gt;</span><span class="entity"><span>&amp;</span>quot;</span>;
<span id="line2208"></span> echo <span class="entity"><span>&amp;</span>quot;</span><span class="entity"><span>&amp;</span>lt;</span>legend<span class="entity"><span>&amp;</span>gt;</span><span class="entity"><span>&amp;</span>lt;</span>b<span class="entity"><span>&amp;</span>gt;</span><span class="entity"><span>&amp;</span>quot;</span> . sprintf($lang['run_sql'], htmlencode($db-<span class="entity"><span>&amp;</span>gt;</span>getName())) . <span class="entity"><span>&amp;</span>quot;</span><span class="entity"><span>&amp;</span>lt;</span>/b<span class="entity"><span>&amp;</span>gt;</span><span class="entity"><span>&amp;</span>lt;</span>/legend<span class="entity"><span>&amp;</span>gt;</span><span class="entity"><span>&amp;</span>quot;</span>;
<span id="line2209"></span> echo $params-<span class="entity"><span>&amp;</span>gt;</span>getForm(array('action' =<span class="entity"><span>&amp;</span>gt;</span> 'table_sql'));
<span id="line2210"></span> if (isset($_SESSION[COOKIENAME . 'query_history']) <span class="entity"><span>&amp;</span>amp;</span><span class="entity"><span>&amp;</span>amp;</span> sizeof($_SESSION[COOKIENAME . 'query_history']) <span class="entity"><span>&amp;</span>gt;</span> 0) {
<span id="line2211"></span> echo <span class="entity"><span>&amp;</span>quot;</span><span class="entity"><span>&amp;</span>lt;</span>b<span class="entity"><span>&amp;</span>gt;</span><span class="entity"><span>&amp;</span>quot;</span> . $lang['recent_queries'] . <span class="entity"><span>&amp;</span>quot;</span><span class="entity"><span>&amp;</span>lt;</span>/b<span class="entity"><span>&amp;</span>gt;</span><span class="entity"><span>&amp;</span>lt;</span>ul<span class="entity"><span>&amp;</span>gt;</span><span class="entity"><span>&amp;</span>quot;</span>;
<span id="line2212"></span> foreach ($_SESSION[COOKIENAME . 'query_history'] as $key =<span class="entity"><span>&amp;</span>gt;</span> $value)
<span id="line2213"></span> echo <span class="entity"><span>&amp;</span>quot;</span><span class="entity"><span>&amp;</span>lt;</span>li<span class="entity"><span>&amp;</span>gt;</span><span class="entity"><span>&amp;</span>lt;</span>a onclick='sqleditorSetValue(this.textContent); return false;' href='#'<span class="entity"><span>&amp;</span>gt;</span><span class="entity"><span>&amp;</span>quot;</span> . htmlencode($value) . <span class="entity"><span>&amp;</span>quot;</span><span class="entity"><span>&amp;</span>lt;</span>/a<span class="entity"><span>&amp;</span>gt;</span><span class="entity"><span>&amp;</span>lt;</span>/li<span class="entity"><span>&amp;</span>gt;</span><span class="entity"><span>&amp;</span>quot;</span>;
<span id="line2214"></span> echo <span class="entity"><span>&amp;</span>quot;</span><span class="entity"><span>&amp;</span>lt;</span>/ul<span class="entity"><span>&amp;</span>gt;</span><span class="entity"><span>&amp;</span>lt;</span>br/<span class="entity"><span>&amp;</span>gt;</span><span class="entity"><span>&amp;</span>lt;</span>br/<span class="entity"><span>&amp;</span>gt;</span><span class="entity"><span>&amp;</span>quot;</span>;
<span id="line2215"></span> }
<span id="line2216"></span> echo <span class="entity"><span>&amp;</span>quot;</span><span class="entity"><span>&amp;</span>lt;</span>div style='float:left; width:70%;'<span class="entity"><span>&amp;</span>gt;</span><span class="entity"><span>&amp;</span>quot;</span>;
<span id="line2217"></span> echo <span class="entity"><span>&amp;</span>quot;</span><span class="entity"><span>&amp;</span>lt;</span>textarea style='width:97%; height:300px;' name='queryval' id='queryval' cols='50' rows='8'<span class="entity"><span>&amp;</span>gt;</span><span class="entity"><span>&amp;</span>quot;</span> . htmlencode($queryStr) . <span class="entity"><span>&amp;</span>quot;</span><span class="entity"><span>&amp;</span>lt;</span>/textarea<span class="entity"><span>&amp;</span>gt;</span><span class="entity"><span>&amp;</span>quot;</span>;
<span id="line2218"></span> echo <span class="entity"><span>&amp;</span>quot;</span><span class="entity"><span>&amp;</span>lt;</span>script<span class="entity"><span>&amp;</span>gt;</span>sqleditor(document.getElementById('queryval'),<span class="entity"><span>&amp;</span>quot;</span> . json_encode($db-<span class="entity"><span>&amp;</span>gt;</span>getTableDefinitions()) . <span class="entity"><span>&amp;</span>quot;</span>,'<span class="entity"><span>&amp;</span>quot;</span> . htmlencode($target_table) . <span class="entity"><span>&amp;</span>quot;</span>');<span class="entity"><span>&amp;</span>lt;</span>/script<span class="entity"><span>&amp;</span>gt;</span><span class="entity"><span>&amp;</span>quot;</span>;
<span id="line2219"></span> echo <span class="entity"><span>&amp;</span>quot;</span><span class="entity"><span>&amp;</span>lt;</span>/div<span class="entity"><span>&amp;</span>gt;</span><span class="entity"><span>&amp;</span>quot;</span>;
<span id="line2220"></span> echo <span class="entity"><span>&amp;</span>quot;</span><span class="entity"><span>&amp;</span>lt;</span>div style='float:left; width:28%; padding-left:10px;'<span class="entity"><span>&amp;</span>gt;</span><span class="entity"><span>&amp;</span>quot;</span>;
<span id="line2221"></span> echo $lang['fields'] . <span class="entity"><span>&amp;</span>quot;</span><span class="entity"><span>&amp;</span>lt;</span>br/<span class="entity"><span>&amp;</span>gt;</span><span class="entity"><span>&amp;</span>quot;</span>;
<span id="line2222"></span> echo <span class="entity"><span>&amp;</span>quot;</span><span class="entity"><span>&amp;</span>lt;</span>select multiple='multiple' style='width:100%;' id='fieldcontainer'<span class="entity"><span>&amp;</span>gt;</span><span class="entity"><span>&amp;</span>quot;</span>;
<span id="line2223"></span> $tableInfo = $db-<span class="entity"><span>&amp;</span>gt;</span>getTableInfo($target_table);
<span id="line2224"></span> for ($i = 0; $i <span class="entity"><span>&amp;</span>lt;</span> sizeof($tableInfo); $i++) {
<span id="line2225"></span> echo <span class="entity"><span>&amp;</span>quot;</span><span class="entity"><span>&amp;</span>lt;</span>option value='<span class="entity"><span>&amp;</span>quot;</span> . htmlencode($tableInfo[$i][1]) . <span class="entity"><span>&amp;</span>quot;</span>'<span class="entity"><span>&amp;</span>gt;</span><span class="entity"><span>&amp;</span>quot;</span> . htmlencode($tableInfo[$i][1]) . <span class="entity"><span>&amp;</span>quot;</span><span class="entity"><span>&amp;</span>lt;</span>/option<span class="entity"><span>&amp;</span>gt;</span><span class="entity"><span>&amp;</span>quot;</span>;
<span id="line2226"></span> }
<span id="line2227"></span> echo <span class="entity"><span>&amp;</span>quot;</span><span class="entity"><span>&amp;</span>lt;</span>/select<span class="entity"><span>&amp;</span>gt;</span><span class="entity"><span>&amp;</span>quot;</span>;
<span id="line2228"></span> echo <span class="entity"><span>&amp;</span>quot;</span><span class="entity"><span>&amp;</span>lt;</span>input type='button' value='<span class="entity"><span>&amp;</span>amp;</span>lt;<span class="entity"><span>&amp;</span>amp;</span>lt;' onclick='moveFields();' class='btn'/<span class="entity"><span>&amp;</span>gt;</span><span class="entity"><span>&amp;</span>quot;</span>;
<span id="line2229"></span> echo <span class="entity"><span>&amp;</span>quot;</span><span class="entity"><span>&amp;</span>lt;</span>/div<span class="entity"><span>&amp;</span>gt;</span><span class="entity"><span>&amp;</span>quot;</span>;
<span id="line2230"></span> echo <span class="entity"><span>&amp;</span>quot;</span><span class="entity"><span>&amp;</span>lt;</span>div style='clear:both;'<span class="entity"><span>&amp;</span>gt;</span><span class="entity"><span>&amp;</span>lt;</span>/div<span class="entity"><span>&amp;</span>gt;</span><span class="entity"><span>&amp;</span>quot;</span>;
<span id="line2231"></span> echo $lang['delimit'] . <span class="entity"><span>&amp;</span>quot;</span> <span class="entity"><span>&amp;</span>lt;</span>input type='text' name='delimiter' value='<span class="entity"><span>&amp;</span>quot;</span> . htmlencode($delimiter) . <span class="entity"><span>&amp;</span>quot;</span>' style='width:50px;'/<span class="entity"><span>&amp;</span>gt;</span> <span class="entity"><span>&amp;</span>quot;</span>;
<span id="line2232"></span> echo <span class="entity"><span>&amp;</span>quot;</span><span class="entity"><span>&amp;</span>lt;</span>input type='submit' name='query' value='<span class="entity"><span>&amp;</span>quot;</span> . $lang['go'] . <span class="entity"><span>&amp;</span>quot;</span>' class='btn'/<span class="entity"><span>&amp;</span>gt;</span><span class="entity"><span>&amp;</span>quot;</span>;
<span id="line2233"></span> echo <span class="entity"><span>&amp;</span>quot;</span><span class="entity"><span>&amp;</span>lt;</span>/form<span class="entity"><span>&amp;</span>gt;</span><span class="entity"><span>&amp;</span>quot;</span>;
<span id="line2234"></span> echo <span class="entity"><span>&amp;</span>quot;</span><span class="entity"><span>&amp;</span>lt;</span>/fieldset<span class="entity"><span>&amp;</span>gt;</span><span class="entity"><span>&amp;</span>quot;</span>;
<span id="line2235"></span> break;
<span id="line2236"></span>
<span id="line2237"></span> //- Empty table (=table_empty)
<span id="line2238"></span> case <span class="entity"><span>&amp;</span>quot;</span>table_empty<span class="entity"><span>&amp;</span>quot;</span>:
<span id="line2239"></span> echo $params-<span class="entity"><span>&amp;</span>gt;</span>getForm(array('action' =<span class="entity"><span>&amp;</span>gt;</span> 'table_empty', 'confirm' =<span class="entity"><span>&amp;</span>gt;</span> '1'));
<span id="line2240"></span> echo <span class="entity"><span>&amp;</span>quot;</span><span class="entity"><span>&amp;</span>lt;</span>div class='confirm'<span class="entity"><span>&amp;</span>gt;</span><span class="entity"><span>&amp;</span>quot;</span>;
<span id="line2241"></span> echo sprintf($lang['ques_empty'], htmlencode($target_table)) . <span class="entity"><span>&amp;</span>quot;</span><span class="entity"><span>&amp;</span>lt;</span>br/<span class="entity"><span>&amp;</span>gt;</span><span class="entity"><span>&amp;</span>lt;</span>br/<span class="entity"><span>&amp;</span>gt;</span><span class="entity"><span>&amp;</span>quot;</span>;
<span id="line2242"></span> echo <span class="entity"><span>&amp;</span>quot;</span><span class="entity"><span>&amp;</span>lt;</span>input type='checkbox' name='vacuum' checked='checked'/<span class="entity"><span>&amp;</span>gt;</span> <span class="entity"><span>&amp;</span>quot;</span> . $lang['vac_on_empty'] . <span class="entity"><span>&amp;</span>quot;</span><span class="entity"><span>&amp;</span>lt;</span>br/<span class="entity"><span>&amp;</span>gt;</span><span class="entity"><span>&amp;</span>lt;</span>br/<span class="entity"><span>&amp;</span>gt;</span><span class="entity"><span>&amp;</span>quot;</span>;
<span id="line2243"></span> echo <span class="entity"><span>&amp;</span>quot;</span><span class="entity"><span>&amp;</span>lt;</span>input type='submit' value='<span class="entity"><span>&amp;</span>quot;</span> . $lang['confirm'] . <span class="entity"><span>&amp;</span>quot;</span>' class='btn'/<span class="entity"><span>&amp;</span>gt;</span> <span class="entity"><span>&amp;</span>quot;</span>;
<span id="line2244"></span> echo $params-<span class="entity"><span>&amp;</span>gt;</span>getLink(array('table' =<span class="entity"><span>&amp;</span>gt;</span> null), $lang['cancel']);
<span id="line2245"></span> echo <span class="entity"><span>&amp;</span>quot;</span><span class="entity"><span>&amp;</span>lt;</span>/div<span class="entity"><span>&amp;</span>gt;</span><span class="entity"><span>&amp;</span>quot;</span>;
<span id="line2246"></span> break;
<span id="line2247"></span>
<span id="line2248"></span> //- Drop table (=table_drop)
<span id="line2249"></span> case <span class="entity"><span>&amp;</span>quot;</span>table_drop<span class="entity"><span>&amp;</span>quot;</span>:
<span id="line2250"></span> echo $params-<span class="entity"><span>&amp;</span>gt;</span>getForm(array('action' =<span class="entity"><span>&amp;</span>gt;</span> 'table_drop', 'confirm' =<span class="entity"><span>&amp;</span>gt;</span> '1'));
<span id="line2251"></span> echo <span class="entity"><span>&amp;</span>quot;</span><span class="entity"><span>&amp;</span>lt;</span>div class='confirm'<span class="entity"><span>&amp;</span>gt;</span><span class="entity"><span>&amp;</span>quot;</span>;
<span id="line2252"></span> echo sprintf($lang['ques_drop'], htmlencode($target_table)) . <span class="entity"><span>&amp;</span>quot;</span><span class="entity"><span>&amp;</span>lt;</span>br/<span class="entity"><span>&amp;</span>gt;</span><span class="entity"><span>&amp;</span>lt;</span>br/<span class="entity"><span>&amp;</span>gt;</span><span class="entity"><span>&amp;</span>quot;</span>;
<span id="line2253"></span> echo <span class="entity"><span>&amp;</span>quot;</span><span class="entity"><span>&amp;</span>lt;</span>input type='checkbox' name='vacuum' checked='checked'/<span class="entity"><span>&amp;</span>gt;</span> <span class="entity"><span>&amp;</span>quot;</span> . $lang['vac_on_empty'] . <span class="entity"><span>&amp;</span>quot;</span><span class="entity"><span>&amp;</span>lt;</span>br/<span class="entity"><span>&amp;</span>gt;</span><span class="entity"><span>&amp;</span>lt;</span>br/<span class="entity"><span>&amp;</span>gt;</span><span class="entity"><span>&amp;</span>quot;</span>;
<span id="line2254"></span> echo <span class="entity"><span>&amp;</span>quot;</span><span class="entity"><span>&amp;</span>lt;</span>input type='submit' value='<span class="entity"><span>&amp;</span>quot;</span> . $lang['confirm'] . <span class="entity"><span>&amp;</span>quot;</span>' class='btn'/<span class="entity"><span>&amp;</span>gt;</span> <span class="entity"><span>&amp;</span>quot;</span>;
<span id="line2255"></span> echo $params-<span class="entity"><span>&amp;</span>gt;</span>getLink(array('table' =<span class="entity"><span>&amp;</span>gt;</span> null), $lang['cancel']);
<span id="line2256"></span> echo <span class="entity"><span>&amp;</span>quot;</span><span class="entity"><span>&amp;</span>lt;</span>/div<span class="entity"><span>&amp;</span>gt;</span><span class="entity"><span>&amp;</span>quot;</span>;
<span id="line2257"></span> break;
<span id="line2258"></span>
<span id="line2259"></span> //- Drop view (=view_drop)
<span id="line2260"></span> case <span class="entity"><span>&amp;</span>quot;</span>view_drop<span class="entity"><span>&amp;</span>quot;</span>:
<span id="line2261"></span> echo $params-<span class="entity"><span>&amp;</span>gt;</span>getForm(array('action' =<span class="entity"><span>&amp;</span>gt;</span> 'view_drop', 'confirm' =<span class="entity"><span>&amp;</span>gt;</span> '1'));
<span id="line2262"></span> echo <span class="entity"><span>&amp;</span>quot;</span><span class="entity"><span>&amp;</span>lt;</span>input type='hidden' name='viewname' value='<span class="entity"><span>&amp;</span>quot;</span> . htmlencode($target_table) . <span class="entity"><span>&amp;</span>quot;</span>'/<span class="entity"><span>&amp;</span>gt;</span><span class="entity"><span>&amp;</span>quot;</span>;
<span id="line2263"></span> echo <span class="entity"><span>&amp;</span>quot;</span><span class="entity"><span>&amp;</span>lt;</span>div class='confirm'<span class="entity"><span>&amp;</span>gt;</span><span class="entity"><span>&amp;</span>quot;</span>;
<span id="line2264"></span> echo sprintf($lang['ques_drop_view'], htmlencode($target_table)) . <span class="entity"><span>&amp;</span>quot;</span><span class="entity"><span>&amp;</span>lt;</span>br/<span class="entity"><span>&amp;</span>gt;</span><span class="entity"><span>&amp;</span>lt;</span>br/<span class="entity"><span>&amp;</span>gt;</span><span class="entity"><span>&amp;</span>quot;</span>;
<span id="line2265"></span> echo <span class="entity"><span>&amp;</span>quot;</span><span class="entity"><span>&amp;</span>lt;</span>input type='submit' value='<span class="entity"><span>&amp;</span>quot;</span> . $lang['confirm'] . <span class="entity"><span>&amp;</span>quot;</span>' class='btn'/<span class="entity"><span>&amp;</span>gt;</span> <span class="entity"><span>&amp;</span>quot;</span>;
<span id="line2266"></span> echo $params-<span class="entity"><span>&amp;</span>gt;</span>getLink(array('table' =<span class="entity"><span>&amp;</span>gt;</span> null), $lang['cancel']);
<span id="line2267"></span> echo <span class="entity"><span>&amp;</span>quot;</span><span class="entity"><span>&amp;</span>lt;</span>/div<span class="entity"><span>&amp;</span>gt;</span><span class="entity"><span>&amp;</span>quot;</span>;
<span id="line2268"></span> break;
<span id="line2269"></span>
<span id="line2270"></span> //- Export table (=table_export)
<span id="line2271"></span> case <span class="entity"><span>&amp;</span>quot;</span>table_export<span class="entity"><span>&amp;</span>quot;</span>:
<span id="line2272"></span> echo $params-<span class="entity"><span>&amp;</span>gt;</span>getForm();
<span id="line2273"></span> echo <span class="entity"><span>&amp;</span>quot;</span><span class="entity"><span>&amp;</span>lt;</span>fieldset style='float:left; width:260px; margin-right:20px;'<span class="entity"><span>&amp;</span>gt;</span><span class="entity"><span>&amp;</span>lt;</span>legend<span class="entity"><span>&amp;</span>gt;</span><span class="entity"><span>&amp;</span>lt;</span>b<span class="entity"><span>&amp;</span>gt;</span><span class="entity"><span>&amp;</span>quot;</span> . $lang['export'] . <span class="entity"><span>&amp;</span>quot;</span><span class="entity"><span>&amp;</span>lt;</span>/b<span class="entity"><span>&amp;</span>gt;</span><span class="entity"><span>&amp;</span>lt;</span>/legend<span class="entity"><span>&amp;</span>gt;</span><span class="entity"><span>&amp;</span>quot;</span>;
<span id="line2274"></span> echo <span class="entity"><span>&amp;</span>quot;</span><span class="entity"><span>&amp;</span>lt;</span>input type='hidden' value='<span class="entity"><span>&amp;</span>quot;</span> . htmlencode($target_table) . <span class="entity"><span>&amp;</span>quot;</span>' name='single_table'/<span class="entity"><span>&amp;</span>gt;</span><span class="entity"><span>&amp;</span>quot;</span>;
<span id="line2275"></span> echo <span class="entity"><span>&amp;</span>quot;</span><span class="entity"><span>&amp;</span>lt;</span>label<span class="entity"><span>&amp;</span>gt;</span><span class="entity"><span>&amp;</span>lt;</span>input type='radio' name='export_type' checked='checked' value='sql' onclick='toggleExports(\<span class="entity"><span>&amp;</span>quot;</span>sql\<span class="entity"><span>&amp;</span>quot;</span>);'/<span class="entity"><span>&amp;</span>gt;</span> <span class="entity"><span>&amp;</span>quot;</span> . $lang['sql'] . <span class="entity"><span>&amp;</span>quot;</span><span class="entity"><span>&amp;</span>lt;</span>/label<span class="entity"><span>&amp;</span>gt;</span><span class="entity"><span>&amp;</span>quot;</span>;
<span id="line2276"></span> echo <span class="entity"><span>&amp;</span>quot;</span><span class="entity"><span>&amp;</span>lt;</span>br/<span class="entity"><span>&amp;</span>gt;</span><span class="entity"><span>&amp;</span>lt;</span>label<span class="entity"><span>&amp;</span>gt;</span><span class="entity"><span>&amp;</span>lt;</span>input type='radio' name='export_type' value='csv' onclick='toggleExports(\<span class="entity"><span>&amp;</span>quot;</span>csv\<span class="entity"><span>&amp;</span>quot;</span>);'/<span class="entity"><span>&amp;</span>gt;</span> <span class="entity"><span>&amp;</span>quot;</span> . $lang['csv'] . <span class="entity"><span>&amp;</span>quot;</span><span class="entity"><span>&amp;</span>lt;</span>/label<span class="entity"><span>&amp;</span>gt;</span><span class="entity"><span>&amp;</span>quot;</span>;
<span id="line2277"></span> echo <span class="entity"><span>&amp;</span>quot;</span><span class="entity"><span>&amp;</span>lt;</span>/fieldset<span class="entity"><span>&amp;</span>gt;</span><span class="entity"><span>&amp;</span>quot;</span>;
<span id="line2278"></span>
<span id="line2279"></span> echo <span class="entity"><span>&amp;</span>quot;</span><span class="entity"><span>&amp;</span>lt;</span>fieldset style='float:left; max-width:350px;' id='exportoptions_sql'<span class="entity"><span>&amp;</span>gt;</span><span class="entity"><span>&amp;</span>lt;</span>legend<span class="entity"><span>&amp;</span>gt;</span><span class="entity"><span>&amp;</span>lt;</span>b<span class="entity"><span>&amp;</span>gt;</span><span class="entity"><span>&amp;</span>quot;</span> . $lang['options'] . <span class="entity"><span>&amp;</span>quot;</span><span class="entity"><span>&amp;</span>lt;</span>/b<span class="entity"><span>&amp;</span>gt;</span><span class="entity"><span>&amp;</span>lt;</span>/legend<span class="entity"><span>&amp;</span>gt;</span><span class="entity"><span>&amp;</span>quot;</span>;
<span id="line2280"></span> echo <span class="entity"><span>&amp;</span>quot;</span><span class="entity"><span>&amp;</span>lt;</span>label<span class="entity"><span>&amp;</span>gt;</span><span class="entity"><span>&amp;</span>lt;</span>input type='checkbox' checked='checked' name='structure'/<span class="entity"><span>&amp;</span>gt;</span> <span class="entity"><span>&amp;</span>quot;</span> . $lang['export_struct'] . <span class="entity"><span>&amp;</span>quot;</span><span class="entity"><span>&amp;</span>lt;</span>/label<span class="entity"><span>&amp;</span>gt;</span> <span class="entity"><span>&amp;</span>quot;</span> . helpLink($lang['help5']) . <span class="entity"><span>&amp;</span>quot;</span><span class="entity"><span>&amp;</span>lt;</span>br/<span class="entity"><span>&amp;</span>gt;</span><span class="entity"><span>&amp;</span>quot;</span>;
<span id="line2281"></span> echo <span class="entity"><span>&amp;</span>quot;</span><span class="entity"><span>&amp;</span>lt;</span>label<span class="entity"><span>&amp;</span>gt;</span><span class="entity"><span>&amp;</span>lt;</span>input type='checkbox' checked='checked' name='data'/<span class="entity"><span>&amp;</span>gt;</span> <span class="entity"><span>&amp;</span>quot;</span> . $lang['export_data'] . <span class="entity"><span>&amp;</span>quot;</span><span class="entity"><span>&amp;</span>lt;</span>/label<span class="entity"><span>&amp;</span>gt;</span> <span class="entity"><span>&amp;</span>quot;</span> . helpLink($lang['help6']) . <span class="entity"><span>&amp;</span>quot;</span><span class="entity"><span>&amp;</span>lt;</span>br/<span class="entity"><span>&amp;</span>gt;</span><span class="entity"><span>&amp;</span>quot;</span>;
<span id="line2282"></span> echo <span class="entity"><span>&amp;</span>quot;</span><span class="entity"><span>&amp;</span>lt;</span>label<span class="entity"><span>&amp;</span>gt;</span><span class="entity"><span>&amp;</span>lt;</span>input type='checkbox' name='drop'/<span class="entity"><span>&amp;</span>gt;</span> <span class="entity"><span>&amp;</span>quot;</span> . $lang['add_drop'] . <span class="entity"><span>&amp;</span>quot;</span><span class="entity"><span>&amp;</span>lt;</span>/label<span class="entity"><span>&amp;</span>gt;</span> <span class="entity"><span>&amp;</span>quot;</span> . helpLink($lang['help7']) . <span class="entity"><span>&amp;</span>quot;</span><span class="entity"><span>&amp;</span>lt;</span>br/<span class="entity"><span>&amp;</span>gt;</span><span class="entity"><span>&amp;</span>quot;</span>;
<span id="line2283"></span> echo <span class="entity"><span>&amp;</span>quot;</span><span class="entity"><span>&amp;</span>lt;</span>label<span class="entity"><span>&amp;</span>gt;</span><span class="entity"><span>&amp;</span>lt;</span>input type='checkbox' checked='checked' name='transaction'/<span class="entity"><span>&amp;</span>gt;</span> <span class="entity"><span>&amp;</span>quot;</span> . $lang['add_transact'] . <span class="entity"><span>&amp;</span>quot;</span><span class="entity"><span>&amp;</span>lt;</span>/label<span class="entity"><span>&amp;</span>gt;</span> <span class="entity"><span>&amp;</span>quot;</span> . helpLink($lang['help8']) . <span class="entity"><span>&amp;</span>quot;</span><span class="entity"><span>&amp;</span>lt;</span>br/<span class="entity"><span>&amp;</span>gt;</span><span class="entity"><span>&amp;</span>quot;</span>;
<span id="line2284"></span> echo <span class="entity"><span>&amp;</span>quot;</span><span class="entity"><span>&amp;</span>lt;</span>label<span class="entity"><span>&amp;</span>gt;</span><span class="entity"><span>&amp;</span>lt;</span>input type='checkbox' checked='checked' name='comments'/<span class="entity"><span>&amp;</span>gt;</span> <span class="entity"><span>&amp;</span>quot;</span> . $lang['comments'] . <span class="entity"><span>&amp;</span>quot;</span><span class="entity"><span>&amp;</span>lt;</span>/label<span class="entity"><span>&amp;</span>gt;</span> <span class="entity"><span>&amp;</span>quot;</span> . helpLink($lang['help9']) . <span class="entity"><span>&amp;</span>quot;</span><span class="entity"><span>&amp;</span>lt;</span>br/<span class="entity"><span>&amp;</span>gt;</span><span class="entity"><span>&amp;</span>quot;</span>;
<span id="line2285"></span> echo <span class="entity"><span>&amp;</span>quot;</span><span class="entity"><span>&amp;</span>lt;</span>/fieldset<span class="entity"><span>&amp;</span>gt;</span><span class="entity"><span>&amp;</span>quot;</span>;
<span id="line2286"></span>
<span id="line2287"></span> echo <span class="entity"><span>&amp;</span>quot;</span><span class="entity"><span>&amp;</span>lt;</span>fieldset style='float:left; max-width:350px; display:none;' id='exportoptions_csv'<span class="entity"><span>&amp;</span>gt;</span><span class="entity"><span>&amp;</span>lt;</span>legend<span class="entity"><span>&amp;</span>gt;</span><span class="entity"><span>&amp;</span>lt;</span>b<span class="entity"><span>&amp;</span>gt;</span><span class="entity"><span>&amp;</span>quot;</span> . $lang['options'] . <span class="entity"><span>&amp;</span>quot;</span><span class="entity"><span>&amp;</span>lt;</span>/b<span class="entity"><span>&amp;</span>gt;</span><span class="entity"><span>&amp;</span>lt;</span>/legend<span class="entity"><span>&amp;</span>gt;</span><span class="entity"><span>&amp;</span>quot;</span>;
<span id="line2288"></span> echo <span class="entity"><span>&amp;</span>quot;</span><span class="entity"><span>&amp;</span>lt;</span>div style='float:left;'<span class="entity"><span>&amp;</span>gt;</span><span class="entity"><span>&amp;</span>quot;</span> . $lang['fld_terminated'] . <span class="entity"><span>&amp;</span>quot;</span><span class="entity"><span>&amp;</span>lt;</span>/div<span class="entity"><span>&amp;</span>gt;</span><span class="entity"><span>&amp;</span>quot;</span>;
<span id="line2289"></span> echo <span class="entity"><span>&amp;</span>quot;</span><span class="entity"><span>&amp;</span>lt;</span>input type='text' value=';' name='export_csv_fieldsterminated' style='float:right;'/<span class="entity"><span>&amp;</span>gt;</span><span class="entity"><span>&amp;</span>quot;</span>;
<span id="line2290"></span> echo <span class="entity"><span>&amp;</span>quot;</span><span class="entity"><span>&amp;</span>lt;</span>div style='clear:both;'<span class="entity"><span>&amp;</span>gt;</span><span class="entity"><span>&amp;</span>lt;</span>/div<span class="entity"><span>&amp;</span>gt;</span><span class="entity"><span>&amp;</span>quot;</span>;
<span id="line2291"></span> echo <span class="entity"><span>&amp;</span>quot;</span><span class="entity"><span>&amp;</span>lt;</span>div style='float:left;'<span class="entity"><span>&amp;</span>gt;</span><span class="entity"><span>&amp;</span>quot;</span> . $lang['fld_enclosed'] . <span class="entity"><span>&amp;</span>quot;</span><span class="entity"><span>&amp;</span>lt;</span>/div<span class="entity"><span>&amp;</span>gt;</span><span class="entity"><span>&amp;</span>quot;</span>;
<span id="line2292"></span> echo <span class="entity"><span>&amp;</span>quot;</span><span class="entity"><span>&amp;</span>lt;</span>input type='text' value='\<span class="entity"><span>&amp;</span>quot;</span>' name='export_csv_fieldsenclosed' style='float:right;'/<span class="entity"><span>&amp;</span>gt;</span><span class="entity"><span>&amp;</span>quot;</span>;
<span id="line2293"></span> echo <span class="entity"><span>&amp;</span>quot;</span><span class="entity"><span>&amp;</span>lt;</span>div style='clear:both;'<span class="entity"><span>&amp;</span>gt;</span><span class="entity"><span>&amp;</span>lt;</span>/div<span class="entity"><span>&amp;</span>gt;</span><span class="entity"><span>&amp;</span>quot;</span>;
<span id="line2294"></span> echo <span class="entity"><span>&amp;</span>quot;</span><span class="entity"><span>&amp;</span>lt;</span>div style='float:left;'<span class="entity"><span>&amp;</span>gt;</span><span class="entity"><span>&amp;</span>quot;</span> . $lang['fld_escaped'] . <span class="entity"><span>&amp;</span>quot;</span><span class="entity"><span>&amp;</span>lt;</span>/div<span class="entity"><span>&amp;</span>gt;</span><span class="entity"><span>&amp;</span>quot;</span>;
<span id="line2295"></span> echo <span class="entity"><span>&amp;</span>quot;</span><span class="entity"><span>&amp;</span>lt;</span>input type='text' value='\' name='export_csv_fieldsescaped' style='float:right;'/<span class="entity"><span>&amp;</span>gt;</span><span class="entity"><span>&amp;</span>quot;</span>;
<span id="line2296"></span> echo <span class="entity"><span>&amp;</span>quot;</span><span class="entity"><span>&amp;</span>lt;</span>div style='clear:both;'<span class="entity"><span>&amp;</span>gt;</span><span class="entity"><span>&amp;</span>lt;</span>/div<span class="entity"><span>&amp;</span>gt;</span><span class="entity"><span>&amp;</span>quot;</span>;
<span id="line2297"></span> echo <span class="entity"><span>&amp;</span>quot;</span><span class="entity"><span>&amp;</span>lt;</span>div style='float:left;'<span class="entity"><span>&amp;</span>gt;</span><span class="entity"><span>&amp;</span>quot;</span> . $lang['rep_null'] . <span class="entity"><span>&amp;</span>quot;</span><span class="entity"><span>&amp;</span>lt;</span>/div<span class="entity"><span>&amp;</span>gt;</span><span class="entity"><span>&amp;</span>quot;</span>;
<span id="line2298"></span> echo <span class="entity"><span>&amp;</span>quot;</span><span class="entity"><span>&amp;</span>lt;</span>input type='text' value='NULL' name='export_csv_replacenull' style='float:right;'/<span class="entity"><span>&amp;</span>gt;</span><span class="entity"><span>&amp;</span>quot;</span>;
<span id="line2299"></span> echo <span class="entity"><span>&amp;</span>quot;</span><span class="entity"><span>&amp;</span>lt;</span>div style='clear:both;'<span class="entity"><span>&amp;</span>gt;</span><span class="entity"><span>&amp;</span>lt;</span>/div<span class="entity"><span>&amp;</span>gt;</span><span class="entity"><span>&amp;</span>quot;</span>;
<span id="line2300"></span> echo <span class="entity"><span>&amp;</span>quot;</span><span class="entity"><span>&amp;</span>lt;</span>label<span class="entity"><span>&amp;</span>gt;</span><span class="entity"><span>&amp;</span>lt;</span>input type='checkbox' name='export_csv_crlf'/<span class="entity"><span>&amp;</span>gt;</span> <span class="entity"><span>&amp;</span>quot;</span> . $lang['rem_crlf'] . <span class="entity"><span>&amp;</span>quot;</span><span class="entity"><span>&amp;</span>lt;</span>/label<span class="entity"><span>&amp;</span>gt;</span><span class="entity"><span>&amp;</span>lt;</span>br/<span class="entity"><span>&amp;</span>gt;</span><span class="entity"><span>&amp;</span>quot;</span>;
<span id="line2301"></span> echo <span class="entity"><span>&amp;</span>quot;</span><span class="entity"><span>&amp;</span>lt;</span>label<span class="entity"><span>&amp;</span>gt;</span><span class="entity"><span>&amp;</span>lt;</span>input type='checkbox' checked='checked' name='export_csv_fieldnames'/<span class="entity"><span>&amp;</span>gt;</span> <span class="entity"><span>&amp;</span>quot;</span> . $lang['put_fld'] . <span class="entity"><span>&amp;</span>quot;</span><span class="entity"><span>&amp;</span>lt;</span>/label<span class="entity"><span>&amp;</span>gt;</span><span class="entity"><span>&amp;</span>quot;</span>;
<span id="line2302"></span> echo <span class="entity"><span>&amp;</span>quot;</span><span class="entity"><span>&amp;</span>lt;</span>/fieldset<span class="entity"><span>&amp;</span>gt;</span><span class="entity"><span>&amp;</span>quot;</span>;
<span id="line2303"></span>
<span id="line2304"></span> echo <span class="entity"><span>&amp;</span>quot;</span><span class="entity"><span>&amp;</span>lt;</span>div style='clear:both;'<span class="entity"><span>&amp;</span>gt;</span><span class="entity"><span>&amp;</span>lt;</span>/div<span class="entity"><span>&amp;</span>gt;</span><span class="entity"><span>&amp;</span>quot;</span>;
<span id="line2305"></span> echo <span class="entity"><span>&amp;</span>quot;</span><span class="entity"><span>&amp;</span>lt;</span>br/<span class="entity"><span>&amp;</span>gt;</span><span class="entity"><span>&amp;</span>lt;</span>br/<span class="entity"><span>&amp;</span>gt;</span><span class="entity"><span>&amp;</span>quot;</span>;
<span id="line2306"></span> echo <span class="entity"><span>&amp;</span>quot;</span><span class="entity"><span>&amp;</span>lt;</span>fieldset<span class="entity"><span>&amp;</span>gt;</span><span class="entity"><span>&amp;</span>lt;</span>legend<span class="entity"><span>&amp;</span>gt;</span><span class="entity"><span>&amp;</span>lt;</span>b<span class="entity"><span>&amp;</span>gt;</span><span class="entity"><span>&amp;</span>quot;</span> . $lang['save_as'] . <span class="entity"><span>&amp;</span>quot;</span><span class="entity"><span>&amp;</span>lt;</span>/b<span class="entity"><span>&amp;</span>gt;</span><span class="entity"><span>&amp;</span>lt;</span>/legend<span class="entity"><span>&amp;</span>gt;</span><span class="entity"><span>&amp;</span>quot;</span>;
<span id="line2307"></span> $file = pathinfo($db-<span class="entity"><span>&amp;</span>gt;</span>getPath());
<span id="line2308"></span> $name = $file['filename'];
<span id="line2309"></span> echo <span class="entity"><span>&amp;</span>quot;</span><span class="entity"><span>&amp;</span>lt;</span>input type='text' name='filename' value='<span class="entity"><span>&amp;</span>quot;</span> . htmlencode($name) . <span class="entity"><span>&amp;</span>quot;</span>_<span class="entity"><span>&amp;</span>quot;</span> . htmlencode($target_table) . <span class="entity"><span>&amp;</span>quot;</span>_<span class="entity"><span>&amp;</span>quot;</span> . date(<span class="entity"><span>&amp;</span>quot;</span>Y-m-d<span class="entity"><span>&amp;</span>quot;</span>) . <span class="entity"><span>&amp;</span>quot;</span>.dump' style='width:400px;'/<span class="entity"><span>&amp;</span>gt;</span> <span class="entity"><span>&amp;</span>lt;</span>input type='submit' name='export' value='<span class="entity"><span>&amp;</span>quot;</span> . $lang['export'] . <span class="entity"><span>&amp;</span>quot;</span>' class='btn'/<span class="entity"><span>&amp;</span>gt;</span><span class="entity"><span>&amp;</span>quot;</span>;
<span id="line2310"></span> echo <span class="entity"><span>&amp;</span>quot;</span><span class="entity"><span>&amp;</span>lt;</span>/fieldset<span class="entity"><span>&amp;</span>gt;</span><span class="entity"><span>&amp;</span>quot;</span>;
<span id="line2311"></span> echo <span class="entity"><span>&amp;</span>quot;</span><span class="entity"><span>&amp;</span>lt;</span>/form<span class="entity"><span>&amp;</span>gt;</span><span class="entity"><span>&amp;</span>quot;</span>;
<span id="line2312"></span> echo <span class="entity"><span>&amp;</span>quot;</span><span class="entity"><span>&amp;</span>lt;</span>div class='confirm' style='margin-top: 2em'<span class="entity"><span>&amp;</span>gt;</span><span class="entity"><span>&amp;</span>quot;</span> . sprintf($lang['backup_hint'],
<span id="line2313"></span> $params-<span class="entity"><span>&amp;</span>gt;</span>getLink(array('download' =<span class="entity"><span>&amp;</span>gt;</span> $currentDB['path'], 'token' =<span class="entity"><span>&amp;</span>gt;</span> $_SESSION[COOKIENAME . 'token']), $lang[<span class="entity"><span>&amp;</span>quot;</span>backup_hint_linktext<span class="entity"><span>&amp;</span>quot;</span>], '', $lang['backup'])) . <span class="entity"><span>&amp;</span>quot;</span><span class="entity"><span>&amp;</span>lt;</span>/div<span class="entity"><span>&amp;</span>gt;</span><span class="entity"><span>&amp;</span>quot;</span>;
<span id="line2314"></span> break;
<span id="line2315"></span>
<span id="line2316"></span> //- Import table (=table_import)
<span id="line2317"></span> case <span class="entity"><span>&amp;</span>quot;</span>table_import<span class="entity"><span>&amp;</span>quot;</span>:
<span id="line2318"></span> if (isset($_POST['import'])) {
<span id="line2319"></span> echo <span class="entity"><span>&amp;</span>quot;</span><span class="entity"><span>&amp;</span>lt;</span>div class='confirm'<span class="entity"><span>&amp;</span>gt;</span><span class="entity"><span>&amp;</span>quot;</span>;
<span id="line2320"></span> if ($importSuccess === true)
<span id="line2321"></span> echo $lang['import_suc'];
<span id="line2322"></span> else
<span id="line2323"></span> echo $lang['err'] . ': ' . htmlencode($importSuccess);
<span id="line2324"></span> echo <span class="entity"><span>&amp;</span>quot;</span><span class="entity"><span>&amp;</span>lt;</span>/div<span class="entity"><span>&amp;</span>gt;</span><span class="entity"><span>&amp;</span>lt;</span>br/<span class="entity"><span>&amp;</span>gt;</span><span class="entity"><span>&amp;</span>quot;</span>;
<span id="line2325"></span> }
<span id="line2326"></span> echo $params-<span class="entity"><span>&amp;</span>gt;</span>getForm(array('action' =<span class="entity"><span>&amp;</span>gt;</span> 'table_import'), 'post', true);
<span id="line2327"></span> echo <span class="entity"><span>&amp;</span>quot;</span><span class="entity"><span>&amp;</span>lt;</span>fieldset style='float:left; width:260px; margin-right:20px;'<span class="entity"><span>&amp;</span>gt;</span><span class="entity"><span>&amp;</span>lt;</span>legend<span class="entity"><span>&amp;</span>gt;</span><span class="entity"><span>&amp;</span>lt;</span>b<span class="entity"><span>&amp;</span>gt;</span><span class="entity"><span>&amp;</span>quot;</span> . $lang['import_into'] . <span class="entity"><span>&amp;</span>quot;</span> <span class="entity"><span>&amp;</span>quot;</span> . htmlencode($target_table) . <span class="entity"><span>&amp;</span>quot;</span><span class="entity"><span>&amp;</span>lt;</span>/b<span class="entity"><span>&amp;</span>gt;</span><span class="entity"><span>&amp;</span>lt;</span>/legend<span class="entity"><span>&amp;</span>gt;</span><span class="entity"><span>&amp;</span>quot;</span>;
<span id="line2328"></span> echo <span class="entity"><span>&amp;</span>quot;</span><span class="entity"><span>&amp;</span>lt;</span>label<span class="entity"><span>&amp;</span>gt;</span><span class="entity"><span>&amp;</span>lt;</span>input type='radio' name='import_type' checked='checked' value='sql' onclick='toggleImports(\<span class="entity"><span>&amp;</span>quot;</span>sql\<span class="entity"><span>&amp;</span>quot;</span>);'/<span class="entity"><span>&amp;</span>gt;</span> <span class="entity"><span>&amp;</span>quot;</span> . $lang['sql'] . <span class="entity"><span>&amp;</span>quot;</span><span class="entity"><span>&amp;</span>lt;</span>/label<span class="entity"><span>&amp;</span>gt;</span><span class="entity"><span>&amp;</span>quot;</span>;
<span id="line2329"></span> echo <span class="entity"><span>&amp;</span>quot;</span><span class="entity"><span>&amp;</span>lt;</span>br/<span class="entity"><span>&amp;</span>gt;</span><span class="entity"><span>&amp;</span>lt;</span>label<span class="entity"><span>&amp;</span>gt;</span><span class="entity"><span>&amp;</span>lt;</span>input type='radio' name='import_type' value='csv' onclick='toggleImports(\<span class="entity"><span>&amp;</span>quot;</span>csv\<span class="entity"><span>&amp;</span>quot;</span>);'/<span class="entity"><span>&amp;</span>gt;</span> <span class="entity"><span>&amp;</span>quot;</span> . $lang['csv'] . <span class="entity"><span>&amp;</span>quot;</span><span class="entity"><span>&amp;</span>lt;</span>/label<span class="entity"><span>&amp;</span>gt;</span><span class="entity"><span>&amp;</span>quot;</span>;
<span id="line2330"></span> echo <span class="entity"><span>&amp;</span>quot;</span><span class="entity"><span>&amp;</span>lt;</span>/fieldset<span class="entity"><span>&amp;</span>gt;</span><span class="entity"><span>&amp;</span>quot;</span>;
<span id="line2331"></span>
<span id="line2332"></span> echo <span class="entity"><span>&amp;</span>quot;</span><span class="entity"><span>&amp;</span>lt;</span>fieldset style='float:left; max-width:350px;' id='importoptions_sql'<span class="entity"><span>&amp;</span>gt;</span><span class="entity"><span>&amp;</span>lt;</span>legend<span class="entity"><span>&amp;</span>gt;</span><span class="entity"><span>&amp;</span>lt;</span>b<span class="entity"><span>&amp;</span>gt;</span><span class="entity"><span>&amp;</span>quot;</span> . $lang['options'] . <span class="entity"><span>&amp;</span>quot;</span><span class="entity"><span>&amp;</span>lt;</span>/b<span class="entity"><span>&amp;</span>gt;</span><span class="entity"><span>&amp;</span>lt;</span>/legend<span class="entity"><span>&amp;</span>gt;</span><span class="entity"><span>&amp;</span>quot;</span>;
<span id="line2333"></span> echo $lang['no_opt'];
<span id="line2334"></span> echo <span class="entity"><span>&amp;</span>quot;</span><span class="entity"><span>&amp;</span>lt;</span>/fieldset<span class="entity"><span>&amp;</span>gt;</span><span class="entity"><span>&amp;</span>quot;</span>;
<span id="line2335"></span>
<span id="line2336"></span> echo <span class="entity"><span>&amp;</span>quot;</span><span class="entity"><span>&amp;</span>lt;</span>fieldset style='float:left; max-width:350px; display:none;' id='importoptions_csv'<span class="entity"><span>&amp;</span>gt;</span><span class="entity"><span>&amp;</span>lt;</span>legend<span class="entity"><span>&amp;</span>gt;</span><span class="entity"><span>&amp;</span>lt;</span>b<span class="entity"><span>&amp;</span>gt;</span><span class="entity"><span>&amp;</span>quot;</span> . $lang['options'] . <span class="entity"><span>&amp;</span>quot;</span><span class="entity"><span>&amp;</span>lt;</span>/b<span class="entity"><span>&amp;</span>gt;</span><span class="entity"><span>&amp;</span>lt;</span>/legend<span class="entity"><span>&amp;</span>gt;</span><span class="entity"><span>&amp;</span>quot;</span>;
<span id="line2337"></span> echo <span class="entity"><span>&amp;</span>quot;</span><span class="entity"><span>&amp;</span>lt;</span>input type='hidden' value='<span class="entity"><span>&amp;</span>quot;</span> . htmlencode($target_table) . <span class="entity"><span>&amp;</span>quot;</span>' name='single_table'/<span class="entity"><span>&amp;</span>gt;</span><span class="entity"><span>&amp;</span>quot;</span>;
<span id="line2338"></span> echo <span class="entity"><span>&amp;</span>quot;</span><span class="entity"><span>&amp;</span>lt;</span>div style='float:left;'<span class="entity"><span>&amp;</span>gt;</span><span class="entity"><span>&amp;</span>quot;</span> . $lang['fld_terminated'] . <span class="entity"><span>&amp;</span>quot;</span><span class="entity"><span>&amp;</span>lt;</span>/div<span class="entity"><span>&amp;</span>gt;</span><span class="entity"><span>&amp;</span>quot;</span>;
<span id="line2339"></span> echo <span class="entity"><span>&amp;</span>quot;</span><span class="entity"><span>&amp;</span>lt;</span>input type='text' value=';' name='import_csv_fieldsterminated' style='float:right;'/<span class="entity"><span>&amp;</span>gt;</span><span class="entity"><span>&amp;</span>quot;</span>;
<span id="line2340"></span> echo <span class="entity"><span>&amp;</span>quot;</span><span class="entity"><span>&amp;</span>lt;</span>div style='clear:both;'<span class="entity"><span>&amp;</span>gt;</span><span class="entity"><span>&amp;</span>quot;</span>;
<span id="line2341"></span> echo <span class="entity"><span>&amp;</span>quot;</span><span class="entity"><span>&amp;</span>lt;</span>div style='float:left;'<span class="entity"><span>&amp;</span>gt;</span><span class="entity"><span>&amp;</span>quot;</span> . $lang['fld_enclosed'] . <span class="entity"><span>&amp;</span>quot;</span><span class="entity"><span>&amp;</span>lt;</span>/div<span class="entity"><span>&amp;</span>gt;</span><span class="entity"><span>&amp;</span>quot;</span>;
<span id="line2342"></span> echo <span class="entity"><span>&amp;</span>quot;</span><span class="entity"><span>&amp;</span>lt;</span>input type='text' value='\<span class="entity"><span>&amp;</span>quot;</span>' name='import_csv_fieldsenclosed' style='float:right;'/<span class="entity"><span>&amp;</span>gt;</span><span class="entity"><span>&amp;</span>quot;</span>;
<span id="line2343"></span> echo <span class="entity"><span>&amp;</span>quot;</span><span class="entity"><span>&amp;</span>lt;</span>div style='clear:both;'<span class="entity"><span>&amp;</span>gt;</span><span class="entity"><span>&amp;</span>quot;</span>;
<span id="line2344"></span> echo <span class="entity"><span>&amp;</span>quot;</span><span class="entity"><span>&amp;</span>lt;</span>div style='float:left;'<span class="entity"><span>&amp;</span>gt;</span><span class="entity"><span>&amp;</span>quot;</span> . $lang['fld_escaped'] . <span class="entity"><span>&amp;</span>quot;</span><span class="entity"><span>&amp;</span>lt;</span>/div<span class="entity"><span>&amp;</span>gt;</span><span class="entity"><span>&amp;</span>quot;</span>;
<span id="line2345"></span> echo <span class="entity"><span>&amp;</span>quot;</span><span class="entity"><span>&amp;</span>lt;</span>input type='text' value='\' name='import_csv_fieldsescaped' style='float:right;'/<span class="entity"><span>&amp;</span>gt;</span><span class="entity"><span>&amp;</span>quot;</span>;
<span id="line2346"></span> echo <span class="entity"><span>&amp;</span>quot;</span><span class="entity"><span>&amp;</span>lt;</span>div style='clear:both;'<span class="entity"><span>&amp;</span>gt;</span><span class="entity"><span>&amp;</span>quot;</span>;
<span id="line2347"></span> echo <span class="entity"><span>&amp;</span>quot;</span><span class="entity"><span>&amp;</span>lt;</span>div style='float:left;'<span class="entity"><span>&amp;</span>gt;</span><span class="entity"><span>&amp;</span>quot;</span> . $lang['rep_null'] . <span class="entity"><span>&amp;</span>quot;</span><span class="entity"><span>&amp;</span>lt;</span>/div<span class="entity"><span>&amp;</span>gt;</span><span class="entity"><span>&amp;</span>quot;</span>;
<span id="line2348"></span> echo <span class="entity"><span>&amp;</span>quot;</span><span class="entity"><span>&amp;</span>lt;</span>input type='text' value='NULL' name='import_csv_replacenull' style='float:right;'/<span class="entity"><span>&amp;</span>gt;</span><span class="entity"><span>&amp;</span>quot;</span>;
<span id="line2349"></span> echo <span class="entity"><span>&amp;</span>quot;</span><span class="entity"><span>&amp;</span>lt;</span>div style='clear:both;'<span class="entity"><span>&amp;</span>gt;</span><span class="entity"><span>&amp;</span>quot;</span>;
<span id="line2350"></span> echo <span class="entity"><span>&amp;</span>quot;</span><span class="entity"><span>&amp;</span>lt;</span>label<span class="entity"><span>&amp;</span>gt;</span><span class="entity"><span>&amp;</span>lt;</span>input type='checkbox' checked='checked' name='import_csv_fieldnames'/<span class="entity"><span>&amp;</span>gt;</span> <span class="entity"><span>&amp;</span>quot;</span> . $lang['fld_names'] . <span class="entity"><span>&amp;</span>quot;</span><span class="entity"><span>&amp;</span>lt;</span>/label<span class="entity"><span>&amp;</span>gt;</span><span class="entity"><span>&amp;</span>quot;</span>;
<span id="line2351"></span> echo <span class="entity"><span>&amp;</span>quot;</span><span class="entity"><span>&amp;</span>lt;</span>/fieldset<span class="entity"><span>&amp;</span>gt;</span><span class="entity"><span>&amp;</span>quot;</span>;
<span id="line2352"></span>
<span id="line2353"></span> echo <span class="entity"><span>&amp;</span>quot;</span><span class="entity"><span>&amp;</span>lt;</span>div style='clear:both;'<span class="entity"><span>&amp;</span>gt;</span><span class="entity"><span>&amp;</span>lt;</span>/div<span class="entity"><span>&amp;</span>gt;</span><span class="entity"><span>&amp;</span>quot;</span>;
<span id="line2354"></span> echo <span class="entity"><span>&amp;</span>quot;</span><span class="entity"><span>&amp;</span>lt;</span>br/<span class="entity"><span>&amp;</span>gt;</span><span class="entity"><span>&amp;</span>lt;</span>br/<span class="entity"><span>&amp;</span>gt;</span><span class="entity"><span>&amp;</span>quot;</span>;
<span id="line2355"></span>
<span id="line2356"></span> echo <span class="entity"><span>&amp;</span>quot;</span><span class="entity"><span>&amp;</span>lt;</span>fieldset<span class="entity"><span>&amp;</span>gt;</span><span class="entity"><span>&amp;</span>lt;</span>legend<span class="entity"><span>&amp;</span>gt;</span><span class="entity"><span>&amp;</span>lt;</span>b<span class="entity"><span>&amp;</span>gt;</span><span class="entity"><span>&amp;</span>quot;</span> . $lang['import_f'] . <span class="entity"><span>&amp;</span>quot;</span><span class="entity"><span>&amp;</span>lt;</span>/b<span class="entity"><span>&amp;</span>gt;</span><span class="entity"><span>&amp;</span>lt;</span>/legend<span class="entity"><span>&amp;</span>gt;</span><span class="entity"><span>&amp;</span>quot;</span>;
<span id="line2357"></span> echo <span class="entity"><span>&amp;</span>quot;</span><span class="entity"><span>&amp;</span>lt;</span>em<span class="entity"><span>&amp;</span>gt;</span><span class="entity"><span>&amp;</span>quot;</span> . $lang['max_file_size'] . <span class="entity"><span>&amp;</span>quot;</span>: <span class="entity"><span>&amp;</span>quot;</span> . number_format(fileUploadMaxSize() / 1024 / 1024) . <span class="entity"><span>&amp;</span>quot;</span> MiB<span class="entity"><span>&amp;</span>lt;</span>/em<span class="entity"><span>&amp;</span>gt;</span> <span class="entity"><span>&amp;</span>quot;</span> . helpLink($lang['help11']) . <span class="entity"><span>&amp;</span>quot;</span><span class="entity"><span>&amp;</span>lt;</span>br /<span class="entity"><span>&amp;</span>gt;</span><span class="entity"><span>&amp;</span>quot;</span>;
<span id="line2358"></span> echo <span class="entity"><span>&amp;</span>quot;</span><span class="entity"><span>&amp;</span>lt;</span>input type='file' value='<span class="entity"><span>&amp;</span>quot;</span> . $lang['choose_f'] . <span class="entity"><span>&amp;</span>quot;</span>' name='file' style='background-color:transparent; border-style:none; margin:0; padding:0' onchange='checkFileSize(this)'/<span class="entity"><span>&amp;</span>gt;</span><span class="entity"><span>&amp;</span>quot;</span>;
<span id="line2359"></span> echo <span class="entity"><span>&amp;</span>quot;</span><span class="entity"><span>&amp;</span>lt;</span>input type='submit' value='<span class="entity"><span>&amp;</span>quot;</span> . $lang['import'] . <span class="entity"><span>&amp;</span>quot;</span>' name='import' class='btn'/<span class="entity"><span>&amp;</span>gt;</span><span class="entity"><span>&amp;</span>quot;</span>;
<span id="line2360"></span> echo <span class="entity"><span>&amp;</span>quot;</span><span class="entity"><span>&amp;</span>lt;</span>/fieldset<span class="entity"><span>&amp;</span>gt;</span><span class="entity"><span>&amp;</span>quot;</span>;
<span id="line2361"></span> break;
<span id="line2362"></span>
<span id="line2363"></span> //- Rename table (=table_rename)
<span id="line2364"></span> case <span class="entity"><span>&amp;</span>quot;</span>table_rename<span class="entity"><span>&amp;</span>quot;</span>:
<span id="line2365"></span> echo $params-<span class="entity"><span>&amp;</span>gt;</span>getForm(array('action' =<span class="entity"><span>&amp;</span>gt;</span> 'table_rename', 'confirm' =<span class="entity"><span>&amp;</span>gt;</span> '1'));
<span id="line2366"></span> printf($lang['rename_tbl'], htmlencode($target_table));
<span id="line2367"></span> echo <span class="entity"><span>&amp;</span>quot;</span> <span class="entity"><span>&amp;</span>lt;</span>input type='text' name='newname' value='<span class="entity"><span>&amp;</span>quot;</span> . htmlencode($target_table) . <span class="entity"><span>&amp;</span>quot;</span>' style='width:200px;'/<span class="entity"><span>&amp;</span>gt;</span> <span class="entity"><span>&amp;</span>lt;</span>input type='submit' value='<span class="entity"><span>&amp;</span>quot;</span> . $lang['rename'] . <span class="entity"><span>&amp;</span>quot;</span>' name='rename' class='btn'/<span class="entity"><span>&amp;</span>gt;</span><span class="entity"><span>&amp;</span>quot;</span>;
<span id="line2368"></span> echo <span class="entity"><span>&amp;</span>quot;</span><span class="entity"><span>&amp;</span>lt;</span>/form<span class="entity"><span>&amp;</span>gt;</span><span class="entity"><span>&amp;</span>quot;</span>;
<span id="line2369"></span> break;
<span id="line2370"></span>
<span id="line2371"></span> //- Search table (=table_search)
<span id="line2372"></span> case <span class="entity"><span>&amp;</span>quot;</span>table_search<span class="entity"><span>&amp;</span>quot;</span>:
<span id="line2373"></span> if (!isset($_GET['search'])) {
<span id="line2374"></span> $tableInfo = $db-<span class="entity"><span>&amp;</span>gt;</span>getTableInfo($target_table);
<span id="line2375"></span>
<span id="line2376"></span> echo $params-<span class="entity"><span>&amp;</span>gt;</span>getForm(array('action' =<span class="entity"><span>&amp;</span>gt;</span> 'table_search', 'confirm' =<span class="entity"><span>&amp;</span>gt;</span> '1'));
<span id="line2377"></span>
<span id="line2378"></span> echo <span class="entity"><span>&amp;</span>quot;</span><span class="entity"><span>&amp;</span>lt;</span>table border='0' cellpadding='2' cellspacing='1' class='viewTable'<span class="entity"><span>&amp;</span>gt;</span><span class="entity"><span>&amp;</span>quot;</span>;
<span id="line2379"></span> echo <span class="entity"><span>&amp;</span>quot;</span><span class="entity"><span>&amp;</span>lt;</span>tr<span class="entity"><span>&amp;</span>gt;</span><span class="entity"><span>&amp;</span>quot;</span>;
<span id="line2380"></span> echo <span class="entity"><span>&amp;</span>quot;</span><span class="entity"><span>&amp;</span>lt;</span>td class='tdheader'<span class="entity"><span>&amp;</span>gt;</span><span class="entity"><span>&amp;</span>quot;</span> . $lang['fld'] . <span class="entity"><span>&amp;</span>quot;</span><span class="entity"><span>&amp;</span>lt;</span>/td<span class="entity"><span>&amp;</span>gt;</span><span class="entity"><span>&amp;</span>quot;</span>;
<span id="line2381"></span> echo <span class="entity"><span>&amp;</span>quot;</span><span class="entity"><span>&amp;</span>lt;</span>td class='tdheader'<span class="entity"><span>&amp;</span>gt;</span><span class="entity"><span>&amp;</span>quot;</span> . $lang['type'] . <span class="entity"><span>&amp;</span>quot;</span><span class="entity"><span>&amp;</span>lt;</span>/td<span class="entity"><span>&amp;</span>gt;</span><span class="entity"><span>&amp;</span>quot;</span>;
<span id="line2382"></span> echo <span class="entity"><span>&amp;</span>quot;</span><span class="entity"><span>&amp;</span>lt;</span>td class='tdheader'<span class="entity"><span>&amp;</span>gt;</span><span class="entity"><span>&amp;</span>quot;</span> . $lang['operator'] . <span class="entity"><span>&amp;</span>quot;</span><span class="entity"><span>&amp;</span>lt;</span>/td<span class="entity"><span>&amp;</span>gt;</span><span class="entity"><span>&amp;</span>quot;</span>;
<span id="line2383"></span> echo <span class="entity"><span>&amp;</span>quot;</span><span class="entity"><span>&amp;</span>lt;</span>td class='tdheader'<span class="entity"><span>&amp;</span>gt;</span><span class="entity"><span>&amp;</span>quot;</span> . $lang['val'] . <span class="entity"><span>&amp;</span>quot;</span><span class="entity"><span>&amp;</span>lt;</span>/td<span class="entity"><span>&amp;</span>gt;</span><span class="entity"><span>&amp;</span>quot;</span>;
<span id="line2384"></span> echo <span class="entity"><span>&amp;</span>quot;</span><span class="entity"><span>&amp;</span>lt;</span>/tr<span class="entity"><span>&amp;</span>gt;</span><span class="entity"><span>&amp;</span>quot;</span>;
<span id="line2385"></span>
<span id="line2386"></span> for ($i = 0; $i <span class="entity"><span>&amp;</span>lt;</span> sizeof($tableInfo); $i++) {
<span id="line2387"></span> $field = $tableInfo[$i][1];
<span id="line2388"></span> $type = $tableInfo[$i]['type'];
<span id="line2389"></span> $typeAffinity = get_type_affinity($type);
<span id="line2390"></span> $tdWithClass = <span class="entity"><span>&amp;</span>quot;</span><span class="entity"><span>&amp;</span>lt;</span>td class='td<span class="entity"><span>&amp;</span>quot;</span> . ($i % 2 ? <span class="entity"><span>&amp;</span>quot;</span>1<span class="entity"><span>&amp;</span>quot;</span> : <span class="entity"><span>&amp;</span>quot;</span>2<span class="entity"><span>&amp;</span>quot;</span>) . <span class="entity"><span>&amp;</span>quot;</span>'<span class="entity"><span>&amp;</span>gt;</span><span class="entity"><span>&amp;</span>quot;</span>;
<span id="line2391"></span> $tdWithClassLeft = <span class="entity"><span>&amp;</span>quot;</span><span class="entity"><span>&amp;</span>lt;</span>td class='td<span class="entity"><span>&amp;</span>quot;</span> . ($i % 2 ? <span class="entity"><span>&amp;</span>quot;</span>1<span class="entity"><span>&amp;</span>quot;</span> : <span class="entity"><span>&amp;</span>quot;</span>2<span class="entity"><span>&amp;</span>quot;</span>) . <span class="entity"><span>&amp;</span>quot;</span>' style='text-align:left;'<span class="entity"><span>&amp;</span>gt;</span><span class="entity"><span>&amp;</span>quot;</span>;
<span id="line2392"></span> if (isset($_GET['oldSearch']) <span class="entity"><span>&amp;</span>amp;</span><span class="entity"><span>&amp;</span>amp;</span> isset($_SESSION[COOKIENAME . 'search'][$_GET['oldSearch']]['values'][$field]))
<span id="line2393"></span> $value = implode($_SESSION[COOKIENAME . 'search'][$_GET['oldSearch']]['values'][$field], <span class="entity"><span>&amp;</span>quot;</span>,<span class="entity"><span>&amp;</span>quot;</span>);
<span id="line2394"></span> else
<span id="line2395"></span> $value = '';
<span id="line2396"></span> if (isset($_GET['oldSearch']) <span class="entity"><span>&amp;</span>amp;</span><span class="entity"><span>&amp;</span>amp;</span> isset($_SESSION[COOKIENAME . 'search'][$_GET['oldSearch']]['operators'][$field]))
<span id="line2397"></span> $operator = $_SESSION[COOKIENAME . 'search'][$_GET['oldSearch']]['operators'][$field];
<span id="line2398"></span> elseif ($typeAffinity == <span class="entity"><span>&amp;</span>quot;</span>TEXT<span class="entity"><span>&amp;</span>quot;</span> || $typeAffinity == <span class="entity"><span>&amp;</span>quot;</span>NONE<span class="entity"><span>&amp;</span>quot;</span>)
<span id="line2399"></span> $operator = 'LIKE';
<span id="line2400"></span> else
<span id="line2401"></span> $operator = '=';
<span id="line2402"></span>
<span id="line2403"></span> echo <span class="entity"><span>&amp;</span>quot;</span><span class="entity"><span>&amp;</span>lt;</span>tr<span class="entity"><span>&amp;</span>gt;</span><span class="entity"><span>&amp;</span>quot;</span>;
<span id="line2404"></span> echo $tdWithClassLeft;
<span id="line2405"></span> echo htmlencode($field);
<span id="line2406"></span> echo <span class="entity"><span>&amp;</span>quot;</span><span class="entity"><span>&amp;</span>lt;</span>/td<span class="entity"><span>&amp;</span>gt;</span><span class="entity"><span>&amp;</span>quot;</span>;
<span id="line2407"></span> echo $tdWithClassLeft;
<span id="line2408"></span> echo htmlencode($type);
<span id="line2409"></span> echo <span class="entity"><span>&amp;</span>quot;</span><span class="entity"><span>&amp;</span>lt;</span>/td<span class="entity"><span>&amp;</span>gt;</span><span class="entity"><span>&amp;</span>quot;</span>;
<span id="line2410"></span> echo $tdWithClassLeft;
<span id="line2411"></span> echo <span class="entity"><span>&amp;</span>quot;</span><span class="entity"><span>&amp;</span>lt;</span>select name='field_<span class="entity"><span>&amp;</span>quot;</span> . $i . <span class="entity"><span>&amp;</span>quot;</span>_operator' onchange='checkLike(\<span class="entity"><span>&amp;</span>quot;</span>field_<span class="entity"><span>&amp;</span>quot;</span> . $i . <span class="entity"><span>&amp;</span>quot;</span>_value\<span class="entity"><span>&amp;</span>quot;</span>, this.options[this.selectedIndex].value); '<span class="entity"><span>&amp;</span>gt;</span><span class="entity"><span>&amp;</span>quot;</span>;
<span id="line2412"></span>
<span id="line2413"></span> $operators = array('=', '<span class="entity"><span>&amp;</span>gt;</span>', '<span class="entity"><span>&amp;</span>gt;</span>=', '<span class="entity"><span>&amp;</span>lt;</span>', '<span class="entity"><span>&amp;</span>lt;</span>=', <span class="entity"><span>&amp;</span>quot;</span>= ''<span class="entity"><span>&amp;</span>quot;</span>, <span class="entity"><span>&amp;</span>quot;</span>!= ''<span class="entity"><span>&amp;</span>quot;</span>, '!=', 'LIKE', 'LIKE%', 'NOT LIKE', 'IN', 'NOT IN', 'IS NULL', 'IS NOT NULL');
<span id="line2414"></span> $operatorsDisplay = array('LIKE%' =<span class="entity"><span>&amp;</span>gt;</span> 'LIKE %...%', 'IN' =<span class="entity"><span>&amp;</span>gt;</span> 'IN (..., ...)', 'NOT IN' =<span class="entity"><span>&amp;</span>gt;</span> 'NOT IN (..., ...)');
<span id="line2415"></span> $operatorsNumbersOnly = array('<span class="entity"><span>&amp;</span>gt;</span>', '<span class="entity"><span>&amp;</span>gt;</span>=', '<span class="entity"><span>&amp;</span>lt;</span>', '<span class="entity"><span>&amp;</span>lt;</span>=');
<span id="line2416"></span> $operatorsTextOnly = array(<span class="entity"><span>&amp;</span>quot;</span>= ''<span class="entity"><span>&amp;</span>quot;</span>, <span class="entity"><span>&amp;</span>quot;</span>!= ''<span class="entity"><span>&amp;</span>quot;</span>);
<span id="line2417"></span> foreach ($operators as $op) {
<span id="line2418"></span> if ($typeAffinity != <span class="entity"><span>&amp;</span>quot;</span>INTEGER<span class="entity"><span>&amp;</span>quot;</span> <span class="entity"><span>&amp;</span>amp;</span><span class="entity"><span>&amp;</span>amp;</span> $typeAffinity != <span class="entity"><span>&amp;</span>quot;</span>REAL<span class="entity"><span>&amp;</span>quot;</span> <span class="entity"><span>&amp;</span>amp;</span><span class="entity"><span>&amp;</span>amp;</span> $typeAffinity != <span class="entity"><span>&amp;</span>quot;</span>NUMERIC<span class="entity"><span>&amp;</span>quot;</span> <span class="entity"><span>&amp;</span>amp;</span><span class="entity"><span>&amp;</span>amp;</span> in_array($op, $operatorsNumbersOnly))
<span id="line2419"></span> continue;
<span id="line2420"></span> if ($typeAffinity != <span class="entity"><span>&amp;</span>quot;</span>TEXT<span class="entity"><span>&amp;</span>quot;</span> <span class="entity"><span>&amp;</span>amp;</span><span class="entity"><span>&amp;</span>amp;</span> $typeAffinity != <span class="entity"><span>&amp;</span>quot;</span>NONE<span class="entity"><span>&amp;</span>quot;</span> <span class="entity"><span>&amp;</span>amp;</span><span class="entity"><span>&amp;</span>amp;</span> in_array($op, $operatorsTextOnly))
<span id="line2421"></span> continue;
<span id="line2422"></span> $display = (isset($operatorsDisplay[$op]) ? $operatorsDisplay[$op] : $op);
<span id="line2423"></span> echo <span class="entity"><span>&amp;</span>quot;</span><span class="entity"><span>&amp;</span>lt;</span>option value='<span class="entity"><span>&amp;</span>quot;</span> . htmlencode($op) . <span class="entity"><span>&amp;</span>quot;</span>'<span class="entity"><span>&amp;</span>quot;</span> . ($operator == $op ? <span class="entity"><span>&amp;</span>quot;</span> selected='selected'<span class="entity"><span>&amp;</span>quot;</span> : '') . <span class="entity"><span>&amp;</span>quot;</span><span class="entity"><span>&amp;</span>gt;</span><span class="entity"><span>&amp;</span>quot;</span> . htmlencode($display) . <span class="entity"><span>&amp;</span>quot;</span><span class="entity"><span>&amp;</span>lt;</span>/option<span class="entity"><span>&amp;</span>gt;</span><span class="entity"><span>&amp;</span>quot;</span>;
<span id="line2424"></span> }
<span id="line2425"></span> echo <span class="entity"><span>&amp;</span>quot;</span><span class="entity"><span>&amp;</span>lt;</span>/select<span class="entity"><span>&amp;</span>gt;</span><span class="entity"><span>&amp;</span>quot;</span>;
<span id="line2426"></span> echo <span class="entity"><span>&amp;</span>quot;</span><span class="entity"><span>&amp;</span>lt;</span>/td<span class="entity"><span>&amp;</span>gt;</span><span class="entity"><span>&amp;</span>quot;</span>;
<span id="line2427"></span> echo $tdWithClassLeft;
<span id="line2428"></span> if ($typeAffinity == <span class="entity"><span>&amp;</span>quot;</span>INTEGER<span class="entity"><span>&amp;</span>quot;</span> || $typeAffinity == <span class="entity"><span>&amp;</span>quot;</span>REAL<span class="entity"><span>&amp;</span>quot;</span> || $typeAffinity == <span class="entity"><span>&amp;</span>quot;</span>NUMERIC<span class="entity"><span>&amp;</span>quot;</span>)
<span id="line2429"></span> echo <span class="entity"><span>&amp;</span>quot;</span><span class="entity"><span>&amp;</span>lt;</span>input type='text' id='field_<span class="entity"><span>&amp;</span>quot;</span> . $i . <span class="entity"><span>&amp;</span>quot;</span>_value' name='field_<span class="entity"><span>&amp;</span>quot;</span> . $i . <span class="entity"><span>&amp;</span>quot;</span>_value' value='<span class="entity"><span>&amp;</span>quot;</span> . htmlencode($value) . <span class="entity"><span>&amp;</span>quot;</span>'/<span class="entity"><span>&amp;</span>gt;</span><span class="entity"><span>&amp;</span>quot;</span>;
<span id="line2430"></span> else
<span id="line2431"></span> echo <span class="entity"><span>&amp;</span>quot;</span><span class="entity"><span>&amp;</span>lt;</span>textarea id='field_<span class="entity"><span>&amp;</span>quot;</span> . $i . <span class="entity"><span>&amp;</span>quot;</span>_value' name='field_<span class="entity"><span>&amp;</span>quot;</span> . $i . <span class="entity"><span>&amp;</span>quot;</span>_value' rows='1' cols='60'<span class="entity"><span>&amp;</span>gt;</span><span class="entity"><span>&amp;</span>quot;</span> . htmlencode($value) . <span class="entity"><span>&amp;</span>quot;</span><span class="entity"><span>&amp;</span>lt;</span>/textarea<span class="entity"><span>&amp;</span>gt;</span><span class="entity"><span>&amp;</span>quot;</span>;
<span id="line2432"></span> echo <span class="entity"><span>&amp;</span>quot;</span><span class="entity"><span>&amp;</span>lt;</span>/td<span class="entity"><span>&amp;</span>gt;</span><span class="entity"><span>&amp;</span>quot;</span>;
<span id="line2433"></span> echo <span class="entity"><span>&amp;</span>quot;</span><span class="entity"><span>&amp;</span>lt;</span>/tr<span class="entity"><span>&amp;</span>gt;</span><span class="entity"><span>&amp;</span>quot;</span>;
<span id="line2434"></span> }
<span id="line2435"></span> echo <span class="entity"><span>&amp;</span>quot;</span><span class="entity"><span>&amp;</span>lt;</span>tr<span class="entity"><span>&amp;</span>gt;</span><span class="entity"><span>&amp;</span>quot;</span>;
<span id="line2436"></span> echo <span class="entity"><span>&amp;</span>quot;</span><span class="entity"><span>&amp;</span>lt;</span>td class='tdheader' style='text-align:right;' colspan='4'<span class="entity"><span>&amp;</span>gt;</span><span class="entity"><span>&amp;</span>quot;</span>;
<span id="line2437"></span> echo <span class="entity"><span>&amp;</span>quot;</span><span class="entity"><span>&amp;</span>lt;</span>input type='submit' value='<span class="entity"><span>&amp;</span>quot;</span> . $lang['srch'] . <span class="entity"><span>&amp;</span>quot;</span>' class='btn'/<span class="entity"><span>&amp;</span>gt;</span><span class="entity"><span>&amp;</span>quot;</span>;
<span id="line2438"></span> echo <span class="entity"><span>&amp;</span>quot;</span><span class="entity"><span>&amp;</span>lt;</span>/td<span class="entity"><span>&amp;</span>gt;</span><span class="entity"><span>&amp;</span>quot;</span>;
<span id="line2439"></span> echo <span class="entity"><span>&amp;</span>quot;</span><span class="entity"><span>&amp;</span>lt;</span>/tr<span class="entity"><span>&amp;</span>gt;</span><span class="entity"><span>&amp;</span>quot;</span>;
<span id="line2440"></span> echo <span class="entity"><span>&amp;</span>quot;</span><span class="entity"><span>&amp;</span>lt;</span>/table<span class="entity"><span>&amp;</span>gt;</span><span class="entity"><span>&amp;</span>quot;</span>;
<span id="line2441"></span> echo <span class="entity"><span>&amp;</span>quot;</span><span class="entity"><span>&amp;</span>lt;</span>/form<span class="entity"><span>&amp;</span>gt;</span><span class="entity"><span>&amp;</span>quot;</span>;
<span id="line2442"></span>
<span id="line2443"></span> break;
<span id="line2444"></span> } elseif (isset($_SESSION[COOKIENAME . 'search'][$_GET['search']])) {
<span id="line2445"></span> $params-<span class="entity"><span>&amp;</span>gt;</span>search = $_GET['search'];
<span id="line2446"></span> $search = $_SESSION[COOKIENAME . 'search'][$_GET['search']];
<span id="line2447"></span> // NOTICE: we do not break here!! we just do the same now like row_view-action does
<span id="line2448"></span> }
<span id="line2449"></span>
<span id="line2450"></span> //- Row actions
<span id="line2451"></span>
<span id="line2452"></span> //- View row (=row_view)
<span id="line2453"></span> case <span class="entity"><span>&amp;</span>quot;</span>row_view<span class="entity"><span>&amp;</span>quot;</span>:
<span id="line2454"></span> if (!isset($_GET['startRow']))
<span id="line2455"></span> $_GET['startRow'] = 0;
<span id="line2456"></span>
<span id="line2457"></span> if (isset($_SESSION[COOKIENAME . 'currentTable']) <span class="entity"><span>&amp;</span>amp;</span><span class="entity"><span>&amp;</span>amp;</span> $_SESSION[COOKIENAME . 'currentTable'] != $target_table) {
<span id="line2458"></span> unset($_SESSION[COOKIENAME . 'sortRows']);
<span id="line2459"></span> unset($_SESSION[COOKIENAME . 'orderRows']);
<span id="line2460"></span> }
<span id="line2461"></span> if (isset($_GET['viewtype'])) {
<span id="line2462"></span> $_SESSION[COOKIENAME . 'viewtype'] = $_GET['viewtype'];
<span id="line2463"></span> }
<span id="line2464"></span>
<span id="line2465"></span> //- Query execution
<span id="line2466"></span> if (!isset($_GET['sort']))
<span id="line2467"></span> $_GET['sort'] = NULL;
<span id="line2468"></span> if (!isset($_GET['order']))
<span id="line2469"></span> $_GET['order'] = NULL;
<span id="line2470"></span>
<span id="line2471"></span> $numRows = $params-<span class="entity"><span>&amp;</span>gt;</span>numRows;
<span id="line2472"></span> $startRow = $_GET['startRow'];
<span id="line2473"></span> if (isset($_GET['sort'])) {
<span id="line2474"></span> $_SESSION[COOKIENAME . 'sortRows'] = $_GET['sort'];
<span id="line2475"></span> $_SESSION[COOKIENAME . 'currentTable'] = $target_table;
<span id="line2476"></span> }
<span id="line2477"></span> if (isset($_GET['order'])) {
<span id="line2478"></span> $_SESSION[COOKIENAME . 'orderRows'] = $_GET['order'];
<span id="line2479"></span> $_SESSION[COOKIENAME . 'currentTable'] = $target_table;
<span id="line2480"></span> }
<span id="line2481"></span> $query = <span class="entity"><span>&amp;</span>quot;</span>SELECT * <span class="entity"><span>&amp;</span>quot;</span>;
<span id="line2482"></span> // select the primary key column(s) last (ROWID if there is no PK).
<span id="line2483"></span> // this will be used to identify rows, e.g. when editing/deleting rows
<span id="line2484"></span> $primary_key = $db-<span class="entity"><span>&amp;</span>gt;</span>getPrimaryKey($target_table);
<span id="line2485"></span> foreach ($primary_key as $pk) {
<span id="line2486"></span> $query .= ', ' . $db-<span class="entity"><span>&amp;</span>gt;</span>quote_id($pk);
<span id="line2487"></span> $query .= ', typeof(' . $db-<span class="entity"><span>&amp;</span>gt;</span>quote_id($pk) . ')';
<span id="line2488"></span> }
<span id="line2489"></span> $query .= <span class="entity"><span>&amp;</span>quot;</span> FROM <span class="entity"><span>&amp;</span>quot;</span> . $db-<span class="entity"><span>&amp;</span>gt;</span>quote_id($target_table);
<span id="line2490"></span> $queryDisp = <span class="entity"><span>&amp;</span>quot;</span>SELECT * FROM <span class="entity"><span>&amp;</span>quot;</span> . $db-<span class="entity"><span>&amp;</span>gt;</span>quote_id($target_table);
<span id="line2491"></span> $queryCount = <span class="entity"><span>&amp;</span>quot;</span>SELECT COUNT(*) AS count FROM <span class="entity"><span>&amp;</span>quot;</span> . $db-<span class="entity"><span>&amp;</span>gt;</span>quote_id($target_table);
<span id="line2492"></span> $queryAdd = <span class="entity"><span>&amp;</span>quot;</span><span class="entity"><span>&amp;</span>quot;</span>;
<span id="line2493"></span> if (isset($search) <span class="entity"><span>&amp;</span>amp;</span><span class="entity"><span>&amp;</span>amp;</span> isset($search['where'])) {
<span id="line2494"></span> $queryAdd = $search['where'];
<span id="line2495"></span> $queryCount .= $search['where'];
<span id="line2496"></span> }
<span id="line2497"></span> if (isset($_SESSION[COOKIENAME . 'sortRows']))
<span id="line2498"></span> $queryAdd .= <span class="entity"><span>&amp;</span>quot;</span> ORDER BY <span class="entity"><span>&amp;</span>quot;</span> . $db-<span class="entity"><span>&amp;</span>gt;</span>quote_id($_SESSION[COOKIENAME . 'sortRows']);
<span id="line2499"></span> if (isset($_SESSION[COOKIENAME . 'orderRows']))
<span id="line2500"></span> $queryAdd .= <span class="entity"><span>&amp;</span>quot;</span> <span class="entity"><span>&amp;</span>quot;</span> . $_SESSION[COOKIENAME . 'orderRows'];
<span id="line2501"></span> $queryAdd .= <span class="entity"><span>&amp;</span>quot;</span> LIMIT <span class="entity"><span>&amp;</span>quot;</span> . $startRow . <span class="entity"><span>&amp;</span>quot;</span>, <span class="entity"><span>&amp;</span>quot;</span> . $numRows;
<span id="line2502"></span> $query .= $queryAdd;
<span id="line2503"></span> $queryDisp .= $queryAdd;
<span id="line2504"></span>
<span id="line2505"></span> $resultRows = $db-<span class="entity"><span>&amp;</span>gt;</span>select($queryCount);
<span id="line2506"></span> $totalRows = $resultRows['count'];
<span id="line2507"></span> $shownRows = min($resultRows['count'] - $startRow, $numRows);
<span id="line2508"></span>
<span id="line2509"></span> //- HTML: pagination buttons
<span id="line2510"></span> $lastPage = intval($totalRows / $params-<span class="entity"><span>&amp;</span>gt;</span>numRows);
<span id="line2511"></span> $remainder = intval($totalRows % $params-<span class="entity"><span>&amp;</span>gt;</span>numRows);
<span id="line2512"></span> if ($remainder == 0)
<span id="line2513"></span> $remainder = $params-<span class="entity"><span>&amp;</span>gt;</span>numRows;
<span id="line2514"></span>
<span id="line2515"></span> echo <span class="entity"><span>&amp;</span>quot;</span><span class="entity"><span>&amp;</span>lt;</span>div style=''<span class="entity"><span>&amp;</span>gt;</span><span class="entity"><span>&amp;</span>quot;</span>;
<span id="line2516"></span> //previous button
<span id="line2517"></span> if ($_GET['startRow'] <span class="entity"><span>&amp;</span>gt;</span> 0) {
<span id="line2518"></span> echo <span class="entity"><span>&amp;</span>quot;</span><span class="entity"><span>&amp;</span>lt;</span>div style='float:left;'<span class="entity"><span>&amp;</span>gt;</span><span class="entity"><span>&amp;</span>quot;</span>;
<span id="line2519"></span> echo $params-<span class="entity"><span>&amp;</span>gt;</span>getForm(array('action' =<span class="entity"><span>&amp;</span>gt;</span> $_GET['action']), 'get');
<span id="line2520"></span> echo <span class="entity"><span>&amp;</span>quot;</span><span class="entity"><span>&amp;</span>lt;</span>input type='hidden' name='startRow' value='0'/<span class="entity"><span>&amp;</span>gt;</span><span class="entity"><span>&amp;</span>quot;</span>;
<span id="line2521"></span> echo <span class="entity"><span>&amp;</span>quot;</span><span class="entity"><span>&amp;</span>lt;</span>input type='submit' value='<span class="entity"><span>&amp;</span>amp;</span>larr;<span class="entity"><span>&amp;</span>amp;</span>larr;' class='btn'/<span class="entity"><span>&amp;</span>gt;</span> <span class="entity"><span>&amp;</span>quot;</span>;
<span id="line2522"></span> echo <span class="entity"><span>&amp;</span>quot;</span><span class="entity"><span>&amp;</span>lt;</span>/form<span class="entity"><span>&amp;</span>gt;</span><span class="entity"><span>&amp;</span>quot;</span>;
<span id="line2523"></span> echo <span class="entity"><span>&amp;</span>quot;</span><span class="entity"><span>&amp;</span>lt;</span>/div<span class="entity"><span>&amp;</span>gt;</span><span class="entity"><span>&amp;</span>quot;</span>;
<span id="line2524"></span> echo <span class="entity"><span>&amp;</span>quot;</span><span class="entity"><span>&amp;</span>lt;</span>div style='float:left; overflow:hidden; margin-right:20px;'<span class="entity"><span>&amp;</span>gt;</span><span class="entity"><span>&amp;</span>quot;</span>;
<span id="line2525"></span> echo $params-<span class="entity"><span>&amp;</span>gt;</span>getForm(array('action' =<span class="entity"><span>&amp;</span>gt;</span> $_GET['action']), 'get');
<span id="line2526"></span> echo <span class="entity"><span>&amp;</span>quot;</span><span class="entity"><span>&amp;</span>lt;</span>input type='hidden' name='startRow' value='<span class="entity"><span>&amp;</span>quot;</span> . max(0, intval($_GET['startRow'] - $params-<span class="entity"><span>&amp;</span>gt;</span>numRows)) . <span class="entity"><span>&amp;</span>quot;</span>'/<span class="entity"><span>&amp;</span>gt;</span><span class="entity"><span>&amp;</span>quot;</span>;
<span id="line2527"></span> echo <span class="entity"><span>&amp;</span>quot;</span><span class="entity"><span>&amp;</span>lt;</span>input type='submit' value='<span class="entity"><span>&amp;</span>amp;</span>larr;' class='btn'/<span class="entity"><span>&amp;</span>gt;</span> <span class="entity"><span>&amp;</span>quot;</span>;
<span id="line2528"></span> echo <span class="entity"><span>&amp;</span>quot;</span><span class="entity"><span>&amp;</span>lt;</span>/form<span class="entity"><span>&amp;</span>gt;</span><span class="entity"><span>&amp;</span>quot;</span>;
<span id="line2529"></span> echo <span class="entity"><span>&amp;</span>quot;</span><span class="entity"><span>&amp;</span>lt;</span>/div<span class="entity"><span>&amp;</span>gt;</span><span class="entity"><span>&amp;</span>quot;</span>;
<span id="line2530"></span> }
<span id="line2531"></span>
<span id="line2532"></span> //show certain number buttons
<span id="line2533"></span> echo <span class="entity"><span>&amp;</span>quot;</span><span class="entity"><span>&amp;</span>lt;</span>div style='float:left;'<span class="entity"><span>&amp;</span>gt;</span><span class="entity"><span>&amp;</span>quot;</span>;
<span id="line2534"></span> echo $params-<span class="entity"><span>&amp;</span>gt;</span>getForm(array('action' =<span class="entity"><span>&amp;</span>gt;</span> $_GET['action'], 'numRows' =<span class="entity"><span>&amp;</span>gt;</span> null), 'get');
<span id="line2535"></span> echo <span class="entity"><span>&amp;</span>quot;</span><span class="entity"><span>&amp;</span>lt;</span>input type='submit' value='<span class="entity"><span>&amp;</span>quot;</span> . $lang['show'] . <span class="entity"><span>&amp;</span>quot;</span> : ' name='show' class='btn'/<span class="entity"><span>&amp;</span>gt;</span> <span class="entity"><span>&amp;</span>quot;</span>;
<span id="line2536"></span> echo <span class="entity"><span>&amp;</span>quot;</span><span class="entity"><span>&amp;</span>lt;</span>input type='text' name='numRows' style='width:50px;' value='<span class="entity"><span>&amp;</span>quot;</span> . $params-<span class="entity"><span>&amp;</span>gt;</span>numRows . <span class="entity"><span>&amp;</span>quot;</span>'/<span class="entity"><span>&amp;</span>gt;</span> <span class="entity"><span>&amp;</span>quot;</span>;
<span id="line2537"></span> echo $lang['rows_records'];
<span id="line2538"></span>
<span id="line2539"></span> if (intval($_GET['startRow'] + $params-<span class="entity"><span>&amp;</span>gt;</span>numRows) <span class="entity"><span>&amp;</span>lt;</span> $totalRows)
<span id="line2540"></span> echo <span class="entity"><span>&amp;</span>quot;</span><span class="entity"><span>&amp;</span>lt;</span>input type='text' name='startRow' style='width:90px;' value='<span class="entity"><span>&amp;</span>quot;</span> . intval($_GET['startRow'] + $params-<span class="entity"><span>&amp;</span>gt;</span>numRows) . <span class="entity"><span>&amp;</span>quot;</span>'/<span class="entity"><span>&amp;</span>gt;</span><span class="entity"><span>&amp;</span>quot;</span>;
<span id="line2541"></span> else
<span id="line2542"></span> echo <span class="entity"><span>&amp;</span>quot;</span><span class="entity"><span>&amp;</span>lt;</span>input type='text' name='startRow' style='width:90px;' value='0'/<span class="entity"><span>&amp;</span>gt;</span> <span class="entity"><span>&amp;</span>quot;</span>;
<span id="line2543"></span> echo $lang['as_a'];
<span id="line2544"></span> echo <span class="entity"><span>&amp;</span>quot;</span> <span class="entity"><span>&amp;</span>lt;</span>select name='viewtype'<span class="entity"><span>&amp;</span>gt;</span><span class="entity"><span>&amp;</span>quot;</span>;
<span id="line2545"></span> if (!isset($_SESSION[COOKIENAME . 'viewtype']) || $_SESSION[COOKIENAME . 'viewtype'] == <span class="entity"><span>&amp;</span>quot;</span>table<span class="entity"><span>&amp;</span>quot;</span>) {
<span id="line2546"></span> echo <span class="entity"><span>&amp;</span>quot;</span><span class="entity"><span>&amp;</span>lt;</span>option value='table' selected='selected'<span class="entity"><span>&amp;</span>gt;</span><span class="entity"><span>&amp;</span>quot;</span> . $lang['tbl'] . <span class="entity"><span>&amp;</span>quot;</span><span class="entity"><span>&amp;</span>lt;</span>/option<span class="entity"><span>&amp;</span>gt;</span><span class="entity"><span>&amp;</span>quot;</span>;
<span id="line2547"></span> echo <span class="entity"><span>&amp;</span>quot;</span><span class="entity"><span>&amp;</span>lt;</span>option value='chart'<span class="entity"><span>&amp;</span>gt;</span><span class="entity"><span>&amp;</span>quot;</span> . $lang['chart'] . <span class="entity"><span>&amp;</span>quot;</span><span class="entity"><span>&amp;</span>lt;</span>/option<span class="entity"><span>&amp;</span>gt;</span><span class="entity"><span>&amp;</span>quot;</span>;
<span id="line2548"></span> } else {
<span id="line2549"></span> echo <span class="entity"><span>&amp;</span>quot;</span><span class="entity"><span>&amp;</span>lt;</span>option value='table'<span class="entity"><span>&amp;</span>gt;</span><span class="entity"><span>&amp;</span>quot;</span> . $lang['tbl'] . <span class="entity"><span>&amp;</span>quot;</span><span class="entity"><span>&amp;</span>lt;</span>/option<span class="entity"><span>&amp;</span>gt;</span><span class="entity"><span>&amp;</span>quot;</span>;
<span id="line2550"></span> echo <span class="entity"><span>&amp;</span>quot;</span><span class="entity"><span>&amp;</span>lt;</span>option value='chart' selected='selected'<span class="entity"><span>&amp;</span>gt;</span><span class="entity"><span>&amp;</span>quot;</span> . $lang['chart'] . <span class="entity"><span>&amp;</span>quot;</span><span class="entity"><span>&amp;</span>lt;</span>/option<span class="entity"><span>&amp;</span>gt;</span><span class="entity"><span>&amp;</span>quot;</span>;
<span id="line2551"></span> }
<span id="line2552"></span> echo <span class="entity"><span>&amp;</span>quot;</span><span class="entity"><span>&amp;</span>lt;</span>/select<span class="entity"><span>&amp;</span>gt;</span><span class="entity"><span>&amp;</span>quot;</span>;
<span id="line2553"></span> echo <span class="entity"><span>&amp;</span>quot;</span><span class="entity"><span>&amp;</span>lt;</span>/form<span class="entity"><span>&amp;</span>gt;</span><span class="entity"><span>&amp;</span>quot;</span>;
<span id="line2554"></span> echo <span class="entity"><span>&amp;</span>quot;</span><span class="entity"><span>&amp;</span>lt;</span>/div<span class="entity"><span>&amp;</span>gt;</span><span class="entity"><span>&amp;</span>quot;</span>;
<span id="line2555"></span>
<span id="line2556"></span> //next button
<span id="line2557"></span> if (intval($_GET['startRow'] + $params-<span class="entity"><span>&amp;</span>gt;</span>numRows) <span class="entity"><span>&amp;</span>lt;</span> $totalRows) {
<span id="line2558"></span> echo <span class="entity"><span>&amp;</span>quot;</span><span class="entity"><span>&amp;</span>lt;</span>div style='float:left; margin-left:20px; '<span class="entity"><span>&amp;</span>gt;</span><span class="entity"><span>&amp;</span>quot;</span>;
<span id="line2559"></span> echo $params-<span class="entity"><span>&amp;</span>gt;</span>getForm(array('action' =<span class="entity"><span>&amp;</span>gt;</span> $_GET['action']), 'get');
<span id="line2560"></span> echo <span class="entity"><span>&amp;</span>quot;</span><span class="entity"><span>&amp;</span>lt;</span>input type='hidden' name='startRow' value='<span class="entity"><span>&amp;</span>quot;</span> . intval($_GET['startRow'] + $params-<span class="entity"><span>&amp;</span>gt;</span>numRows) . <span class="entity"><span>&amp;</span>quot;</span>'/<span class="entity"><span>&amp;</span>gt;</span><span class="entity"><span>&amp;</span>quot;</span>;
<span id="line2561"></span> echo <span class="entity"><span>&amp;</span>quot;</span><span class="entity"><span>&amp;</span>lt;</span>input type='submit' value='<span class="entity"><span>&amp;</span>amp;</span>rarr;' class='btn'/<span class="entity"><span>&amp;</span>gt;</span> <span class="entity"><span>&amp;</span>quot;</span>;
<span id="line2562"></span> echo <span class="entity"><span>&amp;</span>quot;</span><span class="entity"><span>&amp;</span>lt;</span>/form<span class="entity"><span>&amp;</span>gt;</span><span class="entity"><span>&amp;</span>quot;</span>;
<span id="line2563"></span> echo <span class="entity"><span>&amp;</span>quot;</span><span class="entity"><span>&amp;</span>lt;</span>/div<span class="entity"><span>&amp;</span>gt;</span><span class="entity"><span>&amp;</span>quot;</span>;
<span id="line2564"></span> echo <span class="entity"><span>&amp;</span>quot;</span><span class="entity"><span>&amp;</span>lt;</span>div style='float:left; '<span class="entity"><span>&amp;</span>gt;</span><span class="entity"><span>&amp;</span>quot;</span>;
<span id="line2565"></span> echo $params-<span class="entity"><span>&amp;</span>gt;</span>getForm(array('action' =<span class="entity"><span>&amp;</span>gt;</span> $_GET['action']), 'get');
<span id="line2566"></span> echo <span class="entity"><span>&amp;</span>quot;</span><span class="entity"><span>&amp;</span>lt;</span>input type='hidden' name='startRow' value='<span class="entity"><span>&amp;</span>quot;</span> . intval($totalRows - $remainder) . <span class="entity"><span>&amp;</span>quot;</span>'/<span class="entity"><span>&amp;</span>gt;</span><span class="entity"><span>&amp;</span>quot;</span>;
<span id="line2567"></span> echo <span class="entity"><span>&amp;</span>quot;</span><span class="entity"><span>&amp;</span>lt;</span>input type='submit' value='<span class="entity"><span>&amp;</span>amp;</span>rarr;<span class="entity"><span>&amp;</span>amp;</span>rarr;' class='btn'/<span class="entity"><span>&amp;</span>gt;</span> <span class="entity"><span>&amp;</span>quot;</span>;
<span id="line2568"></span> echo <span class="entity"><span>&amp;</span>quot;</span><span class="entity"><span>&amp;</span>lt;</span>/form<span class="entity"><span>&amp;</span>gt;</span><span class="entity"><span>&amp;</span>quot;</span>;
<span id="line2569"></span> echo <span class="entity"><span>&amp;</span>quot;</span><span class="entity"><span>&amp;</span>lt;</span>/div<span class="entity"><span>&amp;</span>gt;</span><span class="entity"><span>&amp;</span>quot;</span>;
<span id="line2570"></span> }
<span id="line2571"></span> echo <span class="entity"><span>&amp;</span>quot;</span><span class="entity"><span>&amp;</span>lt;</span>div style='clear:both;'<span class="entity"><span>&amp;</span>gt;</span><span class="entity"><span>&amp;</span>lt;</span>/div<span class="entity"><span>&amp;</span>gt;</span><span class="entity"><span>&amp;</span>quot;</span>;
<span id="line2572"></span> echo <span class="entity"><span>&amp;</span>quot;</span><span class="entity"><span>&amp;</span>lt;</span>/div<span class="entity"><span>&amp;</span>gt;</span><span class="entity"><span>&amp;</span>quot;</span>;
<span id="line2573"></span>
<span id="line2574"></span>
<span id="line2575"></span> //- Show results
<span id="line2576"></span> if ($shownRows <span class="entity"><span>&amp;</span>gt;</span> 0) {
<span id="line2577"></span> $queryTimer = new MicroTimer();
<span id="line2578"></span> $table_result = $db-<span class="entity"><span>&amp;</span>gt;</span>query($query);
<span id="line2579"></span> $queryTimer-<span class="entity"><span>&amp;</span>gt;</span>stop();
<span id="line2580"></span>
<span id="line2581"></span>
<span id="line2582"></span> echo <span class="entity"><span>&amp;</span>quot;</span><span class="entity"><span>&amp;</span>lt;</span>br/<span class="entity"><span>&amp;</span>gt;</span><span class="entity"><span>&amp;</span>lt;</span>div class='confirm'<span class="entity"><span>&amp;</span>gt;</span><span class="entity"><span>&amp;</span>quot;</span>;
<span id="line2583"></span> echo <span class="entity"><span>&amp;</span>quot;</span><span class="entity"><span>&amp;</span>lt;</span>b<span class="entity"><span>&amp;</span>gt;</span><span class="entity"><span>&amp;</span>quot;</span> . $lang['showing_rows'] . <span class="entity"><span>&amp;</span>quot;</span> <span class="entity"><span>&amp;</span>quot;</span> . $startRow . <span class="entity"><span>&amp;</span>quot;</span> - <span class="entity"><span>&amp;</span>quot;</span> . ($startRow + $shownRows - 1) . <span class="entity"><span>&amp;</span>quot;</span>, <span class="entity"><span>&amp;</span>quot;</span> . $lang['total'] . <span class="entity"><span>&amp;</span>quot;</span>: <span class="entity"><span>&amp;</span>quot;</span> . $totalRows . <span class="entity"><span>&amp;</span>quot;</span> <span class="entity"><span>&amp;</span>quot;</span>;
<span id="line2584"></span> printf($lang['query_time'], $queryTimer);
<span id="line2585"></span> echo <span class="entity"><span>&amp;</span>quot;</span><span class="entity"><span>&amp;</span>lt;</span>/b<span class="entity"><span>&amp;</span>gt;</span><span class="entity"><span>&amp;</span>lt;</span>br/<span class="entity"><span>&amp;</span>gt;</span><span class="entity"><span>&amp;</span>quot;</span>;
<span id="line2586"></span> echo <span class="entity"><span>&amp;</span>quot;</span><span class="entity"><span>&amp;</span>lt;</span>span style='font-size:11px;'<span class="entity"><span>&amp;</span>gt;</span><span class="entity"><span>&amp;</span>quot;</span> . htmlencode($queryDisp) . <span class="entity"><span>&amp;</span>quot;</span><span class="entity"><span>&amp;</span>lt;</span>/span<span class="entity"><span>&amp;</span>gt;</span><span class="entity"><span>&amp;</span>quot;</span>;
<span id="line2587"></span> echo <span class="entity"><span>&amp;</span>quot;</span><span class="entity"><span>&amp;</span>lt;</span>/div<span class="entity"><span>&amp;</span>gt;</span><span class="entity"><span>&amp;</span>lt;</span>br/<span class="entity"><span>&amp;</span>gt;</span><span class="entity"><span>&amp;</span>quot;</span>;
<span id="line2588"></span>
<span id="line2589"></span> if ($target_table_type == 'view') {
<span id="line2590"></span> echo sprintf($lang['readonly_tbl'], htmlencode($target_table)) . <span class="entity"><span>&amp;</span>quot;</span> <span class="entity"><span>&amp;</span>lt;</span>a href='https://en.wikipedia.org/wiki/View_(SQL)' target='_blank'<span class="entity"><span>&amp;</span>gt;</span>https://en.wikipedia.org/wiki/View_(SQL)<span class="entity"><span>&amp;</span>lt;</span>/a<span class="entity"><span>&amp;</span>gt;</span><span class="entity"><span>&amp;</span>quot;</span>;
<span id="line2591"></span> echo <span class="entity"><span>&amp;</span>quot;</span><span class="entity"><span>&amp;</span>lt;</span>br/<span class="entity"><span>&amp;</span>gt;</span><span class="entity"><span>&amp;</span>lt;</span>br/<span class="entity"><span>&amp;</span>gt;</span><span class="entity"><span>&amp;</span>quot;</span>;
<span id="line2592"></span> }
<span id="line2593"></span>
<span id="line2594"></span> $tableInfo = $db-<span class="entity"><span>&amp;</span>gt;</span>getTableInfo($target_table);
<span id="line2595"></span> $pkFirstCol = sizeof($tableInfo) + 1;
<span id="line2596"></span> //- Table view
<span id="line2597"></span> if (!isset($_SESSION[COOKIENAME . 'viewtype']) || $_SESSION[COOKIENAME . 'viewtype'] == <span class="entity"><span>&amp;</span>quot;</span>table<span class="entity"><span>&amp;</span>quot;</span>) {
<span id="line2598"></span> echo $params-<span class="entity"><span>&amp;</span>gt;</span>getForm(array('action' =<span class="entity"><span>&amp;</span>gt;</span> 'row_editordelete'), 'post', false, 'checkForm');
<span id="line2599"></span> echo <span class="entity"><span>&amp;</span>quot;</span><span class="entity"><span>&amp;</span>lt;</span>table border='0' cellpadding='2' cellspacing='1' class='viewTable'<span class="entity"><span>&amp;</span>gt;</span><span class="entity"><span>&amp;</span>quot;</span>;
<span id="line2600"></span> echo <span class="entity"><span>&amp;</span>quot;</span><span class="entity"><span>&amp;</span>lt;</span>tr<span class="entity"><span>&amp;</span>gt;</span><span class="entity"><span>&amp;</span>quot;</span>;
<span id="line2601"></span> echo <span class="entity"><span>&amp;</span>quot;</span><span class="entity"><span>&amp;</span>lt;</span>td colspan='3' class='tdheader' style='text-align:center'<span class="entity"><span>&amp;</span>gt;</span><span class="entity"><span>&amp;</span>quot;</span>;
<span id="line2602"></span> echo <span class="entity"><span>&amp;</span>quot;</span><span class="entity"><span>&amp;</span>lt;</span>a href='<span class="entity"><span>&amp;</span>quot;</span> . $params-<span class="entity"><span>&amp;</span>gt;</span>getURL(array('action' =<span class="entity"><span>&amp;</span>gt;</span> $_GET['action'], 'fulltexts' =<span class="entity"><span>&amp;</span>gt;</span> ($params-<span class="entity"><span>&amp;</span>gt;</span>fulltexts ? 0 : 1))) . <span class="entity"><span>&amp;</span>quot;</span>' title='<span class="entity"><span>&amp;</span>quot;</span> . $lang[($params-<span class="entity"><span>&amp;</span>gt;</span>fulltexts ? 'no_full_texts' : 'full_texts')] . <span class="entity"><span>&amp;</span>quot;</span>'<span class="entity"><span>&amp;</span>gt;</span><span class="entity"><span>&amp;</span>quot;</span>;
<span id="line2603"></span> echo <span class="entity"><span>&amp;</span>quot;</span><span class="entity"><span>&amp;</span>lt;</span>b<span class="entity"><span>&amp;</span>gt;</span><span class="entity"><span>&amp;</span>amp;</span><span class="entity"><span>&amp;</span>quot;</span> . ($params-<span class="entity"><span>&amp;</span>gt;</span>fulltexts ? 'r' : 'l') . <span class="entity"><span>&amp;</span>quot;</span>arr;<span class="entity"><span>&amp;</span>lt;</span>/b<span class="entity"><span>&amp;</span>gt;</span><span class="entity"><span>&amp;</span>amp;</span>nbsp;T<span class="entity"><span>&amp;</span>amp;</span>nbsp;<span class="entity"><span>&amp;</span>lt;</span>b<span class="entity"><span>&amp;</span>gt;</span><span class="entity"><span>&amp;</span>amp;</span><span class="entity"><span>&amp;</span>quot;</span> . ($params-<span class="entity"><span>&amp;</span>gt;</span>fulltexts ? 'l' : 'r') . <span class="entity"><span>&amp;</span>quot;</span>arr;<span class="entity"><span>&amp;</span>lt;</span>/b<span class="entity"><span>&amp;</span>gt;</span><span class="entity"><span>&amp;</span>lt;</span>/a<span class="entity"><span>&amp;</span>gt;</span><span class="entity"><span>&amp;</span>quot;</span>;
<span id="line2604"></span> echo <span class="entity"><span>&amp;</span>quot;</span><span class="entity"><span>&amp;</span>lt;</span>/td<span class="entity"><span>&amp;</span>gt;</span><span class="entity"><span>&amp;</span>quot;</span>;
<span id="line2605"></span>
<span id="line2606"></span> for ($i = 0; $i <span class="entity"><span>&amp;</span>lt;</span> sizeof($tableInfo); $i++) {
<span id="line2607"></span> echo <span class="entity"><span>&amp;</span>quot;</span><span class="entity"><span>&amp;</span>lt;</span>td class='tdheader'<span class="entity"><span>&amp;</span>gt;</span><span class="entity"><span>&amp;</span>quot;</span>;
<span id="line2608"></span> if (isset($_SESSION[COOKIENAME . 'sortRows']))
<span id="line2609"></span> $orderTag = ($_SESSION[COOKIENAME . 'sortRows'] == $tableInfo[$i]['name'] <span class="entity"><span>&amp;</span>amp;</span><span class="entity"><span>&amp;</span>amp;</span> $_SESSION[COOKIENAME . 'orderRows'] == <span class="entity"><span>&amp;</span>quot;</span>ASC<span class="entity"><span>&amp;</span>quot;</span>) ? <span class="entity"><span>&amp;</span>quot;</span>DESC<span class="entity"><span>&amp;</span>quot;</span> : <span class="entity"><span>&amp;</span>quot;</span>ASC<span class="entity"><span>&amp;</span>quot;</span>;
<span id="line2610"></span> else
<span id="line2611"></span> $orderTag = <span class="entity"><span>&amp;</span>quot;</span>ASC<span class="entity"><span>&amp;</span>quot;</span>;
<span id="line2612"></span> echo $params-<span class="entity"><span>&amp;</span>gt;</span>getLink(array('action' =<span class="entity"><span>&amp;</span>gt;</span> $_GET['action'], 'sort' =<span class="entity"><span>&amp;</span>gt;</span> $tableInfo[$i]['name'], 'order' =<span class="entity"><span>&amp;</span>gt;</span> $orderTag), htmlencode($tableInfo[$i]['name']));
<span id="line2613"></span> if (isset($_SESSION[COOKIENAME . 'sortRows']) <span class="entity"><span>&amp;</span>amp;</span><span class="entity"><span>&amp;</span>amp;</span> $_SESSION[COOKIENAME . 'sortRows'] == $tableInfo[$i]['name'])
<span id="line2614"></span> echo(($_SESSION[COOKIENAME . 'orderRows'] == <span class="entity"><span>&amp;</span>quot;</span>ASC<span class="entity"><span>&amp;</span>quot;</span>) ? <span class="entity"><span>&amp;</span>quot;</span> <span class="entity"><span>&amp;</span>lt;</span>b<span class="entity"><span>&amp;</span>gt;</span><span class="entity"><span>&amp;</span>amp;</span>uarr;<span class="entity"><span>&amp;</span>lt;</span>/b<span class="entity"><span>&amp;</span>gt;</span><span class="entity"><span>&amp;</span>quot;</span> : <span class="entity"><span>&amp;</span>quot;</span> <span class="entity"><span>&amp;</span>lt;</span>b<span class="entity"><span>&amp;</span>gt;</span><span class="entity"><span>&amp;</span>amp;</span>darr;<span class="entity"><span>&amp;</span>lt;</span>/b<span class="entity"><span>&amp;</span>gt;</span><span class="entity"><span>&amp;</span>quot;</span>);
<span id="line2615"></span> echo <span class="entity"><span>&amp;</span>quot;</span><span class="entity"><span>&amp;</span>lt;</span>/td<span class="entity"><span>&amp;</span>gt;</span><span class="entity"><span>&amp;</span>quot;</span>;
<span id="line2616"></span> }
<span id="line2617"></span> echo <span class="entity"><span>&amp;</span>quot;</span><span class="entity"><span>&amp;</span>lt;</span>/tr<span class="entity"><span>&amp;</span>gt;</span><span class="entity"><span>&amp;</span>quot;</span>;
<span id="line2618"></span>
<span id="line2619"></span> for ($i = 0; $row = $db-<span class="entity"><span>&amp;</span>gt;</span>fetch($table_result, 'num'); $i++) {
<span id="line2620"></span> // -g-<span class="entity"><span>&amp;</span>gt;</span> $pk will always be the last columns in each row of the array because we are doing <span class="entity"><span>&amp;</span>quot;</span>SELECT *, PK_1, typeof(PK_1), PK2, typeof(PK_2), ... FROM ...<span class="entity"><span>&amp;</span>quot;</span>
<span id="line2621"></span> $pk_arr = array();
<span id="line2622"></span> for ($col = $pkFirstCol; array_key_exists($col, $row); $col = $col + 2) {
<span id="line2623"></span> // in $col we have the type and in $col-1 the value
<span id="line2624"></span> if ($row[$col] == 'integer' || $row[$col] == 'real')
<span id="line2625"></span> // json encode as int or float, not string
<span id="line2626"></span> $pk_arr[] = $row[$col - 1] + 0;
<span id="line2627"></span> else
<span id="line2628"></span> // encode as json string
<span id="line2629"></span> $pk_arr[] = $row[$col - 1];
<span id="line2630"></span> }
<span id="line2631"></span> $pk = json_encode($pk_arr);
<span id="line2632"></span> $tdWithClass = <span class="entity"><span>&amp;</span>quot;</span><span class="entity"><span>&amp;</span>lt;</span>td class='td<span class="entity"><span>&amp;</span>quot;</span> . ($i % 2 ? <span class="entity"><span>&amp;</span>quot;</span>1<span class="entity"><span>&amp;</span>quot;</span> : <span class="entity"><span>&amp;</span>quot;</span>2<span class="entity"><span>&amp;</span>quot;</span>) . <span class="entity"><span>&amp;</span>quot;</span>'<span class="entity"><span>&amp;</span>gt;</span><span class="entity"><span>&amp;</span>quot;</span>;
<span id="line2633"></span> $tdWithClassLeft = <span class="entity"><span>&amp;</span>quot;</span><span class="entity"><span>&amp;</span>lt;</span>td class='td<span class="entity"><span>&amp;</span>quot;</span> . ($i % 2 ? <span class="entity"><span>&amp;</span>quot;</span>1<span class="entity"><span>&amp;</span>quot;</span> : <span class="entity"><span>&amp;</span>quot;</span>2<span class="entity"><span>&amp;</span>quot;</span>) . <span class="entity"><span>&amp;</span>quot;</span>' style='text-align:left;'<span class="entity"><span>&amp;</span>gt;</span><span class="entity"><span>&amp;</span>quot;</span>;
<span id="line2634"></span> echo <span class="entity"><span>&amp;</span>quot;</span><span class="entity"><span>&amp;</span>lt;</span>tr<span class="entity"><span>&amp;</span>gt;</span><span class="entity"><span>&amp;</span>quot;</span>;
<span id="line2635"></span> if ($target_table_type == 'table' <span class="entity"><span>&amp;</span>amp;</span><span class="entity"><span>&amp;</span>amp;</span> $db-<span class="entity"><span>&amp;</span>gt;</span>isWritable() <span class="entity"><span>&amp;</span>amp;</span><span class="entity"><span>&amp;</span>amp;</span> $db-<span class="entity"><span>&amp;</span>gt;</span>isDirWritable()) {
<span id="line2636"></span> echo $tdWithClass;
<span id="line2637"></span> echo <span class="entity"><span>&amp;</span>quot;</span><span class="entity"><span>&amp;</span>lt;</span>input type='checkbox' name='check[]' value='<span class="entity"><span>&amp;</span>quot;</span> . htmlencode($pk) . <span class="entity"><span>&amp;</span>quot;</span>' id='check_<span class="entity"><span>&amp;</span>quot;</span> . htmlencode($i) . <span class="entity"><span>&amp;</span>quot;</span>'/<span class="entity"><span>&amp;</span>gt;</span><span class="entity"><span>&amp;</span>quot;</span>;
<span id="line2638"></span> echo <span class="entity"><span>&amp;</span>quot;</span><span class="entity"><span>&amp;</span>lt;</span>/td<span class="entity"><span>&amp;</span>gt;</span><span class="entity"><span>&amp;</span>quot;</span>;
<span id="line2639"></span> echo $tdWithClass;
<span id="line2640"></span> // -g-<span class="entity"><span>&amp;</span>gt;</span> Here, we need to put the PK in as the link for both the edit and delete.
<span id="line2641"></span> echo $params-<span class="entity"><span>&amp;</span>gt;</span>getLink(array('action' =<span class="entity"><span>&amp;</span>gt;</span> 'row_editordelete', 'pk' =<span class="entity"><span>&amp;</span>gt;</span> $pk, 'type' =<span class="entity"><span>&amp;</span>gt;</span> 'edit'), <span class="entity"><span>&amp;</span>quot;</span><span class="entity"><span>&amp;</span>lt;</span>span<span class="entity"><span>&amp;</span>gt;</span><span class="entity"><span>&amp;</span>quot;</span> . $lang['edit'] . <span class="entity"><span>&amp;</span>quot;</span><span class="entity"><span>&amp;</span>lt;</span>/span<span class="entity"><span>&amp;</span>gt;</span><span class="entity"><span>&amp;</span>quot;</span>, 'edit', $lang['edit']);
<span id="line2642"></span> echo <span class="entity"><span>&amp;</span>quot;</span><span class="entity"><span>&amp;</span>lt;</span>/td<span class="entity"><span>&amp;</span>gt;</span><span class="entity"><span>&amp;</span>quot;</span>;
<span id="line2643"></span> echo $tdWithClass;
<span id="line2644"></span> echo $params-<span class="entity"><span>&amp;</span>gt;</span>getLink(array('action' =<span class="entity"><span>&amp;</span>gt;</span> 'row_editordelete', 'pk' =<span class="entity"><span>&amp;</span>gt;</span> $pk, 'type' =<span class="entity"><span>&amp;</span>gt;</span> 'delete'), <span class="entity"><span>&amp;</span>quot;</span><span class="entity"><span>&amp;</span>lt;</span>span<span class="entity"><span>&amp;</span>gt;</span><span class="entity"><span>&amp;</span>quot;</span> . $lang['del'] . <span class="entity"><span>&amp;</span>quot;</span><span class="entity"><span>&amp;</span>lt;</span>/span<span class="entity"><span>&amp;</span>gt;</span><span class="entity"><span>&amp;</span>quot;</span>, 'delete', $lang['del']);
<span id="line2645"></span> echo <span class="entity"><span>&amp;</span>quot;</span><span class="entity"><span>&amp;</span>lt;</span>/td<span class="entity"><span>&amp;</span>gt;</span><span class="entity"><span>&amp;</span>quot;</span>;
<span id="line2646"></span> } else {
<span id="line2647"></span> echo <span class="entity"><span>&amp;</span>quot;</span><span class="entity"><span>&amp;</span>lt;</span>td class='td<span class="entity"><span>&amp;</span>quot;</span> . ($i % 2 ? <span class="entity"><span>&amp;</span>quot;</span>1<span class="entity"><span>&amp;</span>quot;</span> : <span class="entity"><span>&amp;</span>quot;</span>2<span class="entity"><span>&amp;</span>quot;</span>) . <span class="entity"><span>&amp;</span>quot;</span>' colspan='3'<span class="entity"><span>&amp;</span>gt;</span><span class="entity"><span>&amp;</span>lt;</span>/td<span class="entity"><span>&amp;</span>gt;</span><span class="entity"><span>&amp;</span>quot;</span>;
<span id="line2648"></span> }
<span id="line2649"></span> for ($j = 0; $j <span class="entity"><span>&amp;</span>lt;</span> sizeof($tableInfo); $j++) {
<span id="line2650"></span> $typeAffinity = get_type_affinity($tableInfo[$j]['type']);
<span id="line2651"></span> if ($typeAffinity == <span class="entity"><span>&amp;</span>quot;</span>INTEGER<span class="entity"><span>&amp;</span>quot;</span> || $typeAffinity == <span class="entity"><span>&amp;</span>quot;</span>REAL<span class="entity"><span>&amp;</span>quot;</span> || $typeAffinity == <span class="entity"><span>&amp;</span>quot;</span>NUMERIC<span class="entity"><span>&amp;</span>quot;</span>)
<span id="line2652"></span> echo $tdWithClass;
<span id="line2653"></span> else
<span id="line2654"></span> echo $tdWithClassLeft;
<span id="line2655"></span> if ($row[$j] === <span class="entity"><span>&amp;</span>quot;</span><span class="entity"><span>&amp;</span>quot;</span>)
<span id="line2656"></span> echo <span class="entity"><span>&amp;</span>quot;</span><span class="entity"><span>&amp;</span>amp;</span>nbsp;<span class="entity"><span>&amp;</span>quot;</span>;
<span id="line2657"></span> elseif ($row[$j] === NULL)
<span id="line2658"></span> echo <span class="entity"><span>&amp;</span>quot;</span><span class="entity"><span>&amp;</span>lt;</span>i class='null'<span class="entity"><span>&amp;</span>gt;</span>NULL<span class="entity"><span>&amp;</span>lt;</span>/i<span class="entity"><span>&amp;</span>gt;</span><span class="entity"><span>&amp;</span>quot;</span>;
<span id="line2659"></span> elseif (preg_match('/^BLOB/i', $tableInfo[$j]['type'])) {
<span id="line2660"></span> echo <span class="entity"><span>&amp;</span>quot;</span><span class="entity"><span>&amp;</span>lt;</span>div style='float:left; text-align: left; padding-right:2em'<span class="entity"><span>&amp;</span>gt;</span><span class="entity"><span>&amp;</span>quot;</span>;
<span id="line2661"></span> echo $params-<span class="entity"><span>&amp;</span>gt;</span>getLink(array('action' =<span class="entity"><span>&amp;</span>gt;</span> 'row_get_blob', 'confirm' =<span class="entity"><span>&amp;</span>gt;</span> 1, 'pk' =<span class="entity"><span>&amp;</span>gt;</span> $pk, 'column' =<span class="entity"><span>&amp;</span>gt;</span> $tableInfo[$j]['name'], 'download_blob' =<span class="entity"><span>&amp;</span>gt;</span> 1), $lang[<span class="entity"><span>&amp;</span>quot;</span>download<span class="entity"><span>&amp;</span>quot;</span>]) . ' | ';
<span id="line2662"></span> echo $params-<span class="entity"><span>&amp;</span>gt;</span>getLink(array('action' =<span class="entity"><span>&amp;</span>gt;</span> 'row_get_blob', 'confirm' =<span class="entity"><span>&amp;</span>gt;</span> 1, 'pk' =<span class="entity"><span>&amp;</span>gt;</span> $pk, 'column' =<span class="entity"><span>&amp;</span>gt;</span> $tableInfo[$j]['name'], 'download_blob' =<span class="entity"><span>&amp;</span>gt;</span> 0), $lang[<span class="entity"><span>&amp;</span>quot;</span>open_in_browser<span class="entity"><span>&amp;</span>quot;</span>], '', '', '_blank');
<span id="line2663"></span> echo <span class="entity"><span>&amp;</span>quot;</span><span class="entity"><span>&amp;</span>lt;</span>/div<span class="entity"><span>&amp;</span>gt;</span><span class="entity"><span>&amp;</span>lt;</span>div style='float:right; text-align: right'<span class="entity"><span>&amp;</span>gt;</span><span class="entity"><span>&amp;</span>quot;</span>;
<span id="line2664"></span> echo 'Size: ' . number_format(strlen($row[$j])) . ' Bytes';
<span id="line2665"></span> echo <span class="entity"><span>&amp;</span>quot;</span><span class="entity"><span>&amp;</span>lt;</span>/div<span class="entity"><span>&amp;</span>gt;</span><span class="entity"><span>&amp;</span>quot;</span>;
<span id="line2666"></span> } elseif (isset($search))
<span id="line2667"></span> echo markSearchWords(subString($row[$j]), $tableInfo[$j]['name'], $search);
<span id="line2668"></span> else
<span id="line2669"></span> echo htmlencode(subString($row[$j]));
<span id="line2670"></span> echo <span class="entity"><span>&amp;</span>quot;</span><span class="entity"><span>&amp;</span>lt;</span>/td<span class="entity"><span>&amp;</span>gt;</span><span class="entity"><span>&amp;</span>quot;</span>;
<span id="line2671"></span> }
<span id="line2672"></span> echo <span class="entity"><span>&amp;</span>quot;</span><span class="entity"><span>&amp;</span>lt;</span>/tr<span class="entity"><span>&amp;</span>gt;</span><span class="entity"><span>&amp;</span>quot;</span>;
<span id="line2673"></span> }
<span id="line2674"></span> echo <span class="entity"><span>&amp;</span>quot;</span><span class="entity"><span>&amp;</span>lt;</span>/table<span class="entity"><span>&amp;</span>gt;</span><span class="entity"><span>&amp;</span>quot;</span>;
<span id="line2675"></span> if ($target_table_type == 'table' <span class="entity"><span>&amp;</span>amp;</span><span class="entity"><span>&amp;</span>amp;</span> $db-<span class="entity"><span>&amp;</span>gt;</span>isWritable() <span class="entity"><span>&amp;</span>amp;</span><span class="entity"><span>&amp;</span>amp;</span> $db-<span class="entity"><span>&amp;</span>gt;</span>isDirWritable()) {
<span id="line2676"></span> echo <span class="entity"><span>&amp;</span>quot;</span><span class="entity"><span>&amp;</span>lt;</span>a onclick='checkAll()'<span class="entity"><span>&amp;</span>gt;</span><span class="entity"><span>&amp;</span>quot;</span> . $lang['chk_all'] . <span class="entity"><span>&amp;</span>quot;</span><span class="entity"><span>&amp;</span>lt;</span>/a<span class="entity"><span>&amp;</span>gt;</span> / <span class="entity"><span>&amp;</span>lt;</span>a onclick='uncheckAll()'<span class="entity"><span>&amp;</span>gt;</span><span class="entity"><span>&amp;</span>quot;</span> . $lang['unchk_all'] . <span class="entity"><span>&amp;</span>quot;</span><span class="entity"><span>&amp;</span>lt;</span>/a<span class="entity"><span>&amp;</span>gt;</span> <span class="entity"><span>&amp;</span>lt;</span>i<span class="entity"><span>&amp;</span>gt;</span><span class="entity"><span>&amp;</span>quot;</span> . $lang['with_sel'] . <span class="entity"><span>&amp;</span>quot;</span>:<span class="entity"><span>&amp;</span>lt;</span>/i<span class="entity"><span>&amp;</span>gt;</span> <span class="entity"><span>&amp;</span>quot;</span>;
<span id="line2677"></span> echo <span class="entity"><span>&amp;</span>quot;</span><span class="entity"><span>&amp;</span>lt;</span>select name='type'<span class="entity"><span>&amp;</span>gt;</span><span class="entity"><span>&amp;</span>quot;</span>;
<span id="line2678"></span> echo <span class="entity"><span>&amp;</span>quot;</span><span class="entity"><span>&amp;</span>lt;</span>option value='edit'<span class="entity"><span>&amp;</span>gt;</span><span class="entity"><span>&amp;</span>quot;</span> . $lang['edit'] . <span class="entity"><span>&amp;</span>quot;</span><span class="entity"><span>&amp;</span>lt;</span>/option<span class="entity"><span>&amp;</span>gt;</span><span class="entity"><span>&amp;</span>quot;</span>;
<span id="line2679"></span> echo <span class="entity"><span>&amp;</span>quot;</span><span class="entity"><span>&amp;</span>lt;</span>option value='delete'<span class="entity"><span>&amp;</span>gt;</span><span class="entity"><span>&amp;</span>quot;</span> . $lang['del'] . <span class="entity"><span>&amp;</span>quot;</span><span class="entity"><span>&amp;</span>lt;</span>/option<span class="entity"><span>&amp;</span>gt;</span><span class="entity"><span>&amp;</span>quot;</span>;
<span id="line2680"></span> echo <span class="entity"><span>&amp;</span>quot;</span><span class="entity"><span>&amp;</span>lt;</span>/select<span class="entity"><span>&amp;</span>gt;</span> <span class="entity"><span>&amp;</span>quot;</span>;
<span id="line2681"></span> echo <span class="entity"><span>&amp;</span>quot;</span><span class="entity"><span>&amp;</span>lt;</span>input type='submit' value='<span class="entity"><span>&amp;</span>quot;</span> . $lang['go'] . <span class="entity"><span>&amp;</span>quot;</span>' name='massGo' class='btn'/<span class="entity"><span>&amp;</span>gt;</span><span class="entity"><span>&amp;</span>quot;</span>;
<span id="line2682"></span> }
<span id="line2683"></span> echo <span class="entity"><span>&amp;</span>quot;</span><span class="entity"><span>&amp;</span>lt;</span>/form<span class="entity"><span>&amp;</span>gt;</span><span class="entity"><span>&amp;</span>quot;</span>;
<span id="line2684"></span> } else //- Chart view
<span id="line2685"></span> {
<span id="line2686"></span> if (!isset($_SESSION[COOKIENAME . $target_table . 'chartlabels'])) {
<span id="line2687"></span> // No label-column set. Try to pick a text-column as label-column.
<span id="line2688"></span> for ($i = 0; $i <span class="entity"><span>&amp;</span>lt;</span> sizeof($tableInfo); $i++) {
<span id="line2689"></span> if (get_type_affinity($tableInfo[$i]['type']) == 'TEXT') {
<span id="line2690"></span> $_SESSION[COOKIENAME . $target_table . 'chartlabels'] = $i;
<span id="line2691"></span> break;
<span id="line2692"></span> }
<span id="line2693"></span> }
<span id="line2694"></span> }
<span id="line2695"></span> if (!isset($_SESSION[COOKIENAME . $target_table . 'chartlabels']))
<span id="line2696"></span> // no text column found, use the first column
<span id="line2697"></span> $_SESSION[COOKIENAME . $target_table . 'chartlabels'] = 0;
<span id="line2698"></span>
<span id="line2699"></span> if (!isset($_SESSION[COOKIENAME . $target_table . 'chartvalues'])) {
<span id="line2700"></span> // No value-column set. Pick the first numeric column if possible.
<span id="line2701"></span> // If not possible, pick the first column that is not the label-column.
<span id="line2702"></span>
<span id="line2703"></span> $potential_value_column = null;
<span id="line2704"></span> for ($i = 0; $i <span class="entity"><span>&amp;</span>lt;</span> sizeof($tableInfo); $i++) {
<span id="line2705"></span> if ($potential_value_column === null <span class="entity"><span>&amp;</span>amp;</span><span class="entity"><span>&amp;</span>amp;</span> $i != $_SESSION[COOKIENAME . $target_table . 'chartlabels'])
<span id="line2706"></span> // the first column (of any type) that is not the label-column
<span id="line2707"></span> $potential_value_column = $i;
<span id="line2708"></span> // check if the col is numeric
<span id="line2709"></span> $typeAffinity = get_type_affinity($tableInfo[$i]['type']);
<span id="line2710"></span> if ($typeAffinity == 'INTEGER' || $typeAffinity == 'REAL' || $typeAffinity == 'NUMERIC') {
<span id="line2711"></span> // this is defined as a numeric column, so prefer this as a value column over $potential_value_column
<span id="line2712"></span> $_SESSION[COOKIENAME . $target_table . 'chartvalues'] = $i;
<span id="line2713"></span> break;
<span id="line2714"></span> }
<span id="line2715"></span> }
<span id="line2716"></span> if (!isset($_SESSION[COOKIENAME . $target_table . 'chartvalues'])) {
<span id="line2717"></span> // we did not find a numeric column
<span id="line2718"></span> if ($potential_value_column !== null)
<span id="line2719"></span> // use the $potential_value_column, i.e. the second column which is not the label-column
<span id="line2720"></span> $_SESSION[COOKIENAME . $target_table . 'chartvalues'] = $potential_value_column;
<span id="line2721"></span> else
<span id="line2722"></span> // it's hopeless, there is only 1 column
<span id="line2723"></span> $_SESSION[COOKIENAME . $target_table . 'chartvalues'] = 0;
<span id="line2724"></span> }
<span id="line2725"></span> }
<span id="line2726"></span>
<span id="line2727"></span> if (!isset($_SESSION[COOKIENAME . 'charttype']))
<span id="line2728"></span> $_SESSION[COOKIENAME . 'charttype'] = 'bar';
<span id="line2729"></span>
<span id="line2730"></span> if (isset($_POST['chartsettings'])) {
<span id="line2731"></span> $_SESSION[COOKIENAME . 'charttype'] = $_POST['charttype'];
<span id="line2732"></span> $_SESSION[COOKIENAME . $target_table . 'chartlabels'] = $_POST['chartlabels'];
<span id="line2733"></span> $_SESSION[COOKIENAME . $target_table . 'chartvalues'] = $_POST['chartvalues'];
<span id="line2734"></span> }
<span id="line2735"></span> //- Chart javascript code
<span id="line2736"></span> ?<span class="entity"><span>&amp;</span>gt;</span>
<span id="line2737"></span> <span class="entity"><span>&amp;</span>lt;</span>script type='text/javascript' src='https://www.google.com/jsapi'<span class="entity"><span>&amp;</span>gt;</span><span class="entity"><span>&amp;</span>lt;</span>/script<span class="entity"><span>&amp;</span>gt;</span>
<span id="line2738"></span> <span class="entity"><span>&amp;</span>lt;</span>script type='text/javascript'<span class="entity"><span>&amp;</span>gt;</span>
<span id="line2739"></span> google.load('visualization', '1.0', {'packages': ['corechart']});
<span id="line2740"></span> google.setOnLoadCallback(drawChart);
<span id="line2741"></span>
<span id="line2742"></span> function drawChart() {
<span id="line2743"></span> var data = new google.visualization.DataTable();
<span id="line2744"></span> data.addColumn('string', '<span class="entity"><span>&amp;</span>lt;</span>?php echo $tableInfo[$_SESSION[COOKIENAME . $target_table . 'chartlabels']]['name']; ?<span class="entity"><span>&amp;</span>gt;</span>');
<span id="line2745"></span> data.addColumn('number', '<span class="entity"><span>&amp;</span>lt;</span>?php echo $tableInfo[$_SESSION[COOKIENAME . $target_table . 'chartvalues']]['name']; ?<span class="entity"><span>&amp;</span>gt;</span>');
<span id="line2746"></span> data.addRows([
<span id="line2747"></span> <span class="entity"><span>&amp;</span>lt;</span>?php
<span id="line2748"></span> for ($i = 0; $row = $db-<span class="entity"><span>&amp;</span>gt;</span>fetch($table_result); $i++) {
<span id="line2749"></span> $label = str_replace(<span class="entity"><span>&amp;</span>quot;</span>'<span class="entity"><span>&amp;</span>quot;</span>, <span class="entity"><span>&amp;</span>quot;</span><span class="entity"><span>&amp;</span>quot;</span>, htmlencode($row[$_SESSION[COOKIENAME . $target_table . 'chartlabels']]));
<span id="line2750"></span> $value = htmlencode($row[$_SESSION[COOKIENAME . $target_table . 'chartvalues']]);
<span id="line2751"></span>
<span id="line2752"></span> if ($value == NULL || $value == <span class="entity"><span>&amp;</span>quot;</span><span class="entity"><span>&amp;</span>quot;</span>)
<span id="line2753"></span> $value = 0;
<span id="line2754"></span>
<span id="line2755"></span> echo <span class="entity"><span>&amp;</span>quot;</span>['<span class="entity"><span>&amp;</span>quot;</span> . $label . <span class="entity"><span>&amp;</span>quot;</span>', <span class="entity"><span>&amp;</span>quot;</span> . $value . <span class="entity"><span>&amp;</span>quot;</span>]<span class="entity"><span>&amp;</span>quot;</span>;
<span id="line2756"></span> if ($i <span class="entity"><span>&amp;</span>lt;</span> $totalRows - 1)
<span id="line2757"></span> echo <span class="entity"><span>&amp;</span>quot;</span>,<span class="entity"><span>&amp;</span>quot;</span>;
<span id="line2758"></span> }
<span id="line2759"></span> $height = ($totalRows + 1) * 30;
<span id="line2760"></span> if ($height <span class="entity"><span>&amp;</span>gt;</span> 1000)
<span id="line2761"></span> $height = 1000;
<span id="line2762"></span> else if ($height <span class="entity"><span>&amp;</span>lt;</span> 300)
<span id="line2763"></span> $height = 300;
<span id="line2764"></span> if ($_SESSION[COOKIENAME . 'charttype'] == <span class="entity"><span>&amp;</span>quot;</span>pie<span class="entity"><span>&amp;</span>quot;</span>)
<span id="line2765"></span> $height = 800;
<span id="line2766"></span> ?<span class="entity"><span>&amp;</span>gt;</span>
<span id="line2767"></span> ]);
<span id="line2768"></span> var chartWidth = document.getElementById(<span class="entity"><span>&amp;</span>quot;</span>main_column<span class="entity"><span>&amp;</span>quot;</span>).offsetWidth - document.getElementById(<span class="entity"><span>&amp;</span>quot;</span>chartsettingsbox<span class="entity"><span>&amp;</span>quot;</span>).offsetWidth - 100;
<span id="line2769"></span> if (chartWidth <span class="entity"><span>&amp;</span>gt;</span> 1000)
<span id="line2770"></span> chartWidth = 1000;
<span id="line2771"></span>
<span id="line2772"></span> var options =
<span id="line2773"></span> {
<span id="line2774"></span> 'width': chartWidth,
<span id="line2775"></span> 'height':<span class="entity"><span>&amp;</span>lt;</span>?php echo $height; ?<span class="entity"><span>&amp;</span>gt;</span>,
<span id="line2776"></span> 'title': '<span class="entity"><span>&amp;</span>lt;</span>?php echo $tableInfo[$_SESSION[COOKIENAME . $target_table . 'chartlabels']]['name'] . <span class="entity"><span>&amp;</span>quot;</span> vs <span class="entity"><span>&amp;</span>quot;</span> . $tableInfo[$_SESSION[COOKIENAME . $target_table . 'chartvalues']]['name']; ?<span class="entity"><span>&amp;</span>gt;</span>'
<span id="line2777"></span> };
<span id="line2778"></span> <span class="entity"><span>&amp;</span>lt;</span>?php
<span id="line2779"></span> if ($_SESSION[COOKIENAME . 'charttype'] == <span class="entity"><span>&amp;</span>quot;</span>bar<span class="entity"><span>&amp;</span>quot;</span>)
<span id="line2780"></span> echo <span class="entity"><span>&amp;</span>quot;</span>var chart = new google.visualization.BarChart(document.getElementById('chart_div'));<span class="entity"><span>&amp;</span>quot;</span>;
<span id="line2781"></span> else if ($_SESSION[COOKIENAME . 'charttype'] == <span class="entity"><span>&amp;</span>quot;</span>pie<span class="entity"><span>&amp;</span>quot;</span>)
<span id="line2782"></span> echo <span class="entity"><span>&amp;</span>quot;</span>var chart = new google.visualization.PieChart(document.getElementById('chart_div'));<span class="entity"><span>&amp;</span>quot;</span>;
<span id="line2783"></span> else
<span id="line2784"></span> echo <span class="entity"><span>&amp;</span>quot;</span>var chart = new google.visualization.LineChart(document.getElementById('chart_div'));<span class="entity"><span>&amp;</span>quot;</span>;
<span id="line2785"></span> ?<span class="entity"><span>&amp;</span>gt;</span>
<span id="line2786"></span> chart.draw(data, options);
<span id="line2787"></span> }
<span id="line2788"></span> <span class="entity"><span>&amp;</span>lt;</span>/script<span class="entity"><span>&amp;</span>gt;</span>
<span id="line2789"></span> <span class="entity"><span>&amp;</span>lt;</span>div id=<span class="entity"><span>&amp;</span>quot;</span>chart_div<span class="entity"><span>&amp;</span>quot;</span> style=<span class="entity"><span>&amp;</span>quot;</span>float:left;<span class="entity"><span>&amp;</span>quot;</span><span class="entity"><span>&amp;</span>gt;</span><span class="entity"><span>&amp;</span>lt;</span>?php echo $lang['no_chart']; ?<span class="entity"><span>&amp;</span>gt;</span><span class="entity"><span>&amp;</span>lt;</span>/div<span class="entity"><span>&amp;</span>gt;</span>
<span id="line2790"></span> <span class="entity"><span>&amp;</span>lt;</span>?php
<span id="line2791"></span> echo <span class="entity"><span>&amp;</span>quot;</span><span class="entity"><span>&amp;</span>lt;</span>fieldset style='float:right; text-align:center;' id='chartsettingsbox'<span class="entity"><span>&amp;</span>gt;</span><span class="entity"><span>&amp;</span>lt;</span>legend<span class="entity"><span>&amp;</span>gt;</span><span class="entity"><span>&amp;</span>lt;</span>b<span class="entity"><span>&amp;</span>gt;</span>Chart Settings<span class="entity"><span>&amp;</span>lt;</span>/b<span class="entity"><span>&amp;</span>gt;</span><span class="entity"><span>&amp;</span>lt;</span>/legend<span class="entity"><span>&amp;</span>gt;</span><span class="entity"><span>&amp;</span>quot;</span>;
<span id="line2792"></span> echo $params-<span class="entity"><span>&amp;</span>gt;</span>getForm(array('action' =<span class="entity"><span>&amp;</span>gt;</span> $_GET['action']));
<span id="line2793"></span> echo $lang['chart_type'] . <span class="entity"><span>&amp;</span>quot;</span>: <span class="entity"><span>&amp;</span>lt;</span>select name='charttype'<span class="entity"><span>&amp;</span>gt;</span><span class="entity"><span>&amp;</span>quot;</span>;
<span id="line2794"></span> echo <span class="entity"><span>&amp;</span>quot;</span><span class="entity"><span>&amp;</span>lt;</span>option value='bar'<span class="entity"><span>&amp;</span>quot;</span>;
<span id="line2795"></span> if ($_SESSION[COOKIENAME . 'charttype'] == <span class="entity"><span>&amp;</span>quot;</span>bar<span class="entity"><span>&amp;</span>quot;</span>)
<span id="line2796"></span> echo <span class="entity"><span>&amp;</span>quot;</span> selected='selected'<span class="entity"><span>&amp;</span>quot;</span>;
<span id="line2797"></span> echo <span class="entity"><span>&amp;</span>quot;</span><span class="entity"><span>&amp;</span>gt;</span><span class="entity"><span>&amp;</span>quot;</span> . $lang['chart_bar'] . <span class="entity"><span>&amp;</span>quot;</span><span class="entity"><span>&amp;</span>lt;</span>/option<span class="entity"><span>&amp;</span>gt;</span><span class="entity"><span>&amp;</span>quot;</span>;
<span id="line2798"></span> echo <span class="entity"><span>&amp;</span>quot;</span><span class="entity"><span>&amp;</span>lt;</span>option value='pie'<span class="entity"><span>&amp;</span>quot;</span>;
<span id="line2799"></span> if ($_SESSION[COOKIENAME . 'charttype'] == <span class="entity"><span>&amp;</span>quot;</span>pie<span class="entity"><span>&amp;</span>quot;</span>)
<span id="line2800"></span> echo <span class="entity"><span>&amp;</span>quot;</span> selected='selected'<span class="entity"><span>&amp;</span>quot;</span>;
<span id="line2801"></span> echo <span class="entity"><span>&amp;</span>quot;</span><span class="entity"><span>&amp;</span>gt;</span><span class="entity"><span>&amp;</span>quot;</span> . $lang['chart_pie'] . <span class="entity"><span>&amp;</span>quot;</span><span class="entity"><span>&amp;</span>lt;</span>/option<span class="entity"><span>&amp;</span>gt;</span><span class="entity"><span>&amp;</span>quot;</span>;
<span id="line2802"></span> echo <span class="entity"><span>&amp;</span>quot;</span><span class="entity"><span>&amp;</span>lt;</span>option value='line'<span class="entity"><span>&amp;</span>quot;</span>;
<span id="line2803"></span> if ($_SESSION[COOKIENAME . 'charttype'] == <span class="entity"><span>&amp;</span>quot;</span>line<span class="entity"><span>&amp;</span>quot;</span>)
<span id="line2804"></span> echo <span class="entity"><span>&amp;</span>quot;</span> selected='selected'<span class="entity"><span>&amp;</span>quot;</span>;
<span id="line2805"></span> echo <span class="entity"><span>&amp;</span>quot;</span><span class="entity"><span>&amp;</span>gt;</span><span class="entity"><span>&amp;</span>quot;</span> . $lang['chart_line'] . <span class="entity"><span>&amp;</span>quot;</span><span class="entity"><span>&amp;</span>lt;</span>/option<span class="entity"><span>&amp;</span>gt;</span><span class="entity"><span>&amp;</span>quot;</span>;
<span id="line2806"></span> echo <span class="entity"><span>&amp;</span>quot;</span><span class="entity"><span>&amp;</span>lt;</span>/select<span class="entity"><span>&amp;</span>gt;</span><span class="entity"><span>&amp;</span>quot;</span>;
<span id="line2807"></span> echo <span class="entity"><span>&amp;</span>quot;</span><span class="entity"><span>&amp;</span>lt;</span>br/<span class="entity"><span>&amp;</span>gt;</span><span class="entity"><span>&amp;</span>lt;</span>br/<span class="entity"><span>&amp;</span>gt;</span><span class="entity"><span>&amp;</span>quot;</span>;
<span id="line2808"></span> echo $lang['lbl'] . <span class="entity"><span>&amp;</span>quot;</span>: <span class="entity"><span>&amp;</span>lt;</span>select name='chartlabels'<span class="entity"><span>&amp;</span>gt;</span><span class="entity"><span>&amp;</span>quot;</span>;
<span id="line2809"></span> for ($i = 0; $i <span class="entity"><span>&amp;</span>lt;</span> sizeof($tableInfo); $i++) {
<span id="line2810"></span> if (isset($_SESSION[COOKIENAME . $target_table . 'chartlabels']) <span class="entity"><span>&amp;</span>amp;</span><span class="entity"><span>&amp;</span>amp;</span> $_SESSION[COOKIENAME . $target_table . 'chartlabels'] == $i)
<span id="line2811"></span> echo <span class="entity"><span>&amp;</span>quot;</span><span class="entity"><span>&amp;</span>lt;</span>option value='<span class="entity"><span>&amp;</span>quot;</span> . $i . <span class="entity"><span>&amp;</span>quot;</span>' selected='selected'<span class="entity"><span>&amp;</span>gt;</span><span class="entity"><span>&amp;</span>quot;</span> . htmlencode($tableInfo[$i]['name']) . <span class="entity"><span>&amp;</span>quot;</span><span class="entity"><span>&amp;</span>lt;</span>/option<span class="entity"><span>&amp;</span>gt;</span><span class="entity"><span>&amp;</span>quot;</span>;
<span id="line2812"></span> else
<span id="line2813"></span> echo <span class="entity"><span>&amp;</span>quot;</span><span class="entity"><span>&amp;</span>lt;</span>option value='<span class="entity"><span>&amp;</span>quot;</span> . $i . <span class="entity"><span>&amp;</span>quot;</span>'<span class="entity"><span>&amp;</span>gt;</span><span class="entity"><span>&amp;</span>quot;</span> . htmlencode($tableInfo[$i]['name']) . <span class="entity"><span>&amp;</span>quot;</span><span class="entity"><span>&amp;</span>lt;</span>/option<span class="entity"><span>&amp;</span>gt;</span><span class="entity"><span>&amp;</span>quot;</span>;
<span id="line2814"></span> }
<span id="line2815"></span> echo <span class="entity"><span>&amp;</span>quot;</span><span class="entity"><span>&amp;</span>lt;</span>/select<span class="entity"><span>&amp;</span>gt;</span><span class="entity"><span>&amp;</span>quot;</span>;
<span id="line2816"></span> echo <span class="entity"><span>&amp;</span>quot;</span><span class="entity"><span>&amp;</span>lt;</span>br/<span class="entity"><span>&amp;</span>gt;</span><span class="entity"><span>&amp;</span>lt;</span>br/<span class="entity"><span>&amp;</span>gt;</span><span class="entity"><span>&amp;</span>quot;</span>;
<span id="line2817"></span> echo $lang['val'] . <span class="entity"><span>&amp;</span>quot;</span>: <span class="entity"><span>&amp;</span>lt;</span>select name='chartvalues'<span class="entity"><span>&amp;</span>gt;</span><span class="entity"><span>&amp;</span>quot;</span>;
<span id="line2818"></span> for ($i = 0; $i <span class="entity"><span>&amp;</span>lt;</span> sizeof($tableInfo); $i++) {
<span id="line2819"></span> if (isset($_SESSION[COOKIENAME . $target_table . 'chartvalues']) <span class="entity"><span>&amp;</span>amp;</span><span class="entity"><span>&amp;</span>amp;</span> $_SESSION[COOKIENAME . $target_table . 'chartvalues'] == $i)
<span id="line2820"></span> echo <span class="entity"><span>&amp;</span>quot;</span><span class="entity"><span>&amp;</span>lt;</span>option value='<span class="entity"><span>&amp;</span>quot;</span> . $i . <span class="entity"><span>&amp;</span>quot;</span>' selected='selected'<span class="entity"><span>&amp;</span>gt;</span><span class="entity"><span>&amp;</span>quot;</span> . htmlencode($tableInfo[$i]['name']) . <span class="entity"><span>&amp;</span>quot;</span><span class="entity"><span>&amp;</span>lt;</span>/option<span class="entity"><span>&amp;</span>gt;</span><span class="entity"><span>&amp;</span>quot;</span>;
<span id="line2821"></span> else
<span id="line2822"></span> echo <span class="entity"><span>&amp;</span>quot;</span><span class="entity"><span>&amp;</span>lt;</span>option value='<span class="entity"><span>&amp;</span>quot;</span> . $i . <span class="entity"><span>&amp;</span>quot;</span>'<span class="entity"><span>&amp;</span>gt;</span><span class="entity"><span>&amp;</span>quot;</span> . htmlencode($tableInfo[$i]['name']) . <span class="entity"><span>&amp;</span>quot;</span><span class="entity"><span>&amp;</span>lt;</span>/option<span class="entity"><span>&amp;</span>gt;</span><span class="entity"><span>&amp;</span>quot;</span>;
<span id="line2823"></span> }
<span id="line2824"></span> echo <span class="entity"><span>&amp;</span>quot;</span><span class="entity"><span>&amp;</span>lt;</span>/select<span class="entity"><span>&amp;</span>gt;</span><span class="entity"><span>&amp;</span>quot;</span>;
<span id="line2825"></span> echo <span class="entity"><span>&amp;</span>quot;</span><span class="entity"><span>&amp;</span>lt;</span>br/<span class="entity"><span>&amp;</span>gt;</span><span class="entity"><span>&amp;</span>lt;</span>br/<span class="entity"><span>&amp;</span>gt;</span><span class="entity"><span>&amp;</span>quot;</span>;
<span id="line2826"></span> echo <span class="entity"><span>&amp;</span>quot;</span><span class="entity"><span>&amp;</span>lt;</span>input type='submit' name='chartsettings' value='<span class="entity"><span>&amp;</span>quot;</span> . $lang['update'] . <span class="entity"><span>&amp;</span>quot;</span>' class='btn'/<span class="entity"><span>&amp;</span>gt;</span><span class="entity"><span>&amp;</span>quot;</span>;
<span id="line2827"></span> echo <span class="entity"><span>&amp;</span>quot;</span><span class="entity"><span>&amp;</span>lt;</span>/form<span class="entity"><span>&amp;</span>gt;</span><span class="entity"><span>&amp;</span>quot;</span>;
<span id="line2828"></span> echo <span class="entity"><span>&amp;</span>quot;</span><span class="entity"><span>&amp;</span>lt;</span>/fieldset<span class="entity"><span>&amp;</span>gt;</span><span class="entity"><span>&amp;</span>quot;</span>;
<span id="line2829"></span> echo <span class="entity"><span>&amp;</span>quot;</span><span class="entity"><span>&amp;</span>lt;</span>div style='clear:both;'<span class="entity"><span>&amp;</span>gt;</span><span class="entity"><span>&amp;</span>lt;</span>/div<span class="entity"><span>&amp;</span>gt;</span><span class="entity"><span>&amp;</span>quot;</span>;
<span id="line2830"></span> //end chart view
<span id="line2831"></span> }
<span id="line2832"></span> } else //no rows - do nothing
<span id="line2833"></span> {
<span id="line2834"></span> echo <span class="entity"><span>&amp;</span>quot;</span><span class="entity"><span>&amp;</span>lt;</span>br/<span class="entity"><span>&amp;</span>gt;</span><span class="entity"><span>&amp;</span>lt;</span>div class='confirm'<span class="entity"><span>&amp;</span>gt;</span><span class="entity"><span>&amp;</span>quot;</span>;
<span id="line2835"></span> if (isset($search) || $totalRows <span class="entity"><span>&amp;</span>gt;</span> 0)
<span id="line2836"></span> echo $lang['no_rows'] . <span class="entity"><span>&amp;</span>quot;</span><span class="entity"><span>&amp;</span>lt;</span>br/<span class="entity"><span>&amp;</span>gt;</span><span class="entity"><span>&amp;</span>lt;</span>br/<span class="entity"><span>&amp;</span>gt;</span><span class="entity"><span>&amp;</span>quot;</span>;
<span id="line2837"></span> elseif ($target_table_type == 'table')
<span id="line2838"></span> echo $lang['empty_tbl'] . <span class="entity"><span>&amp;</span>quot;</span> <span class="entity"><span>&amp;</span>quot;</span> . $params-<span class="entity"><span>&amp;</span>gt;</span>getLink(array('action' =<span class="entity"><span>&amp;</span>gt;</span> 'row_create'), $lang['click']) . <span class="entity"><span>&amp;</span>quot;</span> <span class="entity"><span>&amp;</span>quot;</span> . $lang['insert_rows'] . '<span class="entity"><span>&amp;</span>lt;</span>br/<span class="entity"><span>&amp;</span>gt;</span><span class="entity"><span>&amp;</span>lt;</span>br/<span class="entity"><span>&amp;</span>gt;</span>';
<span id="line2839"></span> echo <span class="entity"><span>&amp;</span>quot;</span><span class="entity"><span>&amp;</span>lt;</span>span style='font-size:11px;'<span class="entity"><span>&amp;</span>gt;</span><span class="entity"><span>&amp;</span>quot;</span> . htmlencode($queryDisp) . <span class="entity"><span>&amp;</span>quot;</span><span class="entity"><span>&amp;</span>lt;</span>/span<span class="entity"><span>&amp;</span>gt;</span><span class="entity"><span>&amp;</span>quot;</span>;
<span id="line2840"></span> echo <span class="entity"><span>&amp;</span>quot;</span><span class="entity"><span>&amp;</span>lt;</span>/div<span class="entity"><span>&amp;</span>gt;</span><span class="entity"><span>&amp;</span>lt;</span>br/<span class="entity"><span>&amp;</span>gt;</span><span class="entity"><span>&amp;</span>quot;</span>;
<span id="line2841"></span> }
<span id="line2842"></span>
<span id="line2843"></span> if (isset($search))
<span id="line2844"></span> echo <span class="entity"><span>&amp;</span>quot;</span><span class="entity"><span>&amp;</span>lt;</span>br/<span class="entity"><span>&amp;</span>gt;</span><span class="entity"><span>&amp;</span>lt;</span>br/<span class="entity"><span>&amp;</span>gt;</span><span class="entity"><span>&amp;</span>quot;</span> . $params-<span class="entity"><span>&amp;</span>gt;</span>getLink(array('action' =<span class="entity"><span>&amp;</span>gt;</span> 'table_search', 'search' =<span class="entity"><span>&amp;</span>gt;</span> null, 'oldSearch' =<span class="entity"><span>&amp;</span>gt;</span> (isset($_GET['search']) ? $_GET['search'] : null)), $lang['srch_again']);
<span id="line2845"></span>
<span id="line2846"></span> break;
<span id="line2847"></span>
<span id="line2848"></span> //- Create new row (=row_create)
<span id="line2849"></span> case <span class="entity"><span>&amp;</span>quot;</span>row_create<span class="entity"><span>&amp;</span>quot;</span>:
<span id="line2850"></span> echo $params-<span class="entity"><span>&amp;</span>gt;</span>getForm(array('action' =<span class="entity"><span>&amp;</span>gt;</span> 'row_create'), 'get');
<span id="line2851"></span> echo $lang['restart_insert'];
<span id="line2852"></span> echo <span class="entity"><span>&amp;</span>quot;</span> <span class="entity"><span>&amp;</span>lt;</span>select name='newRows'<span class="entity"><span>&amp;</span>gt;</span><span class="entity"><span>&amp;</span>quot;</span>;
<span id="line2853"></span> for ($i = 1; $i <span class="entity"><span>&amp;</span>lt;</span>= 40; $i++) {
<span id="line2854"></span> if (isset($_GET['newRows']) <span class="entity"><span>&amp;</span>amp;</span><span class="entity"><span>&amp;</span>amp;</span> $_GET['newRows'] == $i)
<span id="line2855"></span> echo <span class="entity"><span>&amp;</span>quot;</span><span class="entity"><span>&amp;</span>lt;</span>option value='<span class="entity"><span>&amp;</span>quot;</span> . $i . <span class="entity"><span>&amp;</span>quot;</span>' selected='selected'<span class="entity"><span>&amp;</span>gt;</span><span class="entity"><span>&amp;</span>quot;</span> . $i . <span class="entity"><span>&amp;</span>quot;</span><span class="entity"><span>&amp;</span>lt;</span>/option<span class="entity"><span>&amp;</span>gt;</span><span class="entity"><span>&amp;</span>quot;</span>;
<span id="line2856"></span> else
<span id="line2857"></span> echo <span class="entity"><span>&amp;</span>quot;</span><span class="entity"><span>&amp;</span>lt;</span>option value='<span class="entity"><span>&amp;</span>quot;</span> . $i . <span class="entity"><span>&amp;</span>quot;</span>'<span class="entity"><span>&amp;</span>gt;</span><span class="entity"><span>&amp;</span>quot;</span> . $i . <span class="entity"><span>&amp;</span>quot;</span><span class="entity"><span>&amp;</span>lt;</span>/option<span class="entity"><span>&amp;</span>gt;</span><span class="entity"><span>&amp;</span>quot;</span>;
<span id="line2858"></span> }
<span id="line2859"></span> echo <span class="entity"><span>&amp;</span>quot;</span><span class="entity"><span>&amp;</span>lt;</span>/select<span class="entity"><span>&amp;</span>gt;</span> <span class="entity"><span>&amp;</span>quot;</span>;
<span id="line2860"></span> echo $lang['rows'];
<span id="line2861"></span> echo <span class="entity"><span>&amp;</span>quot;</span> <span class="entity"><span>&amp;</span>lt;</span>input type='submit' value='<span class="entity"><span>&amp;</span>quot;</span> . $lang['go'] . <span class="entity"><span>&amp;</span>quot;</span>' class='btn'/<span class="entity"><span>&amp;</span>gt;</span><span class="entity"><span>&amp;</span>quot;</span>;
<span id="line2862"></span> echo <span class="entity"><span>&amp;</span>quot;</span><span class="entity"><span>&amp;</span>lt;</span>/form<span class="entity"><span>&amp;</span>gt;</span><span class="entity"><span>&amp;</span>quot;</span>;
<span id="line2863"></span> echo <span class="entity"><span>&amp;</span>quot;</span><span class="entity"><span>&amp;</span>lt;</span>br/<span class="entity"><span>&amp;</span>gt;</span><span class="entity"><span>&amp;</span>quot;</span>;
<span id="line2864"></span> echo $params-<span class="entity"><span>&amp;</span>gt;</span>getForm(array('action' =<span class="entity"><span>&amp;</span>gt;</span> 'row_create', 'confirm' =<span class="entity"><span>&amp;</span>gt;</span> '1'), 'post', true);
<span id="line2865"></span> $tableInfo = $db-<span class="entity"><span>&amp;</span>gt;</span>getTableInfo($target_table);
<span id="line2866"></span> if (isset($_GET['newRows']))
<span id="line2867"></span> $num = $_GET['newRows'];
<span id="line2868"></span> else
<span id="line2869"></span> $num = 1;
<span id="line2870"></span> echo <span class="entity"><span>&amp;</span>quot;</span><span class="entity"><span>&amp;</span>lt;</span>input type='hidden' name='newRows' value='<span class="entity"><span>&amp;</span>quot;</span> . $num . <span class="entity"><span>&amp;</span>quot;</span>'/<span class="entity"><span>&amp;</span>gt;</span><span class="entity"><span>&amp;</span>quot;</span>;
<span id="line2871"></span> for ($j = 0; $j <span class="entity"><span>&amp;</span>lt;</span> $num; $j++) {
<span id="line2872"></span> if ($j <span class="entity"><span>&amp;</span>gt;</span> 0)
<span id="line2873"></span> echo <span class="entity"><span>&amp;</span>quot;</span><span class="entity"><span>&amp;</span>lt;</span>label<span class="entity"><span>&amp;</span>gt;</span><span class="entity"><span>&amp;</span>lt;</span>input type='checkbox' value='ignore' name='<span class="entity"><span>&amp;</span>quot;</span> . $j . <span class="entity"><span>&amp;</span>quot;</span>:ignore' id='row_<span class="entity"><span>&amp;</span>quot;</span> . $j . <span class="entity"><span>&amp;</span>quot;</span>_ignore' checked='checked'/<span class="entity"><span>&amp;</span>gt;</span> <span class="entity"><span>&amp;</span>quot;</span> . $lang['ignore'] . <span class="entity"><span>&amp;</span>quot;</span><span class="entity"><span>&amp;</span>lt;</span>/label<span class="entity"><span>&amp;</span>gt;</span><span class="entity"><span>&amp;</span>lt;</span>br/<span class="entity"><span>&amp;</span>gt;</span><span class="entity"><span>&amp;</span>quot;</span>;
<span id="line2874"></span> echo <span class="entity"><span>&amp;</span>quot;</span><span class="entity"><span>&amp;</span>lt;</span>table border='0' cellpadding='2' cellspacing='1' class='viewTable'<span class="entity"><span>&amp;</span>gt;</span><span class="entity"><span>&amp;</span>quot;</span>;
<span id="line2875"></span> echo <span class="entity"><span>&amp;</span>quot;</span><span class="entity"><span>&amp;</span>lt;</span>tr<span class="entity"><span>&amp;</span>gt;</span><span class="entity"><span>&amp;</span>quot;</span>;
<span id="line2876"></span> echo <span class="entity"><span>&amp;</span>quot;</span><span class="entity"><span>&amp;</span>lt;</span>td class='tdheader'<span class="entity"><span>&amp;</span>gt;</span><span class="entity"><span>&amp;</span>quot;</span> . $lang['fld'] . <span class="entity"><span>&amp;</span>quot;</span><span class="entity"><span>&amp;</span>lt;</span>/td<span class="entity"><span>&amp;</span>gt;</span><span class="entity"><span>&amp;</span>quot;</span>;
<span id="line2877"></span> echo <span class="entity"><span>&amp;</span>quot;</span><span class="entity"><span>&amp;</span>lt;</span>td class='tdheader'<span class="entity"><span>&amp;</span>gt;</span><span class="entity"><span>&amp;</span>quot;</span> . $lang['type'] . <span class="entity"><span>&amp;</span>quot;</span><span class="entity"><span>&amp;</span>lt;</span>/td<span class="entity"><span>&amp;</span>gt;</span><span class="entity"><span>&amp;</span>quot;</span>;
<span id="line2878"></span> echo <span class="entity"><span>&amp;</span>quot;</span><span class="entity"><span>&amp;</span>lt;</span>td class='tdheader'<span class="entity"><span>&amp;</span>gt;</span><span class="entity"><span>&amp;</span>quot;</span> . $lang['func'] . <span class="entity"><span>&amp;</span>quot;</span><span class="entity"><span>&amp;</span>lt;</span>/td<span class="entity"><span>&amp;</span>gt;</span><span class="entity"><span>&amp;</span>quot;</span>;
<span id="line2879"></span> echo <span class="entity"><span>&amp;</span>quot;</span><span class="entity"><span>&amp;</span>lt;</span>td class='tdheader'<span class="entity"><span>&amp;</span>gt;</span>Null<span class="entity"><span>&amp;</span>lt;</span>/td<span class="entity"><span>&amp;</span>gt;</span><span class="entity"><span>&amp;</span>quot;</span>;
<span id="line2880"></span> echo <span class="entity"><span>&amp;</span>quot;</span><span class="entity"><span>&amp;</span>lt;</span>td class='tdheader'<span class="entity"><span>&amp;</span>gt;</span><span class="entity"><span>&amp;</span>quot;</span> . $lang['val'] . <span class="entity"><span>&amp;</span>quot;</span><span class="entity"><span>&amp;</span>lt;</span>/td<span class="entity"><span>&amp;</span>gt;</span><span class="entity"><span>&amp;</span>quot;</span>;
<span id="line2881"></span> echo <span class="entity"><span>&amp;</span>quot;</span><span class="entity"><span>&amp;</span>lt;</span>/tr<span class="entity"><span>&amp;</span>gt;</span><span class="entity"><span>&amp;</span>quot;</span>;
<span id="line2882"></span>
<span id="line2883"></span> for ($i = 0; $i <span class="entity"><span>&amp;</span>lt;</span> sizeof($tableInfo); $i++) {
<span id="line2884"></span> $field = $tableInfo[$i]['name'];
<span id="line2885"></span> $type = strtoupper($tableInfo[$i]['type']);
<span id="line2886"></span> $typeAffinity = get_type_affinity($type);
<span id="line2887"></span> if ($tableInfo[$i]['dflt_value'] === <span class="entity"><span>&amp;</span>quot;</span>NULL<span class="entity"><span>&amp;</span>quot;</span>)
<span id="line2888"></span> $value = NULL;
<span id="line2889"></span> else
<span id="line2890"></span> $value = htmlencode(trim(trim($tableInfo[$i]['dflt_value']), <span class="entity"><span>&amp;</span>quot;</span>'<span class="entity"><span>&amp;</span>quot;</span>));
<span id="line2891"></span> $tdWithClassLeft = <span class="entity"><span>&amp;</span>quot;</span><span class="entity"><span>&amp;</span>lt;</span>td class='td<span class="entity"><span>&amp;</span>quot;</span> . ($i % 2 ? <span class="entity"><span>&amp;</span>quot;</span>1<span class="entity"><span>&amp;</span>quot;</span> : <span class="entity"><span>&amp;</span>quot;</span>2<span class="entity"><span>&amp;</span>quot;</span>) . <span class="entity"><span>&amp;</span>quot;</span>' style='text-align:left;'<span class="entity"><span>&amp;</span>gt;</span><span class="entity"><span>&amp;</span>quot;</span>;
<span id="line2892"></span> echo <span class="entity"><span>&amp;</span>quot;</span><span class="entity"><span>&amp;</span>lt;</span>tr<span class="entity"><span>&amp;</span>gt;</span><span class="entity"><span>&amp;</span>quot;</span>;
<span id="line2893"></span> echo $tdWithClassLeft;
<span id="line2894"></span> echo htmlencode($field);
<span id="line2895"></span> echo <span class="entity"><span>&amp;</span>quot;</span><span class="entity"><span>&amp;</span>lt;</span>/td<span class="entity"><span>&amp;</span>gt;</span><span class="entity"><span>&amp;</span>quot;</span>;
<span id="line2896"></span> echo $tdWithClassLeft;
<span id="line2897"></span> echo htmlencode($type);
<span id="line2898"></span> echo <span class="entity"><span>&amp;</span>quot;</span><span class="entity"><span>&amp;</span>lt;</span>/td<span class="entity"><span>&amp;</span>gt;</span><span class="entity"><span>&amp;</span>quot;</span>;
<span id="line2899"></span> echo $tdWithClassLeft;
<span id="line2900"></span> echo <span class="entity"><span>&amp;</span>quot;</span><span class="entity"><span>&amp;</span>lt;</span>select name='function_<span class="entity"><span>&amp;</span>quot;</span> . $i . <span class="entity"><span>&amp;</span>quot;</span>[]' onchange='notNull(\<span class="entity"><span>&amp;</span>quot;</span>row_<span class="entity"><span>&amp;</span>quot;</span> . $j . <span class="entity"><span>&amp;</span>quot;</span>_field_<span class="entity"><span>&amp;</span>quot;</span> . $i . <span class="entity"><span>&amp;</span>quot;</span>_null\<span class="entity"><span>&amp;</span>quot;</span>);'<span class="entity"><span>&amp;</span>gt;</span><span class="entity"><span>&amp;</span>quot;</span>;
<span id="line2901"></span> echo <span class="entity"><span>&amp;</span>quot;</span><span class="entity"><span>&amp;</span>lt;</span>option value=''<span class="entity"><span>&amp;</span>gt;</span><span class="entity"><span>&amp;</span>amp;</span>nbsp;<span class="entity"><span>&amp;</span>lt;</span>/option<span class="entity"><span>&amp;</span>gt;</span><span class="entity"><span>&amp;</span>quot;</span>;
<span id="line2902"></span> foreach (array_merge($sqlite_functions, $custom_functions) as $f) {
<span id="line2903"></span> echo <span class="entity"><span>&amp;</span>quot;</span><span class="entity"><span>&amp;</span>lt;</span>option value='<span class="entity"><span>&amp;</span>quot;</span> . htmlencode($f) . <span class="entity"><span>&amp;</span>quot;</span>'<span class="entity"><span>&amp;</span>gt;</span><span class="entity"><span>&amp;</span>quot;</span> . htmlencode($f) . <span class="entity"><span>&amp;</span>quot;</span><span class="entity"><span>&amp;</span>lt;</span>/option<span class="entity"><span>&amp;</span>gt;</span><span class="entity"><span>&amp;</span>quot;</span>;
<span id="line2904"></span> }
<span id="line2905"></span> echo <span class="entity"><span>&amp;</span>quot;</span><span class="entity"><span>&amp;</span>lt;</span>/select<span class="entity"><span>&amp;</span>gt;</span><span class="entity"><span>&amp;</span>quot;</span>;
<span id="line2906"></span> echo <span class="entity"><span>&amp;</span>quot;</span><span class="entity"><span>&amp;</span>lt;</span>/td<span class="entity"><span>&amp;</span>gt;</span><span class="entity"><span>&amp;</span>quot;</span>;
<span id="line2907"></span> echo $tdWithClassLeft;
<span id="line2908"></span> if ($tableInfo[$i]['notnull'] == 0) {
<span id="line2909"></span> if ($value === NULL)
<span id="line2910"></span> echo <span class="entity"><span>&amp;</span>quot;</span><span class="entity"><span>&amp;</span>lt;</span>input type='checkbox' name='<span class="entity"><span>&amp;</span>quot;</span> . $i . <span class="entity"><span>&amp;</span>quot;</span>_null[]' id='row_<span class="entity"><span>&amp;</span>quot;</span> . $j . <span class="entity"><span>&amp;</span>quot;</span>_field_<span class="entity"><span>&amp;</span>quot;</span> . $i . <span class="entity"><span>&amp;</span>quot;</span>_null' checked='checked' onclick='disableText(this, \<span class="entity"><span>&amp;</span>quot;</span>row_<span class="entity"><span>&amp;</span>quot;</span> . $j . <span class="entity"><span>&amp;</span>quot;</span>_field_<span class="entity"><span>&amp;</span>quot;</span> . $i . <span class="entity"><span>&amp;</span>quot;</span>_value\<span class="entity"><span>&amp;</span>quot;</span>);'/<span class="entity"><span>&amp;</span>gt;</span><span class="entity"><span>&amp;</span>quot;</span>;
<span id="line2911"></span> else
<span id="line2912"></span> echo <span class="entity"><span>&amp;</span>quot;</span><span class="entity"><span>&amp;</span>lt;</span>input type='checkbox' name='<span class="entity"><span>&amp;</span>quot;</span> . $i . <span class="entity"><span>&amp;</span>quot;</span>_null[]' id='row_<span class="entity"><span>&amp;</span>quot;</span> . $j . <span class="entity"><span>&amp;</span>quot;</span>_field_<span class="entity"><span>&amp;</span>quot;</span> . $i . <span class="entity"><span>&amp;</span>quot;</span>_null' onclick='disableText(this, \<span class="entity"><span>&amp;</span>quot;</span>row_<span class="entity"><span>&amp;</span>quot;</span> . $j . <span class="entity"><span>&amp;</span>quot;</span>_field_<span class="entity"><span>&amp;</span>quot;</span> . $i . <span class="entity"><span>&amp;</span>quot;</span>_value\<span class="entity"><span>&amp;</span>quot;</span>);'/<span class="entity"><span>&amp;</span>gt;</span><span class="entity"><span>&amp;</span>quot;</span>;
<span id="line2913"></span> }
<span id="line2914"></span> echo <span class="entity"><span>&amp;</span>quot;</span><span class="entity"><span>&amp;</span>lt;</span>/td<span class="entity"><span>&amp;</span>gt;</span><span class="entity"><span>&amp;</span>quot;</span>;
<span id="line2915"></span> echo $tdWithClassLeft;
<span id="line2916"></span>
<span id="line2917"></span> if ($typeAffinity == <span class="entity"><span>&amp;</span>quot;</span>INTEGER<span class="entity"><span>&amp;</span>quot;</span> || $typeAffinity == <span class="entity"><span>&amp;</span>quot;</span>REAL<span class="entity"><span>&amp;</span>quot;</span> || $typeAffinity == <span class="entity"><span>&amp;</span>quot;</span>NUMERIC<span class="entity"><span>&amp;</span>quot;</span>)
<span id="line2918"></span> echo <span class="entity"><span>&amp;</span>quot;</span><span class="entity"><span>&amp;</span>lt;</span>input type='text' id='row_<span class="entity"><span>&amp;</span>quot;</span> . $j . <span class="entity"><span>&amp;</span>quot;</span>_field_<span class="entity"><span>&amp;</span>quot;</span> . $i . <span class="entity"><span>&amp;</span>quot;</span>_value' name='<span class="entity"><span>&amp;</span>quot;</span> . $j . <span class="entity"><span>&amp;</span>quot;</span>:<span class="entity"><span>&amp;</span>quot;</span> . $i . <span class="entity"><span>&amp;</span>quot;</span>' value='<span class="entity"><span>&amp;</span>quot;</span> . $value . <span class="entity"><span>&amp;</span>quot;</span>' onblur='changeIgnore(this, \<span class="entity"><span>&amp;</span>quot;</span>row_<span class="entity"><span>&amp;</span>quot;</span> . $j . <span class="entity"><span>&amp;</span>quot;</span>_ignore\<span class="entity"><span>&amp;</span>quot;</span>);' onclick='notNull(\<span class="entity"><span>&amp;</span>quot;</span>row_<span class="entity"><span>&amp;</span>quot;</span> . $j . <span class="entity"><span>&amp;</span>quot;</span>_field_<span class="entity"><span>&amp;</span>quot;</span> . $i . <span class="entity"><span>&amp;</span>quot;</span>_null\<span class="entity"><span>&amp;</span>quot;</span>);'/<span class="entity"><span>&amp;</span>gt;</span><span class="entity"><span>&amp;</span>quot;</span>;
<span id="line2919"></span> elseif (preg_match('/^BLOB/', $type))
<span id="line2920"></span> echo <span class="entity"><span>&amp;</span>quot;</span><span class="entity"><span>&amp;</span>lt;</span>input type='file' id='row_<span class="entity"><span>&amp;</span>quot;</span> . $j . <span class="entity"><span>&amp;</span>quot;</span>_field_<span class="entity"><span>&amp;</span>quot;</span> . $i . <span class="entity"><span>&amp;</span>quot;</span>_value' name='<span class="entity"><span>&amp;</span>quot;</span> . $j . <span class="entity"><span>&amp;</span>quot;</span>:<span class="entity"><span>&amp;</span>quot;</span> . $i . <span class="entity"><span>&amp;</span>quot;</span>' onblur='changeIgnore(this, \<span class="entity"><span>&amp;</span>quot;</span>row_<span class="entity"><span>&amp;</span>quot;</span> . $j . <span class="entity"><span>&amp;</span>quot;</span>_ignore\<span class="entity"><span>&amp;</span>quot;</span>);' onclick='notNull(\<span class="entity"><span>&amp;</span>quot;</span>row_<span class="entity"><span>&amp;</span>quot;</span> . $j . <span class="entity"><span>&amp;</span>quot;</span>_field_<span class="entity"><span>&amp;</span>quot;</span> . $i . <span class="entity"><span>&amp;</span>quot;</span>_null\<span class="entity"><span>&amp;</span>quot;</span>);'/<span class="entity"><span>&amp;</span>gt;</span><span class="entity"><span>&amp;</span>quot;</span>;
<span id="line2921"></span> else
<span id="line2922"></span> echo <span class="entity"><span>&amp;</span>quot;</span><span class="entity"><span>&amp;</span>lt;</span>textarea id='row_<span class="entity"><span>&amp;</span>quot;</span> . $j . <span class="entity"><span>&amp;</span>quot;</span>_field_<span class="entity"><span>&amp;</span>quot;</span> . $i . <span class="entity"><span>&amp;</span>quot;</span>_value' name='<span class="entity"><span>&amp;</span>quot;</span> . $j . <span class="entity"><span>&amp;</span>quot;</span>:<span class="entity"><span>&amp;</span>quot;</span> . $i . <span class="entity"><span>&amp;</span>quot;</span>' rows='5' cols='60' onclick='notNull(\<span class="entity"><span>&amp;</span>quot;</span>row_<span class="entity"><span>&amp;</span>quot;</span> . $j . <span class="entity"><span>&amp;</span>quot;</span>_field_<span class="entity"><span>&amp;</span>quot;</span> . $i . <span class="entity"><span>&amp;</span>quot;</span>_null\<span class="entity"><span>&amp;</span>quot;</span>);' onblur='changeIgnore(this, \<span class="entity"><span>&amp;</span>quot;</span>row_<span class="entity"><span>&amp;</span>quot;</span> . $j . <span class="entity"><span>&amp;</span>quot;</span>_ignore\<span class="entity"><span>&amp;</span>quot;</span>);'<span class="entity"><span>&amp;</span>gt;</span><span class="entity"><span>&amp;</span>quot;</span> . $value . <span class="entity"><span>&amp;</span>quot;</span><span class="entity"><span>&amp;</span>lt;</span>/textarea<span class="entity"><span>&amp;</span>gt;</span><span class="entity"><span>&amp;</span>quot;</span>;
<span id="line2923"></span> echo <span class="entity"><span>&amp;</span>quot;</span><span class="entity"><span>&amp;</span>lt;</span>/td<span class="entity"><span>&amp;</span>gt;</span><span class="entity"><span>&amp;</span>quot;</span>;
<span id="line2924"></span> echo <span class="entity"><span>&amp;</span>quot;</span><span class="entity"><span>&amp;</span>lt;</span>/tr<span class="entity"><span>&amp;</span>gt;</span><span class="entity"><span>&amp;</span>quot;</span>;
<span id="line2925"></span> }
<span id="line2926"></span> echo <span class="entity"><span>&amp;</span>quot;</span><span class="entity"><span>&amp;</span>lt;</span>tr<span class="entity"><span>&amp;</span>gt;</span><span class="entity"><span>&amp;</span>quot;</span>;
<span id="line2927"></span> echo <span class="entity"><span>&amp;</span>quot;</span><span class="entity"><span>&amp;</span>lt;</span>td class='tdheader' style='text-align:right;' colspan='5'<span class="entity"><span>&amp;</span>gt;</span><span class="entity"><span>&amp;</span>quot;</span>;
<span id="line2928"></span> echo <span class="entity"><span>&amp;</span>quot;</span><span class="entity"><span>&amp;</span>lt;</span>input type='submit' value='<span class="entity"><span>&amp;</span>quot;</span> . $lang['insert'] . <span class="entity"><span>&amp;</span>quot;</span>' class='btn'/<span class="entity"><span>&amp;</span>gt;</span><span class="entity"><span>&amp;</span>quot;</span>;
<span id="line2929"></span> echo <span class="entity"><span>&amp;</span>quot;</span><span class="entity"><span>&amp;</span>lt;</span>/td<span class="entity"><span>&amp;</span>gt;</span><span class="entity"><span>&amp;</span>quot;</span>;
<span id="line2930"></span> echo <span class="entity"><span>&amp;</span>quot;</span><span class="entity"><span>&amp;</span>lt;</span>/tr<span class="entity"><span>&amp;</span>gt;</span><span class="entity"><span>&amp;</span>quot;</span>;
<span id="line2931"></span> echo <span class="entity"><span>&amp;</span>quot;</span><span class="entity"><span>&amp;</span>lt;</span>/table<span class="entity"><span>&amp;</span>gt;</span><span class="entity"><span>&amp;</span>lt;</span>br/<span class="entity"><span>&amp;</span>gt;</span><span class="entity"><span>&amp;</span>quot;</span>;
<span id="line2932"></span> }
<span id="line2933"></span> echo <span class="entity"><span>&amp;</span>quot;</span><span class="entity"><span>&amp;</span>lt;</span>/form<span class="entity"><span>&amp;</span>gt;</span><span class="entity"><span>&amp;</span>quot;</span>;
<span id="line2934"></span> break;
<span id="line2935"></span>
<span id="line2936"></span> //- Edit or delete row (=row_editordelete)
<span id="line2937"></span> case <span class="entity"><span>&amp;</span>quot;</span>row_editordelete<span class="entity"><span>&amp;</span>quot;</span>:
<span id="line2938"></span> if (isset($_POST['check']))
<span id="line2939"></span> $pks = $_POST['check'];
<span id="line2940"></span> else if (isset($_GET['pk']))
<span id="line2941"></span> $pks = array($_GET['pk']);
<span id="line2942"></span> else $pks[0] = <span class="entity"><span>&amp;</span>quot;</span><span class="entity"><span>&amp;</span>quot;</span>;
<span id="line2943"></span> $str = implode(', ', $pks);
<span id="line2944"></span> if ($str == <span class="entity"><span>&amp;</span>quot;</span><span class="entity"><span>&amp;</span>quot;</span>) //nothing was selected so show an error
<span id="line2945"></span> {
<span id="line2946"></span> echo <span class="entity"><span>&amp;</span>quot;</span><span class="entity"><span>&amp;</span>lt;</span>div class='confirm'<span class="entity"><span>&amp;</span>gt;</span><span class="entity"><span>&amp;</span>quot;</span>;
<span id="line2947"></span> echo $lang['err'] . <span class="entity"><span>&amp;</span>quot;</span>: <span class="entity"><span>&amp;</span>quot;</span> . $lang['no_sel'];
<span id="line2948"></span> echo <span class="entity"><span>&amp;</span>quot;</span><span class="entity"><span>&amp;</span>lt;</span>/div<span class="entity"><span>&amp;</span>gt;</span><span class="entity"><span>&amp;</span>quot;</span>;
<span id="line2949"></span> echo <span class="entity"><span>&amp;</span>quot;</span><span class="entity"><span>&amp;</span>lt;</span>br/<span class="entity"><span>&amp;</span>gt;</span><span class="entity"><span>&amp;</span>lt;</span>br/<span class="entity"><span>&amp;</span>gt;</span><span class="entity"><span>&amp;</span>quot;</span> . $params-<span class="entity"><span>&amp;</span>gt;</span>getLink(array('action' =<span class="entity"><span>&amp;</span>gt;</span> 'row_view'), $lang['return']);
<span id="line2950"></span> } else {
<span id="line2951"></span> if ((isset($_POST['type']) <span class="entity"><span>&amp;</span>amp;</span><span class="entity"><span>&amp;</span>amp;</span> $_POST['type'] == <span class="entity"><span>&amp;</span>quot;</span>edit<span class="entity"><span>&amp;</span>quot;</span>) || (isset($_GET['type']) <span class="entity"><span>&amp;</span>amp;</span><span class="entity"><span>&amp;</span>amp;</span> $_GET['type'] == <span class="entity"><span>&amp;</span>quot;</span>edit<span class="entity"><span>&amp;</span>quot;</span>)) //edit
<span id="line2952"></span> {
<span id="line2953"></span> echo $params-<span class="entity"><span>&amp;</span>gt;</span>getForm(array('action' =<span class="entity"><span>&amp;</span>gt;</span> 'row_edit', 'confirm' =<span class="entity"><span>&amp;</span>gt;</span> '1', 'pk' =<span class="entity"><span>&amp;</span>gt;</span> json_encode($pks)), 'post', true);
<span id="line2954"></span> $tableInfo = $db-<span class="entity"><span>&amp;</span>gt;</span>getTableInfo($target_table);
<span id="line2955"></span> $primary_key = $db-<span class="entity"><span>&amp;</span>gt;</span>getPrimaryKey($target_table);
<span id="line2956"></span>
<span id="line2957"></span> for ($j = 0; $j <span class="entity"><span>&amp;</span>lt;</span> sizeof($pks); $j++) {
<span id="line2958"></span> $query = <span class="entity"><span>&amp;</span>quot;</span>SELECT * FROM <span class="entity"><span>&amp;</span>quot;</span> . $db-<span class="entity"><span>&amp;</span>gt;</span>quote_id($target_table) . <span class="entity"><span>&amp;</span>quot;</span> WHERE <span class="entity"><span>&amp;</span>quot;</span> . $db-<span class="entity"><span>&amp;</span>gt;</span>wherePK($target_table, json_decode($pks[$j]));
<span id="line2959"></span> $result1 = $db-<span class="entity"><span>&amp;</span>gt;</span>select($query, 'num');
<span id="line2960"></span>
<span id="line2961"></span> echo <span class="entity"><span>&amp;</span>quot;</span><span class="entity"><span>&amp;</span>lt;</span>table border='0' cellpadding='2' cellspacing='1' class='viewTable'<span class="entity"><span>&amp;</span>gt;</span><span class="entity"><span>&amp;</span>quot;</span>;
<span id="line2962"></span> echo <span class="entity"><span>&amp;</span>quot;</span><span class="entity"><span>&amp;</span>lt;</span>tr<span class="entity"><span>&amp;</span>gt;</span><span class="entity"><span>&amp;</span>quot;</span>;
<span id="line2963"></span> echo <span class="entity"><span>&amp;</span>quot;</span><span class="entity"><span>&amp;</span>lt;</span>td class='tdheader'<span class="entity"><span>&amp;</span>gt;</span><span class="entity"><span>&amp;</span>quot;</span> . $lang['fld'] . <span class="entity"><span>&amp;</span>quot;</span><span class="entity"><span>&amp;</span>lt;</span>/td<span class="entity"><span>&amp;</span>gt;</span><span class="entity"><span>&amp;</span>quot;</span>;
<span id="line2964"></span> echo <span class="entity"><span>&amp;</span>quot;</span><span class="entity"><span>&amp;</span>lt;</span>td class='tdheader'<span class="entity"><span>&amp;</span>gt;</span><span class="entity"><span>&amp;</span>quot;</span> . $lang['type'] . <span class="entity"><span>&amp;</span>quot;</span><span class="entity"><span>&amp;</span>lt;</span>/td<span class="entity"><span>&amp;</span>gt;</span><span class="entity"><span>&amp;</span>quot;</span>;
<span id="line2965"></span> echo <span class="entity"><span>&amp;</span>quot;</span><span class="entity"><span>&amp;</span>lt;</span>td class='tdheader'<span class="entity"><span>&amp;</span>gt;</span><span class="entity"><span>&amp;</span>quot;</span> . $lang['func'] . <span class="entity"><span>&amp;</span>quot;</span><span class="entity"><span>&amp;</span>lt;</span>/td<span class="entity"><span>&amp;</span>gt;</span><span class="entity"><span>&amp;</span>quot;</span>;
<span id="line2966"></span> echo <span class="entity"><span>&amp;</span>quot;</span><span class="entity"><span>&amp;</span>lt;</span>td class='tdheader'<span class="entity"><span>&amp;</span>gt;</span>Null<span class="entity"><span>&amp;</span>lt;</span>/td<span class="entity"><span>&amp;</span>gt;</span><span class="entity"><span>&amp;</span>quot;</span>;
<span id="line2967"></span> echo <span class="entity"><span>&amp;</span>quot;</span><span class="entity"><span>&amp;</span>lt;</span>td class='tdheader'<span class="entity"><span>&amp;</span>gt;</span><span class="entity"><span>&amp;</span>quot;</span> . $lang['val'] . <span class="entity"><span>&amp;</span>quot;</span><span class="entity"><span>&amp;</span>lt;</span>/td<span class="entity"><span>&amp;</span>gt;</span><span class="entity"><span>&amp;</span>quot;</span>;
<span id="line2968"></span> echo <span class="entity"><span>&amp;</span>quot;</span><span class="entity"><span>&amp;</span>lt;</span>/tr<span class="entity"><span>&amp;</span>gt;</span><span class="entity"><span>&amp;</span>quot;</span>;
<span id="line2969"></span>
<span id="line2970"></span> for ($i = 0; $i <span class="entity"><span>&amp;</span>lt;</span> sizeof($tableInfo); $i++) {
<span id="line2971"></span> $field = $tableInfo[$i]['name'];
<span id="line2972"></span> $type = strtoupper($tableInfo[$i]['type']);
<span id="line2973"></span> $typeAffinity = get_type_affinity($type);
<span id="line2974"></span> $value = $result1[$i];
<span id="line2975"></span> $tdWithClassLeft = <span class="entity"><span>&amp;</span>quot;</span><span class="entity"><span>&amp;</span>lt;</span>td class='td<span class="entity"><span>&amp;</span>quot;</span> . ($i % 2 ? <span class="entity"><span>&amp;</span>quot;</span>1<span class="entity"><span>&amp;</span>quot;</span> : <span class="entity"><span>&amp;</span>quot;</span>2<span class="entity"><span>&amp;</span>quot;</span>) . <span class="entity"><span>&amp;</span>quot;</span>' style='text-align:left;'<span class="entity"><span>&amp;</span>gt;</span><span class="entity"><span>&amp;</span>quot;</span>;
<span id="line2976"></span> echo <span class="entity"><span>&amp;</span>quot;</span><span class="entity"><span>&amp;</span>lt;</span>tr<span class="entity"><span>&amp;</span>gt;</span><span class="entity"><span>&amp;</span>quot;</span>;
<span id="line2977"></span> echo $tdWithClassLeft;
<span id="line2978"></span> echo htmlencode($field);
<span id="line2979"></span> echo <span class="entity"><span>&amp;</span>quot;</span><span class="entity"><span>&amp;</span>lt;</span>/td<span class="entity"><span>&amp;</span>gt;</span><span class="entity"><span>&amp;</span>quot;</span>;
<span id="line2980"></span> echo $tdWithClassLeft;
<span id="line2981"></span> echo htmlencode($type);
<span id="line2982"></span> echo <span class="entity"><span>&amp;</span>quot;</span><span class="entity"><span>&amp;</span>lt;</span>/td<span class="entity"><span>&amp;</span>gt;</span><span class="entity"><span>&amp;</span>quot;</span>;
<span id="line2983"></span> echo $tdWithClassLeft;
<span id="line2984"></span> echo <span class="entity"><span>&amp;</span>quot;</span><span class="entity"><span>&amp;</span>lt;</span>select name='function_<span class="entity"><span>&amp;</span>quot;</span> . $i . <span class="entity"><span>&amp;</span>quot;</span>[]' onchange='notNull(\<span class="entity"><span>&amp;</span>quot;</span>row_<span class="entity"><span>&amp;</span>quot;</span> . $j . <span class="entity"><span>&amp;</span>quot;</span>_field_<span class="entity"><span>&amp;</span>quot;</span> . $i . <span class="entity"><span>&amp;</span>quot;</span>_null\<span class="entity"><span>&amp;</span>quot;</span>);'<span class="entity"><span>&amp;</span>gt;</span><span class="entity"><span>&amp;</span>quot;</span>;
<span id="line2985"></span> echo <span class="entity"><span>&amp;</span>quot;</span><span class="entity"><span>&amp;</span>lt;</span>option value=''<span class="entity"><span>&amp;</span>gt;</span><span class="entity"><span>&amp;</span>lt;</span>/option<span class="entity"><span>&amp;</span>gt;</span><span class="entity"><span>&amp;</span>quot;</span>;
<span id="line2986"></span> foreach (array_merge($sqlite_functions, $custom_functions) as $f) {
<span id="line2987"></span> echo <span class="entity"><span>&amp;</span>quot;</span><span class="entity"><span>&amp;</span>lt;</span>option value='<span class="entity"><span>&amp;</span>quot;</span> . htmlencode($f) . <span class="entity"><span>&amp;</span>quot;</span>'<span class="entity"><span>&amp;</span>gt;</span><span class="entity"><span>&amp;</span>quot;</span> . htmlencode($f) . <span class="entity"><span>&amp;</span>quot;</span><span class="entity"><span>&amp;</span>lt;</span>/option<span class="entity"><span>&amp;</span>gt;</span><span class="entity"><span>&amp;</span>quot;</span>;
<span id="line2988"></span> }
<span id="line2989"></span> echo <span class="entity"><span>&amp;</span>quot;</span><span class="entity"><span>&amp;</span>lt;</span>/select<span class="entity"><span>&amp;</span>gt;</span><span class="entity"><span>&amp;</span>quot;</span>;
<span id="line2990"></span> echo <span class="entity"><span>&amp;</span>quot;</span><span class="entity"><span>&amp;</span>lt;</span>/td<span class="entity"><span>&amp;</span>gt;</span><span class="entity"><span>&amp;</span>quot;</span>;
<span id="line2991"></span> echo $tdWithClassLeft;
<span id="line2992"></span> if ($tableInfo[$i]['notnull'] == 0) {
<span id="line2993"></span> if ($value === NULL)
<span id="line2994"></span> echo <span class="entity"><span>&amp;</span>quot;</span><span class="entity"><span>&amp;</span>lt;</span>input type='checkbox' name='<span class="entity"><span>&amp;</span>quot;</span> . $i . <span class="entity"><span>&amp;</span>quot;</span>_null[]' id='row_<span class="entity"><span>&amp;</span>quot;</span> . $j . <span class="entity"><span>&amp;</span>quot;</span>_field_<span class="entity"><span>&amp;</span>quot;</span> . $i . <span class="entity"><span>&amp;</span>quot;</span>_null' checked='checked' onclick='disableText(this, \<span class="entity"><span>&amp;</span>quot;</span>row_<span class="entity"><span>&amp;</span>quot;</span> . $j . <span class="entity"><span>&amp;</span>quot;</span>_field_<span class="entity"><span>&amp;</span>quot;</span> . $i . <span class="entity"><span>&amp;</span>quot;</span>_value\<span class="entity"><span>&amp;</span>quot;</span>);'/<span class="entity"><span>&amp;</span>gt;</span><span class="entity"><span>&amp;</span>quot;</span>;
<span id="line2995"></span> else
<span id="line2996"></span> echo <span class="entity"><span>&amp;</span>quot;</span><span class="entity"><span>&amp;</span>lt;</span>input type='checkbox' name='<span class="entity"><span>&amp;</span>quot;</span> . $i . <span class="entity"><span>&amp;</span>quot;</span>_null[]' id='row_<span class="entity"><span>&amp;</span>quot;</span> . $j . <span class="entity"><span>&amp;</span>quot;</span>_field_<span class="entity"><span>&amp;</span>quot;</span> . $i . <span class="entity"><span>&amp;</span>quot;</span>_null' onclick='disableText(this, \<span class="entity"><span>&amp;</span>quot;</span>row_<span class="entity"><span>&amp;</span>quot;</span> . $j . <span class="entity"><span>&amp;</span>quot;</span>_field_<span class="entity"><span>&amp;</span>quot;</span> . $i . <span class="entity"><span>&amp;</span>quot;</span>_value\<span class="entity"><span>&amp;</span>quot;</span>);'/<span class="entity"><span>&amp;</span>gt;</span><span class="entity"><span>&amp;</span>quot;</span>;
<span id="line2997"></span> }
<span id="line2998"></span> echo <span class="entity"><span>&amp;</span>quot;</span><span class="entity"><span>&amp;</span>lt;</span>/td<span class="entity"><span>&amp;</span>gt;</span><span class="entity"><span>&amp;</span>quot;</span>;
<span id="line2999"></span> echo $tdWithClassLeft;
<span id="line3000"></span> if ($typeAffinity == <span class="entity"><span>&amp;</span>quot;</span>INTEGER<span class="entity"><span>&amp;</span>quot;</span> || $typeAffinity == <span class="entity"><span>&amp;</span>quot;</span>REAL<span class="entity"><span>&amp;</span>quot;</span> || $typeAffinity == <span class="entity"><span>&amp;</span>quot;</span>NUMERIC<span class="entity"><span>&amp;</span>quot;</span>)
<span id="line3001"></span> echo <span class="entity"><span>&amp;</span>quot;</span><span class="entity"><span>&amp;</span>lt;</span>input type='text' id='row_<span class="entity"><span>&amp;</span>quot;</span> . $j . <span class="entity"><span>&amp;</span>quot;</span>_field_<span class="entity"><span>&amp;</span>quot;</span> . $i . <span class="entity"><span>&amp;</span>quot;</span>_value' name='<span class="entity"><span>&amp;</span>quot;</span> . $i . <span class="entity"><span>&amp;</span>quot;</span>[]' value='<span class="entity"><span>&amp;</span>quot;</span> . htmlencode($value) . <span class="entity"><span>&amp;</span>quot;</span>' onblur='changeIgnore(this, \<span class="entity"><span>&amp;</span>quot;</span><span class="entity"><span>&amp;</span>quot;</span> . $j . <span class="entity"><span>&amp;</span>quot;</span>\<span class="entity"><span>&amp;</span>quot;</span>, \<span class="entity"><span>&amp;</span>quot;</span>row_<span class="entity"><span>&amp;</span>quot;</span> . $j . <span class="entity"><span>&amp;</span>quot;</span>_field_<span class="entity"><span>&amp;</span>quot;</span> . $i . <span class="entity"><span>&amp;</span>quot;</span>_null\<span class="entity"><span>&amp;</span>quot;</span>)' /<span class="entity"><span>&amp;</span>gt;</span><span class="entity"><span>&amp;</span>quot;</span>;
<span id="line3002"></span> elseif (preg_match('/^BLOB/', $type)) {
<span id="line3003"></span> if ($value !== NULL) {
<span id="line3004"></span> echo <span class="entity"><span>&amp;</span>quot;</span><span class="entity"><span>&amp;</span>lt;</span>input type='radio' name='row_<span class="entity"><span>&amp;</span>quot;</span> . $j . <span class="entity"><span>&amp;</span>quot;</span>_field_<span class="entity"><span>&amp;</span>quot;</span> . $i . <span class="entity"><span>&amp;</span>quot;</span>_blob_use' value='old' checked='checked'<span class="entity"><span>&amp;</span>gt;</span><span class="entity"><span>&amp;</span>quot;</span>;
<span id="line3005"></span> echo $params-<span class="entity"><span>&amp;</span>gt;</span>getLink(array('action' =<span class="entity"><span>&amp;</span>gt;</span> 'row_get_blob', 'confirm' =<span class="entity"><span>&amp;</span>gt;</span> 1, 'pk' =<span class="entity"><span>&amp;</span>gt;</span> $pks[$j], 'column' =<span class="entity"><span>&amp;</span>gt;</span> $field, 'download_blob' =<span class="entity"><span>&amp;</span>gt;</span> 1), $lang[<span class="entity"><span>&amp;</span>quot;</span>download<span class="entity"><span>&amp;</span>quot;</span>]) . ' | ';
<span id="line3006"></span> echo $params-<span class="entity"><span>&amp;</span>gt;</span>getLink(array('action' =<span class="entity"><span>&amp;</span>gt;</span> 'row_get_blob', 'confirm' =<span class="entity"><span>&amp;</span>gt;</span> 1, 'pk' =<span class="entity"><span>&amp;</span>gt;</span> $pks[$j], 'column' =<span class="entity"><span>&amp;</span>gt;</span> $field, 'download_blob' =<span class="entity"><span>&amp;</span>gt;</span> 0), $lang[<span class="entity"><span>&amp;</span>quot;</span>open_in_browser<span class="entity"><span>&amp;</span>quot;</span>], '', '', '_blank') . '<span class="entity"><span>&amp;</span>lt;</span>br/<span class="entity"><span>&amp;</span>gt;</span>';
<span id="line3007"></span> echo <span class="entity"><span>&amp;</span>quot;</span><span class="entity"><span>&amp;</span>lt;</span>input type='radio' name='row_<span class="entity"><span>&amp;</span>quot;</span> . $j . <span class="entity"><span>&amp;</span>quot;</span>_field_<span class="entity"><span>&amp;</span>quot;</span> . $i . <span class="entity"><span>&amp;</span>quot;</span>_blob_use' value='new' id='row_<span class="entity"><span>&amp;</span>quot;</span> . $j . <span class="entity"><span>&amp;</span>quot;</span>_field_<span class="entity"><span>&amp;</span>quot;</span> . $i . <span class="entity"><span>&amp;</span>quot;</span>_blob_new'<span class="entity"><span>&amp;</span>gt;</span><span class="entity"><span>&amp;</span>quot;</span>;
<span id="line3008"></span> }
<span id="line3009"></span> echo <span class="entity"><span>&amp;</span>quot;</span><span class="entity"><span>&amp;</span>lt;</span>input type='file' id='row_<span class="entity"><span>&amp;</span>quot;</span> . $j . <span class="entity"><span>&amp;</span>quot;</span>_field_<span class="entity"><span>&amp;</span>quot;</span> . $i . <span class="entity"><span>&amp;</span>quot;</span>_value' name='<span class="entity"><span>&amp;</span>quot;</span> . $j . <span class="entity"><span>&amp;</span>quot;</span>:<span class="entity"><span>&amp;</span>quot;</span> . $i . <span class="entity"><span>&amp;</span>quot;</span>'
<span id="line3010"></span> onblur='changeIgnore(this, \<span class="entity"><span>&amp;</span>quot;</span>row_<span class="entity"><span>&amp;</span>quot;</span> . $j . <span class="entity"><span>&amp;</span>quot;</span>_ignore\<span class="entity"><span>&amp;</span>quot;</span>);'
<span id="line3011"></span> onchange='document.getElementById(\<span class="entity"><span>&amp;</span>quot;</span>row_<span class="entity"><span>&amp;</span>quot;</span> . $j . <span class="entity"><span>&amp;</span>quot;</span>_field_<span class="entity"><span>&amp;</span>quot;</span> . $i . <span class="entity"><span>&amp;</span>quot;</span>_blob_new\<span class="entity"><span>&amp;</span>quot;</span>).checked=true;'
<span id="line3012"></span> onclick='notNull(\<span class="entity"><span>&amp;</span>quot;</span>row_<span class="entity"><span>&amp;</span>quot;</span> . $j . <span class="entity"><span>&amp;</span>quot;</span>_field_<span class="entity"><span>&amp;</span>quot;</span> . $i . <span class="entity"><span>&amp;</span>quot;</span>_null\<span class="entity"><span>&amp;</span>quot;</span>);'
<span id="line3013"></span> <span class="entity"><span>&amp;</span>quot;</span> . ($value === NULL ? <span class="entity"><span>&amp;</span>quot;</span> disabled='disabled'<span class="entity"><span>&amp;</span>quot;</span> : <span class="entity"><span>&amp;</span>quot;</span><span class="entity"><span>&amp;</span>quot;</span>) . <span class="entity"><span>&amp;</span>quot;</span>/<span class="entity"><span>&amp;</span>gt;</span><span class="entity"><span>&amp;</span>quot;</span>;
<span id="line3014"></span> } else
<span id="line3015"></span> echo <span class="entity"><span>&amp;</span>quot;</span><span class="entity"><span>&amp;</span>lt;</span>textarea id='row_<span class="entity"><span>&amp;</span>quot;</span> . $j . <span class="entity"><span>&amp;</span>quot;</span>_field_<span class="entity"><span>&amp;</span>quot;</span> . $i . <span class="entity"><span>&amp;</span>quot;</span>_value' name='<span class="entity"><span>&amp;</span>quot;</span> . $i . <span class="entity"><span>&amp;</span>quot;</span>[]' rows='1' cols='60' class='<span class="entity"><span>&amp;</span>quot;</span> . htmlencode($field) . <span class="entity"><span>&amp;</span>quot;</span>_textarea' onblur='changeIgnore(this, \<span class="entity"><span>&amp;</span>quot;</span><span class="entity"><span>&amp;</span>quot;</span> . $j . <span class="entity"><span>&amp;</span>quot;</span>\<span class="entity"><span>&amp;</span>quot;</span>, \<span class="entity"><span>&amp;</span>quot;</span>row_<span class="entity"><span>&amp;</span>quot;</span> . $j . <span class="entity"><span>&amp;</span>quot;</span>_field_<span class="entity"><span>&amp;</span>quot;</span> . $i . <span class="entity"><span>&amp;</span>quot;</span>_null\<span class="entity"><span>&amp;</span>quot;</span>)'<span class="entity"><span>&amp;</span>gt;</span><span class="entity"><span>&amp;</span>quot;</span> . htmlencode($value) . <span class="entity"><span>&amp;</span>quot;</span><span class="entity"><span>&amp;</span>lt;</span>/textarea<span class="entity"><span>&amp;</span>gt;</span><span class="entity"><span>&amp;</span>quot;</span>;
<span id="line3016"></span> echo <span class="entity"><span>&amp;</span>quot;</span><span class="entity"><span>&amp;</span>lt;</span>/td<span class="entity"><span>&amp;</span>gt;</span><span class="entity"><span>&amp;</span>quot;</span>;
<span id="line3017"></span> echo <span class="entity"><span>&amp;</span>quot;</span><span class="entity"><span>&amp;</span>lt;</span>/tr<span class="entity"><span>&amp;</span>gt;</span><span class="entity"><span>&amp;</span>quot;</span>;
<span id="line3018"></span> }
<span id="line3019"></span> echo <span class="entity"><span>&amp;</span>quot;</span><span class="entity"><span>&amp;</span>lt;</span>tr<span class="entity"><span>&amp;</span>gt;</span><span class="entity"><span>&amp;</span>quot;</span>;
<span id="line3020"></span> echo <span class="entity"><span>&amp;</span>quot;</span><span class="entity"><span>&amp;</span>lt;</span>td class='tdheader' style='text-align:right;' colspan='5'<span class="entity"><span>&amp;</span>gt;</span><span class="entity"><span>&amp;</span>quot;</span>;
<span id="line3021"></span> // Note: the 'Save changes' button must be first in the code so it is the one used when submitting the form with the Enter key (issue #215)
<span id="line3022"></span> echo <span class="entity"><span>&amp;</span>quot;</span><span class="entity"><span>&amp;</span>lt;</span>input type='submit' value='<span class="entity"><span>&amp;</span>quot;</span> . $lang['save_ch'] . <span class="entity"><span>&amp;</span>quot;</span>' class='btn'/<span class="entity"><span>&amp;</span>gt;</span> <span class="entity"><span>&amp;</span>quot;</span>;
<span id="line3023"></span> echo <span class="entity"><span>&amp;</span>quot;</span><span class="entity"><span>&amp;</span>lt;</span>input type='submit' name='new_row' value='<span class="entity"><span>&amp;</span>quot;</span> . $lang['new_insert'] . <span class="entity"><span>&amp;</span>quot;</span>' class='btn'/<span class="entity"><span>&amp;</span>gt;</span> <span class="entity"><span>&amp;</span>quot;</span>;
<span id="line3024"></span> echo $params-<span class="entity"><span>&amp;</span>gt;</span>getLink(array('action' =<span class="entity"><span>&amp;</span>gt;</span> 'row_view'), $lang['cancel']);
<span id="line3025"></span> echo <span class="entity"><span>&amp;</span>quot;</span><span class="entity"><span>&amp;</span>lt;</span>/td<span class="entity"><span>&amp;</span>gt;</span><span class="entity"><span>&amp;</span>quot;</span>;
<span id="line3026"></span> echo <span class="entity"><span>&amp;</span>quot;</span><span class="entity"><span>&amp;</span>lt;</span>/tr<span class="entity"><span>&amp;</span>gt;</span><span class="entity"><span>&amp;</span>quot;</span>;
<span id="line3027"></span> echo <span class="entity"><span>&amp;</span>quot;</span><span class="entity"><span>&amp;</span>lt;</span>/table<span class="entity"><span>&amp;</span>gt;</span><span class="entity"><span>&amp;</span>quot;</span>;
<span id="line3028"></span> echo <span class="entity"><span>&amp;</span>quot;</span><span class="entity"><span>&amp;</span>lt;</span>br/<span class="entity"><span>&amp;</span>gt;</span><span class="entity"><span>&amp;</span>quot;</span>;
<span id="line3029"></span> }
<span id="line3030"></span> echo <span class="entity"><span>&amp;</span>quot;</span><span class="entity"><span>&amp;</span>lt;</span>/form<span class="entity"><span>&amp;</span>gt;</span><span class="entity"><span>&amp;</span>quot;</span>;
<span id="line3031"></span> } else //delete
<span id="line3032"></span> {
<span id="line3033"></span> echo $params-<span class="entity"><span>&amp;</span>gt;</span>getForm(array('action' =<span class="entity"><span>&amp;</span>gt;</span> 'row_delete', 'confirm' =<span class="entity"><span>&amp;</span>gt;</span> '1', 'pk' =<span class="entity"><span>&amp;</span>gt;</span> json_encode($pks)));
<span id="line3034"></span> echo <span class="entity"><span>&amp;</span>quot;</span><span class="entity"><span>&amp;</span>lt;</span>div class='confirm'<span class="entity"><span>&amp;</span>gt;</span><span class="entity"><span>&amp;</span>quot;</span>;
<span id="line3035"></span> printf($lang['ques_del_rows'], htmlencode($str), htmlencode($target_table));
<span id="line3036"></span> echo <span class="entity"><span>&amp;</span>quot;</span><span class="entity"><span>&amp;</span>lt;</span>br/<span class="entity"><span>&amp;</span>gt;</span><span class="entity"><span>&amp;</span>lt;</span>br/<span class="entity"><span>&amp;</span>gt;</span><span class="entity"><span>&amp;</span>quot;</span>;
<span id="line3037"></span> echo <span class="entity"><span>&amp;</span>quot;</span><span class="entity"><span>&amp;</span>lt;</span>input type='submit' value='<span class="entity"><span>&amp;</span>quot;</span> . $lang['confirm'] . <span class="entity"><span>&amp;</span>quot;</span>' class='btn'/<span class="entity"><span>&amp;</span>gt;</span> <span class="entity"><span>&amp;</span>quot;</span>;
<span id="line3038"></span> echo $params-<span class="entity"><span>&amp;</span>gt;</span>getLink(array('action' =<span class="entity"><span>&amp;</span>gt;</span> 'row_view'), $lang['cancel']);
<span id="line3039"></span> echo <span class="entity"><span>&amp;</span>quot;</span><span class="entity"><span>&amp;</span>lt;</span>/div<span class="entity"><span>&amp;</span>gt;</span><span class="entity"><span>&amp;</span>quot;</span>;
<span id="line3040"></span> }
<span id="line3041"></span> }
<span id="line3042"></span> break;
<span id="line3043"></span>
<span id="line3044"></span> //- Column actions
<span id="line3045"></span>
<span id="line3046"></span> //- View table structure (=column_view)
<span id="line3047"></span> case <span class="entity"><span>&amp;</span>quot;</span>column_view<span class="entity"><span>&amp;</span>quot;</span>:
<span id="line3048"></span> $tableInfo = $db-<span class="entity"><span>&amp;</span>gt;</span>getTableInfo($target_table);
<span id="line3049"></span>
<span id="line3050"></span> echo $params-<span class="entity"><span>&amp;</span>gt;</span>getForm(array('action' =<span class="entity"><span>&amp;</span>gt;</span> 'column_confirm'), 'get', false, 'checkForm');
<span id="line3051"></span> echo <span class="entity"><span>&amp;</span>quot;</span><span class="entity"><span>&amp;</span>lt;</span>table border='0' cellpadding='2' cellspacing='1' class='viewTable'<span class="entity"><span>&amp;</span>gt;</span><span class="entity"><span>&amp;</span>quot;</span>;
<span id="line3052"></span> echo <span class="entity"><span>&amp;</span>quot;</span><span class="entity"><span>&amp;</span>lt;</span>tr<span class="entity"><span>&amp;</span>gt;</span><span class="entity"><span>&amp;</span>quot;</span>;
<span id="line3053"></span> if ($target_table_type == 'table' <span class="entity"><span>&amp;</span>amp;</span><span class="entity"><span>&amp;</span>amp;</span> $db-<span class="entity"><span>&amp;</span>gt;</span>isWritable() <span class="entity"><span>&amp;</span>amp;</span><span class="entity"><span>&amp;</span>amp;</span> $db-<span class="entity"><span>&amp;</span>gt;</span>isDirWritable())
<span id="line3054"></span> echo <span class="entity"><span>&amp;</span>quot;</span><span class="entity"><span>&amp;</span>lt;</span>td colspan='3'<span class="entity"><span>&amp;</span>gt;</span><span class="entity"><span>&amp;</span>lt;</span>/td<span class="entity"><span>&amp;</span>gt;</span><span class="entity"><span>&amp;</span>quot;</span>;
<span id="line3055"></span> echo <span class="entity"><span>&amp;</span>quot;</span><span class="entity"><span>&amp;</span>lt;</span>td class='tdheader'<span class="entity"><span>&amp;</span>gt;</span><span class="entity"><span>&amp;</span>quot;</span> . $lang['col'] . <span class="entity"><span>&amp;</span>quot;</span> #<span class="entity"><span>&amp;</span>lt;</span>/td<span class="entity"><span>&amp;</span>gt;</span><span class="entity"><span>&amp;</span>quot;</span>;
<span id="line3056"></span> echo <span class="entity"><span>&amp;</span>quot;</span><span class="entity"><span>&amp;</span>lt;</span>td class='tdheader'<span class="entity"><span>&amp;</span>gt;</span><span class="entity"><span>&amp;</span>quot;</span> . $lang['fld'] . <span class="entity"><span>&amp;</span>quot;</span><span class="entity"><span>&amp;</span>lt;</span>/td<span class="entity"><span>&amp;</span>gt;</span><span class="entity"><span>&amp;</span>quot;</span>;
<span id="line3057"></span> echo <span class="entity"><span>&amp;</span>quot;</span><span class="entity"><span>&amp;</span>lt;</span>td class='tdheader'<span class="entity"><span>&amp;</span>gt;</span><span class="entity"><span>&amp;</span>quot;</span> . $lang['type'] . <span class="entity"><span>&amp;</span>quot;</span><span class="entity"><span>&amp;</span>lt;</span>/td<span class="entity"><span>&amp;</span>gt;</span><span class="entity"><span>&amp;</span>quot;</span>;
<span id="line3058"></span> echo <span class="entity"><span>&amp;</span>quot;</span><span class="entity"><span>&amp;</span>lt;</span>td class='tdheader'<span class="entity"><span>&amp;</span>gt;</span><span class="entity"><span>&amp;</span>quot;</span> . $lang['not_null'] . <span class="entity"><span>&amp;</span>quot;</span><span class="entity"><span>&amp;</span>lt;</span>/td<span class="entity"><span>&amp;</span>gt;</span><span class="entity"><span>&amp;</span>quot;</span>;
<span id="line3059"></span> echo <span class="entity"><span>&amp;</span>quot;</span><span class="entity"><span>&amp;</span>lt;</span>td class='tdheader'<span class="entity"><span>&amp;</span>gt;</span><span class="entity"><span>&amp;</span>quot;</span> . $lang['def_val'] . <span class="entity"><span>&amp;</span>quot;</span><span class="entity"><span>&amp;</span>lt;</span>/td<span class="entity"><span>&amp;</span>gt;</span><span class="entity"><span>&amp;</span>quot;</span>;
<span id="line3060"></span> echo <span class="entity"><span>&amp;</span>quot;</span><span class="entity"><span>&amp;</span>lt;</span>td class='tdheader'<span class="entity"><span>&amp;</span>gt;</span><span class="entity"><span>&amp;</span>quot;</span> . $lang['prim_key'] . <span class="entity"><span>&amp;</span>quot;</span><span class="entity"><span>&amp;</span>lt;</span>/td<span class="entity"><span>&amp;</span>gt;</span><span class="entity"><span>&amp;</span>quot;</span>;
<span id="line3061"></span> echo <span class="entity"><span>&amp;</span>quot;</span><span class="entity"><span>&amp;</span>lt;</span>/tr<span class="entity"><span>&amp;</span>gt;</span><span class="entity"><span>&amp;</span>quot;</span>;
<span id="line3062"></span>
<span id="line3063"></span> $noPrimaryKey = true;
<span id="line3064"></span>
<span id="line3065"></span> for ($i = 0; $i <span class="entity"><span>&amp;</span>lt;</span> sizeof($tableInfo); $i++) {
<span id="line3066"></span> $colVal = $tableInfo[$i][0];
<span id="line3067"></span> $fieldVal = $tableInfo[$i][1];
<span id="line3068"></span> $typeVal = $tableInfo[$i]['type'];
<span id="line3069"></span> $notnullVal = $tableInfo[$i][3];
<span id="line3070"></span> $defaultVal = $tableInfo[$i][4];
<span id="line3071"></span> $primarykeyVal = $tableInfo[$i][5];
<span id="line3072"></span>
<span id="line3073"></span> if (intval($notnullVal) != 0)
<span id="line3074"></span> $notnullVal = $lang['yes'];
<span id="line3075"></span> else
<span id="line3076"></span> $notnullVal = $lang['no'];
<span id="line3077"></span> if (intval($primarykeyVal) != 0) {
<span id="line3078"></span> $primarykeyVal = $lang['yes'];
<span id="line3079"></span> $noPrimaryKey = false;
<span id="line3080"></span> } else
<span id="line3081"></span> $primarykeyVal = $lang['no'];
<span id="line3082"></span>
<span id="line3083"></span> $tdWithClass = <span class="entity"><span>&amp;</span>quot;</span><span class="entity"><span>&amp;</span>lt;</span>td class='td<span class="entity"><span>&amp;</span>quot;</span> . ($i % 2 ? <span class="entity"><span>&amp;</span>quot;</span>1<span class="entity"><span>&amp;</span>quot;</span> : <span class="entity"><span>&amp;</span>quot;</span>2<span class="entity"><span>&amp;</span>quot;</span>) . <span class="entity"><span>&amp;</span>quot;</span>'<span class="entity"><span>&amp;</span>gt;</span><span class="entity"><span>&amp;</span>quot;</span>;
<span id="line3084"></span> $tdWithClassLeft = <span class="entity"><span>&amp;</span>quot;</span><span class="entity"><span>&amp;</span>lt;</span>td class='td<span class="entity"><span>&amp;</span>quot;</span> . ($i % 2 ? <span class="entity"><span>&amp;</span>quot;</span>1<span class="entity"><span>&amp;</span>quot;</span> : <span class="entity"><span>&amp;</span>quot;</span>2<span class="entity"><span>&amp;</span>quot;</span>) . <span class="entity"><span>&amp;</span>quot;</span>' style='text-align:left;'<span class="entity"><span>&amp;</span>gt;</span><span class="entity"><span>&amp;</span>quot;</span>;
<span id="line3085"></span> echo <span class="entity"><span>&amp;</span>quot;</span><span class="entity"><span>&amp;</span>lt;</span>tr<span class="entity"><span>&amp;</span>gt;</span><span class="entity"><span>&amp;</span>quot;</span>;
<span id="line3086"></span> if ($target_table_type == 'table' <span class="entity"><span>&amp;</span>amp;</span><span class="entity"><span>&amp;</span>amp;</span> $db-<span class="entity"><span>&amp;</span>gt;</span>isWritable() <span class="entity"><span>&amp;</span>amp;</span><span class="entity"><span>&amp;</span>amp;</span> $db-<span class="entity"><span>&amp;</span>gt;</span>isDirWritable()) {
<span id="line3087"></span> echo $tdWithClass;
<span id="line3088"></span> echo <span class="entity"><span>&amp;</span>quot;</span><span class="entity"><span>&amp;</span>lt;</span>input type='checkbox' name='check[]' value='<span class="entity"><span>&amp;</span>quot;</span> . htmlencode($fieldVal) . <span class="entity"><span>&amp;</span>quot;</span>' id='check_<span class="entity"><span>&amp;</span>quot;</span> . $i . <span class="entity"><span>&amp;</span>quot;</span>'/<span class="entity"><span>&amp;</span>gt;</span><span class="entity"><span>&amp;</span>quot;</span>;
<span id="line3089"></span> echo <span class="entity"><span>&amp;</span>quot;</span><span class="entity"><span>&amp;</span>lt;</span>/td<span class="entity"><span>&amp;</span>gt;</span><span class="entity"><span>&amp;</span>quot;</span>;
<span id="line3090"></span> echo $tdWithClass;
<span id="line3091"></span> echo $params-<span class="entity"><span>&amp;</span>gt;</span>getLink(array('action' =<span class="entity"><span>&amp;</span>gt;</span> 'column_edit', 'pk' =<span class="entity"><span>&amp;</span>gt;</span> $fieldVal), <span class="entity"><span>&amp;</span>quot;</span><span class="entity"><span>&amp;</span>lt;</span>span<span class="entity"><span>&amp;</span>gt;</span><span class="entity"><span>&amp;</span>quot;</span> . $lang['edit'] . <span class="entity"><span>&amp;</span>quot;</span><span class="entity"><span>&amp;</span>lt;</span>/span<span class="entity"><span>&amp;</span>gt;</span><span class="entity"><span>&amp;</span>quot;</span>, 'edit', $lang['edit']);
<span id="line3092"></span> echo <span class="entity"><span>&amp;</span>quot;</span><span class="entity"><span>&amp;</span>lt;</span>/td<span class="entity"><span>&amp;</span>gt;</span><span class="entity"><span>&amp;</span>quot;</span>;
<span id="line3093"></span> echo $tdWithClass;
<span id="line3094"></span> echo $params-<span class="entity"><span>&amp;</span>gt;</span>getLink(array('action' =<span class="entity"><span>&amp;</span>gt;</span> 'column_confirm', 'action2' =<span class="entity"><span>&amp;</span>gt;</span> 'column_delete', 'pk' =<span class="entity"><span>&amp;</span>gt;</span> $fieldVal), <span class="entity"><span>&amp;</span>quot;</span><span class="entity"><span>&amp;</span>lt;</span>span<span class="entity"><span>&amp;</span>gt;</span><span class="entity"><span>&amp;</span>quot;</span> . $lang['del'] . <span class="entity"><span>&amp;</span>quot;</span><span class="entity"><span>&amp;</span>lt;</span>/span<span class="entity"><span>&amp;</span>gt;</span><span class="entity"><span>&amp;</span>quot;</span>, 'delete', $lang['del']);
<span id="line3095"></span> echo <span class="entity"><span>&amp;</span>quot;</span><span class="entity"><span>&amp;</span>lt;</span>/td<span class="entity"><span>&amp;</span>gt;</span><span class="entity"><span>&amp;</span>quot;</span>;
<span id="line3096"></span> }
<span id="line3097"></span> echo $tdWithClass;
<span id="line3098"></span> echo htmlencode($colVal);
<span id="line3099"></span> echo <span class="entity"><span>&amp;</span>quot;</span><span class="entity"><span>&amp;</span>lt;</span>/td<span class="entity"><span>&amp;</span>gt;</span><span class="entity"><span>&amp;</span>quot;</span>;
<span id="line3100"></span> echo $tdWithClassLeft;
<span id="line3101"></span> echo htmlencode($fieldVal);
<span id="line3102"></span> echo <span class="entity"><span>&amp;</span>quot;</span><span class="entity"><span>&amp;</span>lt;</span>/td<span class="entity"><span>&amp;</span>gt;</span><span class="entity"><span>&amp;</span>quot;</span>;
<span id="line3103"></span> echo $tdWithClassLeft;
<span id="line3104"></span> echo htmlencode($typeVal);
<span id="line3105"></span> echo <span class="entity"><span>&amp;</span>quot;</span><span class="entity"><span>&amp;</span>lt;</span>/td<span class="entity"><span>&amp;</span>gt;</span><span class="entity"><span>&amp;</span>quot;</span>;
<span id="line3106"></span> echo $tdWithClassLeft;
<span id="line3107"></span> echo htmlencode($notnullVal);
<span id="line3108"></span> echo <span class="entity"><span>&amp;</span>quot;</span><span class="entity"><span>&amp;</span>lt;</span>/td<span class="entity"><span>&amp;</span>gt;</span><span class="entity"><span>&amp;</span>quot;</span>;
<span id="line3109"></span> echo $tdWithClassLeft;
<span id="line3110"></span> if ($defaultVal === NULL)
<span id="line3111"></span> echo <span class="entity"><span>&amp;</span>quot;</span><span class="entity"><span>&amp;</span>lt;</span>i class='null'<span class="entity"><span>&amp;</span>gt;</span><span class="entity"><span>&amp;</span>quot;</span> . $lang['none'] . <span class="entity"><span>&amp;</span>quot;</span><span class="entity"><span>&amp;</span>lt;</span>/i<span class="entity"><span>&amp;</span>gt;</span><span class="entity"><span>&amp;</span>quot;</span>;
<span id="line3112"></span> elseif ($defaultVal === <span class="entity"><span>&amp;</span>quot;</span>NULL<span class="entity"><span>&amp;</span>quot;</span>)
<span id="line3113"></span> echo <span class="entity"><span>&amp;</span>quot;</span><span class="entity"><span>&amp;</span>lt;</span>i class='null'<span class="entity"><span>&amp;</span>gt;</span>NULL<span class="entity"><span>&amp;</span>lt;</span>/i<span class="entity"><span>&amp;</span>gt;</span><span class="entity"><span>&amp;</span>quot;</span>;
<span id="line3114"></span> else
<span id="line3115"></span> echo htmlencode($defaultVal);
<span id="line3116"></span> echo <span class="entity"><span>&amp;</span>quot;</span><span class="entity"><span>&amp;</span>lt;</span>/td<span class="entity"><span>&amp;</span>gt;</span><span class="entity"><span>&amp;</span>quot;</span>;
<span id="line3117"></span> echo $tdWithClassLeft;
<span id="line3118"></span> echo htmlencode($primarykeyVal);
<span id="line3119"></span> echo <span class="entity"><span>&amp;</span>quot;</span><span class="entity"><span>&amp;</span>lt;</span>/td<span class="entity"><span>&amp;</span>gt;</span><span class="entity"><span>&amp;</span>quot;</span>;
<span id="line3120"></span> echo <span class="entity"><span>&amp;</span>quot;</span><span class="entity"><span>&amp;</span>lt;</span>/tr<span class="entity"><span>&amp;</span>gt;</span><span class="entity"><span>&amp;</span>quot;</span>;
<span id="line3121"></span> }
<span id="line3122"></span>
<span id="line3123"></span> echo <span class="entity"><span>&amp;</span>quot;</span><span class="entity"><span>&amp;</span>lt;</span>/table<span class="entity"><span>&amp;</span>gt;</span><span class="entity"><span>&amp;</span>quot;</span>;
<span id="line3124"></span> if ($target_table_type == 'table' <span class="entity"><span>&amp;</span>amp;</span><span class="entity"><span>&amp;</span>amp;</span> $db-<span class="entity"><span>&amp;</span>gt;</span>isWritable() <span class="entity"><span>&amp;</span>amp;</span><span class="entity"><span>&amp;</span>amp;</span> $db-<span class="entity"><span>&amp;</span>gt;</span>isDirWritable()) {
<span id="line3125"></span> echo <span class="entity"><span>&amp;</span>quot;</span><span class="entity"><span>&amp;</span>lt;</span>a onclick='checkAll()'<span class="entity"><span>&amp;</span>gt;</span><span class="entity"><span>&amp;</span>quot;</span> . $lang['chk_all'] . <span class="entity"><span>&amp;</span>quot;</span><span class="entity"><span>&amp;</span>lt;</span>/a<span class="entity"><span>&amp;</span>gt;</span> / <span class="entity"><span>&amp;</span>lt;</span>a onclick='uncheckAll()'<span class="entity"><span>&amp;</span>gt;</span><span class="entity"><span>&amp;</span>quot;</span> . $lang['unchk_all'] . <span class="entity"><span>&amp;</span>quot;</span><span class="entity"><span>&amp;</span>lt;</span>/a<span class="entity"><span>&amp;</span>gt;</span> <span class="entity"><span>&amp;</span>lt;</span>i<span class="entity"><span>&amp;</span>gt;</span><span class="entity"><span>&amp;</span>quot;</span> . $lang['with_sel'] . <span class="entity"><span>&amp;</span>quot;</span>:<span class="entity"><span>&amp;</span>lt;</span>/i<span class="entity"><span>&amp;</span>gt;</span> <span class="entity"><span>&amp;</span>quot;</span>;
<span id="line3126"></span> echo <span class="entity"><span>&amp;</span>quot;</span><span class="entity"><span>&amp;</span>lt;</span>select name='action2'<span class="entity"><span>&amp;</span>gt;</span><span class="entity"><span>&amp;</span>quot;</span>;
<span id="line3127"></span> //echo <span class="entity"><span>&amp;</span>quot;</span><span class="entity"><span>&amp;</span>lt;</span>option value='edit'<span class="entity"><span>&amp;</span>gt;</span><span class="entity"><span>&amp;</span>quot;</span>.$lang['edit'].<span class="entity"><span>&amp;</span>quot;</span><span class="entity"><span>&amp;</span>lt;</span>/option<span class="entity"><span>&amp;</span>gt;</span><span class="entity"><span>&amp;</span>quot;</span>;
<span id="line3128"></span> echo <span class="entity"><span>&amp;</span>quot;</span><span class="entity"><span>&amp;</span>lt;</span>option value='column_delete'<span class="entity"><span>&amp;</span>gt;</span><span class="entity"><span>&amp;</span>quot;</span> . $lang['del'] . <span class="entity"><span>&amp;</span>quot;</span><span class="entity"><span>&amp;</span>lt;</span>/option<span class="entity"><span>&amp;</span>gt;</span><span class="entity"><span>&amp;</span>quot;</span>;
<span id="line3129"></span> if ($noPrimaryKey)
<span id="line3130"></span> echo <span class="entity"><span>&amp;</span>quot;</span><span class="entity"><span>&amp;</span>lt;</span>option value='primarykey_add'<span class="entity"><span>&amp;</span>gt;</span><span class="entity"><span>&amp;</span>quot;</span> . $lang['prim_key'] . <span class="entity"><span>&amp;</span>quot;</span><span class="entity"><span>&amp;</span>lt;</span>/option<span class="entity"><span>&amp;</span>gt;</span><span class="entity"><span>&amp;</span>quot;</span>;
<span id="line3131"></span> echo <span class="entity"><span>&amp;</span>quot;</span><span class="entity"><span>&amp;</span>lt;</span>/select<span class="entity"><span>&amp;</span>gt;</span> <span class="entity"><span>&amp;</span>quot;</span>;
<span id="line3132"></span> echo <span class="entity"><span>&amp;</span>quot;</span><span class="entity"><span>&amp;</span>lt;</span>input type='submit' value='<span class="entity"><span>&amp;</span>quot;</span> . $lang['go'] . <span class="entity"><span>&amp;</span>quot;</span>' name='massGo' class='btn'/<span class="entity"><span>&amp;</span>gt;</span><span class="entity"><span>&amp;</span>quot;</span>;
<span id="line3133"></span> }
<span id="line3134"></span> echo <span class="entity"><span>&amp;</span>quot;</span><span class="entity"><span>&amp;</span>lt;</span>/form<span class="entity"><span>&amp;</span>gt;</span><span class="entity"><span>&amp;</span>quot;</span>;
<span id="line3135"></span> if ($target_table_type == 'table' <span class="entity"><span>&amp;</span>amp;</span><span class="entity"><span>&amp;</span>amp;</span> $db-<span class="entity"><span>&amp;</span>gt;</span>isWritable() <span class="entity"><span>&amp;</span>amp;</span><span class="entity"><span>&amp;</span>amp;</span> $db-<span class="entity"><span>&amp;</span>gt;</span>isDirWritable()) {
<span id="line3136"></span> echo <span class="entity"><span>&amp;</span>quot;</span><span class="entity"><span>&amp;</span>lt;</span>br/<span class="entity"><span>&amp;</span>gt;</span><span class="entity"><span>&amp;</span>quot;</span>;
<span id="line3137"></span> echo $params-<span class="entity"><span>&amp;</span>gt;</span>getForm(array('action' =<span class="entity"><span>&amp;</span>gt;</span> 'column_create'), 'get');
<span id="line3138"></span> echo $lang['add'] . <span class="entity"><span>&amp;</span>quot;</span> <span class="entity"><span>&amp;</span>lt;</span>input type='text' name='tablefields' style='width:30px;' value='1'/<span class="entity"><span>&amp;</span>gt;</span> <span class="entity"><span>&amp;</span>quot;</span> . $lang['tbl_end'] . <span class="entity"><span>&amp;</span>quot;</span> <span class="entity"><span>&amp;</span>lt;</span>input type='submit' value='<span class="entity"><span>&amp;</span>quot;</span> . $lang['go'] . <span class="entity"><span>&amp;</span>quot;</span>' name='addfields' class='btn'/<span class="entity"><span>&amp;</span>gt;</span><span class="entity"><span>&amp;</span>quot;</span>;
<span id="line3139"></span> echo <span class="entity"><span>&amp;</span>quot;</span><span class="entity"><span>&amp;</span>lt;</span>/form<span class="entity"><span>&amp;</span>gt;</span><span class="entity"><span>&amp;</span>quot;</span>;
<span id="line3140"></span> }
<span id="line3141"></span>
<span id="line3142"></span> $query = <span class="entity"><span>&amp;</span>quot;</span>SELECT sql FROM sqlite_master WHERE name=<span class="entity"><span>&amp;</span>quot;</span> . $db-<span class="entity"><span>&amp;</span>gt;</span>quote($target_table);
<span id="line3143"></span> $master = $db-<span class="entity"><span>&amp;</span>gt;</span>selectArray($query);
<span id="line3144"></span>
<span id="line3145"></span> echo <span class="entity"><span>&amp;</span>quot;</span><span class="entity"><span>&amp;</span>lt;</span>br/<span class="entity"><span>&amp;</span>gt;</span><span class="entity"><span>&amp;</span>quot;</span>;
<span id="line3146"></span> echo <span class="entity"><span>&amp;</span>quot;</span><span class="entity"><span>&amp;</span>lt;</span>br/<span class="entity"><span>&amp;</span>gt;</span><span class="entity"><span>&amp;</span>quot;</span>;
<span id="line3147"></span> echo <span class="entity"><span>&amp;</span>quot;</span><span class="entity"><span>&amp;</span>lt;</span>div class='confirm'<span class="entity"><span>&amp;</span>gt;</span><span class="entity"><span>&amp;</span>quot;</span>;
<span id="line3148"></span> echo <span class="entity"><span>&amp;</span>quot;</span><span class="entity"><span>&amp;</span>lt;</span>b<span class="entity"><span>&amp;</span>gt;</span><span class="entity"><span>&amp;</span>quot;</span> . $lang['query_used_' . $target_table_type] . <span class="entity"><span>&amp;</span>quot;</span><span class="entity"><span>&amp;</span>lt;</span>/b<span class="entity"><span>&amp;</span>gt;</span><span class="entity"><span>&amp;</span>lt;</span>br/<span class="entity"><span>&amp;</span>gt;</span><span class="entity"><span>&amp;</span>quot;</span>;
<span id="line3149"></span> echo <span class="entity"><span>&amp;</span>quot;</span><span class="entity"><span>&amp;</span>lt;</span>span style='font-size:11px;'<span class="entity"><span>&amp;</span>gt;</span><span class="entity"><span>&amp;</span>quot;</span> . htmlencode($master[0]['sql']) . <span class="entity"><span>&amp;</span>quot;</span><span class="entity"><span>&amp;</span>lt;</span>/span<span class="entity"><span>&amp;</span>gt;</span><span class="entity"><span>&amp;</span>quot;</span>;
<span id="line3150"></span> echo <span class="entity"><span>&amp;</span>quot;</span><span class="entity"><span>&amp;</span>lt;</span>/div<span class="entity"><span>&amp;</span>gt;</span><span class="entity"><span>&amp;</span>quot;</span>;
<span id="line3151"></span> echo <span class="entity"><span>&amp;</span>quot;</span><span class="entity"><span>&amp;</span>lt;</span>br/<span class="entity"><span>&amp;</span>gt;</span><span class="entity"><span>&amp;</span>quot;</span>;
<span id="line3152"></span> if ($target_table_type != 'view') {
<span id="line3153"></span> echo <span class="entity"><span>&amp;</span>quot;</span><span class="entity"><span>&amp;</span>lt;</span>br/<span class="entity"><span>&amp;</span>gt;</span><span class="entity"><span>&amp;</span>lt;</span>hr/<span class="entity"><span>&amp;</span>gt;</span><span class="entity"><span>&amp;</span>lt;</span>br/<span class="entity"><span>&amp;</span>gt;</span><span class="entity"><span>&amp;</span>quot;</span>;
<span id="line3154"></span> $query = <span class="entity"><span>&amp;</span>quot;</span>PRAGMA index_list(<span class="entity"><span>&amp;</span>quot;</span> . $db-<span class="entity"><span>&amp;</span>gt;</span>quote_id($target_table) . <span class="entity"><span>&amp;</span>quot;</span>)<span class="entity"><span>&amp;</span>quot;</span>;
<span id="line3155"></span> $result = $db-<span class="entity"><span>&amp;</span>gt;</span>selectArray($query);
<span id="line3156"></span> if (sizeof($result) <span class="entity"><span>&amp;</span>gt;</span> 0) {
<span id="line3157"></span> echo <span class="entity"><span>&amp;</span>quot;</span><span class="entity"><span>&amp;</span>lt;</span>h2<span class="entity"><span>&amp;</span>gt;</span><span class="entity"><span>&amp;</span>quot;</span> . $lang['indexes'] . <span class="entity"><span>&amp;</span>quot;</span>:<span class="entity"><span>&amp;</span>lt;</span>/h2<span class="entity"><span>&amp;</span>gt;</span><span class="entity"><span>&amp;</span>quot;</span>;
<span id="line3158"></span> echo <span class="entity"><span>&amp;</span>quot;</span><span class="entity"><span>&amp;</span>lt;</span>table border='0' cellpadding='2' cellspacing='1' class='viewTable'<span class="entity"><span>&amp;</span>gt;</span><span class="entity"><span>&amp;</span>quot;</span>;
<span id="line3159"></span> echo <span class="entity"><span>&amp;</span>quot;</span><span class="entity"><span>&amp;</span>lt;</span>tr<span class="entity"><span>&amp;</span>gt;</span><span class="entity"><span>&amp;</span>quot;</span>;
<span id="line3160"></span> echo <span class="entity"><span>&amp;</span>quot;</span><span class="entity"><span>&amp;</span>lt;</span>td colspan='1'<span class="entity"><span>&amp;</span>gt;</span><span class="entity"><span>&amp;</span>quot;</span>;
<span id="line3161"></span> echo <span class="entity"><span>&amp;</span>quot;</span><span class="entity"><span>&amp;</span>lt;</span>/td<span class="entity"><span>&amp;</span>gt;</span><span class="entity"><span>&amp;</span>quot;</span>;
<span id="line3162"></span> echo <span class="entity"><span>&amp;</span>quot;</span><span class="entity"><span>&amp;</span>lt;</span>td class='tdheader'<span class="entity"><span>&amp;</span>gt;</span><span class="entity"><span>&amp;</span>quot;</span> . $lang['name'] . <span class="entity"><span>&amp;</span>quot;</span><span class="entity"><span>&amp;</span>lt;</span>/td<span class="entity"><span>&amp;</span>gt;</span><span class="entity"><span>&amp;</span>quot;</span>;
<span id="line3163"></span> echo <span class="entity"><span>&amp;</span>quot;</span><span class="entity"><span>&amp;</span>lt;</span>td class='tdheader'<span class="entity"><span>&amp;</span>gt;</span><span class="entity"><span>&amp;</span>quot;</span> . $lang['unique'] . <span class="entity"><span>&amp;</span>quot;</span><span class="entity"><span>&amp;</span>lt;</span>/td<span class="entity"><span>&amp;</span>gt;</span><span class="entity"><span>&amp;</span>quot;</span>;
<span id="line3164"></span> echo <span class="entity"><span>&amp;</span>quot;</span><span class="entity"><span>&amp;</span>lt;</span>td class='tdheader'<span class="entity"><span>&amp;</span>gt;</span><span class="entity"><span>&amp;</span>quot;</span> . $lang['seq_no'] . <span class="entity"><span>&amp;</span>quot;</span><span class="entity"><span>&amp;</span>lt;</span>/td<span class="entity"><span>&amp;</span>gt;</span><span class="entity"><span>&amp;</span>quot;</span>;
<span id="line3165"></span> echo <span class="entity"><span>&amp;</span>quot;</span><span class="entity"><span>&amp;</span>lt;</span>td class='tdheader'<span class="entity"><span>&amp;</span>gt;</span><span class="entity"><span>&amp;</span>quot;</span> . $lang['col'] . <span class="entity"><span>&amp;</span>quot;</span> #<span class="entity"><span>&amp;</span>lt;</span>/td<span class="entity"><span>&amp;</span>gt;</span><span class="entity"><span>&amp;</span>quot;</span>;
<span id="line3166"></span> echo <span class="entity"><span>&amp;</span>quot;</span><span class="entity"><span>&amp;</span>lt;</span>td class='tdheader'<span class="entity"><span>&amp;</span>gt;</span><span class="entity"><span>&amp;</span>quot;</span> . $lang['fld'] . <span class="entity"><span>&amp;</span>quot;</span><span class="entity"><span>&amp;</span>lt;</span>/td<span class="entity"><span>&amp;</span>gt;</span><span class="entity"><span>&amp;</span>quot;</span>;
<span id="line3167"></span> echo <span class="entity"><span>&amp;</span>quot;</span><span class="entity"><span>&amp;</span>lt;</span>/tr<span class="entity"><span>&amp;</span>gt;</span><span class="entity"><span>&amp;</span>quot;</span>;
<span id="line3168"></span> for ($i = 0; $i <span class="entity"><span>&amp;</span>lt;</span> sizeof($result); $i++) {
<span id="line3169"></span> if ($result[$i]['unique'] == 0)
<span id="line3170"></span> $unique = $lang['no'];
<span id="line3171"></span> else
<span id="line3172"></span> $unique = $lang['yes'];
<span id="line3173"></span>
<span id="line3174"></span> $query = <span class="entity"><span>&amp;</span>quot;</span>PRAGMA index_info(<span class="entity"><span>&amp;</span>quot;</span> . $db-<span class="entity"><span>&amp;</span>gt;</span>quote_id($result[$i]['name']) . <span class="entity"><span>&amp;</span>quot;</span>)<span class="entity"><span>&amp;</span>quot;</span>;
<span id="line3175"></span> $info = $db-<span class="entity"><span>&amp;</span>gt;</span>selectArray($query);
<span id="line3176"></span> $span = sizeof($info);
<span id="line3177"></span>
<span id="line3178"></span> $tdWithClass = <span class="entity"><span>&amp;</span>quot;</span><span class="entity"><span>&amp;</span>lt;</span>td class='td<span class="entity"><span>&amp;</span>quot;</span> . ($i % 2 ? <span class="entity"><span>&amp;</span>quot;</span>1<span class="entity"><span>&amp;</span>quot;</span> : <span class="entity"><span>&amp;</span>quot;</span>2<span class="entity"><span>&amp;</span>quot;</span>) . <span class="entity"><span>&amp;</span>quot;</span>'<span class="entity"><span>&amp;</span>gt;</span><span class="entity"><span>&amp;</span>quot;</span>;
<span id="line3179"></span> $tdWithClassLeft = <span class="entity"><span>&amp;</span>quot;</span><span class="entity"><span>&amp;</span>lt;</span>td class='td<span class="entity"><span>&amp;</span>quot;</span> . ($i % 2 ? <span class="entity"><span>&amp;</span>quot;</span>1<span class="entity"><span>&amp;</span>quot;</span> : <span class="entity"><span>&amp;</span>quot;</span>2<span class="entity"><span>&amp;</span>quot;</span>) . <span class="entity"><span>&amp;</span>quot;</span>' style='text-align:left;'<span class="entity"><span>&amp;</span>gt;</span><span class="entity"><span>&amp;</span>quot;</span>;
<span id="line3180"></span> $tdWithClassSpan = <span class="entity"><span>&amp;</span>quot;</span><span class="entity"><span>&amp;</span>lt;</span>td class='td<span class="entity"><span>&amp;</span>quot;</span> . ($i % 2 ? <span class="entity"><span>&amp;</span>quot;</span>1<span class="entity"><span>&amp;</span>quot;</span> : <span class="entity"><span>&amp;</span>quot;</span>2<span class="entity"><span>&amp;</span>quot;</span>) . <span class="entity"><span>&amp;</span>quot;</span>' rowspan='<span class="entity"><span>&amp;</span>quot;</span> . $span . <span class="entity"><span>&amp;</span>quot;</span>'<span class="entity"><span>&amp;</span>gt;</span><span class="entity"><span>&amp;</span>quot;</span>;
<span id="line3181"></span> $tdWithClassLeftSpan = <span class="entity"><span>&amp;</span>quot;</span><span class="entity"><span>&amp;</span>lt;</span>td class='td<span class="entity"><span>&amp;</span>quot;</span> . ($i % 2 ? <span class="entity"><span>&amp;</span>quot;</span>1<span class="entity"><span>&amp;</span>quot;</span> : <span class="entity"><span>&amp;</span>quot;</span>2<span class="entity"><span>&amp;</span>quot;</span>) . <span class="entity"><span>&amp;</span>quot;</span>' style='text-align:left;' rowspan='<span class="entity"><span>&amp;</span>quot;</span> . $span . <span class="entity"><span>&amp;</span>quot;</span>'<span class="entity"><span>&amp;</span>gt;</span><span class="entity"><span>&amp;</span>quot;</span>;
<span id="line3182"></span> echo <span class="entity"><span>&amp;</span>quot;</span><span class="entity"><span>&amp;</span>lt;</span>tr<span class="entity"><span>&amp;</span>gt;</span><span class="entity"><span>&amp;</span>quot;</span>;
<span id="line3183"></span> echo $tdWithClassSpan;
<span id="line3184"></span> echo $params-<span class="entity"><span>&amp;</span>gt;</span>getLink(array('action' =<span class="entity"><span>&amp;</span>gt;</span> 'index_delete', 'pk' =<span class="entity"><span>&amp;</span>gt;</span> $result[$i]['name']), <span class="entity"><span>&amp;</span>quot;</span><span class="entity"><span>&amp;</span>lt;</span>span<span class="entity"><span>&amp;</span>gt;</span><span class="entity"><span>&amp;</span>quot;</span> . $lang['del'] . <span class="entity"><span>&amp;</span>quot;</span><span class="entity"><span>&amp;</span>lt;</span>/span<span class="entity"><span>&amp;</span>gt;</span><span class="entity"><span>&amp;</span>quot;</span>, 'delete', $lang['del']);
<span id="line3185"></span> echo <span class="entity"><span>&amp;</span>quot;</span><span class="entity"><span>&amp;</span>lt;</span>/td<span class="entity"><span>&amp;</span>gt;</span><span class="entity"><span>&amp;</span>quot;</span>;
<span id="line3186"></span> echo $tdWithClassLeftSpan;
<span id="line3187"></span> echo $result[$i]['name'];
<span id="line3188"></span> echo <span class="entity"><span>&amp;</span>quot;</span><span class="entity"><span>&amp;</span>lt;</span>/td<span class="entity"><span>&amp;</span>gt;</span><span class="entity"><span>&amp;</span>quot;</span>;
<span id="line3189"></span> echo $tdWithClassLeftSpan;
<span id="line3190"></span> echo $unique;
<span id="line3191"></span> echo <span class="entity"><span>&amp;</span>quot;</span><span class="entity"><span>&amp;</span>lt;</span>/td<span class="entity"><span>&amp;</span>gt;</span><span class="entity"><span>&amp;</span>quot;</span>;
<span id="line3192"></span> for ($j = 0; $j <span class="entity"><span>&amp;</span>lt;</span> $span; $j++) {
<span id="line3193"></span> if ($j != 0)
<span id="line3194"></span> echo <span class="entity"><span>&amp;</span>quot;</span><span class="entity"><span>&amp;</span>lt;</span>tr<span class="entity"><span>&amp;</span>gt;</span><span class="entity"><span>&amp;</span>quot;</span>;
<span id="line3195"></span> echo $tdWithClassLeft;
<span id="line3196"></span> echo htmlencode($info[$j]['seqno']);
<span id="line3197"></span> echo <span class="entity"><span>&amp;</span>quot;</span><span class="entity"><span>&amp;</span>lt;</span>/td<span class="entity"><span>&amp;</span>gt;</span><span class="entity"><span>&amp;</span>quot;</span>;
<span id="line3198"></span> echo $tdWithClassLeft;
<span id="line3199"></span> echo htmlencode($info[$j]['cid']);
<span id="line3200"></span> echo <span class="entity"><span>&amp;</span>quot;</span><span class="entity"><span>&amp;</span>lt;</span>/td<span class="entity"><span>&amp;</span>gt;</span><span class="entity"><span>&amp;</span>quot;</span>;
<span id="line3201"></span> echo $tdWithClassLeft;
<span id="line3202"></span> echo htmlencode($info[$j]['name']);
<span id="line3203"></span> echo <span class="entity"><span>&amp;</span>quot;</span><span class="entity"><span>&amp;</span>lt;</span>/td<span class="entity"><span>&amp;</span>gt;</span><span class="entity"><span>&amp;</span>quot;</span>;
<span id="line3204"></span> echo <span class="entity"><span>&amp;</span>quot;</span><span class="entity"><span>&amp;</span>lt;</span>/tr<span class="entity"><span>&amp;</span>gt;</span><span class="entity"><span>&amp;</span>quot;</span>;
<span id="line3205"></span> }
<span id="line3206"></span> }
<span id="line3207"></span> echo <span class="entity"><span>&amp;</span>quot;</span><span class="entity"><span>&amp;</span>lt;</span>/table<span class="entity"><span>&amp;</span>gt;</span><span class="entity"><span>&amp;</span>lt;</span>br/<span class="entity"><span>&amp;</span>gt;</span><span class="entity"><span>&amp;</span>lt;</span>br/<span class="entity"><span>&amp;</span>gt;</span><span class="entity"><span>&amp;</span>quot;</span>;
<span id="line3208"></span> }
<span id="line3209"></span>
<span id="line3210"></span> $query = <span class="entity"><span>&amp;</span>quot;</span>SELECT * FROM sqlite_master WHERE type='trigger' AND tbl_name=<span class="entity"><span>&amp;</span>quot;</span> . $db-<span class="entity"><span>&amp;</span>gt;</span>quote($target_table) . <span class="entity"><span>&amp;</span>quot;</span> ORDER BY name<span class="entity"><span>&amp;</span>quot;</span>;
<span id="line3211"></span> $result = $db-<span class="entity"><span>&amp;</span>gt;</span>selectArray($query);
<span id="line3212"></span> //print_r($result);
<span id="line3213"></span> if (sizeof($result) <span class="entity"><span>&amp;</span>gt;</span> 0) {
<span id="line3214"></span> echo <span class="entity"><span>&amp;</span>quot;</span><span class="entity"><span>&amp;</span>lt;</span>h2<span class="entity"><span>&amp;</span>gt;</span><span class="entity"><span>&amp;</span>quot;</span> . $lang['triggers'] . <span class="entity"><span>&amp;</span>quot;</span>:<span class="entity"><span>&amp;</span>lt;</span>/h2<span class="entity"><span>&amp;</span>gt;</span><span class="entity"><span>&amp;</span>quot;</span>;
<span id="line3215"></span> echo <span class="entity"><span>&amp;</span>quot;</span><span class="entity"><span>&amp;</span>lt;</span>table border='0' cellpadding='2' cellspacing='1' class='viewTable'<span class="entity"><span>&amp;</span>gt;</span><span class="entity"><span>&amp;</span>quot;</span>;
<span id="line3216"></span> echo <span class="entity"><span>&amp;</span>quot;</span><span class="entity"><span>&amp;</span>lt;</span>tr<span class="entity"><span>&amp;</span>gt;</span><span class="entity"><span>&amp;</span>quot;</span>;
<span id="line3217"></span> echo <span class="entity"><span>&amp;</span>quot;</span><span class="entity"><span>&amp;</span>lt;</span>td colspan='1'<span class="entity"><span>&amp;</span>gt;</span><span class="entity"><span>&amp;</span>quot;</span>;
<span id="line3218"></span> echo <span class="entity"><span>&amp;</span>quot;</span><span class="entity"><span>&amp;</span>lt;</span>/td<span class="entity"><span>&amp;</span>gt;</span><span class="entity"><span>&amp;</span>quot;</span>;
<span id="line3219"></span> echo <span class="entity"><span>&amp;</span>quot;</span><span class="entity"><span>&amp;</span>lt;</span>td class='tdheader'<span class="entity"><span>&amp;</span>gt;</span><span class="entity"><span>&amp;</span>quot;</span> . $lang['name'] . <span class="entity"><span>&amp;</span>quot;</span><span class="entity"><span>&amp;</span>lt;</span>/td<span class="entity"><span>&amp;</span>gt;</span><span class="entity"><span>&amp;</span>quot;</span>;
<span id="line3220"></span> echo <span class="entity"><span>&amp;</span>quot;</span><span class="entity"><span>&amp;</span>lt;</span>td class='tdheader'<span class="entity"><span>&amp;</span>gt;</span><span class="entity"><span>&amp;</span>quot;</span> . $lang['sql'] . <span class="entity"><span>&amp;</span>quot;</span><span class="entity"><span>&amp;</span>lt;</span>/td<span class="entity"><span>&amp;</span>gt;</span><span class="entity"><span>&amp;</span>quot;</span>;
<span id="line3221"></span> echo <span class="entity"><span>&amp;</span>quot;</span><span class="entity"><span>&amp;</span>lt;</span>/tr<span class="entity"><span>&amp;</span>gt;</span><span class="entity"><span>&amp;</span>quot;</span>;
<span id="line3222"></span> for ($i = 0; $i <span class="entity"><span>&amp;</span>lt;</span> sizeof($result); $i++) {
<span id="line3223"></span> $tdWithClass = <span class="entity"><span>&amp;</span>quot;</span><span class="entity"><span>&amp;</span>lt;</span>td class='td<span class="entity"><span>&amp;</span>quot;</span> . ($i % 2 ? <span class="entity"><span>&amp;</span>quot;</span>1<span class="entity"><span>&amp;</span>quot;</span> : <span class="entity"><span>&amp;</span>quot;</span>2<span class="entity"><span>&amp;</span>quot;</span>) . <span class="entity"><span>&amp;</span>quot;</span>'<span class="entity"><span>&amp;</span>gt;</span><span class="entity"><span>&amp;</span>quot;</span>;
<span id="line3224"></span> echo <span class="entity"><span>&amp;</span>quot;</span><span class="entity"><span>&amp;</span>lt;</span>tr<span class="entity"><span>&amp;</span>gt;</span><span class="entity"><span>&amp;</span>quot;</span>;
<span id="line3225"></span> echo $tdWithClass;
<span id="line3226"></span> echo $params-<span class="entity"><span>&amp;</span>gt;</span>getLink(array('action' =<span class="entity"><span>&amp;</span>gt;</span> 'trigger_delete', 'pk' =<span class="entity"><span>&amp;</span>gt;</span> $result[$i]['name']), <span class="entity"><span>&amp;</span>quot;</span><span class="entity"><span>&amp;</span>lt;</span>span<span class="entity"><span>&amp;</span>gt;</span><span class="entity"><span>&amp;</span>quot;</span> . $lang['del'] . <span class="entity"><span>&amp;</span>quot;</span><span class="entity"><span>&amp;</span>lt;</span>/span<span class="entity"><span>&amp;</span>gt;</span><span class="entity"><span>&amp;</span>quot;</span>, 'delete', $lang['del']);
<span id="line3227"></span> echo <span class="entity"><span>&amp;</span>quot;</span><span class="entity"><span>&amp;</span>lt;</span>/td<span class="entity"><span>&amp;</span>gt;</span><span class="entity"><span>&amp;</span>quot;</span>;
<span id="line3228"></span> echo $tdWithClass;
<span id="line3229"></span> echo htmlencode($result[$i]['name']);
<span id="line3230"></span> echo <span class="entity"><span>&amp;</span>quot;</span><span class="entity"><span>&amp;</span>lt;</span>/td<span class="entity"><span>&amp;</span>gt;</span><span class="entity"><span>&amp;</span>quot;</span>;
<span id="line3231"></span> echo $tdWithClass;
<span id="line3232"></span> echo htmlencode($result[$i]['sql']);
<span id="line3233"></span> echo <span class="entity"><span>&amp;</span>quot;</span><span class="entity"><span>&amp;</span>lt;</span>/td<span class="entity"><span>&amp;</span>gt;</span><span class="entity"><span>&amp;</span>quot;</span>;
<span id="line3234"></span> }
<span id="line3235"></span> echo <span class="entity"><span>&amp;</span>quot;</span><span class="entity"><span>&amp;</span>lt;</span>/table<span class="entity"><span>&amp;</span>gt;</span><span class="entity"><span>&amp;</span>lt;</span>br/<span class="entity"><span>&amp;</span>gt;</span><span class="entity"><span>&amp;</span>lt;</span>br/<span class="entity"><span>&amp;</span>gt;</span><span class="entity"><span>&amp;</span>quot;</span>;
<span id="line3236"></span> }
<span id="line3237"></span>
<span id="line3238"></span> if ($db-<span class="entity"><span>&amp;</span>gt;</span>isWritable() <span class="entity"><span>&amp;</span>amp;</span><span class="entity"><span>&amp;</span>amp;</span> $db-<span class="entity"><span>&amp;</span>gt;</span>isDirWritable()) {
<span id="line3239"></span> echo $params-<span class="entity"><span>&amp;</span>gt;</span>getForm(array('action' =<span class="entity"><span>&amp;</span>gt;</span> 'index_create'), 'get');
<span id="line3240"></span> echo <span class="entity"><span>&amp;</span>quot;</span><span class="entity"><span>&amp;</span>lt;</span>br/<span class="entity"><span>&amp;</span>gt;</span><span class="entity"><span>&amp;</span>lt;</span>div class='tdheader'<span class="entity"><span>&amp;</span>gt;</span><span class="entity"><span>&amp;</span>quot;</span>;
<span id="line3241"></span> echo $lang['create_index2'] . <span class="entity"><span>&amp;</span>quot;</span> <span class="entity"><span>&amp;</span>lt;</span>input type='text' name='numcolumns' style='width:30px;' value='1'/<span class="entity"><span>&amp;</span>gt;</span> <span class="entity"><span>&amp;</span>quot;</span> . $lang['cols'] . <span class="entity"><span>&amp;</span>quot;</span> <span class="entity"><span>&amp;</span>lt;</span>input type='submit' value='<span class="entity"><span>&amp;</span>quot;</span> . $lang['go'] . <span class="entity"><span>&amp;</span>quot;</span>' name='addindex' class='btn'/<span class="entity"><span>&amp;</span>gt;</span><span class="entity"><span>&amp;</span>quot;</span>;
<span id="line3242"></span> echo <span class="entity"><span>&amp;</span>quot;</span><span class="entity"><span>&amp;</span>lt;</span>/div<span class="entity"><span>&amp;</span>gt;</span><span class="entity"><span>&amp;</span>quot;</span>;
<span id="line3243"></span> echo <span class="entity"><span>&amp;</span>quot;</span><span class="entity"><span>&amp;</span>lt;</span>/form<span class="entity"><span>&amp;</span>gt;</span><span class="entity"><span>&amp;</span>quot;</span>;
<span id="line3244"></span>
<span id="line3245"></span> echo $params-<span class="entity"><span>&amp;</span>gt;</span>getForm(array('action' =<span class="entity"><span>&amp;</span>gt;</span> 'trigger_create'), 'get');
<span id="line3246"></span> echo <span class="entity"><span>&amp;</span>quot;</span><span class="entity"><span>&amp;</span>lt;</span>br/<span class="entity"><span>&amp;</span>gt;</span><span class="entity"><span>&amp;</span>lt;</span>div class='tdheader'<span class="entity"><span>&amp;</span>gt;</span><span class="entity"><span>&amp;</span>quot;</span>;
<span id="line3247"></span> echo $lang['create_trigger2'] . <span class="entity"><span>&amp;</span>quot;</span> <span class="entity"><span>&amp;</span>lt;</span>input type='submit' value='<span class="entity"><span>&amp;</span>quot;</span> . $lang['go'] . <span class="entity"><span>&amp;</span>quot;</span>' name='addindex' class='btn'/<span class="entity"><span>&amp;</span>gt;</span><span class="entity"><span>&amp;</span>quot;</span>;
<span id="line3248"></span> echo <span class="entity"><span>&amp;</span>quot;</span><span class="entity"><span>&amp;</span>lt;</span>/div<span class="entity"><span>&amp;</span>gt;</span><span class="entity"><span>&amp;</span>quot;</span>;
<span id="line3249"></span> echo <span class="entity"><span>&amp;</span>quot;</span><span class="entity"><span>&amp;</span>lt;</span>/form<span class="entity"><span>&amp;</span>gt;</span><span class="entity"><span>&amp;</span>quot;</span>;
<span id="line3250"></span> }
<span id="line3251"></span> }
<span id="line3252"></span> break;
<span id="line3253"></span>
<span id="line3254"></span> //- Create column (=column_create)
<span id="line3255"></span> case <span class="entity"><span>&amp;</span>quot;</span>column_create<span class="entity"><span>&amp;</span>quot;</span>:
<span id="line3256"></span> echo <span class="entity"><span>&amp;</span>quot;</span><span class="entity"><span>&amp;</span>lt;</span>h2<span class="entity"><span>&amp;</span>gt;</span><span class="entity"><span>&amp;</span>quot;</span> . sprintf($lang['new_fld'], htmlencode($_GET['table'])) . <span class="entity"><span>&amp;</span>quot;</span><span class="entity"><span>&amp;</span>lt;</span>/h2<span class="entity"><span>&amp;</span>gt;</span><span class="entity"><span>&amp;</span>quot;</span>;
<span id="line3257"></span> if ($_GET['tablefields'] == <span class="entity"><span>&amp;</span>quot;</span><span class="entity"><span>&amp;</span>quot;</span> || intval($_GET['tablefields']) <span class="entity"><span>&amp;</span>lt;</span>= 0)
<span id="line3258"></span> echo $lang['specify_fields'];
<span id="line3259"></span> else if ($_GET['table'] == <span class="entity"><span>&amp;</span>quot;</span><span class="entity"><span>&amp;</span>quot;</span>)
<span id="line3260"></span> echo $lang['specify_tbl'];
<span id="line3261"></span> else {
<span id="line3262"></span> $num = intval($_GET['tablefields']);
<span id="line3263"></span> $name = $_GET['table'];
<span id="line3264"></span> echo $params-<span class="entity"><span>&amp;</span>gt;</span>getForm(array('action' =<span class="entity"><span>&amp;</span>gt;</span> 'column_create', 'confirm' =<span class="entity"><span>&amp;</span>gt;</span> '1'));
<span id="line3265"></span> echo <span class="entity"><span>&amp;</span>quot;</span><span class="entity"><span>&amp;</span>lt;</span>input type='hidden' name='rows' value='<span class="entity"><span>&amp;</span>quot;</span> . $num . <span class="entity"><span>&amp;</span>quot;</span>'/<span class="entity"><span>&amp;</span>gt;</span><span class="entity"><span>&amp;</span>quot;</span>;
<span id="line3266"></span> echo <span class="entity"><span>&amp;</span>quot;</span><span class="entity"><span>&amp;</span>lt;</span>table border='0' cellpadding='2' cellspacing='1' class='viewTable'<span class="entity"><span>&amp;</span>gt;</span><span class="entity"><span>&amp;</span>quot;</span>;
<span id="line3267"></span> echo <span class="entity"><span>&amp;</span>quot;</span><span class="entity"><span>&amp;</span>lt;</span>tr<span class="entity"><span>&amp;</span>gt;</span><span class="entity"><span>&amp;</span>quot;</span>;
<span id="line3268"></span> $headings = array($lang[<span class="entity"><span>&amp;</span>quot;</span>fld<span class="entity"><span>&amp;</span>quot;</span>], $lang[<span class="entity"><span>&amp;</span>quot;</span>type<span class="entity"><span>&amp;</span>quot;</span>], $lang[<span class="entity"><span>&amp;</span>quot;</span>prim_key<span class="entity"><span>&amp;</span>quot;</span>]);
<span id="line3269"></span> if ($db-<span class="entity"><span>&amp;</span>gt;</span>getType() != <span class="entity"><span>&amp;</span>quot;</span>SQLiteDatabase<span class="entity"><span>&amp;</span>quot;</span>) $headings[] = $lang[<span class="entity"><span>&amp;</span>quot;</span>autoincrement<span class="entity"><span>&amp;</span>quot;</span>];
<span id="line3270"></span> $headings[] = $lang[<span class="entity"><span>&amp;</span>quot;</span>not_null<span class="entity"><span>&amp;</span>quot;</span>];
<span id="line3271"></span> $headings[] = $lang[<span class="entity"><span>&amp;</span>quot;</span>def_val<span class="entity"><span>&amp;</span>quot;</span>];
<span id="line3272"></span>
<span id="line3273"></span> for ($k = 0; $k <span class="entity"><span>&amp;</span>lt;</span> count($headings); $k++)
<span id="line3274"></span> echo <span class="entity"><span>&amp;</span>quot;</span><span class="entity"><span>&amp;</span>lt;</span>td class='tdheader'<span class="entity"><span>&amp;</span>gt;</span><span class="entity"><span>&amp;</span>quot;</span> . $headings[$k] . <span class="entity"><span>&amp;</span>quot;</span><span class="entity"><span>&amp;</span>lt;</span>/td<span class="entity"><span>&amp;</span>gt;</span><span class="entity"><span>&amp;</span>quot;</span>;
<span id="line3275"></span> echo <span class="entity"><span>&amp;</span>quot;</span><span class="entity"><span>&amp;</span>lt;</span>/tr<span class="entity"><span>&amp;</span>gt;</span><span class="entity"><span>&amp;</span>quot;</span>;
<span id="line3276"></span>
<span id="line3277"></span> for ($i = 0; $i <span class="entity"><span>&amp;</span>lt;</span> $num; $i++) {
<span id="line3278"></span> $tdWithClass = <span class="entity"><span>&amp;</span>quot;</span><span class="entity"><span>&amp;</span>lt;</span>td class='td<span class="entity"><span>&amp;</span>quot;</span> . ($i % 2 ? <span class="entity"><span>&amp;</span>quot;</span>1<span class="entity"><span>&amp;</span>quot;</span> : <span class="entity"><span>&amp;</span>quot;</span>2<span class="entity"><span>&amp;</span>quot;</span>) . <span class="entity"><span>&amp;</span>quot;</span>'<span class="entity"><span>&amp;</span>gt;</span><span class="entity"><span>&amp;</span>quot;</span>;
<span id="line3279"></span> echo <span class="entity"><span>&amp;</span>quot;</span><span class="entity"><span>&amp;</span>lt;</span>tr<span class="entity"><span>&amp;</span>gt;</span><span class="entity"><span>&amp;</span>quot;</span>;
<span id="line3280"></span> echo $tdWithClass;
<span id="line3281"></span> echo <span class="entity"><span>&amp;</span>quot;</span><span class="entity"><span>&amp;</span>lt;</span>input type='text' name='<span class="entity"><span>&amp;</span>quot;</span> . $i . <span class="entity"><span>&amp;</span>quot;</span>_field' style='width:200px;'/<span class="entity"><span>&amp;</span>gt;</span><span class="entity"><span>&amp;</span>quot;</span>;
<span id="line3282"></span> echo <span class="entity"><span>&amp;</span>quot;</span><span class="entity"><span>&amp;</span>lt;</span>/td<span class="entity"><span>&amp;</span>gt;</span><span class="entity"><span>&amp;</span>quot;</span>;
<span id="line3283"></span> echo $tdWithClass;
<span id="line3284"></span> echo <span class="entity"><span>&amp;</span>quot;</span><span class="entity"><span>&amp;</span>lt;</span>select name='<span class="entity"><span>&amp;</span>quot;</span> . $i . <span class="entity"><span>&amp;</span>quot;</span>_type' id='i<span class="entity"><span>&amp;</span>quot;</span> . $i . <span class="entity"><span>&amp;</span>quot;</span>_type' onchange='toggleAutoincrement(<span class="entity"><span>&amp;</span>quot;</span> . $i . <span class="entity"><span>&amp;</span>quot;</span>);'<span class="entity"><span>&amp;</span>gt;</span><span class="entity"><span>&amp;</span>quot;</span>;
<span id="line3285"></span> foreach ($sqlite_datatypes as $t) {
<span id="line3286"></span> echo <span class="entity"><span>&amp;</span>quot;</span><span class="entity"><span>&amp;</span>lt;</span>option value='<span class="entity"><span>&amp;</span>quot;</span> . htmlencode($t) . <span class="entity"><span>&amp;</span>quot;</span>'<span class="entity"><span>&amp;</span>gt;</span><span class="entity"><span>&amp;</span>quot;</span> . htmlencode($t) . <span class="entity"><span>&amp;</span>quot;</span><span class="entity"><span>&amp;</span>lt;</span>/option<span class="entity"><span>&amp;</span>gt;</span><span class="entity"><span>&amp;</span>quot;</span>;
<span id="line3287"></span> }
<span id="line3288"></span> echo <span class="entity"><span>&amp;</span>quot;</span><span class="entity"><span>&amp;</span>lt;</span>/select<span class="entity"><span>&amp;</span>gt;</span><span class="entity"><span>&amp;</span>quot;</span>;
<span id="line3289"></span> echo <span class="entity"><span>&amp;</span>quot;</span><span class="entity"><span>&amp;</span>lt;</span>/td<span class="entity"><span>&amp;</span>gt;</span><span class="entity"><span>&amp;</span>quot;</span>;
<span id="line3290"></span> echo $tdWithClass;
<span id="line3291"></span> echo <span class="entity"><span>&amp;</span>quot;</span><span class="entity"><span>&amp;</span>lt;</span>label<span class="entity"><span>&amp;</span>gt;</span><span class="entity"><span>&amp;</span>lt;</span>input type='checkbox' name='<span class="entity"><span>&amp;</span>quot;</span> . $i . <span class="entity"><span>&amp;</span>quot;</span>_primarykey'/<span class="entity"><span>&amp;</span>gt;</span> <span class="entity"><span>&amp;</span>quot;</span> . $lang['yes'] . <span class="entity"><span>&amp;</span>quot;</span><span class="entity"><span>&amp;</span>lt;</span>/label<span class="entity"><span>&amp;</span>gt;</span><span class="entity"><span>&amp;</span>quot;</span>;
<span id="line3292"></span> echo <span class="entity"><span>&amp;</span>quot;</span><span class="entity"><span>&amp;</span>lt;</span>/td<span class="entity"><span>&amp;</span>gt;</span><span class="entity"><span>&amp;</span>quot;</span>;
<span id="line3293"></span> if ($db-<span class="entity"><span>&amp;</span>gt;</span>getType() != <span class="entity"><span>&amp;</span>quot;</span>SQLiteDatabase<span class="entity"><span>&amp;</span>quot;</span>) {
<span id="line3294"></span> echo $tdWithClass;
<span id="line3295"></span> echo <span class="entity"><span>&amp;</span>quot;</span><span class="entity"><span>&amp;</span>lt;</span>label<span class="entity"><span>&amp;</span>gt;</span><span class="entity"><span>&amp;</span>lt;</span>input type='checkbox' name='<span class="entity"><span>&amp;</span>quot;</span> . $i . <span class="entity"><span>&amp;</span>quot;</span>_autoincrement' id='i<span class="entity"><span>&amp;</span>quot;</span> . $i . <span class="entity"><span>&amp;</span>quot;</span>_autoincrement'/<span class="entity"><span>&amp;</span>gt;</span> <span class="entity"><span>&amp;</span>quot;</span> . $lang['yes'] . <span class="entity"><span>&amp;</span>quot;</span><span class="entity"><span>&amp;</span>lt;</span>/label<span class="entity"><span>&amp;</span>gt;</span><span class="entity"><span>&amp;</span>quot;</span>;
<span id="line3296"></span> echo <span class="entity"><span>&amp;</span>quot;</span><span class="entity"><span>&amp;</span>lt;</span>/td<span class="entity"><span>&amp;</span>gt;</span><span class="entity"><span>&amp;</span>quot;</span>;
<span id="line3297"></span> }
<span id="line3298"></span> echo $tdWithClass;
<span id="line3299"></span> echo <span class="entity"><span>&amp;</span>quot;</span><span class="entity"><span>&amp;</span>lt;</span>label<span class="entity"><span>&amp;</span>gt;</span><span class="entity"><span>&amp;</span>lt;</span>input type='checkbox' name='<span class="entity"><span>&amp;</span>quot;</span> . $i . <span class="entity"><span>&amp;</span>quot;</span>_notnull'/<span class="entity"><span>&amp;</span>gt;</span> <span class="entity"><span>&amp;</span>quot;</span> . $lang['yes'] . <span class="entity"><span>&amp;</span>quot;</span><span class="entity"><span>&amp;</span>lt;</span>/label<span class="entity"><span>&amp;</span>gt;</span><span class="entity"><span>&amp;</span>quot;</span>;
<span id="line3300"></span> echo <span class="entity"><span>&amp;</span>quot;</span><span class="entity"><span>&amp;</span>lt;</span>/td<span class="entity"><span>&amp;</span>gt;</span><span class="entity"><span>&amp;</span>quot;</span>;
<span id="line3301"></span> echo $tdWithClass;
<span id="line3302"></span> echo <span class="entity"><span>&amp;</span>quot;</span><span class="entity"><span>&amp;</span>lt;</span>select name='<span class="entity"><span>&amp;</span>quot;</span> . $i . <span class="entity"><span>&amp;</span>quot;</span>_defaultoption' id='i<span class="entity"><span>&amp;</span>quot;</span> . $i . <span class="entity"><span>&amp;</span>quot;</span>_defaultoption' onchange=\<span class="entity"><span>&amp;</span>quot;</span>if(this.value!='defined' <span class="entity"><span>&amp;</span>amp;</span><span class="entity"><span>&amp;</span>amp;</span> this.value!='expr') document.getElementById('i<span class="entity"><span>&amp;</span>quot;</span> . $i . <span class="entity"><span>&amp;</span>quot;</span>_defaultvalue').value='';\<span class="entity"><span>&amp;</span>quot;</span><span class="entity"><span>&amp;</span>gt;</span><span class="entity"><span>&amp;</span>quot;</span>;
<span id="line3303"></span> echo <span class="entity"><span>&amp;</span>quot;</span><span class="entity"><span>&amp;</span>lt;</span>option value='none'<span class="entity"><span>&amp;</span>gt;</span><span class="entity"><span>&amp;</span>quot;</span> . $lang['none'] . <span class="entity"><span>&amp;</span>quot;</span><span class="entity"><span>&amp;</span>lt;</span>/option<span class="entity"><span>&amp;</span>gt;</span><span class="entity"><span>&amp;</span>lt;</span>option value='defined'<span class="entity"><span>&amp;</span>gt;</span><span class="entity"><span>&amp;</span>quot;</span> . $lang['as_defined'] . <span class="entity"><span>&amp;</span>quot;</span>:<span class="entity"><span>&amp;</span>lt;</span>/option<span class="entity"><span>&amp;</span>gt;</span><span class="entity"><span>&amp;</span>lt;</span>option<span class="entity"><span>&amp;</span>gt;</span>NULL<span class="entity"><span>&amp;</span>lt;</span>/option<span class="entity"><span>&amp;</span>gt;</span><span class="entity"><span>&amp;</span>lt;</span>option<span class="entity"><span>&amp;</span>gt;</span>CURRENT_TIME<span class="entity"><span>&amp;</span>lt;</span>/option<span class="entity"><span>&amp;</span>gt;</span><span class="entity"><span>&amp;</span>lt;</span>option<span class="entity"><span>&amp;</span>gt;</span>CURRENT_DATE<span class="entity"><span>&amp;</span>lt;</span>/option<span class="entity"><span>&amp;</span>gt;</span><span class="entity"><span>&amp;</span>lt;</span>option<span class="entity"><span>&amp;</span>gt;</span>CURRENT_TIMESTAMP<span class="entity"><span>&amp;</span>lt;</span>/option<span class="entity"><span>&amp;</span>gt;</span><span class="entity"><span>&amp;</span>lt;</span>option value='expr'<span class="entity"><span>&amp;</span>gt;</span><span class="entity"><span>&amp;</span>quot;</span> . $lang['expression'] . <span class="entity"><span>&amp;</span>quot;</span>:<span class="entity"><span>&amp;</span>lt;</span>/option<span class="entity"><span>&amp;</span>gt;</span><span class="entity"><span>&amp;</span>quot;</span>;
<span id="line3304"></span> echo <span class="entity"><span>&amp;</span>quot;</span><span class="entity"><span>&amp;</span>lt;</span>/select<span class="entity"><span>&amp;</span>gt;</span><span class="entity"><span>&amp;</span>quot;</span>;
<span id="line3305"></span> echo <span class="entity"><span>&amp;</span>quot;</span><span class="entity"><span>&amp;</span>lt;</span>input type='text' name='<span class="entity"><span>&amp;</span>quot;</span> . $i . <span class="entity"><span>&amp;</span>quot;</span>_defaultvalue' id='i<span class="entity"><span>&amp;</span>quot;</span> . $i . <span class="entity"><span>&amp;</span>quot;</span>_defaultvalue' style='width:100px;' onchange=\<span class="entity"><span>&amp;</span>quot;</span>if(document.getElementById('i<span class="entity"><span>&amp;</span>quot;</span> . $i . <span class="entity"><span>&amp;</span>quot;</span>_defaultoption').value!='expr') document.getElementById('i<span class="entity"><span>&amp;</span>quot;</span> . $i . <span class="entity"><span>&amp;</span>quot;</span>_defaultoption').value='defined';\<span class="entity"><span>&amp;</span>quot;</span>/<span class="entity"><span>&amp;</span>gt;</span><span class="entity"><span>&amp;</span>quot;</span>;
<span id="line3306"></span> echo <span class="entity"><span>&amp;</span>quot;</span><span class="entity"><span>&amp;</span>lt;</span>/td<span class="entity"><span>&amp;</span>gt;</span><span class="entity"><span>&amp;</span>quot;</span>;
<span id="line3307"></span> echo <span class="entity"><span>&amp;</span>quot;</span><span class="entity"><span>&amp;</span>lt;</span>/tr<span class="entity"><span>&amp;</span>gt;</span><span class="entity"><span>&amp;</span>quot;</span>;
<span id="line3308"></span> }
<span id="line3309"></span> echo <span class="entity"><span>&amp;</span>quot;</span><span class="entity"><span>&amp;</span>lt;</span>tr<span class="entity"><span>&amp;</span>gt;</span><span class="entity"><span>&amp;</span>quot;</span>;
<span id="line3310"></span> echo <span class="entity"><span>&amp;</span>quot;</span><span class="entity"><span>&amp;</span>lt;</span>td class='tdheader' style='text-align:right;' colspan='6'<span class="entity"><span>&amp;</span>gt;</span><span class="entity"><span>&amp;</span>quot;</span>;
<span id="line3311"></span> echo <span class="entity"><span>&amp;</span>quot;</span><span class="entity"><span>&amp;</span>lt;</span>input type='submit' value='<span class="entity"><span>&amp;</span>quot;</span> . $lang['add_flds'] . <span class="entity"><span>&amp;</span>quot;</span>' class='btn'/<span class="entity"><span>&amp;</span>gt;</span> <span class="entity"><span>&amp;</span>quot;</span>;
<span id="line3312"></span> echo $params-<span class="entity"><span>&amp;</span>gt;</span>getLink(array('action' =<span class="entity"><span>&amp;</span>gt;</span> 'column_view'), $lang['cancel']);
<span id="line3313"></span> echo <span class="entity"><span>&amp;</span>quot;</span><span class="entity"><span>&amp;</span>lt;</span>/td<span class="entity"><span>&amp;</span>gt;</span><span class="entity"><span>&amp;</span>quot;</span>;
<span id="line3314"></span> echo <span class="entity"><span>&amp;</span>quot;</span><span class="entity"><span>&amp;</span>lt;</span>/tr<span class="entity"><span>&amp;</span>gt;</span><span class="entity"><span>&amp;</span>quot;</span>;
<span id="line3315"></span> echo <span class="entity"><span>&amp;</span>quot;</span><span class="entity"><span>&amp;</span>lt;</span>/table<span class="entity"><span>&amp;</span>gt;</span><span class="entity"><span>&amp;</span>quot;</span>;
<span id="line3316"></span> echo <span class="entity"><span>&amp;</span>quot;</span><span class="entity"><span>&amp;</span>lt;</span>/form<span class="entity"><span>&amp;</span>gt;</span><span class="entity"><span>&amp;</span>quot;</span>;
<span id="line3317"></span> }
<span id="line3318"></span> break;
<span id="line3319"></span>
<span id="line3320"></span> //- Delete column (=column_confirm)
<span id="line3321"></span> case <span class="entity"><span>&amp;</span>quot;</span>column_confirm<span class="entity"><span>&amp;</span>quot;</span>:
<span id="line3322"></span> if (isset($_GET['check']))
<span id="line3323"></span> $pks = $_GET['check'];
<span id="line3324"></span> elseif (isset($_GET['pk']))
<span id="line3325"></span> $pks = array($_GET['pk']);
<span id="line3326"></span> else $pks = array();
<span id="line3327"></span>
<span id="line3328"></span> if (sizeof($pks) == 0) //nothing was selected so show an error
<span id="line3329"></span> {
<span id="line3330"></span> echo <span class="entity"><span>&amp;</span>quot;</span><span class="entity"><span>&amp;</span>lt;</span>div class='confirm'<span class="entity"><span>&amp;</span>gt;</span><span class="entity"><span>&amp;</span>quot;</span>;
<span id="line3331"></span> echo $lang['err'] . <span class="entity"><span>&amp;</span>quot;</span>: <span class="entity"><span>&amp;</span>quot;</span> . $lang['no_sel'];
<span id="line3332"></span> echo <span class="entity"><span>&amp;</span>quot;</span><span class="entity"><span>&amp;</span>lt;</span>/div<span class="entity"><span>&amp;</span>gt;</span><span class="entity"><span>&amp;</span>quot;</span>;
<span id="line3333"></span> echo <span class="entity"><span>&amp;</span>quot;</span><span class="entity"><span>&amp;</span>lt;</span>br/<span class="entity"><span>&amp;</span>gt;</span><span class="entity"><span>&amp;</span>lt;</span>br/<span class="entity"><span>&amp;</span>gt;</span><span class="entity"><span>&amp;</span>quot;</span>;
<span id="line3334"></span> echo $params-<span class="entity"><span>&amp;</span>gt;</span>getLink(array('action' =<span class="entity"><span>&amp;</span>gt;</span> 'column_view'), $lang['return']);
<span id="line3335"></span> } else {
<span id="line3336"></span> $str = $pks[0];
<span id="line3337"></span> $pkVal = $pks[0];
<span id="line3338"></span> for ($i = 1; $i <span class="entity"><span>&amp;</span>lt;</span> sizeof($pks); $i++) {
<span id="line3339"></span> $str .= <span class="entity"><span>&amp;</span>quot;</span>, <span class="entity"><span>&amp;</span>quot;</span> . $pks[$i];
<span id="line3340"></span> $pkVal .= <span class="entity"><span>&amp;</span>quot;</span>:<span class="entity"><span>&amp;</span>quot;</span> . $pks[$i];
<span id="line3341"></span> }
<span id="line3342"></span> echo $params-<span class="entity"><span>&amp;</span>gt;</span>getForm(array('action' =<span class="entity"><span>&amp;</span>gt;</span> $_GET['action2'], 'confirm' =<span class="entity"><span>&amp;</span>gt;</span> '1', 'pk' =<span class="entity"><span>&amp;</span>gt;</span> $pkVal));
<span id="line3343"></span> echo <span class="entity"><span>&amp;</span>quot;</span><span class="entity"><span>&amp;</span>lt;</span>div class='confirm'<span class="entity"><span>&amp;</span>gt;</span><span class="entity"><span>&amp;</span>quot;</span>;
<span id="line3344"></span> printf($lang['ques_' . $_GET['action2']], htmlencode($str), htmlencode($target_table));
<span id="line3345"></span> echo <span class="entity"><span>&amp;</span>quot;</span><span class="entity"><span>&amp;</span>lt;</span>br/<span class="entity"><span>&amp;</span>gt;</span><span class="entity"><span>&amp;</span>lt;</span>br/<span class="entity"><span>&amp;</span>gt;</span><span class="entity"><span>&amp;</span>quot;</span>;
<span id="line3346"></span> echo <span class="entity"><span>&amp;</span>quot;</span><span class="entity"><span>&amp;</span>lt;</span>input type='submit' value='<span class="entity"><span>&amp;</span>quot;</span> . $lang['confirm'] . <span class="entity"><span>&amp;</span>quot;</span>' class='btn'/<span class="entity"><span>&amp;</span>gt;</span> <span class="entity"><span>&amp;</span>quot;</span>;
<span id="line3347"></span> echo $params-<span class="entity"><span>&amp;</span>gt;</span>getLink(array('action' =<span class="entity"><span>&amp;</span>gt;</span> 'column_view'), $lang['cancel']);
<span id="line3348"></span> echo <span class="entity"><span>&amp;</span>quot;</span><span class="entity"><span>&amp;</span>lt;</span>/div<span class="entity"><span>&amp;</span>gt;</span><span class="entity"><span>&amp;</span>quot;</span>;
<span id="line3349"></span> }
<span id="line3350"></span> break;
<span id="line3351"></span>
<span id="line3352"></span> //- Edit column (=column_edit)
<span id="line3353"></span> case <span class="entity"><span>&amp;</span>quot;</span>column_edit<span class="entity"><span>&amp;</span>quot;</span>:
<span id="line3354"></span> echo <span class="entity"><span>&amp;</span>quot;</span><span class="entity"><span>&amp;</span>lt;</span>h2<span class="entity"><span>&amp;</span>gt;</span><span class="entity"><span>&amp;</span>quot;</span> . sprintf($lang['edit_col'], htmlencode($_GET['pk'])) . <span class="entity"><span>&amp;</span>quot;</span> <span class="entity"><span>&amp;</span>quot;</span> . $lang['on_tbl'] . <span class="entity"><span>&amp;</span>quot;</span> '<span class="entity"><span>&amp;</span>quot;</span> . htmlencode($target_table) . <span class="entity"><span>&amp;</span>quot;</span>'<span class="entity"><span>&amp;</span>lt;</span>/h2<span class="entity"><span>&amp;</span>gt;</span><span class="entity"><span>&amp;</span>quot;</span>;
<span id="line3355"></span> echo $lang['sqlite_limit'] . <span class="entity"><span>&amp;</span>quot;</span><span class="entity"><span>&amp;</span>lt;</span>br/<span class="entity"><span>&amp;</span>gt;</span><span class="entity"><span>&amp;</span>lt;</span>br/<span class="entity"><span>&amp;</span>gt;</span><span class="entity"><span>&amp;</span>quot;</span>;
<span id="line3356"></span> if (!isset($_GET['pk']))
<span id="line3357"></span> echo $lang['specify_col'];
<span id="line3358"></span> else if (!$target_table)
<span id="line3359"></span> echo $lang['specify_tbl'];
<span id="line3360"></span> else {
<span id="line3361"></span> $tableInfo = $db-<span class="entity"><span>&amp;</span>gt;</span>getTableInfo($target_table);
<span id="line3362"></span>
<span id="line3363"></span> for ($i = 0; $i <span class="entity"><span>&amp;</span>lt;</span> sizeof($tableInfo); $i++) {
<span id="line3364"></span> if ($tableInfo[$i][1] == $_GET['pk']) {
<span id="line3365"></span> $colVal = $tableInfo[$i][0];
<span id="line3366"></span> $fieldVal = $tableInfo[$i][1];
<span id="line3367"></span> $typeVal = $tableInfo[$i]['type'];
<span id="line3368"></span> $notnullVal = $tableInfo[$i][3];
<span id="line3369"></span> $defaultVal = $tableInfo[$i][4];
<span id="line3370"></span> $primarykeyVal = $tableInfo[$i][5];
<span id="line3371"></span> break;
<span id="line3372"></span> }
<span id="line3373"></span> }
<span id="line3374"></span>
<span id="line3375"></span> if (!isset($fieldVal)) {
<span id="line3376"></span> echo <span class="entity"><span>&amp;</span>quot;</span><span class="entity"><span>&amp;</span>lt;</span>div class='confirm'<span class="entity"><span>&amp;</span>gt;</span><span class="entity"><span>&amp;</span>quot;</span> . $lang['err'] . <span class="entity"><span>&amp;</span>quot;</span>: <span class="entity"><span>&amp;</span>quot;</span> . sprintf($lang['col_inexistent'], htmlencode($_GET['pk'])) . <span class="entity"><span>&amp;</span>quot;</span><span class="entity"><span>&amp;</span>lt;</span>/div<span class="entity"><span>&amp;</span>gt;</span><span class="entity"><span>&amp;</span>quot;</span>;
<span id="line3377"></span> } else {
<span id="line3378"></span> $name = $target_table;
<span id="line3379"></span> echo $params-<span class="entity"><span>&amp;</span>gt;</span>getForm(array('action' =<span class="entity"><span>&amp;</span>gt;</span> 'column_edit', 'confirm' =<span class="entity"><span>&amp;</span>gt;</span> '1'));
<span id="line3380"></span> echo <span class="entity"><span>&amp;</span>quot;</span><span class="entity"><span>&amp;</span>lt;</span>input type='hidden' name='oldvalue' value='<span class="entity"><span>&amp;</span>quot;</span> . htmlencode($_GET['pk']) . <span class="entity"><span>&amp;</span>quot;</span>'/<span class="entity"><span>&amp;</span>gt;</span><span class="entity"><span>&amp;</span>quot;</span>;
<span id="line3381"></span> echo <span class="entity"><span>&amp;</span>quot;</span><span class="entity"><span>&amp;</span>lt;</span>table border='0' cellpadding='2' cellspacing='1' class='viewTable'<span class="entity"><span>&amp;</span>gt;</span><span class="entity"><span>&amp;</span>quot;</span>;
<span id="line3382"></span> echo <span class="entity"><span>&amp;</span>quot;</span><span class="entity"><span>&amp;</span>lt;</span>tr<span class="entity"><span>&amp;</span>gt;</span><span class="entity"><span>&amp;</span>quot;</span>;
<span id="line3383"></span> //$headings = array(<span class="entity"><span>&amp;</span>quot;</span>Field<span class="entity"><span>&amp;</span>quot;</span>, <span class="entity"><span>&amp;</span>quot;</span>Type<span class="entity"><span>&amp;</span>quot;</span>, <span class="entity"><span>&amp;</span>quot;</span>Primary Key<span class="entity"><span>&amp;</span>quot;</span>, <span class="entity"><span>&amp;</span>quot;</span>Autoincrement<span class="entity"><span>&amp;</span>quot;</span>, <span class="entity"><span>&amp;</span>quot;</span>Not NULL<span class="entity"><span>&amp;</span>quot;</span>, <span class="entity"><span>&amp;</span>quot;</span>Default Value<span class="entity"><span>&amp;</span>quot;</span>);
<span id="line3384"></span> $headings = array($lang[<span class="entity"><span>&amp;</span>quot;</span>fld<span class="entity"><span>&amp;</span>quot;</span>], $lang[<span class="entity"><span>&amp;</span>quot;</span>type<span class="entity"><span>&amp;</span>quot;</span>]);
<span id="line3385"></span> for ($k = 0; $k <span class="entity"><span>&amp;</span>lt;</span> count($headings); $k++)
<span id="line3386"></span> echo <span class="entity"><span>&amp;</span>quot;</span><span class="entity"><span>&amp;</span>lt;</span>td class='tdheader'<span class="entity"><span>&amp;</span>gt;</span><span class="entity"><span>&amp;</span>quot;</span> . $headings[$k] . <span class="entity"><span>&amp;</span>quot;</span><span class="entity"><span>&amp;</span>lt;</span>/td<span class="entity"><span>&amp;</span>gt;</span><span class="entity"><span>&amp;</span>quot;</span>;
<span id="line3387"></span> echo <span class="entity"><span>&amp;</span>quot;</span><span class="entity"><span>&amp;</span>lt;</span>/tr<span class="entity"><span>&amp;</span>gt;</span><span class="entity"><span>&amp;</span>quot;</span>;
<span id="line3388"></span>
<span id="line3389"></span> $i = 0;
<span id="line3390"></span> $tdWithClass = <span class="entity"><span>&amp;</span>quot;</span><span class="entity"><span>&amp;</span>lt;</span>td class='td<span class="entity"><span>&amp;</span>quot;</span> . ($i % 2 ? <span class="entity"><span>&amp;</span>quot;</span>1<span class="entity"><span>&amp;</span>quot;</span> : <span class="entity"><span>&amp;</span>quot;</span>2<span class="entity"><span>&amp;</span>quot;</span>) . <span class="entity"><span>&amp;</span>quot;</span>'<span class="entity"><span>&amp;</span>gt;</span><span class="entity"><span>&amp;</span>quot;</span>;
<span id="line3391"></span> echo <span class="entity"><span>&amp;</span>quot;</span><span class="entity"><span>&amp;</span>lt;</span>tr<span class="entity"><span>&amp;</span>gt;</span><span class="entity"><span>&amp;</span>quot;</span>;
<span id="line3392"></span> echo $tdWithClass;
<span id="line3393"></span> echo <span class="entity"><span>&amp;</span>quot;</span><span class="entity"><span>&amp;</span>lt;</span>input type='text' name='<span class="entity"><span>&amp;</span>quot;</span> . $i . <span class="entity"><span>&amp;</span>quot;</span>_field' style='width:200px;' value='<span class="entity"><span>&amp;</span>quot;</span> . htmlencode($fieldVal) . <span class="entity"><span>&amp;</span>quot;</span>'/<span class="entity"><span>&amp;</span>gt;</span><span class="entity"><span>&amp;</span>quot;</span>;
<span id="line3394"></span> echo <span class="entity"><span>&amp;</span>quot;</span><span class="entity"><span>&amp;</span>lt;</span>/td<span class="entity"><span>&amp;</span>gt;</span><span class="entity"><span>&amp;</span>quot;</span>;
<span id="line3395"></span> echo $tdWithClass;
<span id="line3396"></span> echo <span class="entity"><span>&amp;</span>quot;</span><span class="entity"><span>&amp;</span>lt;</span>select name='<span class="entity"><span>&amp;</span>quot;</span> . $i . <span class="entity"><span>&amp;</span>quot;</span>_type' id='i<span class="entity"><span>&amp;</span>quot;</span> . $i . <span class="entity"><span>&amp;</span>quot;</span>_type' onchange='toggleAutoincrement(<span class="entity"><span>&amp;</span>quot;</span> . $i . <span class="entity"><span>&amp;</span>quot;</span>);'<span class="entity"><span>&amp;</span>gt;</span><span class="entity"><span>&amp;</span>quot;</span>;
<span id="line3397"></span> if (!in_array($typeVal, $sqlite_datatypes))
<span id="line3398"></span> echo <span class="entity"><span>&amp;</span>quot;</span><span class="entity"><span>&amp;</span>lt;</span>option value='<span class="entity"><span>&amp;</span>quot;</span> . htmlencode($typeVal) . <span class="entity"><span>&amp;</span>quot;</span>' selected='selected'<span class="entity"><span>&amp;</span>gt;</span><span class="entity"><span>&amp;</span>quot;</span> . htmlencode($typeVal) . <span class="entity"><span>&amp;</span>quot;</span><span class="entity"><span>&amp;</span>lt;</span>/option<span class="entity"><span>&amp;</span>gt;</span><span class="entity"><span>&amp;</span>quot;</span>;
<span id="line3399"></span> foreach ($sqlite_datatypes as $t) {
<span id="line3400"></span> if ($t == $typeVal)
<span id="line3401"></span> echo <span class="entity"><span>&amp;</span>quot;</span><span class="entity"><span>&amp;</span>lt;</span>option value='<span class="entity"><span>&amp;</span>quot;</span> . htmlencode($t) . <span class="entity"><span>&amp;</span>quot;</span>' selected='selected'<span class="entity"><span>&amp;</span>gt;</span><span class="entity"><span>&amp;</span>quot;</span> . htmlencode($t) . <span class="entity"><span>&amp;</span>quot;</span><span class="entity"><span>&amp;</span>lt;</span>/option<span class="entity"><span>&amp;</span>gt;</span><span class="entity"><span>&amp;</span>quot;</span>;
<span id="line3402"></span> else
<span id="line3403"></span> echo <span class="entity"><span>&amp;</span>quot;</span><span class="entity"><span>&amp;</span>lt;</span>option value='<span class="entity"><span>&amp;</span>quot;</span> . htmlencode($t) . <span class="entity"><span>&amp;</span>quot;</span>'<span class="entity"><span>&amp;</span>gt;</span><span class="entity"><span>&amp;</span>quot;</span> . htmlencode($t) . <span class="entity"><span>&amp;</span>quot;</span><span class="entity"><span>&amp;</span>lt;</span>/option<span class="entity"><span>&amp;</span>gt;</span><span class="entity"><span>&amp;</span>quot;</span>;
<span id="line3404"></span> }
<span id="line3405"></span> echo <span class="entity"><span>&amp;</span>quot;</span><span class="entity"><span>&amp;</span>lt;</span>/select<span class="entity"><span>&amp;</span>gt;</span><span class="entity"><span>&amp;</span>quot;</span>;
<span id="line3406"></span> echo <span class="entity"><span>&amp;</span>quot;</span><span class="entity"><span>&amp;</span>lt;</span>/td<span class="entity"><span>&amp;</span>gt;</span><span class="entity"><span>&amp;</span>quot;</span>;
<span id="line3407"></span> /*
<span id="line3408"></span> echo $tdWithClass;
<span id="line3409"></span> if($primarykeyVal)
<span id="line3410"></span> echo <span class="entity"><span>&amp;</span>quot;</span><span class="entity"><span>&amp;</span>lt;</span>input type='checkbox' name='<span class="entity"><span>&amp;</span>quot;</span>.$i.<span class="entity"><span>&amp;</span>quot;</span>_primarykey' checked='checked'/<span class="entity"><span>&amp;</span>gt;</span> Yes<span class="entity"><span>&amp;</span>quot;</span>;
<span id="line3411"></span> else
<span id="line3412"></span> echo <span class="entity"><span>&amp;</span>quot;</span><span class="entity"><span>&amp;</span>lt;</span>input type='checkbox' name='<span class="entity"><span>&amp;</span>quot;</span>.$i.<span class="entity"><span>&amp;</span>quot;</span>_primarykey'/<span class="entity"><span>&amp;</span>gt;</span> Yes<span class="entity"><span>&amp;</span>quot;</span>;
<span id="line3413"></span> echo <span class="entity"><span>&amp;</span>quot;</span><span class="entity"><span>&amp;</span>lt;</span>/td<span class="entity"><span>&amp;</span>gt;</span><span class="entity"><span>&amp;</span>quot;</span>;
<span id="line3414"></span> echo $tdWithClass;
<span id="line3415"></span> if(1==2)
<span id="line3416"></span> echo <span class="entity"><span>&amp;</span>quot;</span><span class="entity"><span>&amp;</span>lt;</span>input type='checkbox' name='<span class="entity"><span>&amp;</span>quot;</span>.$i.<span class="entity"><span>&amp;</span>quot;</span>_autoincrement' id='<span class="entity"><span>&amp;</span>quot;</span>.$i.<span class="entity"><span>&amp;</span>quot;</span>_autoincrement' checked='checked'/<span class="entity"><span>&amp;</span>gt;</span> Yes<span class="entity"><span>&amp;</span>quot;</span>;
<span id="line3417"></span> else
<span id="line3418"></span> echo <span class="entity"><span>&amp;</span>quot;</span><span class="entity"><span>&amp;</span>lt;</span>input type='checkbox' name='<span class="entity"><span>&amp;</span>quot;</span>.$i.<span class="entity"><span>&amp;</span>quot;</span>_autoincrement' id='<span class="entity"><span>&amp;</span>quot;</span>.$i.<span class="entity"><span>&amp;</span>quot;</span>_autoincrement'/<span class="entity"><span>&amp;</span>gt;</span> Yes<span class="entity"><span>&amp;</span>quot;</span>;
<span id="line3419"></span> echo <span class="entity"><span>&amp;</span>quot;</span><span class="entity"><span>&amp;</span>lt;</span>/td<span class="entity"><span>&amp;</span>gt;</span><span class="entity"><span>&amp;</span>quot;</span>;
<span id="line3420"></span> echo $tdWithClass;
<span id="line3421"></span> if($notnullVal)
<span id="line3422"></span> echo <span class="entity"><span>&amp;</span>quot;</span><span class="entity"><span>&amp;</span>lt;</span>input type='checkbox' name='<span class="entity"><span>&amp;</span>quot;</span>.$i.<span class="entity"><span>&amp;</span>quot;</span>_notnull' checked='checked'/<span class="entity"><span>&amp;</span>gt;</span> Yes<span class="entity"><span>&amp;</span>quot;</span>;
<span id="line3423"></span> else
<span id="line3424"></span> echo <span class="entity"><span>&amp;</span>quot;</span><span class="entity"><span>&amp;</span>lt;</span>input type='checkbox' name='<span class="entity"><span>&amp;</span>quot;</span>.$i.<span class="entity"><span>&amp;</span>quot;</span>_notnull'/<span class="entity"><span>&amp;</span>gt;</span> Yes<span class="entity"><span>&amp;</span>quot;</span>;
<span id="line3425"></span> echo <span class="entity"><span>&amp;</span>quot;</span><span class="entity"><span>&amp;</span>lt;</span>/td<span class="entity"><span>&amp;</span>gt;</span><span class="entity"><span>&amp;</span>quot;</span>;
<span id="line3426"></span> echo $tdWithClass;
<span id="line3427"></span> echo <span class="entity"><span>&amp;</span>quot;</span><span class="entity"><span>&amp;</span>lt;</span>input type='text' name='<span class="entity"><span>&amp;</span>quot;</span>.$i.<span class="entity"><span>&amp;</span>quot;</span>_defaultvalue' value='<span class="entity"><span>&amp;</span>quot;</span>.$defaultVal.<span class="entity"><span>&amp;</span>quot;</span>' style='width:100px;'/<span class="entity"><span>&amp;</span>gt;</span><span class="entity"><span>&amp;</span>quot;</span>;
<span id="line3428"></span> echo <span class="entity"><span>&amp;</span>quot;</span><span class="entity"><span>&amp;</span>lt;</span>/td<span class="entity"><span>&amp;</span>gt;</span><span class="entity"><span>&amp;</span>quot;</span>;
<span id="line3429"></span> */
<span id="line3430"></span> echo <span class="entity"><span>&amp;</span>quot;</span><span class="entity"><span>&amp;</span>lt;</span>/tr<span class="entity"><span>&amp;</span>gt;</span><span class="entity"><span>&amp;</span>quot;</span>;
<span id="line3431"></span>
<span id="line3432"></span> echo <span class="entity"><span>&amp;</span>quot;</span><span class="entity"><span>&amp;</span>lt;</span>tr<span class="entity"><span>&amp;</span>gt;</span><span class="entity"><span>&amp;</span>quot;</span>;
<span id="line3433"></span> echo <span class="entity"><span>&amp;</span>quot;</span><span class="entity"><span>&amp;</span>lt;</span>td class='tdheader' style='text-align:right;' colspan='6'<span class="entity"><span>&amp;</span>gt;</span><span class="entity"><span>&amp;</span>quot;</span>;
<span id="line3434"></span> echo <span class="entity"><span>&amp;</span>quot;</span><span class="entity"><span>&amp;</span>lt;</span>input type='submit' value='<span class="entity"><span>&amp;</span>quot;</span> . $lang['save_ch'] . <span class="entity"><span>&amp;</span>quot;</span>' class='btn'/<span class="entity"><span>&amp;</span>gt;</span> <span class="entity"><span>&amp;</span>quot;</span>;
<span id="line3435"></span> echo $params-<span class="entity"><span>&amp;</span>gt;</span>getLink(array('action' =<span class="entity"><span>&amp;</span>gt;</span> 'column_view'), $lang['cancel']);
<span id="line3436"></span> echo <span class="entity"><span>&amp;</span>quot;</span><span class="entity"><span>&amp;</span>lt;</span>/td<span class="entity"><span>&amp;</span>gt;</span><span class="entity"><span>&amp;</span>quot;</span>;
<span id="line3437"></span> echo <span class="entity"><span>&amp;</span>quot;</span><span class="entity"><span>&amp;</span>lt;</span>/tr<span class="entity"><span>&amp;</span>gt;</span><span class="entity"><span>&amp;</span>quot;</span>;
<span id="line3438"></span> echo <span class="entity"><span>&amp;</span>quot;</span><span class="entity"><span>&amp;</span>lt;</span>/table<span class="entity"><span>&amp;</span>gt;</span><span class="entity"><span>&amp;</span>quot;</span>;
<span id="line3439"></span> echo <span class="entity"><span>&amp;</span>quot;</span><span class="entity"><span>&amp;</span>lt;</span>/form<span class="entity"><span>&amp;</span>gt;</span><span class="entity"><span>&amp;</span>quot;</span>;
<span id="line3440"></span> }
<span id="line3441"></span> }
<span id="line3442"></span> break;
<span id="line3443"></span>
<span id="line3444"></span> //- Delete index (=index_delete)
<span id="line3445"></span> case <span class="entity"><span>&amp;</span>quot;</span>index_delete<span class="entity"><span>&amp;</span>quot;</span>:
<span id="line3446"></span> echo $params-<span class="entity"><span>&amp;</span>gt;</span>getForm(array('action' =<span class="entity"><span>&amp;</span>gt;</span> 'index_delete', 'pk' =<span class="entity"><span>&amp;</span>gt;</span> $_GET['pk'], 'confirm' =<span class="entity"><span>&amp;</span>gt;</span> '1'));
<span id="line3447"></span> echo <span class="entity"><span>&amp;</span>quot;</span><span class="entity"><span>&amp;</span>lt;</span>div class='confirm'<span class="entity"><span>&amp;</span>gt;</span><span class="entity"><span>&amp;</span>quot;</span>;
<span id="line3448"></span> echo sprintf($lang['ques_del_index'], htmlencode($_GET['pk'])) . <span class="entity"><span>&amp;</span>quot;</span><span class="entity"><span>&amp;</span>lt;</span>br/<span class="entity"><span>&amp;</span>gt;</span><span class="entity"><span>&amp;</span>lt;</span>br/<span class="entity"><span>&amp;</span>gt;</span><span class="entity"><span>&amp;</span>quot;</span>;
<span id="line3449"></span> echo <span class="entity"><span>&amp;</span>quot;</span><span class="entity"><span>&amp;</span>lt;</span>input type='submit' value='<span class="entity"><span>&amp;</span>quot;</span> . $lang['confirm'] . <span class="entity"><span>&amp;</span>quot;</span>' class='btn'/<span class="entity"><span>&amp;</span>gt;</span> <span class="entity"><span>&amp;</span>quot;</span>;
<span id="line3450"></span> echo $params-<span class="entity"><span>&amp;</span>gt;</span>getLink(array('action' =<span class="entity"><span>&amp;</span>gt;</span> 'column_view'), $lang['cancel']);
<span id="line3451"></span> echo <span class="entity"><span>&amp;</span>quot;</span><span class="entity"><span>&amp;</span>lt;</span>/div<span class="entity"><span>&amp;</span>gt;</span><span class="entity"><span>&amp;</span>quot;</span>;
<span id="line3452"></span> echo <span class="entity"><span>&amp;</span>quot;</span><span class="entity"><span>&amp;</span>lt;</span>/form<span class="entity"><span>&amp;</span>gt;</span><span class="entity"><span>&amp;</span>quot;</span>;
<span id="line3453"></span> break;
<span id="line3454"></span>
<span id="line3455"></span> //- Delete trigger (=trigger_delete)
<span id="line3456"></span> case <span class="entity"><span>&amp;</span>quot;</span>trigger_delete<span class="entity"><span>&amp;</span>quot;</span>:
<span id="line3457"></span> echo $params-<span class="entity"><span>&amp;</span>gt;</span>getForm(array('action' =<span class="entity"><span>&amp;</span>gt;</span> 'trigger_delete', 'pk' =<span class="entity"><span>&amp;</span>gt;</span> $_GET['pk'], 'confirm' =<span class="entity"><span>&amp;</span>gt;</span> '1'));
<span id="line3458"></span> echo <span class="entity"><span>&amp;</span>quot;</span><span class="entity"><span>&amp;</span>lt;</span>div class='confirm'<span class="entity"><span>&amp;</span>gt;</span><span class="entity"><span>&amp;</span>quot;</span>;
<span id="line3459"></span> echo sprintf($lang['ques_del_trigger'], htmlencode($_GET['pk'])) . <span class="entity"><span>&amp;</span>quot;</span><span class="entity"><span>&amp;</span>lt;</span>br/<span class="entity"><span>&amp;</span>gt;</span><span class="entity"><span>&amp;</span>lt;</span>br/<span class="entity"><span>&amp;</span>gt;</span><span class="entity"><span>&amp;</span>quot;</span>;
<span id="line3460"></span> echo <span class="entity"><span>&amp;</span>quot;</span><span class="entity"><span>&amp;</span>lt;</span>input type='submit' value='<span class="entity"><span>&amp;</span>quot;</span> . $lang['confirm'] . <span class="entity"><span>&amp;</span>quot;</span>' class='btn'/<span class="entity"><span>&amp;</span>gt;</span> <span class="entity"><span>&amp;</span>quot;</span>;
<span id="line3461"></span> echo $params-<span class="entity"><span>&amp;</span>gt;</span>getLink(array('action' =<span class="entity"><span>&amp;</span>gt;</span> 'column_view'), $lang['cancel']);
<span id="line3462"></span> echo <span class="entity"><span>&amp;</span>quot;</span><span class="entity"><span>&amp;</span>lt;</span>/div<span class="entity"><span>&amp;</span>gt;</span><span class="entity"><span>&amp;</span>quot;</span>;
<span id="line3463"></span> echo <span class="entity"><span>&amp;</span>quot;</span><span class="entity"><span>&amp;</span>lt;</span>/form<span class="entity"><span>&amp;</span>gt;</span><span class="entity"><span>&amp;</span>quot;</span>;
<span id="line3464"></span> break;
<span id="line3465"></span>
<span id="line3466"></span> //- Create trigger (=trigger_create)
<span id="line3467"></span> case <span class="entity"><span>&amp;</span>quot;</span>trigger_create<span class="entity"><span>&amp;</span>quot;</span>:
<span id="line3468"></span> echo <span class="entity"><span>&amp;</span>quot;</span><span class="entity"><span>&amp;</span>lt;</span>h2<span class="entity"><span>&amp;</span>gt;</span><span class="entity"><span>&amp;</span>quot;</span> . $lang['create_trigger'] . <span class="entity"><span>&amp;</span>quot;</span> '<span class="entity"><span>&amp;</span>quot;</span> . htmlencode($_GET['table']) . <span class="entity"><span>&amp;</span>quot;</span>'<span class="entity"><span>&amp;</span>lt;</span>/h2<span class="entity"><span>&amp;</span>gt;</span><span class="entity"><span>&amp;</span>quot;</span>;
<span id="line3469"></span> if ($_GET['table'] == <span class="entity"><span>&amp;</span>quot;</span><span class="entity"><span>&amp;</span>quot;</span>)
<span id="line3470"></span> echo $lang['specify_tbl'];
<span id="line3471"></span> else {
<span id="line3472"></span> echo $params-<span class="entity"><span>&amp;</span>gt;</span>getForm(array('action' =<span class="entity"><span>&amp;</span>gt;</span> 'trigger_create', 'confirm' =<span class="entity"><span>&amp;</span>gt;</span> '1'));
<span id="line3473"></span> echo $lang['trigger_name'] . <span class="entity"><span>&amp;</span>quot;</span>: <span class="entity"><span>&amp;</span>lt;</span>input type='text' name='trigger_name'/<span class="entity"><span>&amp;</span>gt;</span><span class="entity"><span>&amp;</span>lt;</span>br/<span class="entity"><span>&amp;</span>gt;</span><span class="entity"><span>&amp;</span>lt;</span>br/<span class="entity"><span>&amp;</span>gt;</span><span class="entity"><span>&amp;</span>quot;</span>;
<span id="line3474"></span> echo <span class="entity"><span>&amp;</span>quot;</span><span class="entity"><span>&amp;</span>lt;</span>fieldset<span class="entity"><span>&amp;</span>gt;</span><span class="entity"><span>&amp;</span>lt;</span>legend<span class="entity"><span>&amp;</span>gt;</span><span class="entity"><span>&amp;</span>quot;</span> . $lang['db_event'] . <span class="entity"><span>&amp;</span>quot;</span><span class="entity"><span>&amp;</span>lt;</span>/legend<span class="entity"><span>&amp;</span>gt;</span><span class="entity"><span>&amp;</span>quot;</span>;
<span id="line3475"></span> echo $lang['before'] . <span class="entity"><span>&amp;</span>quot;</span>/<span class="entity"><span>&amp;</span>quot;</span> . $lang['after'] . <span class="entity"><span>&amp;</span>quot;</span>: <span class="entity"><span>&amp;</span>quot;</span>;
<span id="line3476"></span> echo <span class="entity"><span>&amp;</span>quot;</span><span class="entity"><span>&amp;</span>lt;</span>select name='beforeafter'<span class="entity"><span>&amp;</span>gt;</span><span class="entity"><span>&amp;</span>quot;</span>;
<span id="line3477"></span> echo <span class="entity"><span>&amp;</span>quot;</span><span class="entity"><span>&amp;</span>lt;</span>option value=''<span class="entity"><span>&amp;</span>gt;</span><span class="entity"><span>&amp;</span>lt;</span>/option<span class="entity"><span>&amp;</span>gt;</span><span class="entity"><span>&amp;</span>quot;</span>;
<span id="line3478"></span> echo <span class="entity"><span>&amp;</span>quot;</span><span class="entity"><span>&amp;</span>lt;</span>option value='BEFORE'<span class="entity"><span>&amp;</span>gt;</span><span class="entity"><span>&amp;</span>quot;</span> . $lang['before'] . <span class="entity"><span>&amp;</span>quot;</span><span class="entity"><span>&amp;</span>lt;</span>/option<span class="entity"><span>&amp;</span>gt;</span><span class="entity"><span>&amp;</span>quot;</span>;
<span id="line3479"></span> echo <span class="entity"><span>&amp;</span>quot;</span><span class="entity"><span>&amp;</span>lt;</span>option value='AFTER'<span class="entity"><span>&amp;</span>gt;</span><span class="entity"><span>&amp;</span>quot;</span> . $lang['after'] . <span class="entity"><span>&amp;</span>quot;</span><span class="entity"><span>&amp;</span>lt;</span>/option<span class="entity"><span>&amp;</span>gt;</span><span class="entity"><span>&amp;</span>quot;</span>;
<span id="line3480"></span> echo <span class="entity"><span>&amp;</span>quot;</span><span class="entity"><span>&amp;</span>lt;</span>option value='INSTEAD OF'<span class="entity"><span>&amp;</span>gt;</span><span class="entity"><span>&amp;</span>quot;</span> . $lang['instead'] . <span class="entity"><span>&amp;</span>quot;</span><span class="entity"><span>&amp;</span>lt;</span>/option<span class="entity"><span>&amp;</span>gt;</span><span class="entity"><span>&amp;</span>quot;</span>;
<span id="line3481"></span> echo <span class="entity"><span>&amp;</span>quot;</span><span class="entity"><span>&amp;</span>lt;</span>/select<span class="entity"><span>&amp;</span>gt;</span><span class="entity"><span>&amp;</span>quot;</span>;
<span id="line3482"></span> echo <span class="entity"><span>&amp;</span>quot;</span><span class="entity"><span>&amp;</span>lt;</span>br/<span class="entity"><span>&amp;</span>gt;</span><span class="entity"><span>&amp;</span>lt;</span>br/<span class="entity"><span>&amp;</span>gt;</span><span class="entity"><span>&amp;</span>quot;</span>;
<span id="line3483"></span> echo $lang['event'] . <span class="entity"><span>&amp;</span>quot;</span>: <span class="entity"><span>&amp;</span>quot;</span>;
<span id="line3484"></span> echo <span class="entity"><span>&amp;</span>quot;</span><span class="entity"><span>&amp;</span>lt;</span>select name='event'<span class="entity"><span>&amp;</span>gt;</span><span class="entity"><span>&amp;</span>quot;</span>;
<span id="line3485"></span> echo <span class="entity"><span>&amp;</span>quot;</span><span class="entity"><span>&amp;</span>lt;</span>option value='DELETE'<span class="entity"><span>&amp;</span>gt;</span><span class="entity"><span>&amp;</span>quot;</span> . $lang['del'] . <span class="entity"><span>&amp;</span>quot;</span><span class="entity"><span>&amp;</span>lt;</span>/option<span class="entity"><span>&amp;</span>gt;</span><span class="entity"><span>&amp;</span>quot;</span>;
<span id="line3486"></span> echo <span class="entity"><span>&amp;</span>quot;</span><span class="entity"><span>&amp;</span>lt;</span>option value='INSERT'<span class="entity"><span>&amp;</span>gt;</span><span class="entity"><span>&amp;</span>quot;</span> . $lang['insert'] . <span class="entity"><span>&amp;</span>quot;</span><span class="entity"><span>&amp;</span>lt;</span>/option<span class="entity"><span>&amp;</span>gt;</span><span class="entity"><span>&amp;</span>quot;</span>;
<span id="line3487"></span> echo <span class="entity"><span>&amp;</span>quot;</span><span class="entity"><span>&amp;</span>lt;</span>option value='UPDATE'<span class="entity"><span>&amp;</span>gt;</span><span class="entity"><span>&amp;</span>quot;</span> . $lang['update'] . <span class="entity"><span>&amp;</span>quot;</span><span class="entity"><span>&amp;</span>lt;</span>/option<span class="entity"><span>&amp;</span>gt;</span><span class="entity"><span>&amp;</span>quot;</span>;
<span id="line3488"></span> echo <span class="entity"><span>&amp;</span>quot;</span><span class="entity"><span>&amp;</span>lt;</span>/select<span class="entity"><span>&amp;</span>gt;</span><span class="entity"><span>&amp;</span>quot;</span>;
<span id="line3489"></span> echo <span class="entity"><span>&amp;</span>quot;</span><span class="entity"><span>&amp;</span>lt;</span>/fieldset<span class="entity"><span>&amp;</span>gt;</span><span class="entity"><span>&amp;</span>lt;</span>br/<span class="entity"><span>&amp;</span>gt;</span><span class="entity"><span>&amp;</span>lt;</span>br/<span class="entity"><span>&amp;</span>gt;</span><span class="entity"><span>&amp;</span>quot;</span>;
<span id="line3490"></span> echo <span class="entity"><span>&amp;</span>quot;</span><span class="entity"><span>&amp;</span>lt;</span>fieldset<span class="entity"><span>&amp;</span>gt;</span><span class="entity"><span>&amp;</span>lt;</span>legend<span class="entity"><span>&amp;</span>gt;</span><span class="entity"><span>&amp;</span>quot;</span> . $lang['trigger_act'] . <span class="entity"><span>&amp;</span>quot;</span><span class="entity"><span>&amp;</span>lt;</span>/legend<span class="entity"><span>&amp;</span>gt;</span><span class="entity"><span>&amp;</span>quot;</span>;
<span id="line3491"></span> echo <span class="entity"><span>&amp;</span>quot;</span><span class="entity"><span>&amp;</span>lt;</span>label<span class="entity"><span>&amp;</span>gt;</span><span class="entity"><span>&amp;</span>lt;</span>input type='checkbox' name='foreachrow'/<span class="entity"><span>&amp;</span>gt;</span> <span class="entity"><span>&amp;</span>quot;</span> . $lang['each_row'] . <span class="entity"><span>&amp;</span>quot;</span><span class="entity"><span>&amp;</span>lt;</span>/label<span class="entity"><span>&amp;</span>gt;</span><span class="entity"><span>&amp;</span>lt;</span>br/<span class="entity"><span>&amp;</span>gt;</span><span class="entity"><span>&amp;</span>lt;</span>br/<span class="entity"><span>&amp;</span>gt;</span><span class="entity"><span>&amp;</span>quot;</span>;
<span id="line3492"></span> echo $lang['when_exp'] . <span class="entity"><span>&amp;</span>quot;</span>:<span class="entity"><span>&amp;</span>lt;</span>br/<span class="entity"><span>&amp;</span>gt;</span><span class="entity"><span>&amp;</span>quot;</span>;
<span id="line3493"></span> echo <span class="entity"><span>&amp;</span>quot;</span><span class="entity"><span>&amp;</span>lt;</span>textarea name='whenexpression' style='width:500px; height:100px;' rows='8' cols='50'<span class="entity"><span>&amp;</span>gt;</span><span class="entity"><span>&amp;</span>lt;</span>/textarea<span class="entity"><span>&amp;</span>gt;</span><span class="entity"><span>&amp;</span>quot;</span>;
<span id="line3494"></span> echo <span class="entity"><span>&amp;</span>quot;</span><span class="entity"><span>&amp;</span>lt;</span>br/<span class="entity"><span>&amp;</span>gt;</span><span class="entity"><span>&amp;</span>lt;</span>br/<span class="entity"><span>&amp;</span>gt;</span><span class="entity"><span>&amp;</span>quot;</span>;
<span id="line3495"></span> echo $lang['trigger_step'] . <span class="entity"><span>&amp;</span>quot;</span>:<span class="entity"><span>&amp;</span>lt;</span>br/<span class="entity"><span>&amp;</span>gt;</span><span class="entity"><span>&amp;</span>quot;</span>;
<span id="line3496"></span> echo <span class="entity"><span>&amp;</span>quot;</span><span class="entity"><span>&amp;</span>lt;</span>textarea name='triggersteps' style='width:500px; height:100px;' rows='8' cols='50'<span class="entity"><span>&amp;</span>gt;</span><span class="entity"><span>&amp;</span>lt;</span>/textarea<span class="entity"><span>&amp;</span>gt;</span><span class="entity"><span>&amp;</span>quot;</span>;
<span id="line3497"></span> echo <span class="entity"><span>&amp;</span>quot;</span><span class="entity"><span>&amp;</span>lt;</span>/fieldset<span class="entity"><span>&amp;</span>gt;</span><span class="entity"><span>&amp;</span>lt;</span>br/<span class="entity"><span>&amp;</span>gt;</span><span class="entity"><span>&amp;</span>lt;</span>br/<span class="entity"><span>&amp;</span>gt;</span><span class="entity"><span>&amp;</span>quot;</span>;
<span id="line3498"></span> echo <span class="entity"><span>&amp;</span>quot;</span><span class="entity"><span>&amp;</span>lt;</span>input type='submit' value='<span class="entity"><span>&amp;</span>quot;</span> . $lang['create_trigger2'] . <span class="entity"><span>&amp;</span>quot;</span>' class='btn'/<span class="entity"><span>&amp;</span>gt;</span> <span class="entity"><span>&amp;</span>quot;</span>;
<span id="line3499"></span> echo $params-<span class="entity"><span>&amp;</span>gt;</span>getLink(array('action' =<span class="entity"><span>&amp;</span>gt;</span> 'column_view'), $lang['cancel']);
<span id="line3500"></span> echo <span class="entity"><span>&amp;</span>quot;</span><span class="entity"><span>&amp;</span>lt;</span>/form<span class="entity"><span>&amp;</span>gt;</span><span class="entity"><span>&amp;</span>quot;</span>;
<span id="line3501"></span> }
<span id="line3502"></span> break;
<span id="line3503"></span>
<span id="line3504"></span> //- Create index (=index_create)
<span id="line3505"></span> case <span class="entity"><span>&amp;</span>quot;</span>index_create<span class="entity"><span>&amp;</span>quot;</span>:
<span id="line3506"></span> echo <span class="entity"><span>&amp;</span>quot;</span><span class="entity"><span>&amp;</span>lt;</span>h2<span class="entity"><span>&amp;</span>gt;</span><span class="entity"><span>&amp;</span>quot;</span> . $lang['create_index'] . <span class="entity"><span>&amp;</span>quot;</span> '<span class="entity"><span>&amp;</span>quot;</span> . htmlencode($_GET['table']) . <span class="entity"><span>&amp;</span>quot;</span>'<span class="entity"><span>&amp;</span>lt;</span>/h2<span class="entity"><span>&amp;</span>gt;</span><span class="entity"><span>&amp;</span>quot;</span>;
<span id="line3507"></span> if ($_GET['numcolumns'] == <span class="entity"><span>&amp;</span>quot;</span><span class="entity"><span>&amp;</span>quot;</span> || intval($_GET['numcolumns']) <span class="entity"><span>&amp;</span>lt;</span>= 0)
<span id="line3508"></span> echo $lang['specify_fields'];
<span id="line3509"></span> else if ($_GET['table'] == <span class="entity"><span>&amp;</span>quot;</span><span class="entity"><span>&amp;</span>quot;</span>)
<span id="line3510"></span> echo $lang['specify_tbl'];
<span id="line3511"></span> else {
<span id="line3512"></span> echo $params-<span class="entity"><span>&amp;</span>gt;</span>getForm(array('action' =<span class="entity"><span>&amp;</span>gt;</span> 'index_create', 'confirm' =<span class="entity"><span>&amp;</span>gt;</span> '1'));
<span id="line3513"></span> $num = intval($_GET['numcolumns']);
<span id="line3514"></span> $tableInfo = $db-<span class="entity"><span>&amp;</span>gt;</span>getTableInfo($_GET['table']);
<span id="line3515"></span> echo <span class="entity"><span>&amp;</span>quot;</span><span class="entity"><span>&amp;</span>lt;</span>fieldset<span class="entity"><span>&amp;</span>gt;</span><span class="entity"><span>&amp;</span>lt;</span>legend<span class="entity"><span>&amp;</span>gt;</span><span class="entity"><span>&amp;</span>quot;</span> . $lang['define_index'] . <span class="entity"><span>&amp;</span>quot;</span><span class="entity"><span>&amp;</span>lt;</span>/legend<span class="entity"><span>&amp;</span>gt;</span><span class="entity"><span>&amp;</span>quot;</span>;
<span id="line3516"></span> echo <span class="entity"><span>&amp;</span>quot;</span><span class="entity"><span>&amp;</span>lt;</span>label for='index_name'<span class="entity"><span>&amp;</span>gt;</span><span class="entity"><span>&amp;</span>quot;</span> . $lang['index_name'] . <span class="entity"><span>&amp;</span>quot;</span>:<span class="entity"><span>&amp;</span>lt;</span>/label<span class="entity"><span>&amp;</span>gt;</span> <span class="entity"><span>&amp;</span>lt;</span>input type='text' name='name' id='index_name'/<span class="entity"><span>&amp;</span>gt;</span><span class="entity"><span>&amp;</span>lt;</span>br/<span class="entity"><span>&amp;</span>gt;</span><span class="entity"><span>&amp;</span>quot;</span>;
<span id="line3517"></span> echo <span class="entity"><span>&amp;</span>quot;</span><span class="entity"><span>&amp;</span>lt;</span>label for='index_duplicate'<span class="entity"><span>&amp;</span>gt;</span><span class="entity"><span>&amp;</span>quot;</span> . $lang['dup_val'] . <span class="entity"><span>&amp;</span>quot;</span>:<span class="entity"><span>&amp;</span>lt;</span>/label<span class="entity"><span>&amp;</span>gt;</span><span class="entity"><span>&amp;</span>quot;</span>;
<span id="line3518"></span> echo <span class="entity"><span>&amp;</span>quot;</span><span class="entity"><span>&amp;</span>lt;</span>select name='duplicate' id='index_duplicate'<span class="entity"><span>&amp;</span>gt;</span><span class="entity"><span>&amp;</span>quot;</span>;
<span id="line3519"></span> echo <span class="entity"><span>&amp;</span>quot;</span><span class="entity"><span>&amp;</span>lt;</span>option value='yes'<span class="entity"><span>&amp;</span>gt;</span><span class="entity"><span>&amp;</span>quot;</span> . $lang['allow'] . <span class="entity"><span>&amp;</span>quot;</span><span class="entity"><span>&amp;</span>lt;</span>/option<span class="entity"><span>&amp;</span>gt;</span><span class="entity"><span>&amp;</span>quot;</span>;
<span id="line3520"></span> echo <span class="entity"><span>&amp;</span>quot;</span><span class="entity"><span>&amp;</span>lt;</span>option value='no'<span class="entity"><span>&amp;</span>gt;</span><span class="entity"><span>&amp;</span>quot;</span> . $lang['not_allow'] . <span class="entity"><span>&amp;</span>quot;</span><span class="entity"><span>&amp;</span>lt;</span>/option<span class="entity"><span>&amp;</span>gt;</span><span class="entity"><span>&amp;</span>quot;</span>;
<span id="line3521"></span> echo <span class="entity"><span>&amp;</span>quot;</span><span class="entity"><span>&amp;</span>lt;</span>/select<span class="entity"><span>&amp;</span>gt;</span><span class="entity"><span>&amp;</span>lt;</span>br/<span class="entity"><span>&amp;</span>gt;</span><span class="entity"><span>&amp;</span>quot;</span>;
<span id="line3522"></span> if (version_compare($db-<span class="entity"><span>&amp;</span>gt;</span>getSQLiteVersion(), '3.8.0') <span class="entity"><span>&amp;</span>gt;</span>= 0)
<span id="line3523"></span> echo <span class="entity"><span>&amp;</span>quot;</span><span class="entity"><span>&amp;</span>lt;</span>label for='index_where'<span class="entity"><span>&amp;</span>gt;</span>WHERE:<span class="entity"><span>&amp;</span>lt;</span>/label<span class="entity"><span>&amp;</span>gt;</span> <span class="entity"><span>&amp;</span>lt;</span>input type='text' name='where' id='index_where'/<span class="entity"><span>&amp;</span>gt;</span> <span class="entity"><span>&amp;</span>quot;</span> . helpLink($lang['help10']);
<span id="line3524"></span> echo <span class="entity"><span>&amp;</span>quot;</span><span class="entity"><span>&amp;</span>lt;</span>/fieldset<span class="entity"><span>&amp;</span>gt;</span><span class="entity"><span>&amp;</span>quot;</span>;
<span id="line3525"></span> echo <span class="entity"><span>&amp;</span>quot;</span><span class="entity"><span>&amp;</span>lt;</span>br/<span class="entity"><span>&amp;</span>gt;</span><span class="entity"><span>&amp;</span>quot;</span>;
<span id="line3526"></span> echo <span class="entity"><span>&amp;</span>quot;</span><span class="entity"><span>&amp;</span>lt;</span>fieldset<span class="entity"><span>&amp;</span>gt;</span><span class="entity"><span>&amp;</span>lt;</span>legend<span class="entity"><span>&amp;</span>gt;</span><span class="entity"><span>&amp;</span>quot;</span> . $lang['define_in_col'] . <span class="entity"><span>&amp;</span>quot;</span><span class="entity"><span>&amp;</span>lt;</span>/legend<span class="entity"><span>&amp;</span>gt;</span><span class="entity"><span>&amp;</span>quot;</span>;
<span id="line3527"></span> for ($i = 0; $i <span class="entity"><span>&amp;</span>lt;</span> $num; $i++) {
<span id="line3528"></span> echo <span class="entity"><span>&amp;</span>quot;</span><span class="entity"><span>&amp;</span>lt;</span>select name='<span class="entity"><span>&amp;</span>quot;</span> . $i . <span class="entity"><span>&amp;</span>quot;</span>_field'<span class="entity"><span>&amp;</span>gt;</span><span class="entity"><span>&amp;</span>quot;</span>;
<span id="line3529"></span> echo <span class="entity"><span>&amp;</span>quot;</span><span class="entity"><span>&amp;</span>lt;</span>option value=''<span class="entity"><span>&amp;</span>gt;</span>--<span class="entity"><span>&amp;</span>quot;</span> . $lang['ignore'] . <span class="entity"><span>&amp;</span>quot;</span>--<span class="entity"><span>&amp;</span>lt;</span>/option<span class="entity"><span>&amp;</span>gt;</span><span class="entity"><span>&amp;</span>quot;</span>;
<span id="line3530"></span> for ($j = 0; $j <span class="entity"><span>&amp;</span>lt;</span> sizeof($tableInfo); $j++)
<span id="line3531"></span> echo <span class="entity"><span>&amp;</span>quot;</span><span class="entity"><span>&amp;</span>lt;</span>option value='<span class="entity"><span>&amp;</span>quot;</span> . htmlencode($tableInfo[$j][1]) . <span class="entity"><span>&amp;</span>quot;</span>'<span class="entity"><span>&amp;</span>gt;</span><span class="entity"><span>&amp;</span>quot;</span> . htmlencode($tableInfo[$j][1]) . <span class="entity"><span>&amp;</span>quot;</span><span class="entity"><span>&amp;</span>lt;</span>/option<span class="entity"><span>&amp;</span>gt;</span><span class="entity"><span>&amp;</span>quot;</span>;
<span id="line3532"></span> echo <span class="entity"><span>&amp;</span>quot;</span><span class="entity"><span>&amp;</span>lt;</span>/select<span class="entity"><span>&amp;</span>gt;</span> <span class="entity"><span>&amp;</span>quot;</span>;
<span id="line3533"></span> echo <span class="entity"><span>&amp;</span>quot;</span><span class="entity"><span>&amp;</span>lt;</span>select name='<span class="entity"><span>&amp;</span>quot;</span> . $i . <span class="entity"><span>&amp;</span>quot;</span>_order'<span class="entity"><span>&amp;</span>gt;</span><span class="entity"><span>&amp;</span>quot;</span>;
<span id="line3534"></span> echo <span class="entity"><span>&amp;</span>quot;</span><span class="entity"><span>&amp;</span>lt;</span>option value=''<span class="entity"><span>&amp;</span>gt;</span><span class="entity"><span>&amp;</span>lt;</span>/option<span class="entity"><span>&amp;</span>gt;</span><span class="entity"><span>&amp;</span>quot;</span>;
<span id="line3535"></span> echo <span class="entity"><span>&amp;</span>quot;</span><span class="entity"><span>&amp;</span>lt;</span>option value=' ASC'<span class="entity"><span>&amp;</span>gt;</span><span class="entity"><span>&amp;</span>quot;</span> . $lang['asc'] . <span class="entity"><span>&amp;</span>quot;</span><span class="entity"><span>&amp;</span>lt;</span>/option<span class="entity"><span>&amp;</span>gt;</span><span class="entity"><span>&amp;</span>quot;</span>;
<span id="line3536"></span> echo <span class="entity"><span>&amp;</span>quot;</span><span class="entity"><span>&amp;</span>lt;</span>option value=' DESC'<span class="entity"><span>&amp;</span>gt;</span><span class="entity"><span>&amp;</span>quot;</span> . $lang['desc'] . <span class="entity"><span>&amp;</span>quot;</span><span class="entity"><span>&amp;</span>lt;</span>/option<span class="entity"><span>&amp;</span>gt;</span><span class="entity"><span>&amp;</span>quot;</span>;
<span id="line3537"></span> echo <span class="entity"><span>&amp;</span>quot;</span><span class="entity"><span>&amp;</span>lt;</span>/select<span class="entity"><span>&amp;</span>gt;</span><span class="entity"><span>&amp;</span>lt;</span>br/<span class="entity"><span>&amp;</span>gt;</span><span class="entity"><span>&amp;</span>quot;</span>;
<span id="line3538"></span> }
<span id="line3539"></span> echo <span class="entity"><span>&amp;</span>quot;</span><span class="entity"><span>&amp;</span>lt;</span>/fieldset<span class="entity"><span>&amp;</span>gt;</span><span class="entity"><span>&amp;</span>quot;</span>;
<span id="line3540"></span> echo <span class="entity"><span>&amp;</span>quot;</span><span class="entity"><span>&amp;</span>lt;</span>br/<span class="entity"><span>&amp;</span>gt;</span><span class="entity"><span>&amp;</span>lt;</span>br/<span class="entity"><span>&amp;</span>gt;</span><span class="entity"><span>&amp;</span>quot;</span>;
<span id="line3541"></span> echo <span class="entity"><span>&amp;</span>quot;</span><span class="entity"><span>&amp;</span>lt;</span>input type='hidden' name='num' value='<span class="entity"><span>&amp;</span>quot;</span> . $num . <span class="entity"><span>&amp;</span>quot;</span>'/<span class="entity"><span>&amp;</span>gt;</span><span class="entity"><span>&amp;</span>quot;</span>;
<span id="line3542"></span> echo <span class="entity"><span>&amp;</span>quot;</span><span class="entity"><span>&amp;</span>lt;</span>input type='submit' value='<span class="entity"><span>&amp;</span>quot;</span> . $lang['create_index1'] . <span class="entity"><span>&amp;</span>quot;</span>' class='btn'/<span class="entity"><span>&amp;</span>gt;</span> <span class="entity"><span>&amp;</span>quot;</span>;
<span id="line3543"></span> echo $params-<span class="entity"><span>&amp;</span>gt;</span>getLink(array('action' =<span class="entity"><span>&amp;</span>gt;</span> 'column_view'), $lang['cancel']);
<span id="line3544"></span> echo <span class="entity"><span>&amp;</span>quot;</span><span class="entity"><span>&amp;</span>lt;</span>/form<span class="entity"><span>&amp;</span>gt;</span><span class="entity"><span>&amp;</span>quot;</span>;
<span id="line3545"></span> }
<span id="line3546"></span> break;
<span id="line3547"></span> }
<span id="line3548"></span> echo <span class="entity"><span>&amp;</span>quot;</span><span class="entity"><span>&amp;</span>lt;</span>/div<span class="entity"><span>&amp;</span>gt;</span><span class="entity"><span>&amp;</span>quot;</span>;
<span id="line3549"></span>}
<span id="line3550"></span>
<span id="line3551"></span>//- HMTL: views for databases
<span id="line3552"></span>if (!$target_table <span class="entity"><span>&amp;</span>amp;</span><span class="entity"><span>&amp;</span>amp;</span> !isset($_GET['confirm']) <span class="entity"><span>&amp;</span>amp;</span><span class="entity"><span>&amp;</span>amp;</span> (!isset($_GET['action']) || (isset($_GET['action']) <span class="entity"><span>&amp;</span>amp;</span><span class="entity"><span>&amp;</span>amp;</span> $_GET['action'] != <span class="entity"><span>&amp;</span>quot;</span>table_create<span class="entity"><span>&amp;</span>quot;</span>))) //the absence of these fields means we are viewing the database homepage
<span id="line3553"></span>{
<span id="line3554"></span> //- Switch on $view (actually a series of if-else)
<span id="line3555"></span>
<span id="line3556"></span> if ($view == <span class="entity"><span>&amp;</span>quot;</span>structure<span class="entity"><span>&amp;</span>quot;</span>) {
<span id="line3557"></span> //- Database structure, shows all the tables (=structure)
<span id="line3558"></span>
<span id="line3559"></span> if ($db-<span class="entity"><span>&amp;</span>gt;</span>isWritable() <span class="entity"><span>&amp;</span>amp;</span><span class="entity"><span>&amp;</span>amp;</span> !$db-<span class="entity"><span>&amp;</span>gt;</span>isDirWritable()) {
<span id="line3560"></span> echo <span class="entity"><span>&amp;</span>quot;</span><span class="entity"><span>&amp;</span>lt;</span>div class='confirm' style='margin:10px 0'<span class="entity"><span>&amp;</span>gt;</span><span class="entity"><span>&amp;</span>quot;</span>;
<span id="line3561"></span> echo $lang['attention'] . ': ' . $lang['directory_not_writable'];
<span id="line3562"></span> echo <span class="entity"><span>&amp;</span>quot;</span><span class="entity"><span>&amp;</span>lt;</span>/div<span class="entity"><span>&amp;</span>gt;</span><span class="entity"><span>&amp;</span>lt;</span>br/<span class="entity"><span>&amp;</span>gt;</span><span class="entity"><span>&amp;</span>quot;</span>;
<span id="line3563"></span> } elseif (!$db-<span class="entity"><span>&amp;</span>gt;</span>isWritable()) {
<span id="line3564"></span> echo <span class="entity"><span>&amp;</span>quot;</span><span class="entity"><span>&amp;</span>lt;</span>div class='confirm' style='margin:10px 0;'<span class="entity"><span>&amp;</span>gt;</span><span class="entity"><span>&amp;</span>quot;</span>;
<span id="line3565"></span> echo $lang['attention'] . ': ' . $lang['database_not_writable'];
<span id="line3566"></span> echo <span class="entity"><span>&amp;</span>quot;</span><span class="entity"><span>&amp;</span>lt;</span>/div<span class="entity"><span>&amp;</span>gt;</span><span class="entity"><span>&amp;</span>lt;</span>br/<span class="entity"><span>&amp;</span>gt;</span><span class="entity"><span>&amp;</span>quot;</span>;
<span id="line3567"></span> }
<span id="line3568"></span>
<span id="line3569"></span> if ($auth-<span class="entity"><span>&amp;</span>gt;</span>isPasswordDefault()) {
<span id="line3570"></span> echo <span class="entity"><span>&amp;</span>quot;</span><span class="entity"><span>&amp;</span>lt;</span>div class='confirm' style='margin:20px 0px;'<span class="entity"><span>&amp;</span>gt;</span><span class="entity"><span>&amp;</span>quot;</span>;
<span id="line3571"></span> echo sprintf($lang['warn_passwd'], (is_readable('phpliteadmin.config.php') ? 'phpliteadmin.config.php' : basename(__FILE__))) . <span class="entity"><span>&amp;</span>quot;</span><span class="entity"><span>&amp;</span>lt;</span>br /<span class="entity"><span>&amp;</span>gt;</span><span class="entity"><span>&amp;</span>quot;</span> . $lang['warn0'];
<span id="line3572"></span> echo <span class="entity"><span>&amp;</span>quot;</span><span class="entity"><span>&amp;</span>lt;</span>/div<span class="entity"><span>&amp;</span>gt;</span><span class="entity"><span>&amp;</span>quot;</span>;
<span id="line3573"></span> }
<span id="line3574"></span>
<span id="line3575"></span> echo <span class="entity"><span>&amp;</span>quot;</span><span class="entity"><span>&amp;</span>lt;</span>b<span class="entity"><span>&amp;</span>gt;</span><span class="entity"><span>&amp;</span>quot;</span> . $lang['db_name'] . <span class="entity"><span>&amp;</span>quot;</span><span class="entity"><span>&amp;</span>lt;</span>/b<span class="entity"><span>&amp;</span>gt;</span>: <span class="entity"><span>&amp;</span>quot;</span> . htmlencode($db-<span class="entity"><span>&amp;</span>gt;</span>getName()) . <span class="entity"><span>&amp;</span>quot;</span><span class="entity"><span>&amp;</span>lt;</span>br/<span class="entity"><span>&amp;</span>gt;</span><span class="entity"><span>&amp;</span>quot;</span>;
<span id="line3576"></span> echo <span class="entity"><span>&amp;</span>quot;</span><span class="entity"><span>&amp;</span>lt;</span>b<span class="entity"><span>&amp;</span>gt;</span><span class="entity"><span>&amp;</span>quot;</span> . $lang['db_path'] . <span class="entity"><span>&amp;</span>quot;</span><span class="entity"><span>&amp;</span>lt;</span>/b<span class="entity"><span>&amp;</span>gt;</span>: <span class="entity"><span>&amp;</span>quot;</span> . htmlencode($db-<span class="entity"><span>&amp;</span>gt;</span>getPath()) . <span class="entity"><span>&amp;</span>quot;</span><span class="entity"><span>&amp;</span>lt;</span>br/<span class="entity"><span>&amp;</span>gt;</span><span class="entity"><span>&amp;</span>quot;</span>;
<span id="line3577"></span> echo <span class="entity"><span>&amp;</span>quot;</span><span class="entity"><span>&amp;</span>lt;</span>b<span class="entity"><span>&amp;</span>gt;</span><span class="entity"><span>&amp;</span>quot;</span> . $lang['db_size'] . <span class="entity"><span>&amp;</span>quot;</span><span class="entity"><span>&amp;</span>lt;</span>/b<span class="entity"><span>&amp;</span>gt;</span>: <span class="entity"><span>&amp;</span>quot;</span> . number_format($db-<span class="entity"><span>&amp;</span>gt;</span>getSize()) . <span class="entity"><span>&amp;</span>quot;</span> KiB<span class="entity"><span>&amp;</span>lt;</span>br/<span class="entity"><span>&amp;</span>gt;</span><span class="entity"><span>&amp;</span>quot;</span>;
<span id="line3578"></span> echo <span class="entity"><span>&amp;</span>quot;</span><span class="entity"><span>&amp;</span>lt;</span>b<span class="entity"><span>&amp;</span>gt;</span><span class="entity"><span>&amp;</span>quot;</span> . $lang['db_mod'] . <span class="entity"><span>&amp;</span>quot;</span><span class="entity"><span>&amp;</span>lt;</span>/b<span class="entity"><span>&amp;</span>gt;</span>: <span class="entity"><span>&amp;</span>quot;</span> . $db-<span class="entity"><span>&amp;</span>gt;</span>getDate() . <span class="entity"><span>&amp;</span>quot;</span><span class="entity"><span>&amp;</span>lt;</span>br/<span class="entity"><span>&amp;</span>gt;</span><span class="entity"><span>&amp;</span>quot;</span>;
<span id="line3579"></span> echo <span class="entity"><span>&amp;</span>quot;</span><span class="entity"><span>&amp;</span>lt;</span>b<span class="entity"><span>&amp;</span>gt;</span><span class="entity"><span>&amp;</span>quot;</span> . $lang['sqlite_v'] . <span class="entity"><span>&amp;</span>quot;</span><span class="entity"><span>&amp;</span>lt;</span>/b<span class="entity"><span>&amp;</span>gt;</span>: <span class="entity"><span>&amp;</span>quot;</span> . $db-<span class="entity"><span>&amp;</span>gt;</span>getSQLiteVersion() . <span class="entity"><span>&amp;</span>quot;</span><span class="entity"><span>&amp;</span>lt;</span>br/<span class="entity"><span>&amp;</span>gt;</span><span class="entity"><span>&amp;</span>quot;</span>;
<span id="line3580"></span> echo <span class="entity"><span>&amp;</span>quot;</span><span class="entity"><span>&amp;</span>lt;</span>b<span class="entity"><span>&amp;</span>gt;</span><span class="entity"><span>&amp;</span>quot;</span> . $lang['sqlite_ext'] . <span class="entity"><span>&amp;</span>quot;</span><span class="entity"><span>&amp;</span>lt;</span>/b<span class="entity"><span>&amp;</span>gt;</span> <span class="entity"><span>&amp;</span>quot;</span> . helpLink($lang['help1']) . <span class="entity"><span>&amp;</span>quot;</span>: <span class="entity"><span>&amp;</span>quot;</span> . $db-<span class="entity"><span>&amp;</span>gt;</span>getType() . <span class="entity"><span>&amp;</span>quot;</span><span class="entity"><span>&amp;</span>lt;</span>br/<span class="entity"><span>&amp;</span>gt;</span><span class="entity"><span>&amp;</span>quot;</span>;
<span id="line3581"></span> echo <span class="entity"><span>&amp;</span>quot;</span><span class="entity"><span>&amp;</span>lt;</span>b<span class="entity"><span>&amp;</span>gt;</span><span class="entity"><span>&amp;</span>quot;</span> . $lang['php_v'] . <span class="entity"><span>&amp;</span>quot;</span><span class="entity"><span>&amp;</span>lt;</span>/b<span class="entity"><span>&amp;</span>gt;</span>: <span class="entity"><span>&amp;</span>quot;</span> . phpversion() . <span class="entity"><span>&amp;</span>quot;</span><span class="entity"><span>&amp;</span>lt;</span>br/<span class="entity"><span>&amp;</span>gt;</span><span class="entity"><span>&amp;</span>quot;</span>;
<span id="line3582"></span> echo <span class="entity"><span>&amp;</span>quot;</span><span class="entity"><span>&amp;</span>lt;</span>b<span class="entity"><span>&amp;</span>gt;</span><span class="entity"><span>&amp;</span>quot;</span> . PROJECT . <span class="entity"><span>&amp;</span>quot;</span> <span class="entity"><span>&amp;</span>quot;</span> . $lang[<span class="entity"><span>&amp;</span>quot;</span>ver<span class="entity"><span>&amp;</span>quot;</span>] . <span class="entity"><span>&amp;</span>quot;</span><span class="entity"><span>&amp;</span>lt;</span>/b<span class="entity"><span>&amp;</span>gt;</span>: <span class="entity"><span>&amp;</span>quot;</span> . VERSION;
<span id="line3583"></span> echo <span class="entity"><span>&amp;</span>quot;</span> <span class="entity"><span>&amp;</span>lt;</span>a href='<span class="entity"><span>&amp;</span>quot;</span> . PROJECT_URL . <span class="entity"><span>&amp;</span>quot;</span>' target='_blank' id='oldVersion' style='display: none;' class='warning'<span class="entity"><span>&amp;</span>gt;</span><span class="entity"><span>&amp;</span>quot;</span> . $lang['new_version'] . <span class="entity"><span>&amp;</span>quot;</span><span class="entity"><span>&amp;</span>lt;</span>/a<span class="entity"><span>&amp;</span>gt;</span><span class="entity"><span>&amp;</span>lt;</span>br/<span class="entity"><span>&amp;</span>gt;</span><span class="entity"><span>&amp;</span>lt;</span>br/<span class="entity"><span>&amp;</span>gt;</span><span class="entity"><span>&amp;</span>quot;</span>;
<span id="line3584"></span> echo <span class="entity"><span>&amp;</span>quot;</span><span class="entity"><span>&amp;</span>lt;</span>script type='text/javascript'<span class="entity"><span>&amp;</span>gt;</span>checkVersion('<span class="entity"><span>&amp;</span>quot;</span> . VERSION . <span class="entity"><span>&amp;</span>quot;</span>','<span class="entity"><span>&amp;</span>quot;</span> . VERSION_CHECK_URL . <span class="entity"><span>&amp;</span>quot;</span>');<span class="entity"><span>&amp;</span>lt;</span>/script<span class="entity"><span>&amp;</span>gt;</span><span class="entity"><span>&amp;</span>quot;</span>;
<span id="line3585"></span>
<span id="line3586"></span> if (isset($_GET['sort']) <span class="entity"><span>&amp;</span>amp;</span><span class="entity"><span>&amp;</span>amp;</span> ($_GET['sort'] == 'type' || $_GET['sort'] == 'name'))
<span id="line3587"></span> $_SESSION[COOKIENAME . 'sortTables'] = $_GET['sort'];
<span id="line3588"></span> if (isset($_GET['order']) <span class="entity"><span>&amp;</span>amp;</span><span class="entity"><span>&amp;</span>amp;</span> ($_GET['order'] == 'ASC' || $_GET['order'] == 'DESC'))
<span id="line3589"></span> $_SESSION[COOKIENAME . 'orderTables'] = $_GET['order'];
<span id="line3590"></span>
<span id="line3591"></span> if (!isset($_SESSION[COOKIENAME . 'sortTables']))
<span id="line3592"></span> $_SESSION[COOKIENAME . 'sortTables'] = 'name';
<span id="line3593"></span>
<span id="line3594"></span> if (!isset($_SESSION[COOKIENAME . 'orderTables']))
<span id="line3595"></span> $_SESSION[COOKIENAME . 'orderTables'] = 'ASC';
<span id="line3596"></span>
<span id="line3597"></span> $tables = $db-<span class="entity"><span>&amp;</span>gt;</span>getTables(true, false, $_SESSION[COOKIENAME . 'sortTables'], $_SESSION[COOKIENAME . 'orderTables']);
<span id="line3598"></span>
<span id="line3599"></span> if (sizeof($tables) == 0)
<span id="line3600"></span> echo $lang['no_tbl'] . <span class="entity"><span>&amp;</span>quot;</span><span class="entity"><span>&amp;</span>lt;</span>br/<span class="entity"><span>&amp;</span>gt;</span><span class="entity"><span>&amp;</span>lt;</span>br/<span class="entity"><span>&amp;</span>gt;</span><span class="entity"><span>&amp;</span>quot;</span>;
<span id="line3601"></span> else {
<span id="line3602"></span> echo <span class="entity"><span>&amp;</span>quot;</span><span class="entity"><span>&amp;</span>lt;</span>table border='0' cellpadding='2' cellspacing='1' class='viewTable'<span class="entity"><span>&amp;</span>gt;</span><span class="entity"><span>&amp;</span>quot;</span>;
<span id="line3603"></span> echo <span class="entity"><span>&amp;</span>quot;</span><span class="entity"><span>&amp;</span>lt;</span>tr<span class="entity"><span>&amp;</span>gt;</span><span class="entity"><span>&amp;</span>quot;</span>;
<span id="line3604"></span>
<span id="line3605"></span> echo <span class="entity"><span>&amp;</span>quot;</span><span class="entity"><span>&amp;</span>lt;</span>td class='tdheader'<span class="entity"><span>&amp;</span>gt;</span><span class="entity"><span>&amp;</span>quot;</span>;
<span id="line3606"></span> if (isset($_SESSION[COOKIENAME . 'sortTables']))
<span id="line3607"></span> $orderTag = ($_SESSION[COOKIENAME . 'sortTables'] == <span class="entity"><span>&amp;</span>quot;</span>type<span class="entity"><span>&amp;</span>quot;</span> <span class="entity"><span>&amp;</span>amp;</span><span class="entity"><span>&amp;</span>amp;</span> $_SESSION[COOKIENAME . 'orderTables'] == <span class="entity"><span>&amp;</span>quot;</span>ASC<span class="entity"><span>&amp;</span>quot;</span>) ? <span class="entity"><span>&amp;</span>quot;</span>DESC<span class="entity"><span>&amp;</span>quot;</span> : <span class="entity"><span>&amp;</span>quot;</span>ASC<span class="entity"><span>&amp;</span>quot;</span>;
<span id="line3608"></span> else
<span id="line3609"></span> $orderTag = <span class="entity"><span>&amp;</span>quot;</span>ASC<span class="entity"><span>&amp;</span>quot;</span>;
<span id="line3610"></span> echo $params-<span class="entity"><span>&amp;</span>gt;</span>getLink(array('sort' =<span class="entity"><span>&amp;</span>gt;</span> 'type', 'order' =<span class="entity"><span>&amp;</span>gt;</span> $orderTag), $lang['type']);
<span id="line3611"></span> echo helpLink($lang['help3']);
<span id="line3612"></span> if (isset($_SESSION[COOKIENAME . 'sortTables']) <span class="entity"><span>&amp;</span>amp;</span><span class="entity"><span>&amp;</span>amp;</span> $_SESSION[COOKIENAME . 'sortTables'] == <span class="entity"><span>&amp;</span>quot;</span>type<span class="entity"><span>&amp;</span>quot;</span>)
<span id="line3613"></span> echo(($_SESSION[COOKIENAME . 'orderTables'] == <span class="entity"><span>&amp;</span>quot;</span>ASC<span class="entity"><span>&amp;</span>quot;</span>) ? <span class="entity"><span>&amp;</span>quot;</span> <span class="entity"><span>&amp;</span>lt;</span>b<span class="entity"><span>&amp;</span>gt;</span><span class="entity"><span>&amp;</span>amp;</span>uarr;<span class="entity"><span>&amp;</span>lt;</span>/b<span class="entity"><span>&amp;</span>gt;</span><span class="entity"><span>&amp;</span>quot;</span> : <span class="entity"><span>&amp;</span>quot;</span> <span class="entity"><span>&amp;</span>lt;</span>b<span class="entity"><span>&amp;</span>gt;</span><span class="entity"><span>&amp;</span>amp;</span>darr;<span class="entity"><span>&amp;</span>lt;</span>/b<span class="entity"><span>&amp;</span>gt;</span><span class="entity"><span>&amp;</span>quot;</span>);
<span id="line3614"></span> echo <span class="entity"><span>&amp;</span>quot;</span><span class="entity"><span>&amp;</span>lt;</span>/td<span class="entity"><span>&amp;</span>gt;</span><span class="entity"><span>&amp;</span>quot;</span>;
<span id="line3615"></span>
<span id="line3616"></span> echo <span class="entity"><span>&amp;</span>quot;</span><span class="entity"><span>&amp;</span>lt;</span>td class='tdheader'<span class="entity"><span>&amp;</span>gt;</span><span class="entity"><span>&amp;</span>quot;</span>;
<span id="line3617"></span> if (isset($_SESSION[COOKIENAME . 'sortTables']))
<span id="line3618"></span> $orderTag = ($_SESSION[COOKIENAME . 'sortTables'] == <span class="entity"><span>&amp;</span>quot;</span>name<span class="entity"><span>&amp;</span>quot;</span> <span class="entity"><span>&amp;</span>amp;</span><span class="entity"><span>&amp;</span>amp;</span> $_SESSION[COOKIENAME . 'orderTables'] == <span class="entity"><span>&amp;</span>quot;</span>ASC<span class="entity"><span>&amp;</span>quot;</span>) ? <span class="entity"><span>&amp;</span>quot;</span>DESC<span class="entity"><span>&amp;</span>quot;</span> : <span class="entity"><span>&amp;</span>quot;</span>ASC<span class="entity"><span>&amp;</span>quot;</span>;
<span id="line3619"></span> else
<span id="line3620"></span> $orderTag = <span class="entity"><span>&amp;</span>quot;</span>ASC<span class="entity"><span>&amp;</span>quot;</span>;
<span id="line3621"></span> echo $params-<span class="entity"><span>&amp;</span>gt;</span>getLink(array('sort' =<span class="entity"><span>&amp;</span>gt;</span> 'name', 'order' =<span class="entity"><span>&amp;</span>gt;</span> $orderTag), $lang['name']);
<span id="line3622"></span> if (isset($_SESSION[COOKIENAME . 'sortTables']) <span class="entity"><span>&amp;</span>amp;</span><span class="entity"><span>&amp;</span>amp;</span> $_SESSION[COOKIENAME . 'sortTables'] == <span class="entity"><span>&amp;</span>quot;</span>name<span class="entity"><span>&amp;</span>quot;</span>)
<span id="line3623"></span> echo(($_SESSION[COOKIENAME . 'orderTables'] == <span class="entity"><span>&amp;</span>quot;</span>ASC<span class="entity"><span>&amp;</span>quot;</span>) ? <span class="entity"><span>&amp;</span>quot;</span> <span class="entity"><span>&amp;</span>lt;</span>b<span class="entity"><span>&amp;</span>gt;</span><span class="entity"><span>&amp;</span>amp;</span>uarr;<span class="entity"><span>&amp;</span>lt;</span>/b<span class="entity"><span>&amp;</span>gt;</span><span class="entity"><span>&amp;</span>quot;</span> : <span class="entity"><span>&amp;</span>quot;</span> <span class="entity"><span>&amp;</span>lt;</span>b<span class="entity"><span>&amp;</span>gt;</span><span class="entity"><span>&amp;</span>amp;</span>darr;<span class="entity"><span>&amp;</span>lt;</span>/b<span class="entity"><span>&amp;</span>gt;</span><span class="entity"><span>&amp;</span>quot;</span>);
<span id="line3624"></span> echo <span class="entity"><span>&amp;</span>quot;</span><span class="entity"><span>&amp;</span>lt;</span>/td<span class="entity"><span>&amp;</span>gt;</span><span class="entity"><span>&amp;</span>quot;</span>;
<span id="line3625"></span>
<span id="line3626"></span> echo <span class="entity"><span>&amp;</span>quot;</span><span class="entity"><span>&amp;</span>lt;</span>td class='tdheader' colspan='10'<span class="entity"><span>&amp;</span>gt;</span><span class="entity"><span>&amp;</span>quot;</span> . $lang['act'] . <span class="entity"><span>&amp;</span>quot;</span><span class="entity"><span>&amp;</span>lt;</span>/td<span class="entity"><span>&amp;</span>gt;</span><span class="entity"><span>&amp;</span>quot;</span>;
<span id="line3627"></span> echo <span class="entity"><span>&amp;</span>quot;</span><span class="entity"><span>&amp;</span>lt;</span>td class='tdheader'<span class="entity"><span>&amp;</span>gt;</span><span class="entity"><span>&amp;</span>quot;</span> . $lang['rec'] . <span class="entity"><span>&amp;</span>quot;</span><span class="entity"><span>&amp;</span>lt;</span>/td<span class="entity"><span>&amp;</span>gt;</span><span class="entity"><span>&amp;</span>quot;</span>;
<span id="line3628"></span> echo <span class="entity"><span>&amp;</span>quot;</span><span class="entity"><span>&amp;</span>lt;</span>/tr<span class="entity"><span>&amp;</span>gt;</span><span class="entity"><span>&amp;</span>quot;</span>;
<span id="line3629"></span>
<span id="line3630"></span> $totalRecords = 0;
<span id="line3631"></span> $skippedTables = false;
<span id="line3632"></span> foreach ($tables as $tableName =<span class="entity"><span>&amp;</span>gt;</span> $tableType) {
<span id="line3633"></span> $records = $db-<span class="entity"><span>&amp;</span>gt;</span>numRows($tableName, (!isset($_GET['forceCount'])));
<span id="line3634"></span> if ($records == '?') {
<span id="line3635"></span> $skippedTables = true;
<span id="line3636"></span> $records = $params-<span class="entity"><span>&amp;</span>gt;</span>getLink(array('forceCount' =<span class="entity"><span>&amp;</span>gt;</span> '1'), '?');
<span id="line3637"></span> } else
<span id="line3638"></span> $totalRecords += $records;
<span id="line3639"></span> $tdWithClass = <span class="entity"><span>&amp;</span>quot;</span><span class="entity"><span>&amp;</span>lt;</span>td class='td<span class="entity"><span>&amp;</span>quot;</span> . ($i % 2 ? <span class="entity"><span>&amp;</span>quot;</span>1<span class="entity"><span>&amp;</span>quot;</span> : <span class="entity"><span>&amp;</span>quot;</span>2<span class="entity"><span>&amp;</span>quot;</span>) . <span class="entity"><span>&amp;</span>quot;</span>'<span class="entity"><span>&amp;</span>gt;</span><span class="entity"><span>&amp;</span>quot;</span>;
<span id="line3640"></span> $tdWithClassLeft = <span class="entity"><span>&amp;</span>quot;</span><span class="entity"><span>&amp;</span>lt;</span>td class='td<span class="entity"><span>&amp;</span>quot;</span> . ($i % 2 ? <span class="entity"><span>&amp;</span>quot;</span>1<span class="entity"><span>&amp;</span>quot;</span> : <span class="entity"><span>&amp;</span>quot;</span>2<span class="entity"><span>&amp;</span>quot;</span>) . <span class="entity"><span>&amp;</span>quot;</span>' style='text-align:left;'<span class="entity"><span>&amp;</span>gt;</span><span class="entity"><span>&amp;</span>quot;</span>;
<span id="line3641"></span>
<span id="line3642"></span> echo <span class="entity"><span>&amp;</span>quot;</span><span class="entity"><span>&amp;</span>lt;</span>tr<span class="entity"><span>&amp;</span>gt;</span><span class="entity"><span>&amp;</span>quot;</span>;
<span id="line3643"></span> echo $tdWithClassLeft;
<span id="line3644"></span> echo($tableType == <span class="entity"><span>&amp;</span>quot;</span>table<span class="entity"><span>&amp;</span>quot;</span> ? $lang['tbl'] : $lang['view']);
<span id="line3645"></span> echo <span class="entity"><span>&amp;</span>quot;</span><span class="entity"><span>&amp;</span>lt;</span>/td<span class="entity"><span>&amp;</span>gt;</span><span class="entity"><span>&amp;</span>quot;</span>;
<span id="line3646"></span> echo $tdWithClassLeft;
<span id="line3647"></span> echo $params-<span class="entity"><span>&amp;</span>gt;</span>getLink(array('table' =<span class="entity"><span>&amp;</span>gt;</span> $tableName, 'action' =<span class="entity"><span>&amp;</span>gt;</span> 'row_view'), htmlencode($tableName));
<span id="line3648"></span> echo <span class="entity"><span>&amp;</span>quot;</span><span class="entity"><span>&amp;</span>lt;</span>/td<span class="entity"><span>&amp;</span>gt;</span><span class="entity"><span>&amp;</span>quot;</span>;
<span id="line3649"></span> echo $tdWithClass;
<span id="line3650"></span> echo $params-<span class="entity"><span>&amp;</span>gt;</span>getLink(array('table' =<span class="entity"><span>&amp;</span>gt;</span> $tableName, 'action' =<span class="entity"><span>&amp;</span>gt;</span> 'row_view'), $lang['browse']);
<span id="line3651"></span> echo <span class="entity"><span>&amp;</span>quot;</span><span class="entity"><span>&amp;</span>lt;</span>/td<span class="entity"><span>&amp;</span>gt;</span><span class="entity"><span>&amp;</span>quot;</span>;
<span id="line3652"></span> echo $tdWithClass;
<span id="line3653"></span> echo $params-<span class="entity"><span>&amp;</span>gt;</span>getLink(array('table' =<span class="entity"><span>&amp;</span>gt;</span> $tableName, 'action' =<span class="entity"><span>&amp;</span>gt;</span> 'column_view'), $lang['struct']);
<span id="line3654"></span> echo <span class="entity"><span>&amp;</span>quot;</span><span class="entity"><span>&amp;</span>lt;</span>/td<span class="entity"><span>&amp;</span>gt;</span><span class="entity"><span>&amp;</span>quot;</span>;
<span id="line3655"></span> echo $tdWithClass;
<span id="line3656"></span> echo $params-<span class="entity"><span>&amp;</span>gt;</span>getLink(array('table' =<span class="entity"><span>&amp;</span>gt;</span> $tableName, 'action' =<span class="entity"><span>&amp;</span>gt;</span> 'table_sql'), $lang['sql']);
<span id="line3657"></span> echo <span class="entity"><span>&amp;</span>quot;</span><span class="entity"><span>&amp;</span>lt;</span>/td<span class="entity"><span>&amp;</span>gt;</span><span class="entity"><span>&amp;</span>quot;</span>;
<span id="line3658"></span> echo $tdWithClass;
<span id="line3659"></span> echo $params-<span class="entity"><span>&amp;</span>gt;</span>getLink(array('table' =<span class="entity"><span>&amp;</span>gt;</span> $tableName, 'action' =<span class="entity"><span>&amp;</span>gt;</span> 'table_search'), $lang['srch']);
<span id="line3660"></span> echo <span class="entity"><span>&amp;</span>quot;</span><span class="entity"><span>&amp;</span>lt;</span>/td<span class="entity"><span>&amp;</span>gt;</span><span class="entity"><span>&amp;</span>quot;</span>;
<span id="line3661"></span> echo $tdWithClass;
<span id="line3662"></span> if ($tableType == <span class="entity"><span>&amp;</span>quot;</span>table<span class="entity"><span>&amp;</span>quot;</span> <span class="entity"><span>&amp;</span>amp;</span><span class="entity"><span>&amp;</span>amp;</span> $db-<span class="entity"><span>&amp;</span>gt;</span>isWritable() <span class="entity"><span>&amp;</span>amp;</span><span class="entity"><span>&amp;</span>amp;</span> $db-<span class="entity"><span>&amp;</span>gt;</span>isDirWritable())
<span id="line3663"></span> echo $params-<span class="entity"><span>&amp;</span>gt;</span>getLink(array('table' =<span class="entity"><span>&amp;</span>gt;</span> $tableName, 'action' =<span class="entity"><span>&amp;</span>gt;</span> 'row_create'), $lang['insert']);
<span id="line3664"></span> else
<span id="line3665"></span> echo $lang['insert'];
<span id="line3666"></span> echo <span class="entity"><span>&amp;</span>quot;</span><span class="entity"><span>&amp;</span>lt;</span>/td<span class="entity"><span>&amp;</span>gt;</span><span class="entity"><span>&amp;</span>quot;</span>;
<span id="line3667"></span> echo $tdWithClass;
<span id="line3668"></span> echo $params-<span class="entity"><span>&amp;</span>gt;</span>getLink(array('table' =<span class="entity"><span>&amp;</span>gt;</span> $tableName, 'action' =<span class="entity"><span>&amp;</span>gt;</span> 'table_export'), $lang['export']);
<span id="line3669"></span> echo <span class="entity"><span>&amp;</span>quot;</span><span class="entity"><span>&amp;</span>lt;</span>/td<span class="entity"><span>&amp;</span>gt;</span><span class="entity"><span>&amp;</span>quot;</span>;
<span id="line3670"></span> echo $tdWithClass;
<span id="line3671"></span> if ($tableType == <span class="entity"><span>&amp;</span>quot;</span>table<span class="entity"><span>&amp;</span>quot;</span> <span class="entity"><span>&amp;</span>amp;</span><span class="entity"><span>&amp;</span>amp;</span> $db-<span class="entity"><span>&amp;</span>gt;</span>isWritable() <span class="entity"><span>&amp;</span>amp;</span><span class="entity"><span>&amp;</span>amp;</span> $db-<span class="entity"><span>&amp;</span>gt;</span>isDirWritable())
<span id="line3672"></span> echo $params-<span class="entity"><span>&amp;</span>gt;</span>getLink(array('table' =<span class="entity"><span>&amp;</span>gt;</span> $tableName, 'action' =<span class="entity"><span>&amp;</span>gt;</span> 'table_import'), $lang['import']);
<span id="line3673"></span> else
<span id="line3674"></span> echo $lang['import'];
<span id="line3675"></span> echo <span class="entity"><span>&amp;</span>quot;</span><span class="entity"><span>&amp;</span>lt;</span>/td<span class="entity"><span>&amp;</span>gt;</span><span class="entity"><span>&amp;</span>quot;</span>;
<span id="line3676"></span> echo $tdWithClass;
<span id="line3677"></span> if ($db-<span class="entity"><span>&amp;</span>gt;</span>isWritable() <span class="entity"><span>&amp;</span>amp;</span><span class="entity"><span>&amp;</span>amp;</span> $db-<span class="entity"><span>&amp;</span>gt;</span>isDirWritable())
<span id="line3678"></span> echo $params-<span class="entity"><span>&amp;</span>gt;</span>getLink(array('table' =<span class="entity"><span>&amp;</span>gt;</span> $tableName, 'action' =<span class="entity"><span>&amp;</span>gt;</span> 'table_rename'), $lang['rename']);
<span id="line3679"></span> else
<span id="line3680"></span> echo $lang['rename'];
<span id="line3681"></span> echo <span class="entity"><span>&amp;</span>quot;</span><span class="entity"><span>&amp;</span>lt;</span>/td<span class="entity"><span>&amp;</span>gt;</span><span class="entity"><span>&amp;</span>quot;</span>;
<span id="line3682"></span> echo $tdWithClass;
<span id="line3683"></span> if ($tableType == <span class="entity"><span>&amp;</span>quot;</span>table<span class="entity"><span>&amp;</span>quot;</span> <span class="entity"><span>&amp;</span>amp;</span><span class="entity"><span>&amp;</span>amp;</span> $db-<span class="entity"><span>&amp;</span>gt;</span>isWritable() <span class="entity"><span>&amp;</span>amp;</span><span class="entity"><span>&amp;</span>amp;</span> $db-<span class="entity"><span>&amp;</span>gt;</span>isDirWritable())
<span id="line3684"></span> echo $params-<span class="entity"><span>&amp;</span>gt;</span>getLink(array('table' =<span class="entity"><span>&amp;</span>gt;</span> $tableName, 'action' =<span class="entity"><span>&amp;</span>gt;</span> 'table_empty'), $lang['empty'], 'empty');
<span id="line3685"></span> else
<span id="line3686"></span> echo $lang['empty'];
<span id="line3687"></span> echo <span class="entity"><span>&amp;</span>quot;</span><span class="entity"><span>&amp;</span>lt;</span>/td<span class="entity"><span>&amp;</span>gt;</span><span class="entity"><span>&amp;</span>quot;</span>;
<span id="line3688"></span> echo $tdWithClass;
<span id="line3689"></span> if ($db-<span class="entity"><span>&amp;</span>gt;</span>isWritable() <span class="entity"><span>&amp;</span>amp;</span><span class="entity"><span>&amp;</span>amp;</span> $db-<span class="entity"><span>&amp;</span>gt;</span>isDirWritable())
<span id="line3690"></span> echo $params-<span class="entity"><span>&amp;</span>gt;</span>getLink(array('table' =<span class="entity"><span>&amp;</span>gt;</span> $tableName, 'action' =<span class="entity"><span>&amp;</span>gt;</span> 'table_drop'), $lang['drop'], 'drop');
<span id="line3691"></span> else
<span id="line3692"></span> echo $lang['drop'];
<span id="line3693"></span> echo <span class="entity"><span>&amp;</span>quot;</span><span class="entity"><span>&amp;</span>lt;</span>/td<span class="entity"><span>&amp;</span>gt;</span><span class="entity"><span>&amp;</span>quot;</span>;
<span id="line3694"></span> echo $tdWithClass;
<span id="line3695"></span> echo $records;
<span id="line3696"></span> echo <span class="entity"><span>&amp;</span>quot;</span><span class="entity"><span>&amp;</span>lt;</span>/td<span class="entity"><span>&amp;</span>gt;</span><span class="entity"><span>&amp;</span>quot;</span>;
<span id="line3697"></span> echo <span class="entity"><span>&amp;</span>quot;</span><span class="entity"><span>&amp;</span>lt;</span>/tr<span class="entity"><span>&amp;</span>gt;</span><span class="entity"><span>&amp;</span>quot;</span>;
<span id="line3698"></span> }
<span id="line3699"></span> echo <span class="entity"><span>&amp;</span>quot;</span><span class="entity"><span>&amp;</span>lt;</span>tr<span class="entity"><span>&amp;</span>gt;</span><span class="entity"><span>&amp;</span>quot;</span>;
<span id="line3700"></span> echo <span class="entity"><span>&amp;</span>quot;</span><span class="entity"><span>&amp;</span>lt;</span>td class='tdheader' colspan='12'<span class="entity"><span>&amp;</span>gt;</span><span class="entity"><span>&amp;</span>quot;</span> . sizeof($tables) . <span class="entity"><span>&amp;</span>quot;</span> <span class="entity"><span>&amp;</span>quot;</span> . $lang['total'] . <span class="entity"><span>&amp;</span>quot;</span><span class="entity"><span>&amp;</span>lt;</span>/td<span class="entity"><span>&amp;</span>gt;</span><span class="entity"><span>&amp;</span>quot;</span>;
<span id="line3701"></span> echo <span class="entity"><span>&amp;</span>quot;</span><span class="entity"><span>&amp;</span>lt;</span>td class='tdheader' colspan='1' style='text-align:right;'<span class="entity"><span>&amp;</span>gt;</span><span class="entity"><span>&amp;</span>quot;</span> . $totalRecords . ($skippedTables ? <span class="entity"><span>&amp;</span>quot;</span> <span class="entity"><span>&amp;</span>quot;</span> . $params-<span class="entity"><span>&amp;</span>gt;</span>getLink(array('forceCount' =<span class="entity"><span>&amp;</span>gt;</span> '1'), '+ ?') : <span class="entity"><span>&amp;</span>quot;</span><span class="entity"><span>&amp;</span>quot;</span>) . <span class="entity"><span>&amp;</span>quot;</span><span class="entity"><span>&amp;</span>lt;</span>/td<span class="entity"><span>&amp;</span>gt;</span><span class="entity"><span>&amp;</span>quot;</span>;
<span id="line3702"></span> echo <span class="entity"><span>&amp;</span>quot;</span><span class="entity"><span>&amp;</span>lt;</span>/tr<span class="entity"><span>&amp;</span>gt;</span><span class="entity"><span>&amp;</span>quot;</span>;
<span id="line3703"></span> echo <span class="entity"><span>&amp;</span>quot;</span><span class="entity"><span>&amp;</span>lt;</span>/table<span class="entity"><span>&amp;</span>gt;</span><span class="entity"><span>&amp;</span>quot;</span>;
<span id="line3704"></span> echo <span class="entity"><span>&amp;</span>quot;</span><span class="entity"><span>&amp;</span>lt;</span>br/<span class="entity"><span>&amp;</span>gt;</span><span class="entity"><span>&amp;</span>quot;</span>;
<span id="line3705"></span> if ($skippedTables)
<span id="line3706"></span> echo <span class="entity"><span>&amp;</span>quot;</span><span class="entity"><span>&amp;</span>lt;</span>div class='confirm' style='margin-bottom:20px;'<span class="entity"><span>&amp;</span>gt;</span><span class="entity"><span>&amp;</span>quot;</span> . sprintf($lang[<span class="entity"><span>&amp;</span>quot;</span>counting_skipped<span class="entity"><span>&amp;</span>quot;</span>], <span class="entity"><span>&amp;</span>quot;</span><span class="entity"><span>&amp;</span>lt;</span>a href='<span class="entity"><span>&amp;</span>quot;</span> . $params-<span class="entity"><span>&amp;</span>gt;</span>getURL(array('forceCount' =<span class="entity"><span>&amp;</span>gt;</span> '1')) . <span class="entity"><span>&amp;</span>quot;</span>'<span class="entity"><span>&amp;</span>gt;</span><span class="entity"><span>&amp;</span>quot;</span>, <span class="entity"><span>&amp;</span>quot;</span><span class="entity"><span>&amp;</span>lt;</span>/a<span class="entity"><span>&amp;</span>gt;</span><span class="entity"><span>&amp;</span>quot;</span>) . <span class="entity"><span>&amp;</span>quot;</span><span class="entity"><span>&amp;</span>lt;</span>/div<span class="entity"><span>&amp;</span>gt;</span><span class="entity"><span>&amp;</span>quot;</span>;
<span id="line3707"></span> }
<span id="line3708"></span> if ($db-<span class="entity"><span>&amp;</span>gt;</span>isWritable() <span class="entity"><span>&amp;</span>amp;</span><span class="entity"><span>&amp;</span>amp;</span> $db-<span class="entity"><span>&amp;</span>gt;</span>isDirWritable()) {
<span id="line3709"></span> echo <span class="entity"><span>&amp;</span>quot;</span><span class="entity"><span>&amp;</span>lt;</span>fieldset<span class="entity"><span>&amp;</span>gt;</span><span class="entity"><span>&amp;</span>quot;</span>;
<span id="line3710"></span> echo <span class="entity"><span>&amp;</span>quot;</span><span class="entity"><span>&amp;</span>lt;</span>legend<span class="entity"><span>&amp;</span>gt;</span><span class="entity"><span>&amp;</span>lt;</span>b<span class="entity"><span>&amp;</span>gt;</span><span class="entity"><span>&amp;</span>quot;</span> . $lang['create_tbl_db'] . <span class="entity"><span>&amp;</span>quot;</span> '<span class="entity"><span>&amp;</span>quot;</span> . htmlencode($db-<span class="entity"><span>&amp;</span>gt;</span>getName()) . <span class="entity"><span>&amp;</span>quot;</span>'<span class="entity"><span>&amp;</span>lt;</span>/b<span class="entity"><span>&amp;</span>gt;</span><span class="entity"><span>&amp;</span>lt;</span>/legend<span class="entity"><span>&amp;</span>gt;</span><span class="entity"><span>&amp;</span>quot;</span>;
<span id="line3711"></span> echo $params-<span class="entity"><span>&amp;</span>gt;</span>getForm(array('action' =<span class="entity"><span>&amp;</span>gt;</span> 'table_create'), 'get');
<span id="line3712"></span> echo $lang['name'] . <span class="entity"><span>&amp;</span>quot;</span>: <span class="entity"><span>&amp;</span>lt;</span>input type='text' name='tablename' style='width:200px;'/<span class="entity"><span>&amp;</span>gt;</span> <span class="entity"><span>&amp;</span>quot;</span>;
<span id="line3713"></span> echo $lang['fld_num'] . <span class="entity"><span>&amp;</span>quot;</span>: <span class="entity"><span>&amp;</span>lt;</span>input type='text' name='tablefields' style='width:90px;'/<span class="entity"><span>&amp;</span>gt;</span> <span class="entity"><span>&amp;</span>quot;</span>;
<span id="line3714"></span> echo <span class="entity"><span>&amp;</span>quot;</span><span class="entity"><span>&amp;</span>lt;</span>input type='submit' name='createtable' value='<span class="entity"><span>&amp;</span>quot;</span> . $lang['go'] . <span class="entity"><span>&amp;</span>quot;</span>' class='btn'/<span class="entity"><span>&amp;</span>gt;</span><span class="entity"><span>&amp;</span>quot;</span>;
<span id="line3715"></span> echo <span class="entity"><span>&amp;</span>quot;</span><span class="entity"><span>&amp;</span>lt;</span>/form<span class="entity"><span>&amp;</span>gt;</span><span class="entity"><span>&amp;</span>quot;</span>;
<span id="line3716"></span> echo <span class="entity"><span>&amp;</span>quot;</span><span class="entity"><span>&amp;</span>lt;</span>/fieldset<span class="entity"><span>&amp;</span>gt;</span><span class="entity"><span>&amp;</span>quot;</span>;
<span id="line3717"></span> echo <span class="entity"><span>&amp;</span>quot;</span><span class="entity"><span>&amp;</span>lt;</span>br/<span class="entity"><span>&amp;</span>gt;</span><span class="entity"><span>&amp;</span>quot;</span>;
<span id="line3718"></span> echo <span class="entity"><span>&amp;</span>quot;</span><span class="entity"><span>&amp;</span>lt;</span>fieldset<span class="entity"><span>&amp;</span>gt;</span><span class="entity"><span>&amp;</span>quot;</span>;
<span id="line3719"></span> echo <span class="entity"><span>&amp;</span>quot;</span><span class="entity"><span>&amp;</span>lt;</span>legend<span class="entity"><span>&amp;</span>gt;</span><span class="entity"><span>&amp;</span>lt;</span>b<span class="entity"><span>&amp;</span>gt;</span><span class="entity"><span>&amp;</span>quot;</span> . $lang['create_view'] . <span class="entity"><span>&amp;</span>quot;</span> '<span class="entity"><span>&amp;</span>quot;</span> . htmlencode($db-<span class="entity"><span>&amp;</span>gt;</span>getName()) . <span class="entity"><span>&amp;</span>quot;</span>'<span class="entity"><span>&amp;</span>lt;</span>/b<span class="entity"><span>&amp;</span>gt;</span><span class="entity"><span>&amp;</span>lt;</span>/legend<span class="entity"><span>&amp;</span>gt;</span><span class="entity"><span>&amp;</span>quot;</span>;
<span id="line3720"></span> echo $params-<span class="entity"><span>&amp;</span>gt;</span>getForm(array('action' =<span class="entity"><span>&amp;</span>gt;</span> 'view_create', 'confirm' =<span class="entity"><span>&amp;</span>gt;</span> '1'));
<span id="line3721"></span> echo $lang['name'] . <span class="entity"><span>&amp;</span>quot;</span>: <span class="entity"><span>&amp;</span>lt;</span>input type='text' name='viewname' style='width:200px;'/<span class="entity"><span>&amp;</span>gt;</span> <span class="entity"><span>&amp;</span>quot;</span>;
<span id="line3722"></span> echo $lang['sel_state'] . <span class="entity"><span>&amp;</span>quot;</span> <span class="entity"><span>&amp;</span>quot;</span> . helpLink($lang['help4']) . <span class="entity"><span>&amp;</span>quot;</span>: <span class="entity"><span>&amp;</span>lt;</span>input type='text' name='select' style='width:400px;'/<span class="entity"><span>&amp;</span>gt;</span> <span class="entity"><span>&amp;</span>quot;</span>;
<span id="line3723"></span> echo <span class="entity"><span>&amp;</span>quot;</span><span class="entity"><span>&amp;</span>lt;</span>input type='submit' name='createtable' value='<span class="entity"><span>&amp;</span>quot;</span> . $lang['go'] . <span class="entity"><span>&amp;</span>quot;</span>' class='btn'/<span class="entity"><span>&amp;</span>gt;</span><span class="entity"><span>&amp;</span>quot;</span>;
<span id="line3724"></span> echo <span class="entity"><span>&amp;</span>quot;</span><span class="entity"><span>&amp;</span>lt;</span>/form<span class="entity"><span>&amp;</span>gt;</span><span class="entity"><span>&amp;</span>quot;</span>;
<span id="line3725"></span> echo <span class="entity"><span>&amp;</span>quot;</span><span class="entity"><span>&amp;</span>lt;</span>/fieldset<span class="entity"><span>&amp;</span>gt;</span><span class="entity"><span>&amp;</span>quot;</span>;
<span id="line3726"></span> }
<span id="line3727"></span> } else if ($view == <span class="entity"><span>&amp;</span>quot;</span>sql<span class="entity"><span>&amp;</span>quot;</span>) {
<span id="line3728"></span> //- Database SQL editor (=sql)
<span id="line3729"></span> if (isset($_POST['query']) <span class="entity"><span>&amp;</span>amp;</span><span class="entity"><span>&amp;</span>amp;</span> $_POST['query'] != <span class="entity"><span>&amp;</span>quot;</span><span class="entity"><span>&amp;</span>quot;</span>) {
<span id="line3730"></span> $delimiter = $_POST['delimiter'];
<span id="line3731"></span> $queryStr = $_POST['queryval'];
<span id="line3732"></span> //save the queries in history if necessary
<span id="line3733"></span> if ($maxSavedQueries != 0 <span class="entity"><span>&amp;</span>amp;</span><span class="entity"><span>&amp;</span>amp;</span> $maxSavedQueries != false) {
<span id="line3734"></span> if (!isset($_SESSION[COOKIENAME . 'query_history']))
<span id="line3735"></span> $_SESSION[COOKIENAME . 'query_history'] = array();
<span id="line3736"></span> $_SESSION[COOKIENAME . 'query_history'][md5(strtolower($queryStr))] = $queryStr;
<span id="line3737"></span> if (sizeof($_SESSION[COOKIENAME . 'query_history']) <span class="entity"><span>&amp;</span>gt;</span> $maxSavedQueries)
<span id="line3738"></span> array_shift($_SESSION[COOKIENAME . 'query_history']);
<span id="line3739"></span> }
<span id="line3740"></span> $query = explode_sql($delimiter, $queryStr); //explode the query string into individual queries based on the delimiter
<span id="line3741"></span>
<span id="line3742"></span> for ($i = 0; $i <span class="entity"><span>&amp;</span>lt;</span> sizeof($query); $i++) //iterate through the queries exploded by the delimiter
<span id="line3743"></span> {
<span id="line3744"></span> if (str_replace(<span class="entity"><span>&amp;</span>quot;</span> <span class="entity"><span>&amp;</span>quot;</span>, <span class="entity"><span>&amp;</span>quot;</span><span class="entity"><span>&amp;</span>quot;</span>, str_replace(<span class="entity"><span>&amp;</span>quot;</span>\n<span class="entity"><span>&amp;</span>quot;</span>, <span class="entity"><span>&amp;</span>quot;</span><span class="entity"><span>&amp;</span>quot;</span>, str_replace(<span class="entity"><span>&amp;</span>quot;</span>\r<span class="entity"><span>&amp;</span>quot;</span>, <span class="entity"><span>&amp;</span>quot;</span><span class="entity"><span>&amp;</span>quot;</span>, $query[$i]))) != <span class="entity"><span>&amp;</span>quot;</span><span class="entity"><span>&amp;</span>quot;</span>) //make sure this query is not an empty string
<span id="line3745"></span> {
<span id="line3746"></span> $queryTimer = new MicroTimer();
<span id="line3747"></span> $table_result = $db-<span class="entity"><span>&amp;</span>gt;</span>query($query[$i]);
<span id="line3748"></span>
<span id="line3749"></span> echo <span class="entity"><span>&amp;</span>quot;</span><span class="entity"><span>&amp;</span>lt;</span>div class='confirm'<span class="entity"><span>&amp;</span>gt;</span><span class="entity"><span>&amp;</span>quot;</span>;
<span id="line3750"></span> echo <span class="entity"><span>&amp;</span>quot;</span><span class="entity"><span>&amp;</span>lt;</span>b<span class="entity"><span>&amp;</span>gt;</span><span class="entity"><span>&amp;</span>quot;</span> . htmlencode($query[$i]) . <span class="entity"><span>&amp;</span>quot;</span><span class="entity"><span>&amp;</span>lt;</span>/b<span class="entity"><span>&amp;</span>gt;</span><span class="entity"><span>&amp;</span>quot;</span>;
<span id="line3751"></span> if ($table_result === NULL || $table_result === false) {
<span id="line3752"></span> echo <span class="entity"><span>&amp;</span>quot;</span><span class="entity"><span>&amp;</span>lt;</span>br /<span class="entity"><span>&amp;</span>gt;</span><span class="entity"><span>&amp;</span>lt;</span>b<span class="entity"><span>&amp;</span>gt;</span><span class="entity"><span>&amp;</span>quot;</span> . $lang['err'] . <span class="entity"><span>&amp;</span>quot;</span>: <span class="entity"><span>&amp;</span>quot;</span> . htmlencode($db-<span class="entity"><span>&amp;</span>gt;</span>getError()) . <span class="entity"><span>&amp;</span>quot;</span><span class="entity"><span>&amp;</span>lt;</span>/b<span class="entity"><span>&amp;</span>gt;</span><span class="entity"><span>&amp;</span>lt;</span>/div<span class="entity"><span>&amp;</span>gt;</span><span class="entity"><span>&amp;</span>quot;</span>;
<span id="line3753"></span> }
<span id="line3754"></span> echo <span class="entity"><span>&amp;</span>quot;</span><span class="entity"><span>&amp;</span>lt;</span>/div<span class="entity"><span>&amp;</span>gt;</span><span class="entity"><span>&amp;</span>lt;</span>br/<span class="entity"><span>&amp;</span>gt;</span><span class="entity"><span>&amp;</span>quot;</span>;
<span id="line3755"></span> if ($row = $db-<span class="entity"><span>&amp;</span>gt;</span>fetch($table_result, 'num')) {
<span id="line3756"></span> for ($j = 0; $j <span class="entity"><span>&amp;</span>lt;</span> sizeof($row); $j++)
<span id="line3757"></span> $headers[$j] = $db-<span class="entity"><span>&amp;</span>gt;</span>getColumnName($table_result, $j);
<span id="line3758"></span> echo <span class="entity"><span>&amp;</span>quot;</span><span class="entity"><span>&amp;</span>lt;</span>table border='0' cellpadding='2' cellspacing='1' class='viewTable'<span class="entity"><span>&amp;</span>gt;</span><span class="entity"><span>&amp;</span>quot;</span>;
<span id="line3759"></span> echo <span class="entity"><span>&amp;</span>quot;</span><span class="entity"><span>&amp;</span>lt;</span>tr<span class="entity"><span>&amp;</span>gt;</span><span class="entity"><span>&amp;</span>quot;</span>;
<span id="line3760"></span> for ($j = 0; $j <span class="entity"><span>&amp;</span>lt;</span> sizeof($headers); $j++) {
<span id="line3761"></span> echo <span class="entity"><span>&amp;</span>quot;</span><span class="entity"><span>&amp;</span>lt;</span>td class='tdheader'<span class="entity"><span>&amp;</span>gt;</span><span class="entity"><span>&amp;</span>quot;</span>;
<span id="line3762"></span> echo htmlencode($headers[$j]);
<span id="line3763"></span> echo <span class="entity"><span>&amp;</span>quot;</span><span class="entity"><span>&amp;</span>lt;</span>/td<span class="entity"><span>&amp;</span>gt;</span><span class="entity"><span>&amp;</span>quot;</span>;
<span id="line3764"></span> }
<span id="line3765"></span> echo <span class="entity"><span>&amp;</span>quot;</span><span class="entity"><span>&amp;</span>lt;</span>/tr<span class="entity"><span>&amp;</span>gt;</span><span class="entity"><span>&amp;</span>quot;</span>;
<span id="line3766"></span> $rowCount = 0;
<span id="line3767"></span> for (; $rowCount == 0 || $row = $db-<span class="entity"><span>&amp;</span>gt;</span>fetch($table_result, 'num'); $rowCount++) {
<span id="line3768"></span> $tdWithClass = <span class="entity"><span>&amp;</span>quot;</span><span class="entity"><span>&amp;</span>lt;</span>td class='td<span class="entity"><span>&amp;</span>quot;</span> . ($rowCount % 2 ? <span class="entity"><span>&amp;</span>quot;</span>1<span class="entity"><span>&amp;</span>quot;</span> : <span class="entity"><span>&amp;</span>quot;</span>2<span class="entity"><span>&amp;</span>quot;</span>) . <span class="entity"><span>&amp;</span>quot;</span>'<span class="entity"><span>&amp;</span>gt;</span><span class="entity"><span>&amp;</span>quot;</span>;
<span id="line3769"></span> echo <span class="entity"><span>&amp;</span>quot;</span><span class="entity"><span>&amp;</span>lt;</span>tr<span class="entity"><span>&amp;</span>gt;</span><span class="entity"><span>&amp;</span>quot;</span>;
<span id="line3770"></span> for ($z = 0; $z <span class="entity"><span>&amp;</span>lt;</span> sizeof($headers); $z++) {
<span id="line3771"></span> echo $tdWithClass;
<span id="line3772"></span> if ($row[$z] === <span class="entity"><span>&amp;</span>quot;</span><span class="entity"><span>&amp;</span>quot;</span>)
<span id="line3773"></span> echo <span class="entity"><span>&amp;</span>quot;</span><span class="entity"><span>&amp;</span>amp;</span>nbsp;<span class="entity"><span>&amp;</span>quot;</span>;
<span id="line3774"></span> elseif ($row[$z] === NULL)
<span id="line3775"></span> echo <span class="entity"><span>&amp;</span>quot;</span><span class="entity"><span>&amp;</span>lt;</span>i class='null'<span class="entity"><span>&amp;</span>gt;</span>NULL<span class="entity"><span>&amp;</span>lt;</span>/i<span class="entity"><span>&amp;</span>gt;</span><span class="entity"><span>&amp;</span>quot;</span>;
<span id="line3776"></span> else
<span id="line3777"></span> echo htmlencode(subString($row[$z]));
<span id="line3778"></span> echo <span class="entity"><span>&amp;</span>quot;</span><span class="entity"><span>&amp;</span>lt;</span>/td<span class="entity"><span>&amp;</span>gt;</span><span class="entity"><span>&amp;</span>quot;</span>;
<span id="line3779"></span> }
<span id="line3780"></span> echo <span class="entity"><span>&amp;</span>quot;</span><span class="entity"><span>&amp;</span>lt;</span>/tr<span class="entity"><span>&amp;</span>gt;</span><span class="entity"><span>&amp;</span>quot;</span>;
<span id="line3781"></span> }
<span id="line3782"></span> $queryTimer-<span class="entity"><span>&amp;</span>gt;</span>stop();
<span id="line3783"></span> echo <span class="entity"><span>&amp;</span>quot;</span><span class="entity"><span>&amp;</span>lt;</span>/table<span class="entity"><span>&amp;</span>gt;</span><span class="entity"><span>&amp;</span>lt;</span>br/<span class="entity"><span>&amp;</span>gt;</span><span class="entity"><span>&amp;</span>lt;</span>br/<span class="entity"><span>&amp;</span>gt;</span><span class="entity"><span>&amp;</span>quot;</span>;
<span id="line3784"></span>
<span id="line3785"></span>
<span id="line3786"></span> if ($table_result !== NULL <span class="entity"><span>&amp;</span>amp;</span><span class="entity"><span>&amp;</span>amp;</span> $table_result !== false) {
<span id="line3787"></span> echo <span class="entity"><span>&amp;</span>quot;</span><span class="entity"><span>&amp;</span>lt;</span>div class='confirm' style='margin-bottom: 2em'<span class="entity"><span>&amp;</span>gt;</span><span class="entity"><span>&amp;</span>quot;</span>;
<span id="line3788"></span> if ($rowCount <span class="entity"><span>&amp;</span>gt;</span> 0 || $db-<span class="entity"><span>&amp;</span>gt;</span>getAffectedRows() == 0) {
<span id="line3789"></span> printf($lang['show_rows'], $rowCount);
<span id="line3790"></span> }
<span id="line3791"></span> if ($db-<span class="entity"><span>&amp;</span>gt;</span>getAffectedRows() <span class="entity"><span>&amp;</span>gt;</span> 0 || $rowCount == 0) {
<span id="line3792"></span> echo $db-<span class="entity"><span>&amp;</span>gt;</span>getAffectedRows() . <span class="entity"><span>&amp;</span>quot;</span> <span class="entity"><span>&amp;</span>quot;</span> . $lang['rows_aff'] . <span class="entity"><span>&amp;</span>quot;</span> <span class="entity"><span>&amp;</span>quot;</span>;
<span id="line3793"></span> }
<span id="line3794"></span> printf($lang['query_time'], $queryTimer);
<span id="line3795"></span> echo <span class="entity"><span>&amp;</span>quot;</span><span class="entity"><span>&amp;</span>lt;</span>/div<span class="entity"><span>&amp;</span>gt;</span><span class="entity"><span>&amp;</span>quot;</span>;
<span id="line3796"></span> }
<span id="line3797"></span>
<span id="line3798"></span>
<span id="line3799"></span> }
<span id="line3800"></span> }
<span id="line3801"></span> }
<span id="line3802"></span> } else {
<span id="line3803"></span> $delimiter = <span class="entity"><span>&amp;</span>quot;</span>;<span class="entity"><span>&amp;</span>quot;</span>;
<span id="line3804"></span> $queryStr = <span class="entity"><span>&amp;</span>quot;</span><span class="entity"><span>&amp;</span>quot;</span>;
<span id="line3805"></span> }
<span id="line3806"></span>
<span id="line3807"></span> echo <span class="entity"><span>&amp;</span>quot;</span><span class="entity"><span>&amp;</span>lt;</span>fieldset<span class="entity"><span>&amp;</span>gt;</span><span class="entity"><span>&amp;</span>quot;</span>;
<span id="line3808"></span> echo <span class="entity"><span>&amp;</span>quot;</span><span class="entity"><span>&amp;</span>lt;</span>legend<span class="entity"><span>&amp;</span>gt;</span><span class="entity"><span>&amp;</span>lt;</span>b<span class="entity"><span>&amp;</span>gt;</span><span class="entity"><span>&amp;</span>quot;</span> . sprintf($lang['run_sql'], htmlencode($db-<span class="entity"><span>&amp;</span>gt;</span>getName())) . <span class="entity"><span>&amp;</span>quot;</span><span class="entity"><span>&amp;</span>lt;</span>/b<span class="entity"><span>&amp;</span>gt;</span><span class="entity"><span>&amp;</span>lt;</span>/legend<span class="entity"><span>&amp;</span>gt;</span><span class="entity"><span>&amp;</span>quot;</span>;
<span id="line3809"></span> echo $params-<span class="entity"><span>&amp;</span>gt;</span>getForm(array('view' =<span class="entity"><span>&amp;</span>gt;</span> 'sql'));
<span id="line3810"></span> if (isset($_SESSION[COOKIENAME . 'query_history']) <span class="entity"><span>&amp;</span>amp;</span><span class="entity"><span>&amp;</span>amp;</span> sizeof($_SESSION[COOKIENAME . 'query_history']) <span class="entity"><span>&amp;</span>gt;</span> 0) {
<span id="line3811"></span> echo <span class="entity"><span>&amp;</span>quot;</span><span class="entity"><span>&amp;</span>lt;</span>b<span class="entity"><span>&amp;</span>gt;</span><span class="entity"><span>&amp;</span>quot;</span> . $lang['recent_queries'] . <span class="entity"><span>&amp;</span>quot;</span><span class="entity"><span>&amp;</span>lt;</span>/b<span class="entity"><span>&amp;</span>gt;</span><span class="entity"><span>&amp;</span>lt;</span>ul<span class="entity"><span>&amp;</span>gt;</span><span class="entity"><span>&amp;</span>quot;</span>;
<span id="line3812"></span> foreach ($_SESSION[COOKIENAME . 'query_history'] as $key =<span class="entity"><span>&amp;</span>gt;</span> $value) {
<span id="line3813"></span> echo <span class="entity"><span>&amp;</span>quot;</span><span class="entity"><span>&amp;</span>lt;</span>li<span class="entity"><span>&amp;</span>gt;</span><span class="entity"><span>&amp;</span>lt;</span>a onclick='sqleditorSetValue(this.textContent); return false;' href='#'<span class="entity"><span>&amp;</span>gt;</span><span class="entity"><span>&amp;</span>quot;</span> . htmlencode($value) . <span class="entity"><span>&amp;</span>quot;</span><span class="entity"><span>&amp;</span>lt;</span>/a<span class="entity"><span>&amp;</span>gt;</span><span class="entity"><span>&amp;</span>lt;</span>/li<span class="entity"><span>&amp;</span>gt;</span><span class="entity"><span>&amp;</span>quot;</span>;
<span id="line3814"></span> }
<span id="line3815"></span> echo <span class="entity"><span>&amp;</span>quot;</span><span class="entity"><span>&amp;</span>lt;</span>/ul<span class="entity"><span>&amp;</span>gt;</span><span class="entity"><span>&amp;</span>lt;</span>br/<span class="entity"><span>&amp;</span>gt;</span><span class="entity"><span>&amp;</span>lt;</span>br/<span class="entity"><span>&amp;</span>gt;</span><span class="entity"><span>&amp;</span>quot;</span>;
<span id="line3816"></span> }
<span id="line3817"></span> echo <span class="entity"><span>&amp;</span>quot;</span><span class="entity"><span>&amp;</span>lt;</span>textarea style='width:100%; height:300px;' name='queryval' id='queryval' cols='50' rows='8'<span class="entity"><span>&amp;</span>gt;</span><span class="entity"><span>&amp;</span>quot;</span> . htmlencode($queryStr) . <span class="entity"><span>&amp;</span>quot;</span><span class="entity"><span>&amp;</span>lt;</span>/textarea<span class="entity"><span>&amp;</span>gt;</span><span class="entity"><span>&amp;</span>quot;</span>;
<span id="line3818"></span> echo <span class="entity"><span>&amp;</span>quot;</span><span class="entity"><span>&amp;</span>lt;</span>script<span class="entity"><span>&amp;</span>gt;</span>sqleditor(document.getElementById('queryval'),<span class="entity"><span>&amp;</span>quot;</span> . json_encode($db-<span class="entity"><span>&amp;</span>gt;</span>getTableDefinitions()) . <span class="entity"><span>&amp;</span>quot;</span>, null);<span class="entity"><span>&amp;</span>lt;</span>/script<span class="entity"><span>&amp;</span>gt;</span><span class="entity"><span>&amp;</span>quot;</span>;
<span id="line3819"></span> echo $lang['delimit'] . <span class="entity"><span>&amp;</span>quot;</span> <span class="entity"><span>&amp;</span>lt;</span>input type='text' name='delimiter' value='<span class="entity"><span>&amp;</span>quot;</span> . htmlencode($delimiter) . <span class="entity"><span>&amp;</span>quot;</span>' style='width:50px;'/<span class="entity"><span>&amp;</span>gt;</span> <span class="entity"><span>&amp;</span>quot;</span>;
<span id="line3820"></span> echo <span class="entity"><span>&amp;</span>quot;</span><span class="entity"><span>&amp;</span>lt;</span>input type='submit' name='query' value='<span class="entity"><span>&amp;</span>quot;</span> . $lang['go'] . <span class="entity"><span>&amp;</span>quot;</span>' class='btn'/<span class="entity"><span>&amp;</span>gt;</span><span class="entity"><span>&amp;</span>quot;</span>;
<span id="line3821"></span> echo <span class="entity"><span>&amp;</span>quot;</span><span class="entity"><span>&amp;</span>lt;</span>/form<span class="entity"><span>&amp;</span>gt;</span><span class="entity"><span>&amp;</span>quot;</span>;
<span id="line3822"></span> echo <span class="entity"><span>&amp;</span>quot;</span><span class="entity"><span>&amp;</span>lt;</span>/fieldset<span class="entity"><span>&amp;</span>gt;</span><span class="entity"><span>&amp;</span>quot;</span>;
<span id="line3823"></span> } else if ($view == <span class="entity"><span>&amp;</span>quot;</span>vacuum<span class="entity"><span>&amp;</span>quot;</span>) {
<span id="line3824"></span> //- Vacuum database confirmation (=vacuum)
<span id="line3825"></span> if (isset($_POST['vacuum'])) {
<span id="line3826"></span> $query = <span class="entity"><span>&amp;</span>quot;</span>VACUUM<span class="entity"><span>&amp;</span>quot;</span>;
<span id="line3827"></span> $db-<span class="entity"><span>&amp;</span>gt;</span>query($query);
<span id="line3828"></span> echo <span class="entity"><span>&amp;</span>quot;</span><span class="entity"><span>&amp;</span>lt;</span>div class='confirm'<span class="entity"><span>&amp;</span>gt;</span><span class="entity"><span>&amp;</span>quot;</span>;
<span id="line3829"></span> printf($lang['db_vac'], htmlencode($db-<span class="entity"><span>&amp;</span>gt;</span>getName()));
<span id="line3830"></span> echo <span class="entity"><span>&amp;</span>quot;</span><span class="entity"><span>&amp;</span>lt;</span>/div<span class="entity"><span>&amp;</span>gt;</span><span class="entity"><span>&amp;</span>lt;</span>br/<span class="entity"><span>&amp;</span>gt;</span><span class="entity"><span>&amp;</span>quot;</span>;
<span id="line3831"></span> }
<span id="line3832"></span> echo $params-<span class="entity"><span>&amp;</span>gt;</span>getForm(array('view' =<span class="entity"><span>&amp;</span>gt;</span> 'vacuum'));
<span id="line3833"></span> printf($lang['vac_desc'], htmlencode($db-<span class="entity"><span>&amp;</span>gt;</span>getName()));
<span id="line3834"></span> echo <span class="entity"><span>&amp;</span>quot;</span><span class="entity"><span>&amp;</span>lt;</span>br/<span class="entity"><span>&amp;</span>gt;</span><span class="entity"><span>&amp;</span>lt;</span>br/<span class="entity"><span>&amp;</span>gt;</span><span class="entity"><span>&amp;</span>quot;</span>;
<span id="line3835"></span> echo <span class="entity"><span>&amp;</span>quot;</span><span class="entity"><span>&amp;</span>lt;</span>input type='submit' value='<span class="entity"><span>&amp;</span>quot;</span> . $lang['vac'] . <span class="entity"><span>&amp;</span>quot;</span>' name='vacuum' class='btn'/<span class="entity"><span>&amp;</span>gt;</span><span class="entity"><span>&amp;</span>quot;</span>;
<span id="line3836"></span> echo <span class="entity"><span>&amp;</span>quot;</span><span class="entity"><span>&amp;</span>lt;</span>/form<span class="entity"><span>&amp;</span>gt;</span><span class="entity"><span>&amp;</span>quot;</span>;
<span id="line3837"></span> } else if ($view == <span class="entity"><span>&amp;</span>quot;</span>export<span class="entity"><span>&amp;</span>quot;</span>) {
<span id="line3838"></span> //- Export view (=export)
<span id="line3839"></span> echo $params-<span class="entity"><span>&amp;</span>gt;</span>getForm(array('view' =<span class="entity"><span>&amp;</span>gt;</span> 'export'));
<span id="line3840"></span> echo <span class="entity"><span>&amp;</span>quot;</span><span class="entity"><span>&amp;</span>lt;</span>fieldset style='float:left; width:260px; margin-right:20px;'<span class="entity"><span>&amp;</span>gt;</span><span class="entity"><span>&amp;</span>lt;</span>legend<span class="entity"><span>&amp;</span>gt;</span><span class="entity"><span>&amp;</span>lt;</span>b<span class="entity"><span>&amp;</span>gt;</span><span class="entity"><span>&amp;</span>quot;</span> . $lang['export'] . <span class="entity"><span>&amp;</span>quot;</span><span class="entity"><span>&amp;</span>lt;</span>/b<span class="entity"><span>&amp;</span>gt;</span><span class="entity"><span>&amp;</span>lt;</span>/legend<span class="entity"><span>&amp;</span>gt;</span><span class="entity"><span>&amp;</span>quot;</span>;
<span id="line3841"></span> echo <span class="entity"><span>&amp;</span>quot;</span><span class="entity"><span>&amp;</span>lt;</span>select multiple='multiple' size='10' style='width:240px;' name='tables[]'<span class="entity"><span>&amp;</span>gt;</span><span class="entity"><span>&amp;</span>quot;</span>;
<span id="line3842"></span> $tables = $db-<span class="entity"><span>&amp;</span>gt;</span>getTables(true, false);
<span id="line3843"></span> foreach ($tables as $tableName =<span class="entity"><span>&amp;</span>gt;</span> $tableType) {
<span id="line3844"></span> echo <span class="entity"><span>&amp;</span>quot;</span><span class="entity"><span>&amp;</span>lt;</span>option value='<span class="entity"><span>&amp;</span>quot;</span> . htmlencode($tableName) . <span class="entity"><span>&amp;</span>quot;</span>' selected='selected'<span class="entity"><span>&amp;</span>gt;</span><span class="entity"><span>&amp;</span>quot;</span> . htmlencode($tableName) . <span class="entity"><span>&amp;</span>quot;</span><span class="entity"><span>&amp;</span>lt;</span>/option<span class="entity"><span>&amp;</span>gt;</span><span class="entity"><span>&amp;</span>quot;</span>;
<span id="line3845"></span> }
<span id="line3846"></span> echo <span class="entity"><span>&amp;</span>quot;</span><span class="entity"><span>&amp;</span>lt;</span>/select<span class="entity"><span>&amp;</span>gt;</span><span class="entity"><span>&amp;</span>quot;</span>;
<span id="line3847"></span> echo <span class="entity"><span>&amp;</span>quot;</span><span class="entity"><span>&amp;</span>lt;</span>br/<span class="entity"><span>&amp;</span>gt;</span><span class="entity"><span>&amp;</span>lt;</span>br/<span class="entity"><span>&amp;</span>gt;</span><span class="entity"><span>&amp;</span>quot;</span>;
<span id="line3848"></span> echo <span class="entity"><span>&amp;</span>quot;</span><span class="entity"><span>&amp;</span>lt;</span>label<span class="entity"><span>&amp;</span>gt;</span><span class="entity"><span>&amp;</span>lt;</span>input type='radio' name='export_type' checked='checked' value='sql' onclick='toggleExports(\<span class="entity"><span>&amp;</span>quot;</span>sql\<span class="entity"><span>&amp;</span>quot;</span>);'/<span class="entity"><span>&amp;</span>gt;</span> <span class="entity"><span>&amp;</span>quot;</span> . $lang['sql'] . <span class="entity"><span>&amp;</span>quot;</span><span class="entity"><span>&amp;</span>lt;</span>/label<span class="entity"><span>&amp;</span>gt;</span><span class="entity"><span>&amp;</span>quot;</span>;
<span id="line3849"></span> echo <span class="entity"><span>&amp;</span>quot;</span><span class="entity"><span>&amp;</span>lt;</span>br/<span class="entity"><span>&amp;</span>gt;</span><span class="entity"><span>&amp;</span>lt;</span>label<span class="entity"><span>&amp;</span>gt;</span><span class="entity"><span>&amp;</span>lt;</span>input type='radio' name='export_type' value='csv' onclick='toggleExports(\<span class="entity"><span>&amp;</span>quot;</span>csv\<span class="entity"><span>&amp;</span>quot;</span>);'/<span class="entity"><span>&amp;</span>gt;</span> <span class="entity"><span>&amp;</span>quot;</span> . $lang['csv'] . <span class="entity"><span>&amp;</span>quot;</span><span class="entity"><span>&amp;</span>lt;</span>/label<span class="entity"><span>&amp;</span>gt;</span><span class="entity"><span>&amp;</span>quot;</span>;
<span id="line3850"></span> echo <span class="entity"><span>&amp;</span>quot;</span><span class="entity"><span>&amp;</span>lt;</span>/fieldset<span class="entity"><span>&amp;</span>gt;</span><span class="entity"><span>&amp;</span>quot;</span>;
<span id="line3851"></span>
<span id="line3852"></span> echo <span class="entity"><span>&amp;</span>quot;</span><span class="entity"><span>&amp;</span>lt;</span>fieldset style='float:left; max-width:350px;' id='exportoptions_sql'<span class="entity"><span>&amp;</span>gt;</span><span class="entity"><span>&amp;</span>lt;</span>legend<span class="entity"><span>&amp;</span>gt;</span><span class="entity"><span>&amp;</span>lt;</span>b<span class="entity"><span>&amp;</span>gt;</span><span class="entity"><span>&amp;</span>quot;</span> . $lang['options'] . <span class="entity"><span>&amp;</span>quot;</span><span class="entity"><span>&amp;</span>lt;</span>/b<span class="entity"><span>&amp;</span>gt;</span><span class="entity"><span>&amp;</span>lt;</span>/legend<span class="entity"><span>&amp;</span>gt;</span><span class="entity"><span>&amp;</span>quot;</span>;
<span id="line3853"></span> echo <span class="entity"><span>&amp;</span>quot;</span><span class="entity"><span>&amp;</span>lt;</span>label<span class="entity"><span>&amp;</span>gt;</span><span class="entity"><span>&amp;</span>lt;</span>input type='checkbox' checked='checked' name='structure'/<span class="entity"><span>&amp;</span>gt;</span> <span class="entity"><span>&amp;</span>quot;</span> . $lang['export_struct'] . <span class="entity"><span>&amp;</span>quot;</span><span class="entity"><span>&amp;</span>lt;</span>/label<span class="entity"><span>&amp;</span>gt;</span> <span class="entity"><span>&amp;</span>quot;</span> . helpLink($lang['help5']) . <span class="entity"><span>&amp;</span>quot;</span><span class="entity"><span>&amp;</span>lt;</span>br/<span class="entity"><span>&amp;</span>gt;</span><span class="entity"><span>&amp;</span>quot;</span>;
<span id="line3854"></span> echo <span class="entity"><span>&amp;</span>quot;</span><span class="entity"><span>&amp;</span>lt;</span>label<span class="entity"><span>&amp;</span>gt;</span><span class="entity"><span>&amp;</span>lt;</span>input type='checkbox' checked='checked' name='data'/<span class="entity"><span>&amp;</span>gt;</span> <span class="entity"><span>&amp;</span>quot;</span> . $lang['export_data'] . <span class="entity"><span>&amp;</span>quot;</span><span class="entity"><span>&amp;</span>lt;</span>/label<span class="entity"><span>&amp;</span>gt;</span> <span class="entity"><span>&amp;</span>quot;</span> . helpLink($lang['help6']) . <span class="entity"><span>&amp;</span>quot;</span><span class="entity"><span>&amp;</span>lt;</span>br/<span class="entity"><span>&amp;</span>gt;</span><span class="entity"><span>&amp;</span>quot;</span>;
<span id="line3855"></span> echo <span class="entity"><span>&amp;</span>quot;</span><span class="entity"><span>&amp;</span>lt;</span>label<span class="entity"><span>&amp;</span>gt;</span><span class="entity"><span>&amp;</span>lt;</span>input type='checkbox' name='drop'/<span class="entity"><span>&amp;</span>gt;</span> <span class="entity"><span>&amp;</span>quot;</span> . $lang['add_drop'] . <span class="entity"><span>&amp;</span>quot;</span><span class="entity"><span>&amp;</span>lt;</span>/label<span class="entity"><span>&amp;</span>gt;</span> <span class="entity"><span>&amp;</span>quot;</span> . helpLink($lang['help7']) . <span class="entity"><span>&amp;</span>quot;</span><span class="entity"><span>&amp;</span>lt;</span>br/<span class="entity"><span>&amp;</span>gt;</span><span class="entity"><span>&amp;</span>quot;</span>;
<span id="line3856"></span> echo <span class="entity"><span>&amp;</span>quot;</span><span class="entity"><span>&amp;</span>lt;</span>label<span class="entity"><span>&amp;</span>gt;</span><span class="entity"><span>&amp;</span>lt;</span>input type='checkbox' checked='checked' name='transaction'/<span class="entity"><span>&amp;</span>gt;</span> <span class="entity"><span>&amp;</span>quot;</span> . $lang['add_transact'] . <span class="entity"><span>&amp;</span>quot;</span><span class="entity"><span>&amp;</span>lt;</span>/label<span class="entity"><span>&amp;</span>gt;</span> <span class="entity"><span>&amp;</span>quot;</span> . helpLink($lang['help8']) . <span class="entity"><span>&amp;</span>quot;</span><span class="entity"><span>&amp;</span>lt;</span>br/<span class="entity"><span>&amp;</span>gt;</span><span class="entity"><span>&amp;</span>quot;</span>;
<span id="line3857"></span> echo <span class="entity"><span>&amp;</span>quot;</span><span class="entity"><span>&amp;</span>lt;</span>label<span class="entity"><span>&amp;</span>gt;</span><span class="entity"><span>&amp;</span>lt;</span>input type='checkbox' checked='checked' name='comments'/<span class="entity"><span>&amp;</span>gt;</span> <span class="entity"><span>&amp;</span>quot;</span> . $lang['comments'] . <span class="entity"><span>&amp;</span>quot;</span><span class="entity"><span>&amp;</span>lt;</span>/label<span class="entity"><span>&amp;</span>gt;</span> <span class="entity"><span>&amp;</span>quot;</span> . helpLink($lang['help9']) . <span class="entity"><span>&amp;</span>quot;</span><span class="entity"><span>&amp;</span>lt;</span>br/<span class="entity"><span>&amp;</span>gt;</span><span class="entity"><span>&amp;</span>quot;</span>;
<span id="line3858"></span> echo <span class="entity"><span>&amp;</span>quot;</span><span class="entity"><span>&amp;</span>lt;</span>/fieldset<span class="entity"><span>&amp;</span>gt;</span><span class="entity"><span>&amp;</span>quot;</span>;
<span id="line3859"></span>
<span id="line3860"></span> echo <span class="entity"><span>&amp;</span>quot;</span><span class="entity"><span>&amp;</span>lt;</span>fieldset style='float:left; max-width:350px; display:none;' id='exportoptions_csv'<span class="entity"><span>&amp;</span>gt;</span><span class="entity"><span>&amp;</span>lt;</span>legend<span class="entity"><span>&amp;</span>gt;</span><span class="entity"><span>&amp;</span>lt;</span>b<span class="entity"><span>&amp;</span>gt;</span><span class="entity"><span>&amp;</span>quot;</span> . $lang['options'] . <span class="entity"><span>&amp;</span>quot;</span><span class="entity"><span>&amp;</span>lt;</span>/b<span class="entity"><span>&amp;</span>gt;</span><span class="entity"><span>&amp;</span>lt;</span>/legend<span class="entity"><span>&amp;</span>gt;</span><span class="entity"><span>&amp;</span>quot;</span>;
<span id="line3861"></span> echo <span class="entity"><span>&amp;</span>quot;</span><span class="entity"><span>&amp;</span>lt;</span>div style='float:left;'<span class="entity"><span>&amp;</span>gt;</span><span class="entity"><span>&amp;</span>quot;</span> . $lang['fld_terminated'] . <span class="entity"><span>&amp;</span>quot;</span><span class="entity"><span>&amp;</span>lt;</span>/div<span class="entity"><span>&amp;</span>gt;</span><span class="entity"><span>&amp;</span>quot;</span>;
<span id="line3862"></span> echo <span class="entity"><span>&amp;</span>quot;</span><span class="entity"><span>&amp;</span>lt;</span>input type='text' value=';' name='export_csv_fieldsterminated' style='float:right;'/<span class="entity"><span>&amp;</span>gt;</span><span class="entity"><span>&amp;</span>quot;</span>;
<span id="line3863"></span> echo <span class="entity"><span>&amp;</span>quot;</span><span class="entity"><span>&amp;</span>lt;</span>div style='clear:both;'<span class="entity"><span>&amp;</span>gt;</span><span class="entity"><span>&amp;</span>quot;</span>;
<span id="line3864"></span> echo <span class="entity"><span>&amp;</span>quot;</span><span class="entity"><span>&amp;</span>lt;</span>div style='float:left;'<span class="entity"><span>&amp;</span>gt;</span><span class="entity"><span>&amp;</span>quot;</span> . $lang['fld_enclosed'] . <span class="entity"><span>&amp;</span>quot;</span><span class="entity"><span>&amp;</span>lt;</span>/div<span class="entity"><span>&amp;</span>gt;</span><span class="entity"><span>&amp;</span>quot;</span>;
<span id="line3865"></span> echo <span class="entity"><span>&amp;</span>quot;</span><span class="entity"><span>&amp;</span>lt;</span>input type='text' value='\<span class="entity"><span>&amp;</span>quot;</span>' name='export_csv_fieldsenclosed' style='float:right;'/<span class="entity"><span>&amp;</span>gt;</span><span class="entity"><span>&amp;</span>quot;</span>;
<span id="line3866"></span> echo <span class="entity"><span>&amp;</span>quot;</span><span class="entity"><span>&amp;</span>lt;</span>div style='clear:both;'<span class="entity"><span>&amp;</span>gt;</span><span class="entity"><span>&amp;</span>quot;</span>;
<span id="line3867"></span> echo <span class="entity"><span>&amp;</span>quot;</span><span class="entity"><span>&amp;</span>lt;</span>div style='float:left;'<span class="entity"><span>&amp;</span>gt;</span><span class="entity"><span>&amp;</span>quot;</span> . $lang['fld_escaped'] . <span class="entity"><span>&amp;</span>quot;</span><span class="entity"><span>&amp;</span>lt;</span>/div<span class="entity"><span>&amp;</span>gt;</span><span class="entity"><span>&amp;</span>quot;</span>;
<span id="line3868"></span> echo <span class="entity"><span>&amp;</span>quot;</span><span class="entity"><span>&amp;</span>lt;</span>input type='text' value='\' name='export_csv_fieldsescaped' style='float:right;'/<span class="entity"><span>&amp;</span>gt;</span><span class="entity"><span>&amp;</span>quot;</span>;
<span id="line3869"></span> echo <span class="entity"><span>&amp;</span>quot;</span><span class="entity"><span>&amp;</span>lt;</span>div style='clear:both;'<span class="entity"><span>&amp;</span>gt;</span><span class="entity"><span>&amp;</span>quot;</span>;
<span id="line3870"></span> echo <span class="entity"><span>&amp;</span>quot;</span><span class="entity"><span>&amp;</span>lt;</span>div style='float:left;'<span class="entity"><span>&amp;</span>gt;</span><span class="entity"><span>&amp;</span>quot;</span> . $lang['rep_null'] . <span class="entity"><span>&amp;</span>quot;</span><span class="entity"><span>&amp;</span>lt;</span>/div<span class="entity"><span>&amp;</span>gt;</span><span class="entity"><span>&amp;</span>quot;</span>;
<span id="line3871"></span> echo <span class="entity"><span>&amp;</span>quot;</span><span class="entity"><span>&amp;</span>lt;</span>input type='text' value='NULL' name='export_csv_replacenull' style='float:right;'/<span class="entity"><span>&amp;</span>gt;</span><span class="entity"><span>&amp;</span>quot;</span>;
<span id="line3872"></span> echo <span class="entity"><span>&amp;</span>quot;</span><span class="entity"><span>&amp;</span>lt;</span>div style='clear:both;'<span class="entity"><span>&amp;</span>gt;</span><span class="entity"><span>&amp;</span>quot;</span>;
<span id="line3873"></span> echo <span class="entity"><span>&amp;</span>quot;</span><span class="entity"><span>&amp;</span>lt;</span>label<span class="entity"><span>&amp;</span>gt;</span><span class="entity"><span>&amp;</span>lt;</span>input type='checkbox' name='export_csv_crlf'/<span class="entity"><span>&amp;</span>gt;</span> <span class="entity"><span>&amp;</span>quot;</span> . $lang['rem_crlf'] . <span class="entity"><span>&amp;</span>quot;</span><span class="entity"><span>&amp;</span>lt;</span>/label<span class="entity"><span>&amp;</span>gt;</span><span class="entity"><span>&amp;</span>lt;</span>br/<span class="entity"><span>&amp;</span>gt;</span><span class="entity"><span>&amp;</span>quot;</span>;
<span id="line3874"></span> echo <span class="entity"><span>&amp;</span>quot;</span><span class="entity"><span>&amp;</span>lt;</span>label<span class="entity"><span>&amp;</span>gt;</span><span class="entity"><span>&amp;</span>lt;</span>input type='checkbox' checked='checked' name='export_csv_fieldnames'/<span class="entity"><span>&amp;</span>gt;</span> <span class="entity"><span>&amp;</span>quot;</span> . $lang['put_fld'] . <span class="entity"><span>&amp;</span>quot;</span><span class="entity"><span>&amp;</span>lt;</span>/label<span class="entity"><span>&amp;</span>gt;</span><span class="entity"><span>&amp;</span>quot;</span>;
<span id="line3875"></span> echo <span class="entity"><span>&amp;</span>quot;</span><span class="entity"><span>&amp;</span>lt;</span>/fieldset<span class="entity"><span>&amp;</span>gt;</span><span class="entity"><span>&amp;</span>quot;</span>;
<span id="line3876"></span>
<span id="line3877"></span> echo <span class="entity"><span>&amp;</span>quot;</span><span class="entity"><span>&amp;</span>lt;</span>div style='clear:both;'<span class="entity"><span>&amp;</span>gt;</span><span class="entity"><span>&amp;</span>lt;</span>/div<span class="entity"><span>&amp;</span>gt;</span><span class="entity"><span>&amp;</span>quot;</span>;
<span id="line3878"></span> echo <span class="entity"><span>&amp;</span>quot;</span><span class="entity"><span>&amp;</span>lt;</span>br/<span class="entity"><span>&amp;</span>gt;</span><span class="entity"><span>&amp;</span>lt;</span>br/<span class="entity"><span>&amp;</span>gt;</span><span class="entity"><span>&amp;</span>quot;</span>;
<span id="line3879"></span> echo <span class="entity"><span>&amp;</span>quot;</span><span class="entity"><span>&amp;</span>lt;</span>fieldset<span class="entity"><span>&amp;</span>gt;</span><span class="entity"><span>&amp;</span>lt;</span>legend<span class="entity"><span>&amp;</span>gt;</span><span class="entity"><span>&amp;</span>lt;</span>b<span class="entity"><span>&amp;</span>gt;</span><span class="entity"><span>&amp;</span>quot;</span> . $lang['save_as'] . <span class="entity"><span>&amp;</span>quot;</span><span class="entity"><span>&amp;</span>lt;</span>/b<span class="entity"><span>&amp;</span>gt;</span><span class="entity"><span>&amp;</span>lt;</span>/legend<span class="entity"><span>&amp;</span>gt;</span><span class="entity"><span>&amp;</span>quot;</span>;
<span id="line3880"></span> $file = pathinfo($db-<span class="entity"><span>&amp;</span>gt;</span>getPath());
<span id="line3881"></span> $name = $file['filename'];
<span id="line3882"></span> echo <span class="entity"><span>&amp;</span>quot;</span><span class="entity"><span>&amp;</span>lt;</span>input type='text' name='filename' value='<span class="entity"><span>&amp;</span>quot;</span> . htmlencode($name) . <span class="entity"><span>&amp;</span>quot;</span>_<span class="entity"><span>&amp;</span>quot;</span> . date(<span class="entity"><span>&amp;</span>quot;</span>Y-m-d<span class="entity"><span>&amp;</span>quot;</span>) . <span class="entity"><span>&amp;</span>quot;</span>.dump' style='width:400px;'/<span class="entity"><span>&amp;</span>gt;</span> <span class="entity"><span>&amp;</span>lt;</span>input type='submit' name='export' value='<span class="entity"><span>&amp;</span>quot;</span> . $lang['export'] . <span class="entity"><span>&amp;</span>quot;</span>' class='btn'/<span class="entity"><span>&amp;</span>gt;</span><span class="entity"><span>&amp;</span>quot;</span>;
<span id="line3883"></span> echo <span class="entity"><span>&amp;</span>quot;</span><span class="entity"><span>&amp;</span>lt;</span>/fieldset<span class="entity"><span>&amp;</span>gt;</span><span class="entity"><span>&amp;</span>quot;</span>;
<span id="line3884"></span> echo <span class="entity"><span>&amp;</span>quot;</span><span class="entity"><span>&amp;</span>lt;</span>/form<span class="entity"><span>&amp;</span>gt;</span><span class="entity"><span>&amp;</span>quot;</span>;
<span id="line3885"></span> echo <span class="entity"><span>&amp;</span>quot;</span><span class="entity"><span>&amp;</span>lt;</span>div class='confirm' style='margin-top: 2em'<span class="entity"><span>&amp;</span>gt;</span><span class="entity"><span>&amp;</span>quot;</span> . sprintf($lang['backup_hint'],
<span id="line3886"></span> $params-<span class="entity"><span>&amp;</span>gt;</span>getLink(array('download' =<span class="entity"><span>&amp;</span>gt;</span> $currentDB['path'], 'token' =<span class="entity"><span>&amp;</span>gt;</span> $_SESSION[COOKIENAME . 'token']), $lang[<span class="entity"><span>&amp;</span>quot;</span>backup_hint_linktext<span class="entity"><span>&amp;</span>quot;</span>], '', $lang['backup'])
<span id="line3887"></span> ) . <span class="entity"><span>&amp;</span>quot;</span><span class="entity"><span>&amp;</span>lt;</span>/div<span class="entity"><span>&amp;</span>gt;</span><span class="entity"><span>&amp;</span>quot;</span>;
<span id="line3888"></span> } else if ($view == <span class="entity"><span>&amp;</span>quot;</span>import<span class="entity"><span>&amp;</span>quot;</span>) {
<span id="line3889"></span> //- Import view (=import)
<span id="line3890"></span> if (isset($_POST['import'])) {
<span id="line3891"></span> echo <span class="entity"><span>&amp;</span>quot;</span><span class="entity"><span>&amp;</span>lt;</span>div class='confirm'<span class="entity"><span>&amp;</span>gt;</span><span class="entity"><span>&amp;</span>quot;</span>;
<span id="line3892"></span> if ($importSuccess === true)
<span id="line3893"></span> echo $lang['import_suc'];
<span id="line3894"></span> else
<span id="line3895"></span> echo $importSuccess;
<span id="line3896"></span> echo <span class="entity"><span>&amp;</span>quot;</span><span class="entity"><span>&amp;</span>lt;</span>/div<span class="entity"><span>&amp;</span>gt;</span><span class="entity"><span>&amp;</span>lt;</span>br/<span class="entity"><span>&amp;</span>gt;</span><span class="entity"><span>&amp;</span>quot;</span>;
<span id="line3897"></span> }
<span id="line3898"></span>
<span id="line3899"></span> echo $params-<span class="entity"><span>&amp;</span>gt;</span>getForm(array('view' =<span class="entity"><span>&amp;</span>gt;</span> 'import'), 'post', true);
<span id="line3900"></span> echo <span class="entity"><span>&amp;</span>quot;</span><span class="entity"><span>&amp;</span>lt;</span>fieldset style='float:left; width:260px; margin-right:20px;'<span class="entity"><span>&amp;</span>gt;</span><span class="entity"><span>&amp;</span>lt;</span>legend<span class="entity"><span>&amp;</span>gt;</span><span class="entity"><span>&amp;</span>lt;</span>b<span class="entity"><span>&amp;</span>gt;</span><span class="entity"><span>&amp;</span>quot;</span> . $lang['import'] . <span class="entity"><span>&amp;</span>quot;</span><span class="entity"><span>&amp;</span>lt;</span>/b<span class="entity"><span>&amp;</span>gt;</span><span class="entity"><span>&amp;</span>lt;</span>/legend<span class="entity"><span>&amp;</span>gt;</span><span class="entity"><span>&amp;</span>quot;</span>;
<span id="line3901"></span> echo <span class="entity"><span>&amp;</span>quot;</span><span class="entity"><span>&amp;</span>lt;</span>label<span class="entity"><span>&amp;</span>gt;</span><span class="entity"><span>&amp;</span>lt;</span>input type='radio' name='import_type' checked='checked' value='sql' onclick='toggleImports(\<span class="entity"><span>&amp;</span>quot;</span>sql\<span class="entity"><span>&amp;</span>quot;</span>);'/<span class="entity"><span>&amp;</span>gt;</span> <span class="entity"><span>&amp;</span>quot;</span> . $lang['sql'] . <span class="entity"><span>&amp;</span>quot;</span><span class="entity"><span>&amp;</span>lt;</span>/label<span class="entity"><span>&amp;</span>gt;</span><span class="entity"><span>&amp;</span>quot;</span>;
<span id="line3902"></span> echo <span class="entity"><span>&amp;</span>quot;</span><span class="entity"><span>&amp;</span>lt;</span>br/<span class="entity"><span>&amp;</span>gt;</span><span class="entity"><span>&amp;</span>lt;</span>label<span class="entity"><span>&amp;</span>gt;</span><span class="entity"><span>&amp;</span>lt;</span>input type='radio' name='import_type' value='csv' onclick='toggleImports(\<span class="entity"><span>&amp;</span>quot;</span>csv\<span class="entity"><span>&amp;</span>quot;</span>);'/<span class="entity"><span>&amp;</span>gt;</span> <span class="entity"><span>&amp;</span>quot;</span> . $lang['csv'] . <span class="entity"><span>&amp;</span>quot;</span><span class="entity"><span>&amp;</span>lt;</span>/label<span class="entity"><span>&amp;</span>gt;</span><span class="entity"><span>&amp;</span>quot;</span>;
<span id="line3903"></span> echo <span class="entity"><span>&amp;</span>quot;</span><span class="entity"><span>&amp;</span>lt;</span>/fieldset<span class="entity"><span>&amp;</span>gt;</span><span class="entity"><span>&amp;</span>quot;</span>;
<span id="line3904"></span>
<span id="line3905"></span> echo <span class="entity"><span>&amp;</span>quot;</span><span class="entity"><span>&amp;</span>lt;</span>fieldset style='float:left; max-width:350px;' id='importoptions_sql'<span class="entity"><span>&amp;</span>gt;</span><span class="entity"><span>&amp;</span>lt;</span>legend<span class="entity"><span>&amp;</span>gt;</span><span class="entity"><span>&amp;</span>lt;</span>b<span class="entity"><span>&amp;</span>gt;</span><span class="entity"><span>&amp;</span>quot;</span> . $lang['options'] . <span class="entity"><span>&amp;</span>quot;</span><span class="entity"><span>&amp;</span>lt;</span>/b<span class="entity"><span>&amp;</span>gt;</span><span class="entity"><span>&amp;</span>lt;</span>/legend<span class="entity"><span>&amp;</span>gt;</span><span class="entity"><span>&amp;</span>quot;</span>;
<span id="line3906"></span> echo $lang['no_opt'];
<span id="line3907"></span> echo <span class="entity"><span>&amp;</span>quot;</span><span class="entity"><span>&amp;</span>lt;</span>/fieldset<span class="entity"><span>&amp;</span>gt;</span><span class="entity"><span>&amp;</span>quot;</span>;
<span id="line3908"></span>
<span id="line3909"></span> echo <span class="entity"><span>&amp;</span>quot;</span><span class="entity"><span>&amp;</span>lt;</span>fieldset style='float:left; max-width:350px; display:none;' id='importoptions_csv'<span class="entity"><span>&amp;</span>gt;</span><span class="entity"><span>&amp;</span>lt;</span>legend<span class="entity"><span>&amp;</span>gt;</span><span class="entity"><span>&amp;</span>lt;</span>b<span class="entity"><span>&amp;</span>gt;</span><span class="entity"><span>&amp;</span>quot;</span> . $lang['options'] . <span class="entity"><span>&amp;</span>quot;</span><span class="entity"><span>&amp;</span>lt;</span>/b<span class="entity"><span>&amp;</span>gt;</span><span class="entity"><span>&amp;</span>lt;</span>/legend<span class="entity"><span>&amp;</span>gt;</span><span class="entity"><span>&amp;</span>quot;</span>;
<span id="line3910"></span> echo <span class="entity"><span>&amp;</span>quot;</span><span class="entity"><span>&amp;</span>lt;</span>div style='float:left;'<span class="entity"><span>&amp;</span>gt;</span><span class="entity"><span>&amp;</span>quot;</span> . $lang['csv_tbl'] . <span class="entity"><span>&amp;</span>quot;</span><span class="entity"><span>&amp;</span>lt;</span>/div<span class="entity"><span>&amp;</span>gt;</span><span class="entity"><span>&amp;</span>quot;</span>;
<span id="line3911"></span> echo <span class="entity"><span>&amp;</span>quot;</span><span class="entity"><span>&amp;</span>lt;</span>select name='single_table' style='float:right;'<span class="entity"><span>&amp;</span>gt;</span><span class="entity"><span>&amp;</span>quot;</span>;
<span id="line3912"></span> $tables = $db-<span class="entity"><span>&amp;</span>gt;</span>getTables(true, false);
<span id="line3913"></span> echo <span class="entity"><span>&amp;</span>quot;</span><span class="entity"><span>&amp;</span>lt;</span>option value=''<span class="entity"><span>&amp;</span>gt;</span>(<span class="entity"><span>&amp;</span>quot;</span> . $lang['create_tbl'] . <span class="entity"><span>&amp;</span>quot;</span>)<span class="entity"><span>&amp;</span>lt;</span>/option<span class="entity"><span>&amp;</span>gt;</span><span class="entity"><span>&amp;</span>quot;</span>;
<span id="line3914"></span> foreach ($tables as $tableName =<span class="entity"><span>&amp;</span>gt;</span> $tableType) {
<span id="line3915"></span> echo <span class="entity"><span>&amp;</span>quot;</span><span class="entity"><span>&amp;</span>lt;</span>option value='<span class="entity"><span>&amp;</span>quot;</span> . htmlencode($tableName) . <span class="entity"><span>&amp;</span>quot;</span>'<span class="entity"><span>&amp;</span>gt;</span><span class="entity"><span>&amp;</span>quot;</span> . htmlencode($tableName) . <span class="entity"><span>&amp;</span>quot;</span><span class="entity"><span>&amp;</span>lt;</span>/option<span class="entity"><span>&amp;</span>gt;</span><span class="entity"><span>&amp;</span>quot;</span>;
<span id="line3916"></span> }
<span id="line3917"></span> echo <span class="entity"><span>&amp;</span>quot;</span><span class="entity"><span>&amp;</span>lt;</span>/select<span class="entity"><span>&amp;</span>gt;</span><span class="entity"><span>&amp;</span>quot;</span>;
<span id="line3918"></span> echo <span class="entity"><span>&amp;</span>quot;</span><span class="entity"><span>&amp;</span>lt;</span>div style='clear:both;'<span class="entity"><span>&amp;</span>gt;</span><span class="entity"><span>&amp;</span>quot;</span>;
<span id="line3919"></span> echo <span class="entity"><span>&amp;</span>quot;</span><span class="entity"><span>&amp;</span>lt;</span>div style='float:left;'<span class="entity"><span>&amp;</span>gt;</span><span class="entity"><span>&amp;</span>quot;</span> . $lang['fld_terminated'] . <span class="entity"><span>&amp;</span>quot;</span><span class="entity"><span>&amp;</span>lt;</span>/div<span class="entity"><span>&amp;</span>gt;</span><span class="entity"><span>&amp;</span>quot;</span>;
<span id="line3920"></span> echo <span class="entity"><span>&amp;</span>quot;</span><span class="entity"><span>&amp;</span>lt;</span>input type='text' value=';' name='import_csv_fieldsterminated' style='float:right;'/<span class="entity"><span>&amp;</span>gt;</span><span class="entity"><span>&amp;</span>quot;</span>;
<span id="line3921"></span> echo <span class="entity"><span>&amp;</span>quot;</span><span class="entity"><span>&amp;</span>lt;</span>div style='clear:both;'<span class="entity"><span>&amp;</span>gt;</span><span class="entity"><span>&amp;</span>quot;</span>;
<span id="line3922"></span> echo <span class="entity"><span>&amp;</span>quot;</span><span class="entity"><span>&amp;</span>lt;</span>div style='float:left;'<span class="entity"><span>&amp;</span>gt;</span><span class="entity"><span>&amp;</span>quot;</span> . $lang['fld_enclosed'] . <span class="entity"><span>&amp;</span>quot;</span><span class="entity"><span>&amp;</span>lt;</span>/div<span class="entity"><span>&amp;</span>gt;</span><span class="entity"><span>&amp;</span>quot;</span>;
<span id="line3923"></span> echo <span class="entity"><span>&amp;</span>quot;</span><span class="entity"><span>&amp;</span>lt;</span>input type='text' value='\<span class="entity"><span>&amp;</span>quot;</span>' name='import_csv_fieldsenclosed' style='float:right;'/<span class="entity"><span>&amp;</span>gt;</span><span class="entity"><span>&amp;</span>quot;</span>;
<span id="line3924"></span> echo <span class="entity"><span>&amp;</span>quot;</span><span class="entity"><span>&amp;</span>lt;</span>div style='clear:both;'<span class="entity"><span>&amp;</span>gt;</span><span class="entity"><span>&amp;</span>quot;</span>;
<span id="line3925"></span> echo <span class="entity"><span>&amp;</span>quot;</span><span class="entity"><span>&amp;</span>lt;</span>div style='float:left;'<span class="entity"><span>&amp;</span>gt;</span><span class="entity"><span>&amp;</span>quot;</span> . $lang['fld_escaped'] . <span class="entity"><span>&amp;</span>quot;</span><span class="entity"><span>&amp;</span>lt;</span>/div<span class="entity"><span>&amp;</span>gt;</span><span class="entity"><span>&amp;</span>quot;</span>;
<span id="line3926"></span> echo <span class="entity"><span>&amp;</span>quot;</span><span class="entity"><span>&amp;</span>lt;</span>input type='text' value='\' name='import_csv_fieldsescaped' style='float:right;'/<span class="entity"><span>&amp;</span>gt;</span><span class="entity"><span>&amp;</span>quot;</span>;
<span id="line3927"></span> echo <span class="entity"><span>&amp;</span>quot;</span><span class="entity"><span>&amp;</span>lt;</span>div style='clear:both;'<span class="entity"><span>&amp;</span>gt;</span><span class="entity"><span>&amp;</span>quot;</span>;
<span id="line3928"></span> echo <span class="entity"><span>&amp;</span>quot;</span><span class="entity"><span>&amp;</span>lt;</span>div style='float:left;'<span class="entity"><span>&amp;</span>gt;</span><span class="entity"><span>&amp;</span>quot;</span> . $lang['null_represent'] . <span class="entity"><span>&amp;</span>quot;</span><span class="entity"><span>&amp;</span>lt;</span>/div<span class="entity"><span>&amp;</span>gt;</span><span class="entity"><span>&amp;</span>quot;</span>;
<span id="line3929"></span> echo <span class="entity"><span>&amp;</span>quot;</span><span class="entity"><span>&amp;</span>lt;</span>input type='text' value='NULL' name='import_csv_replacenull' style='float:right;'/<span class="entity"><span>&amp;</span>gt;</span><span class="entity"><span>&amp;</span>quot;</span>;
<span id="line3930"></span> echo <span class="entity"><span>&amp;</span>quot;</span><span class="entity"><span>&amp;</span>lt;</span>div style='clear:both;'<span class="entity"><span>&amp;</span>gt;</span><span class="entity"><span>&amp;</span>quot;</span>;
<span id="line3931"></span> echo <span class="entity"><span>&amp;</span>quot;</span><span class="entity"><span>&amp;</span>lt;</span>label<span class="entity"><span>&amp;</span>gt;</span><span class="entity"><span>&amp;</span>lt;</span>input type='checkbox' checked='checked' name='import_csv_fieldnames'/<span class="entity"><span>&amp;</span>gt;</span> <span class="entity"><span>&amp;</span>quot;</span> . $lang['fld_names'] . <span class="entity"><span>&amp;</span>quot;</span><span class="entity"><span>&amp;</span>lt;</span>/label<span class="entity"><span>&amp;</span>gt;</span><span class="entity"><span>&amp;</span>quot;</span>;
<span id="line3932"></span> echo <span class="entity"><span>&amp;</span>quot;</span><span class="entity"><span>&amp;</span>lt;</span>/fieldset<span class="entity"><span>&amp;</span>gt;</span><span class="entity"><span>&amp;</span>quot;</span>;
<span id="line3933"></span>
<span id="line3934"></span> echo <span class="entity"><span>&amp;</span>quot;</span><span class="entity"><span>&amp;</span>lt;</span>div style='clear:both;'<span class="entity"><span>&amp;</span>gt;</span><span class="entity"><span>&amp;</span>lt;</span>/div<span class="entity"><span>&amp;</span>gt;</span><span class="entity"><span>&amp;</span>quot;</span>;
<span id="line3935"></span> echo <span class="entity"><span>&amp;</span>quot;</span><span class="entity"><span>&amp;</span>lt;</span>br/<span class="entity"><span>&amp;</span>gt;</span><span class="entity"><span>&amp;</span>lt;</span>br/<span class="entity"><span>&amp;</span>gt;</span><span class="entity"><span>&amp;</span>quot;</span>;
<span id="line3936"></span>
<span id="line3937"></span> echo <span class="entity"><span>&amp;</span>quot;</span><span class="entity"><span>&amp;</span>lt;</span>fieldset<span class="entity"><span>&amp;</span>gt;</span><span class="entity"><span>&amp;</span>lt;</span>legend<span class="entity"><span>&amp;</span>gt;</span><span class="entity"><span>&amp;</span>lt;</span>b<span class="entity"><span>&amp;</span>gt;</span><span class="entity"><span>&amp;</span>quot;</span> . $lang['import_f'] . <span class="entity"><span>&amp;</span>quot;</span><span class="entity"><span>&amp;</span>lt;</span>/b<span class="entity"><span>&amp;</span>gt;</span><span class="entity"><span>&amp;</span>lt;</span>/legend<span class="entity"><span>&amp;</span>gt;</span><span class="entity"><span>&amp;</span>quot;</span>;
<span id="line3938"></span> echo <span class="entity"><span>&amp;</span>quot;</span><span class="entity"><span>&amp;</span>lt;</span>em<span class="entity"><span>&amp;</span>gt;</span><span class="entity"><span>&amp;</span>quot;</span> . $lang['max_file_size'] . <span class="entity"><span>&amp;</span>quot;</span>: <span class="entity"><span>&amp;</span>quot;</span> . number_format(fileUploadMaxSize() / 1024 / 1024) . <span class="entity"><span>&amp;</span>quot;</span> MiB<span class="entity"><span>&amp;</span>lt;</span>/em<span class="entity"><span>&amp;</span>gt;</span> <span class="entity"><span>&amp;</span>quot;</span> . helpLink($lang['help11']) . <span class="entity"><span>&amp;</span>quot;</span><span class="entity"><span>&amp;</span>lt;</span>br /<span class="entity"><span>&amp;</span>gt;</span><span class="entity"><span>&amp;</span>quot;</span>;
<span id="line3939"></span> echo <span class="entity"><span>&amp;</span>quot;</span><span class="entity"><span>&amp;</span>lt;</span>input type='file' value='<span class="entity"><span>&amp;</span>quot;</span> . $lang['choose_f'] . <span class="entity"><span>&amp;</span>quot;</span>' name='file' style='background-color:transparent; border-style:none; margin:0; padding:0' onchange='checkFileSize(this)'/<span class="entity"><span>&amp;</span>gt;</span><span class="entity"><span>&amp;</span>quot;</span>;
<span id="line3940"></span> echo <span class="entity"><span>&amp;</span>quot;</span><span class="entity"><span>&amp;</span>lt;</span>input type='submit' value='<span class="entity"><span>&amp;</span>quot;</span> . $lang['import'] . <span class="entity"><span>&amp;</span>quot;</span>' name='import' class='btn'/<span class="entity"><span>&amp;</span>gt;</span><span class="entity"><span>&amp;</span>quot;</span>;
<span id="line3941"></span> echo <span class="entity"><span>&amp;</span>quot;</span><span class="entity"><span>&amp;</span>lt;</span>/fieldset<span class="entity"><span>&amp;</span>gt;</span><span class="entity"><span>&amp;</span>quot;</span>;
<span id="line3942"></span> } else if ($view == <span class="entity"><span>&amp;</span>quot;</span>rename<span class="entity"><span>&amp;</span>quot;</span>) {
<span id="line3943"></span> //- Rename database confirmation (=rename)
<span id="line3944"></span> echo $params-<span class="entity"><span>&amp;</span>gt;</span>getForm(array('view' =<span class="entity"><span>&amp;</span>gt;</span> 'rename', 'database_rename' =<span class="entity"><span>&amp;</span>gt;</span> '1'));
<span id="line3945"></span> echo <span class="entity"><span>&amp;</span>quot;</span><span class="entity"><span>&amp;</span>lt;</span>input type='hidden' name='oldname' value='<span class="entity"><span>&amp;</span>quot;</span> . htmlencode($db-<span class="entity"><span>&amp;</span>gt;</span>getPath()) . <span class="entity"><span>&amp;</span>quot;</span>'/<span class="entity"><span>&amp;</span>gt;</span><span class="entity"><span>&amp;</span>quot;</span>;
<span id="line3946"></span> echo $lang['db_rename'] . <span class="entity"><span>&amp;</span>quot;</span> '<span class="entity"><span>&amp;</span>quot;</span> . htmlencode($db-<span class="entity"><span>&amp;</span>gt;</span>getPath()) . <span class="entity"><span>&amp;</span>quot;</span>' <span class="entity"><span>&amp;</span>quot;</span> . $lang['to'] . <span class="entity"><span>&amp;</span>quot;</span> <span class="entity"><span>&amp;</span>lt;</span>input type='text' name='newname' style='width:200px;' value='<span class="entity"><span>&amp;</span>quot;</span> . htmlencode($db-<span class="entity"><span>&amp;</span>gt;</span>getPath()) . <span class="entity"><span>&amp;</span>quot;</span>'/<span class="entity"><span>&amp;</span>gt;</span> <span class="entity"><span>&amp;</span>lt;</span>input type='submit' value='<span class="entity"><span>&amp;</span>quot;</span> . $lang['rename'] . <span class="entity"><span>&amp;</span>quot;</span>' name='rename' class='btn'/<span class="entity"><span>&amp;</span>gt;</span><span class="entity"><span>&amp;</span>quot;</span>;
<span id="line3947"></span> echo <span class="entity"><span>&amp;</span>quot;</span><span class="entity"><span>&amp;</span>lt;</span>/form<span class="entity"><span>&amp;</span>gt;</span><span class="entity"><span>&amp;</span>quot;</span>;
<span id="line3948"></span> } else if ($view == <span class="entity"><span>&amp;</span>quot;</span>delete<span class="entity"><span>&amp;</span>quot;</span>) {
<span id="line3949"></span> //- Delete database confirmation (=delete)
<span id="line3950"></span> echo $params-<span class="entity"><span>&amp;</span>gt;</span>getForm(array('database_delete' =<span class="entity"><span>&amp;</span>gt;</span> '1'));
<span id="line3951"></span> echo <span class="entity"><span>&amp;</span>quot;</span><span class="entity"><span>&amp;</span>lt;</span>div class='confirm'<span class="entity"><span>&amp;</span>gt;</span><span class="entity"><span>&amp;</span>quot;</span>;
<span id="line3952"></span> echo sprintf($lang['ques_del_db'], htmlencode($db-<span class="entity"><span>&amp;</span>gt;</span>getPath())) . <span class="entity"><span>&amp;</span>quot;</span><span class="entity"><span>&amp;</span>lt;</span>br/<span class="entity"><span>&amp;</span>gt;</span><span class="entity"><span>&amp;</span>lt;</span>br/<span class="entity"><span>&amp;</span>gt;</span><span class="entity"><span>&amp;</span>quot;</span>;
<span id="line3953"></span> echo <span class="entity"><span>&amp;</span>quot;</span><span class="entity"><span>&amp;</span>lt;</span>input name='database_delete' value='<span class="entity"><span>&amp;</span>quot;</span> . htmlencode($db-<span class="entity"><span>&amp;</span>gt;</span>getPath()) . <span class="entity"><span>&amp;</span>quot;</span>' type='hidden'/<span class="entity"><span>&amp;</span>gt;</span><span class="entity"><span>&amp;</span>quot;</span>;
<span id="line3954"></span> echo <span class="entity"><span>&amp;</span>quot;</span><span class="entity"><span>&amp;</span>lt;</span>input type='submit' value='<span class="entity"><span>&amp;</span>quot;</span> . $lang['confirm'] . <span class="entity"><span>&amp;</span>quot;</span>' class='btn'/<span class="entity"><span>&amp;</span>gt;</span> <span class="entity"><span>&amp;</span>quot;</span>;
<span id="line3955"></span> echo $params-<span class="entity"><span>&amp;</span>gt;</span>getLink(array(), $lang['cancel']);
<span id="line3956"></span> echo <span class="entity"><span>&amp;</span>quot;</span><span class="entity"><span>&amp;</span>lt;</span>/div<span class="entity"><span>&amp;</span>gt;</span><span class="entity"><span>&amp;</span>quot;</span>;
<span id="line3957"></span> echo <span class="entity"><span>&amp;</span>quot;</span><span class="entity"><span>&amp;</span>lt;</span>/form<span class="entity"><span>&amp;</span>gt;</span><span class="entity"><span>&amp;</span>quot;</span>;
<span id="line3958"></span> }
<span id="line3959"></span>
<span id="line3960"></span> echo <span class="entity"><span>&amp;</span>quot;</span><span class="entity"><span>&amp;</span>lt;</span>/div<span class="entity"><span>&amp;</span>gt;</span><span class="entity"><span>&amp;</span>quot;</span>;
<span id="line3961"></span>}
<span id="line3962"></span>echo <span class="entity"><span>&amp;</span>quot;</span><span class="entity"><span>&amp;</span>lt;</span>/div<span class="entity"><span>&amp;</span>gt;</span><span class="entity"><span>&amp;</span>quot;</span>;
<span id="line3963"></span>
<span id="line3964"></span>//- HTML: page footer
<span id="line3965"></span>echo <span class="entity"><span>&amp;</span>quot;</span><span class="entity"><span>&amp;</span>lt;</span>br/<span class="entity"><span>&amp;</span>gt;</span><span class="entity"><span>&amp;</span>quot;</span>;
<span id="line3966"></span>echo <span class="entity"><span>&amp;</span>quot;</span><span class="entity"><span>&amp;</span>lt;</span>span style='font-size:11px;'<span class="entity"><span>&amp;</span>gt;</span><span class="entity"><span>&amp;</span>quot;</span> . $lang['powered'] . <span class="entity"><span>&amp;</span>quot;</span> <span class="entity"><span>&amp;</span>lt;</span>a href='<span class="entity"><span>&amp;</span>quot;</span> . PROJECT_URL . <span class="entity"><span>&amp;</span>quot;</span>' target='_blank' style='font-size:11px;'<span class="entity"><span>&amp;</span>gt;</span><span class="entity"><span>&amp;</span>quot;</span> . PROJECT . <span class="entity"><span>&amp;</span>quot;</span><span class="entity"><span>&amp;</span>lt;</span>/a<span class="entity"><span>&amp;</span>gt;</span> | <span class="entity"><span>&amp;</span>quot;</span>;
<span id="line3967"></span>echo $lang['free_software'] . <span class="entity"><span>&amp;</span>quot;</span> <span class="entity"><span>&amp;</span>lt;</span>a href='<span class="entity"><span>&amp;</span>quot;</span> . DONATE_URL . <span class="entity"><span>&amp;</span>quot;</span>' target='_blank' style='font-size:11px;'<span class="entity"><span>&amp;</span>gt;</span><span class="entity"><span>&amp;</span>quot;</span> . $lang['please_donate'] . <span class="entity"><span>&amp;</span>quot;</span><span class="entity"><span>&amp;</span>lt;</span>/a<span class="entity"><span>&amp;</span>gt;</span> | <span class="entity"><span>&amp;</span>quot;</span>;
<span id="line3968"></span>printf($lang['page_gen'], $pageTimer);
<span id="line3969"></span>echo <span class="entity"><span>&amp;</span>quot;</span><span class="entity"><span>&amp;</span>lt;</span>/span<span class="entity"><span>&amp;</span>gt;</span><span class="entity"><span>&amp;</span>quot;</span>;
<span id="line3970"></span>echo <span class="entity"><span>&amp;</span>quot;</span><span class="entity"><span>&amp;</span>lt;</span>/td<span class="entity"><span>&amp;</span>gt;</span><span class="entity"><span>&amp;</span>lt;</span>/tr<span class="entity"><span>&amp;</span>gt;</span><span class="entity"><span>&amp;</span>lt;</span>/table<span class="entity"><span>&amp;</span>gt;</span><span class="entity"><span>&amp;</span>quot;</span>;
<span id="line3971"></span>$db-<span class="entity"><span>&amp;</span>gt;</span>close(); //close the database
<span id="line3972"></span>echo <span class="entity"><span>&amp;</span>quot;</span><span class="entity"><span>&amp;</span>lt;</span>/body<span class="entity"><span>&amp;</span>gt;</span><span class="entity"><span>&amp;</span>quot;</span>;
<span id="line3973"></span>echo <span class="entity"><span>&amp;</span>quot;</span><span class="entity"><span>&amp;</span>lt;</span>/html<span class="entity"><span>&amp;</span>gt;</span><span class="entity"><span>&amp;</span>quot;</span>;
<span id="line3974"></span>
<span id="line3975"></span>//- End of main code
<span id="line3976"></span>
<span id="line3977"></span>// Authorization class
<span id="line3978"></span>// Maintains user's logged-in state and security of application
<span id="line3979"></span>//
<span id="line3980"></span>
<span id="line3981"></span>class Authorization
<span id="line3982"></span>{
<span id="line3983"></span> private $authorized;
<span id="line3984"></span> private $login_failed;
<span id="line3985"></span> private $system_password_encrypted;
<span id="line3986"></span>
<span id="line3987"></span> public function __construct()
<span id="line3988"></span> {
<span id="line3989"></span> // first, make sure a CSRF token is generated
<span id="line3990"></span> $this-<span class="entity"><span>&amp;</span>gt;</span>generateToken();
<span id="line3991"></span> // second, check for possible CSRF attacks. to protect logins, this is done before checking login
<span id="line3992"></span> $this-<span class="entity"><span>&amp;</span>gt;</span>checkToken();
<span id="line3993"></span>
<span id="line3994"></span> // the salt and password encrypting is probably unnecessary protection but is done just
<span id="line3995"></span> // for the sake of being very secure
<span id="line3996"></span> if (!isset($_SESSION[COOKIENAME . '_salt']) <span class="entity"><span>&amp;</span>amp;</span><span class="entity"><span>&amp;</span>amp;</span> !isset($_COOKIE[COOKIENAME . '_salt'])) {
<span id="line3997"></span> // create a random salt for this session if a cookie doesn't already exist for it
<span id="line3998"></span> $_SESSION[COOKIENAME . '_salt'] = self::generateSalt(22);
<span id="line3999"></span> } else if (!isset($_SESSION[COOKIENAME . '_salt']) <span class="entity"><span>&amp;</span>amp;</span><span class="entity"><span>&amp;</span>amp;</span> isset($_COOKIE[COOKIENAME . '_salt'])) {
<span id="line4000"></span> // session doesn't exist, but cookie does so grab it
<span id="line4001"></span> $_SESSION[COOKIENAME . '_salt'] = $_COOKIE[COOKIENAME . '_salt'];
<span id="line4002"></span> }
<span id="line4003"></span>
<span id="line4004"></span><span style="font-weight: bold"> // salted and encrypted password used for checking</span>
<span id="line4005"></span><span style="color: lawngreen; font-weight: bold"> $this->system_password_encrypted = md5(SYSTEMPASSWORD . "_" . $_SESSION[COOKIENAME . '_salt']);</span>
<span id="line4006"></span>
<span id="line4007"></span> $this-<span class="entity"><span>&amp;</span>gt;</span>authorized =
<span id="line4008"></span> // no password
<span id="line4009"></span> SYSTEMPASSWORD == ''
<span id="line4010"></span> // correct password stored in session
<span id="line4011"></span> || isset($_SESSION[COOKIENAME . 'password']) <span class="entity"><span>&amp;</span>amp;</span><span class="entity"><span>&amp;</span>amp;</span> hash_equals($_SESSION[COOKIENAME . 'password'], $this-<span class="entity"><span>&amp;</span>gt;</span>system_password_encrypted)
<span id="line4012"></span> // correct password stored in cookie
<span id="line4013"></span> || isset($_COOKIE[COOKIENAME]) <span class="entity"><span>&amp;</span>amp;</span><span class="entity"><span>&amp;</span>amp;</span> isset($_COOKIE[COOKIENAME . '_salt']) <span class="entity"><span>&amp;</span>amp;</span><span class="entity"><span>&amp;</span>amp;</span> hash_equals(md5(SYSTEMPASSWORD . <span class="entity"><span>&amp;</span>quot;</span>_<span class="entity"><span>&amp;</span>quot;</span> . $_COOKIE[COOKIENAME . '_salt']), $_COOKIE[COOKIENAME]);
<span id="line4014"></span> }
<span id="line4015"></span>
<span id="line4016"></span> public function attemptGrant($password, $remember)
<span id="line4017"></span> {
<span id="line4018"></span> $hashed_password = crypt(SYSTEMPASSWORD, '$2a$07$' . self::generateSalt(22) . '$');
<span id="line4019"></span> if (hash_equals($hashed_password, crypt($password, $hashed_password))) {
<span id="line4020"></span><span style="font-weight: bold"> if ($remember) {</span>
<span id="line4021"></span><span style="font-weight: bold"> // user wants to be remembered, so set a cookie</span>
<span id="line4022"></span><span style="color: lawngreen; font-weight: bold"> $expire = time() + 60 * 60 * 24 * 30; //set expiration to 1 month from now</span>
<span id="line4023"></span><span style="color: lawngreen; font-weight: bold"> setcookie(COOKIENAME, $this->system_password_encrypted, $expire, null, null, null, true);</span>
<span id="line4024"></span> //setcookie(COOKIENAME . "_salt", $_SESSION[COOKIENAME . '_salt'], $expire, null, null, null, true);</span>
<span id="line4025"></span><span style="font-weight: bold"> } else {</span>
<span id="line4026"></span><span style="font-weight: bold"> // user does not want to be remembered, so destroy any potential cookies</span>
<span id="line4027"></span><span style="color: lawngreen; font-weight: bold">setcookie(COOKIENAME, "", time() - 86400, null, null, null, true);</span>
<span id="line4028"></span> //setcookie(COOKIENAME . "_salt", "", time() - 86400, null, null, null, true);
<span id="line4029"></span><span style="color: lawngreen; font-weight: bold"> unset($_COOKIE[COOKIENAME]);</span>
<span id="line4030"></span> //unset($_COOKIE[COOKIENAME . '_salt']);
<span id="line4031"></span><span style="font-weight: bold"> }</span>
<span id="line4032"></span> 
<span id="line4033"></span> $_SESSION[COOKIENAME . 'password'] = $this-<span class="entity"><span>&amp;</span>gt;</span>system_password_encrypted;
<span id="line4034"></span> $this-<span class="entity"><span>&amp;</span>gt;</span>authorized = true;
<span id="line4035"></span> return true;
<span id="line4036"></span> }
<span id="line4037"></span> 
<span id="line4038"></span> $this-<span class="entity"><span>&amp;</span>gt;</span>login_failed = true;
<span id="line4039"></span> return false;
<span id="line4040"></span> }
<span id="line4041"></span>
<span id="line4042"></span><span style="font-weight: bold"> public function revoke()</span>
<span id="line4043"></span><span style="font-weight: bold"> {</span>
<span id="line4044"></span><span style="font-weight: bold"> //destroy everything - cookies and session vars</span>
<span id="line4045"></span><span style="color: lawngreen; font-weight: bold"> setcookie(COOKIENAME, "", time() - 86400, null, null, null, true);</span>
<span id="line4046"></span><span style="color: lawngreen; font-weight: bold"> unset($_COOKIE[COOKIENAME]);</span>
<span id="line4047"></span><span style="font-weight: bold"> session_unset();</span>
<span id="line4048"></span><span style="font-weight: bold"> session_destroy();</span>
<span id="line4049"></span><span style="font-weight: bold"> $this->authorized = false;</span>
<span id="line4050"></span><span style="font-weight: bold"> // start a new session and generate a new CSRF token for the login form</span>
<span id="line4051"></span><span style="font-weight: bold"> session_start();</span>
<span id="line4052"></span><span style="font-weight: bold"> $this->generateToken();</span>
<span id="line4053"></span><span style="font-weight: bold"> }</span>
<span id="line4054"></span>
<span id="line4055"></span> public function isAuthorized()
<span id="line4056"></span> {
<span id="line4057"></span> return $this-<span class="entity"><span>&amp;</span>gt;</span>authorized;
<span id="line4058"></span> }
<span id="line4059"></span>
<span id="line4060"></span> public function isFailedLogin()
<span id="line4061"></span> {
<span id="line4062"></span> return $this-<span class="entity"><span>&amp;</span>gt;</span>login_failed;
<span id="line4063"></span> }
<span id="line4064"></span>
<span id="line4065"></span> public function isPasswordDefault()
<span id="line4066"></span> {
<span id="line4067"></span> return SYSTEMPASSWORD == 'admin';
<span id="line4068"></span> }
<span id="line4069"></span>
<span id="line4070"></span> private static function generateSalt($saltSize)
<span id="line4071"></span> {
<span id="line4072"></span> $set = 'ABCDEFGHiJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789';
<span id="line4073"></span> $setLast = strlen($set) - 1;
<span id="line4074"></span> $salt = '';
<span id="line4075"></span> while ($saltSize-- <span class="entity"><span>&amp;</span>gt;</span> 0) {
<span id="line4076"></span> $salt .= $set[mt_rand(0, $setLast)];
<span id="line4077"></span> }
<span id="line4078"></span> return $salt;
<span id="line4079"></span> }
<span id="line4080"></span>
<span id="line4081"></span> private function generateToken()
<span id="line4082"></span> {
<span id="line4083"></span> // generate CSRF token 
<span id="line4084"></span> if (empty($_SESSION[COOKIENAME . 'token'])) {
<span id="line4085"></span> if (function_exists('random_bytes')) // introduced in PHP 7.0
<span id="line4086"></span> {
<span id="line4087"></span> $_SESSION[COOKIENAME . 'token'] = bin2hex(random_bytes(32));
<span id="line4088"></span> } elseif (function_exists('openssl_random_pseudo_bytes')) // introduced in PHP 5.3.0
<span id="line4089"></span> {
<span id="line4090"></span> $_SESSION[COOKIENAME . 'token'] = bin2hex(openssl_random_pseudo_bytes(32));
<span id="line4091"></span> } else {
<span id="line4092"></span> // For PHP 5.2.x - This case can be removed once we drop support for 5.2.x
<span id="line4093"></span> $_SESSION[COOKIENAME . 'token'] = bin2hex(mcrypt_create_iv(32, MCRYPT_DEV_URANDOM));
<span id="line4094"></span> }
<span id="line4095"></span> }
<span id="line4096"></span> }
<span id="line4097"></span>
<span id="line4098"></span> private function checkToken()
<span id="line4099"></span> {
<span id="line4100"></span> // checking CSRF token
<span id="line4101"></span> if ($_SERVER['REQUEST_METHOD'] === 'POST' || isset($_GET['download'])) // all POST forms need tokens! downloads are protected as well
<span id="line4102"></span> {
<span id="line4103"></span> if ($_SERVER['REQUEST_METHOD'] === 'POST' <span class="entity"><span>&amp;</span>amp;</span><span class="entity"><span>&amp;</span>amp;</span> isset($_POST['token']))
<span id="line4104"></span> $check_token = $_POST['token'];
<span id="line4105"></span> elseif ($_SERVER['REQUEST_METHOD'] === 'GET' <span class="entity"><span>&amp;</span>amp;</span><span class="entity"><span>&amp;</span>amp;</span> isset($_GET['token']))
<span id="line4106"></span> $check_token = $_GET['token'];
<span id="line4107"></span>
<span id="line4108"></span> if (!isset($check_token)) {
<span id="line4109"></span> die(<span class="entity"><span>&amp;</span>quot;</span>CSRF token missing<span class="entity"><span>&amp;</span>quot;</span>);
<span id="line4110"></span> } elseif (!hash_equals($_SESSION[COOKIENAME . 'token'], $check_token)) {
<span id="line4111"></span> die(<span class="entity"><span>&amp;</span>quot;</span>CSRF token is wrong - please try to login again<span class="entity"><span>&amp;</span>quot;</span>);
<span id="line4112"></span> }
<span id="line4113"></span> }
<span id="line4114"></span> }
<span id="line4115"></span>
<span id="line4116"></span>}
<span id="line4117"></span>
<span id="line4118"></span>// Database class
<span id="line4119"></span>// Generic database abstraction class to manage interaction with database without worrying about SQLite vs. PHP versions
<span id="line4120"></span>//
<span id="line4121"></span>class Database
<span id="line4122"></span>{
<span id="line4123"></span> protected $db; //reference to the DB object
<span id="line4124"></span> protected $type; //the extension for PHP that handles SQLite
<span id="line4125"></span> protected $data;
<span id="line4126"></span> protected $lastResult;
<span id="line4127"></span> protected $alterError;
<span id="line4128"></span> protected $debugOutput = '';
<span id="line4129"></span>
<span id="line4130"></span> public function __construct($data)
<span id="line4131"></span> {
<span id="line4132"></span> global $lang, $params;
<span id="line4133"></span> $this-<span class="entity"><span>&amp;</span>gt;</span>data = $data;
<span id="line4134"></span> try {
<span id="line4135"></span> if (!file_exists($this-<span class="entity"><span>&amp;</span>gt;</span>data[<span class="entity"><span>&amp;</span>quot;</span>path<span class="entity"><span>&amp;</span>quot;</span>]) <span class="entity"><span>&amp;</span>amp;</span><span class="entity"><span>&amp;</span>amp;</span> !is_writable(dirname($this-<span class="entity"><span>&amp;</span>gt;</span>data[<span class="entity"><span>&amp;</span>quot;</span>path<span class="entity"><span>&amp;</span>quot;</span>]))) //make sure the containing directory is writable if the database does not exist
<span id="line4136"></span> {
<span id="line4137"></span> echo <span class="entity"><span>&amp;</span>quot;</span><span class="entity"><span>&amp;</span>lt;</span>div class='confirm' style='margin:20px;'<span class="entity"><span>&amp;</span>gt;</span><span class="entity"><span>&amp;</span>quot;</span>;
<span id="line4138"></span> printf($lang['db_not_writeable'], htmlencode($this-<span class="entity"><span>&amp;</span>gt;</span>data[<span class="entity"><span>&amp;</span>quot;</span>path<span class="entity"><span>&amp;</span>quot;</span>]), htmlencode(dirname($this-<span class="entity"><span>&amp;</span>gt;</span>data[<span class="entity"><span>&amp;</span>quot;</span>path<span class="entity"><span>&amp;</span>quot;</span>])));
<span id="line4139"></span> echo $params-<span class="entity"><span>&amp;</span>gt;</span>getForm();
<span id="line4140"></span> echo <span class="entity"><span>&amp;</span>quot;</span><span class="entity"><span>&amp;</span>lt;</span>input type='submit' value='Log Out' name='<span class="entity"><span>&amp;</span>quot;</span> . $lang['logout'] . <span class="entity"><span>&amp;</span>quot;</span>' class='btn'/<span class="entity"><span>&amp;</span>gt;</span><span class="entity"><span>&amp;</span>quot;</span>;
<span id="line4141"></span> echo <span class="entity"><span>&amp;</span>quot;</span><span class="entity"><span>&amp;</span>lt;</span>/form<span class="entity"><span>&amp;</span>gt;</span><span class="entity"><span>&amp;</span>quot;</span>;
<span id="line4142"></span> echo <span class="entity"><span>&amp;</span>quot;</span><span class="entity"><span>&amp;</span>lt;</span>/div<span class="entity"><span>&amp;</span>gt;</span><span class="entity"><span>&amp;</span>lt;</span>br/<span class="entity"><span>&amp;</span>gt;</span><span class="entity"><span>&amp;</span>quot;</span>;
<span id="line4143"></span> exit();
<span id="line4144"></span> }
<span id="line4145"></span>
<span id="line4146"></span> $ver = $this-<span class="entity"><span>&amp;</span>gt;</span>getVersion();
<span id="line4147"></span>
<span id="line4148"></span> switch (true) {
<span id="line4149"></span> case ((!isset($data['type']) || $data['type'] != 2) <span class="entity"><span>&amp;</span>amp;</span><span class="entity"><span>&amp;</span>amp;</span> (FORCETYPE == <span class="entity"><span>&amp;</span>quot;</span>PDO<span class="entity"><span>&amp;</span>quot;</span> || (FORCETYPE == false <span class="entity"><span>&amp;</span>amp;</span><span class="entity"><span>&amp;</span>amp;</span> class_exists(<span class="entity"><span>&amp;</span>quot;</span>PDO<span class="entity"><span>&amp;</span>quot;</span>) <span class="entity"><span>&amp;</span>amp;</span><span class="entity"><span>&amp;</span>amp;</span> in_array(<span class="entity"><span>&amp;</span>quot;</span>sqlite<span class="entity"><span>&amp;</span>quot;</span>, PDO::getAvailableDrivers()) <span class="entity"><span>&amp;</span>amp;</span><span class="entity"><span>&amp;</span>amp;</span> ($ver == -1 || $ver == 3)))):
<span id="line4150"></span> $this-<span class="entity"><span>&amp;</span>gt;</span>db = new PDO(<span class="entity"><span>&amp;</span>quot;</span>sqlite:<span class="entity"><span>&amp;</span>quot;</span> . $this-<span class="entity"><span>&amp;</span>gt;</span>data['path']);
<span id="line4151"></span> if ($this-<span class="entity"><span>&amp;</span>gt;</span>db != NULL) {
<span id="line4152"></span> $this-<span class="entity"><span>&amp;</span>gt;</span>type = <span class="entity"><span>&amp;</span>quot;</span>PDO<span class="entity"><span>&amp;</span>quot;</span>;
<span id="line4153"></span> break;
<span id="line4154"></span> }
<span id="line4155"></span> case ((!isset($data['type']) || $data['type'] != 2) <span class="entity"><span>&amp;</span>amp;</span><span class="entity"><span>&amp;</span>amp;</span> (FORCETYPE == <span class="entity"><span>&amp;</span>quot;</span>SQLite3<span class="entity"><span>&amp;</span>quot;</span> || (FORCETYPE == false <span class="entity"><span>&amp;</span>amp;</span><span class="entity"><span>&amp;</span>amp;</span> class_exists(<span class="entity"><span>&amp;</span>quot;</span>SQLite3<span class="entity"><span>&amp;</span>quot;</span>) <span class="entity"><span>&amp;</span>amp;</span><span class="entity"><span>&amp;</span>amp;</span> ($ver == -1 || $ver == 3)))):
<span id="line4156"></span> $this-<span class="entity"><span>&amp;</span>gt;</span>db = new SQLite3($this-<span class="entity"><span>&amp;</span>gt;</span>data['path']);
<span id="line4157"></span> if ($this-<span class="entity"><span>&amp;</span>gt;</span>db != NULL) {
<span id="line4158"></span> $this-<span class="entity"><span>&amp;</span>gt;</span>type = <span class="entity"><span>&amp;</span>quot;</span>SQLite3<span class="entity"><span>&amp;</span>quot;</span>;
<span id="line4159"></span> break;
<span id="line4160"></span> }
<span id="line4161"></span> case (FORCETYPE == <span class="entity"><span>&amp;</span>quot;</span>SQLiteDatabase<span class="entity"><span>&amp;</span>quot;</span> || (FORCETYPE == false <span class="entity"><span>&amp;</span>amp;</span><span class="entity"><span>&amp;</span>amp;</span> class_exists(<span class="entity"><span>&amp;</span>quot;</span>SQLiteDatabase<span class="entity"><span>&amp;</span>quot;</span>) <span class="entity"><span>&amp;</span>amp;</span><span class="entity"><span>&amp;</span>amp;</span> ($ver == -1 || $ver == 2))):
<span id="line4162"></span> $this-<span class="entity"><span>&amp;</span>gt;</span>db = new SQLiteDatabase($this-<span class="entity"><span>&amp;</span>gt;</span>data['path']);
<span id="line4163"></span> if ($this-<span class="entity"><span>&amp;</span>gt;</span>db != NULL) {
<span id="line4164"></span> $this-<span class="entity"><span>&amp;</span>gt;</span>type = <span class="entity"><span>&amp;</span>quot;</span>SQLiteDatabase<span class="entity"><span>&amp;</span>quot;</span>;
<span id="line4165"></span> break;
<span id="line4166"></span> }
<span id="line4167"></span> default:
<span id="line4168"></span> $this-<span class="entity"><span>&amp;</span>gt;</span>showError();
<span id="line4169"></span> exit();
<span id="line4170"></span> }
<span id="line4171"></span> $this-<span class="entity"><span>&amp;</span>gt;</span>query(<span class="entity"><span>&amp;</span>quot;</span>PRAGMA foreign_keys = ON<span class="entity"><span>&amp;</span>quot;</span>);
<span id="line4172"></span> } catch (Exception $e) {
<span id="line4173"></span> $this-<span class="entity"><span>&amp;</span>gt;</span>showError();
<span id="line4174"></span> exit();
<span id="line4175"></span> }
<span id="line4176"></span> }
<span id="line4177"></span>
<span id="line4178"></span> public function registerUserFunction($ids)
<span id="line4179"></span> {
<span id="line4180"></span> // in case a single function id was passed
<span id="line4181"></span> if (is_string($ids))
<span id="line4182"></span> $ids = array($ids);
<span id="line4183"></span>
<span id="line4184"></span> if ($this-<span class="entity"><span>&amp;</span>gt;</span>type == 'PDO') {
<span id="line4185"></span> foreach ($ids as $id) {
<span id="line4186"></span> $this-<span class="entity"><span>&amp;</span>gt;</span>db-<span class="entity"><span>&amp;</span>gt;</span>sqliteCreateFunction($id, $id, -1);
<span id="line4187"></span> }
<span id="line4188"></span> } else { // type is Sqlite3 or SQLiteDatabase
<span id="line4189"></span> foreach ($ids as $id) {
<span id="line4190"></span> $this-<span class="entity"><span>&amp;</span>gt;</span>db-<span class="entity"><span>&amp;</span>gt;</span>createFunction($id, $id, -1);
<span id="line4191"></span> }
<span id="line4192"></span> }
<span id="line4193"></span> }
<span id="line4194"></span>
<span id="line4195"></span> public function getError($complete_msg = false)
<span id="line4196"></span> {
<span id="line4197"></span> global $lang, $debug;
<span id="line4198"></span> $error = <span class="entity"><span>&amp;</span>quot;</span>unknown<span class="entity"><span>&amp;</span>quot;</span>;
<span id="line4199"></span>
<span id="line4200"></span> if ($this-<span class="entity"><span>&amp;</span>gt;</span>alterError != '') {
<span id="line4201"></span> $error = $this-<span class="entity"><span>&amp;</span>gt;</span>alterError;
<span id="line4202"></span> $this-<span class="entity"><span>&amp;</span>gt;</span>alterError = <span class="entity"><span>&amp;</span>quot;</span><span class="entity"><span>&amp;</span>quot;</span>;
<span id="line4203"></span> } else if ($this-<span class="entity"><span>&amp;</span>gt;</span>type == <span class="entity"><span>&amp;</span>quot;</span>PDO<span class="entity"><span>&amp;</span>quot;</span>) {
<span id="line4204"></span> $e = $this-<span class="entity"><span>&amp;</span>gt;</span>db-<span class="entity"><span>&amp;</span>gt;</span>errorInfo();
<span id="line4205"></span> $error = $e[2];
<span id="line4206"></span> } else if ($this-<span class="entity"><span>&amp;</span>gt;</span>type == <span class="entity"><span>&amp;</span>quot;</span>SQLite3<span class="entity"><span>&amp;</span>quot;</span>) {
<span id="line4207"></span> $error = $this-<span class="entity"><span>&amp;</span>gt;</span>db-<span class="entity"><span>&amp;</span>gt;</span>lastErrorMsg();
<span id="line4208"></span> } else {
<span id="line4209"></span> $error = sqlite_error_string($this-<span class="entity"><span>&amp;</span>gt;</span>db-<span class="entity"><span>&amp;</span>gt;</span>lastError());
<span id="line4210"></span> }
<span id="line4211"></span>
<span id="line4212"></span> if ($complete_msg) {
<span id="line4213"></span> $error = $lang['err'] . <span class="entity"><span>&amp;</span>quot;</span>: <span class="entity"><span>&amp;</span>quot;</span> . htmlencode($error);
<span id="line4214"></span> // do not suggest to report a bug when constraints fail
<span id="line4215"></span> if (strpos($error, 'constraint failed') === false)
<span id="line4216"></span> $error .= <span class="entity"><span>&amp;</span>quot;</span><span class="entity"><span>&amp;</span>lt;</span>br/<span class="entity"><span>&amp;</span>gt;</span><span class="entity"><span>&amp;</span>quot;</span> . $lang['bug_report'] . ' ' . PROJECT_BUGTRACKER_LINK;
<span id="line4217"></span> }
<span id="line4218"></span>
<span id="line4219"></span> if ($debug)
<span id="line4220"></span> $error .= $this-<span class="entity"><span>&amp;</span>gt;</span>getDebugOutput();
<span id="line4221"></span>
<span id="line4222"></span> return $error;
<span id="line4223"></span> }
<span id="line4224"></span>
<span id="line4225"></span> function getDebugOutput()
<span id="line4226"></span> {
<span id="line4227"></span> return ($this-<span class="entity"><span>&amp;</span>gt;</span>debugOutput != <span class="entity"><span>&amp;</span>quot;</span><span class="entity"><span>&amp;</span>quot;</span> ? <span class="entity"><span>&amp;</span>quot;</span><span class="entity"><span>&amp;</span>lt;</span>hr /<span class="entity"><span>&amp;</span>gt;</span><span class="entity"><span>&amp;</span>lt;</span>strong<span class="entity"><span>&amp;</span>gt;</span>DEBUG:<span class="entity"><span>&amp;</span>lt;</span>/strong<span class="entity"><span>&amp;</span>gt;</span><span class="entity"><span>&amp;</span>lt;</span>br /<span class="entity"><span>&amp;</span>gt;</span><span class="entity"><span>&amp;</span>quot;</span> . $this-<span class="entity"><span>&amp;</span>gt;</span>debugOutput : $this-<span class="entity"><span>&amp;</span>gt;</span>debugOutput);
<span id="line4228"></span> }
<span id="line4229"></span>
<span id="line4230"></span> public function showError()
<span id="line4231"></span> {
<span id="line4232"></span> global $lang;
<span id="line4233"></span> $classPDO = class_exists(<span class="entity"><span>&amp;</span>quot;</span>PDO<span class="entity"><span>&amp;</span>quot;</span>);
<span id="line4234"></span> $classSQLite3 = class_exists(<span class="entity"><span>&amp;</span>quot;</span>SQLite3<span class="entity"><span>&amp;</span>quot;</span>);
<span id="line4235"></span> $classSQLiteDatabase = class_exists(<span class="entity"><span>&amp;</span>quot;</span>SQLiteDatabase<span class="entity"><span>&amp;</span>quot;</span>);
<span id="line4236"></span> if ($classPDO) // PDO is there, check if the SQLite driver for PDO is missing
<span id="line4237"></span> $PDOSqliteDriver = (in_array(<span class="entity"><span>&amp;</span>quot;</span>sqlite<span class="entity"><span>&amp;</span>quot;</span>, PDO::getAvailableDrivers()));
<span id="line4238"></span> else
<span id="line4239"></span> $PDOSqliteDriver = false;
<span id="line4240"></span> echo <span class="entity"><span>&amp;</span>quot;</span><span class="entity"><span>&amp;</span>lt;</span>div class='confirm' style='margin:20px;'<span class="entity"><span>&amp;</span>gt;</span><span class="entity"><span>&amp;</span>quot;</span>;
<span id="line4241"></span> printf($lang['db_setup'], $this-<span class="entity"><span>&amp;</span>gt;</span>getPath());
<span id="line4242"></span> echo <span class="entity"><span>&amp;</span>quot;</span>.<span class="entity"><span>&amp;</span>lt;</span>br/<span class="entity"><span>&amp;</span>gt;</span><span class="entity"><span>&amp;</span>lt;</span>br/<span class="entity"><span>&amp;</span>gt;</span><span class="entity"><span>&amp;</span>lt;</span>i<span class="entity"><span>&amp;</span>gt;</span><span class="entity"><span>&amp;</span>quot;</span> . $lang['chk_ext'] . <span class="entity"><span>&amp;</span>quot;</span>...<span class="entity"><span>&amp;</span>lt;</span>br/<span class="entity"><span>&amp;</span>gt;</span><span class="entity"><span>&amp;</span>lt;</span>br/<span class="entity"><span>&amp;</span>gt;</span><span class="entity"><span>&amp;</span>quot;</span>;
<span id="line4243"></span> echo <span class="entity"><span>&amp;</span>quot;</span><span class="entity"><span>&amp;</span>lt;</span>b<span class="entity"><span>&amp;</span>gt;</span>PDO<span class="entity"><span>&amp;</span>lt;</span>/b<span class="entity"><span>&amp;</span>gt;</span>: <span class="entity"><span>&amp;</span>quot;</span> . ($classPDO ? $lang['installed'] : $lang['not_installed']) . <span class="entity"><span>&amp;</span>quot;</span><span class="entity"><span>&amp;</span>lt;</span>br/<span class="entity"><span>&amp;</span>gt;</span><span class="entity"><span>&amp;</span>quot;</span>;
<span id="line4244"></span> echo <span class="entity"><span>&amp;</span>quot;</span><span class="entity"><span>&amp;</span>lt;</span>b<span class="entity"><span>&amp;</span>gt;</span>PDO SQLite Driver<span class="entity"><span>&amp;</span>lt;</span>/b<span class="entity"><span>&amp;</span>gt;</span>: <span class="entity"><span>&amp;</span>quot;</span> . ($PDOSqliteDriver ? $lang['installed'] : $lang['not_installed']) . <span class="entity"><span>&amp;</span>quot;</span><span class="entity"><span>&amp;</span>lt;</span>br/<span class="entity"><span>&amp;</span>gt;</span><span class="entity"><span>&amp;</span>quot;</span>;
<span id="line4245"></span> echo <span class="entity"><span>&amp;</span>quot;</span><span class="entity"><span>&amp;</span>lt;</span>b<span class="entity"><span>&amp;</span>gt;</span>SQLite3<span class="entity"><span>&amp;</span>lt;</span>/b<span class="entity"><span>&amp;</span>gt;</span>: <span class="entity"><span>&amp;</span>quot;</span> . ($classSQLite3 ? $lang['installed'] : $lang['not_installed']) . <span class="entity"><span>&amp;</span>quot;</span><span class="entity"><span>&amp;</span>lt;</span>br/<span class="entity"><span>&amp;</span>gt;</span><span class="entity"><span>&amp;</span>quot;</span>;
<span id="line4246"></span> echo <span class="entity"><span>&amp;</span>quot;</span><span class="entity"><span>&amp;</span>lt;</span>b<span class="entity"><span>&amp;</span>gt;</span>SQLiteDatabase<span class="entity"><span>&amp;</span>lt;</span>/b<span class="entity"><span>&amp;</span>gt;</span>: <span class="entity"><span>&amp;</span>quot;</span> . ($classSQLiteDatabase ? $lang['installed'] : $lang['not_installed']) . <span class="entity"><span>&amp;</span>quot;</span><span class="entity"><span>&amp;</span>lt;</span>br/<span class="entity"><span>&amp;</span>gt;</span><span class="entity"><span>&amp;</span>quot;</span>;
<span id="line4247"></span> echo <span class="entity"><span>&amp;</span>quot;</span><span class="entity"><span>&amp;</span>lt;</span>br/<span class="entity"><span>&amp;</span>gt;</span>...<span class="entity"><span>&amp;</span>quot;</span> . $lang['done'] . <span class="entity"><span>&amp;</span>quot;</span>.<span class="entity"><span>&amp;</span>lt;</span>/i<span class="entity"><span>&amp;</span>gt;</span><span class="entity"><span>&amp;</span>lt;</span>br/<span class="entity"><span>&amp;</span>gt;</span><span class="entity"><span>&amp;</span>lt;</span>br/<span class="entity"><span>&amp;</span>gt;</span><span class="entity"><span>&amp;</span>quot;</span>;
<span id="line4248"></span> if (!$classPDO <span class="entity"><span>&amp;</span>amp;</span><span class="entity"><span>&amp;</span>amp;</span> !$classSQLite3 <span class="entity"><span>&amp;</span>amp;</span><span class="entity"><span>&amp;</span>amp;</span> !$classSQLiteDatabase)
<span id="line4249"></span> printf($lang['sqlite_ext_support'], PROJECT);
<span id="line4250"></span> else {
<span id="line4251"></span> if (!$PDOSqliteDriver <span class="entity"><span>&amp;</span>amp;</span><span class="entity"><span>&amp;</span>amp;</span> !$classSQLite3 <span class="entity"><span>&amp;</span>amp;</span><span class="entity"><span>&amp;</span>amp;</span> $this-<span class="entity"><span>&amp;</span>gt;</span>getVersion() == 3)
<span id="line4252"></span> printf($lang['sqlite_v_error'], 3, PROJECT, 2);
<span id="line4253"></span> else if (!$classSQLiteDatabase <span class="entity"><span>&amp;</span>amp;</span><span class="entity"><span>&amp;</span>amp;</span> $this-<span class="entity"><span>&amp;</span>gt;</span>getVersion() == 2)
<span id="line4254"></span> printf($lang['sqlite_v_error'], 2, PROJECT, 3);
<span id="line4255"></span> else
<span id="line4256"></span> echo $lang['report_issue'] . ' ' . PROJECT_BUGTRACKER_LINK . '.';
<span id="line4257"></span> }
<span id="line4258"></span> echo <span class="entity"><span>&amp;</span>quot;</span><span class="entity"><span>&amp;</span>lt;</span>p<span class="entity"><span>&amp;</span>gt;</span>See <span class="entity"><span>&amp;</span>quot;</span> . PROJECT_INSTALL_LINK . <span class="entity"><span>&amp;</span>quot;</span> for help.<span class="entity"><span>&amp;</span>lt;</span>/p<span class="entity"><span>&amp;</span>gt;</span><span class="entity"><span>&amp;</span>quot;</span>;
<span id="line4259"></span>
<span id="line4260"></span> $this-<span class="entity"><span>&amp;</span>gt;</span>print_db_list();
<span id="line4261"></span>
<span id="line4262"></span> echo <span class="entity"><span>&amp;</span>quot;</span><span class="entity"><span>&amp;</span>lt;</span>/div<span class="entity"><span>&amp;</span>gt;</span><span class="entity"><span>&amp;</span>quot;</span>;
<span id="line4263"></span> }
<span id="line4264"></span>
<span id="line4265"></span> // print the list of databases
<span id="line4266"></span> public function print_db_list()
<span id="line4267"></span> {
<span id="line4268"></span> global $databases, $lang, $params, $currentDB;
<span id="line4269"></span> echo <span class="entity"><span>&amp;</span>quot;</span><span class="entity"><span>&amp;</span>lt;</span>fieldset style='margin:15px;' class='databaseList'<span class="entity"><span>&amp;</span>gt;</span><span class="entity"><span>&amp;</span>lt;</span>legend<span class="entity"><span>&amp;</span>gt;</span><span class="entity"><span>&amp;</span>lt;</span>b<span class="entity"><span>&amp;</span>gt;</span><span class="entity"><span>&amp;</span>quot;</span> . $lang['db_ch'] . <span class="entity"><span>&amp;</span>quot;</span><span class="entity"><span>&amp;</span>lt;</span>/b<span class="entity"><span>&amp;</span>gt;</span><span class="entity"><span>&amp;</span>lt;</span>/legend<span class="entity"><span>&amp;</span>gt;</span><span class="entity"><span>&amp;</span>quot;</span>;
<span id="line4270"></span> if (sizeof($databases) <span class="entity"><span>&amp;</span>lt;</span> 10) //if there aren't a lot of databases, just show them as a list of links instead of drop down menu
<span id="line4271"></span> {
<span id="line4272"></span> $i = 0;
<span id="line4273"></span> foreach ($databases as $database) {
<span id="line4274"></span> $i++;
<span id="line4275"></span> $name = $database['name'];
<span id="line4276"></span> if (mb_strlen($name) <span class="entity"><span>&amp;</span>gt;</span> 25)
<span id="line4277"></span> $name = <span class="entity"><span>&amp;</span>quot;</span>...<span class="entity"><span>&amp;</span>quot;</span> . mb_substr($name, mb_strlen($name) - 22, 22);
<span id="line4278"></span> echo '[' . ($database['readable'] ? 'r' : ' ') . ($database['writable'] <span class="entity"><span>&amp;</span>amp;</span><span class="entity"><span>&amp;</span>amp;</span> $database['writable_dir'] ? 'w' : ' ') . ']<span class="entity"><span>&amp;</span>amp;</span>nbsp;';
<span id="line4279"></span>
<span id="line4280"></span> echo $params-<span class="entity"><span>&amp;</span>gt;</span>getLink(array('database' =<span class="entity"><span>&amp;</span>gt;</span> $database['path'], 'table' =<span class="entity"><span>&amp;</span>gt;</span> null), htmlencode($name), ($database == $currentDB ? 'active_db' : ''));
<span id="line4281"></span> echo <span class="entity"><span>&amp;</span>quot;</span><span class="entity"><span>&amp;</span>amp;</span>nbsp;<span class="entity"><span>&amp;</span>amp;</span>nbsp;<span class="entity"><span>&amp;</span>quot;</span>;
<span id="line4282"></span> echo $params-<span class="entity"><span>&amp;</span>gt;</span>getLink(array('download' =<span class="entity"><span>&amp;</span>gt;</span> $database['path'], 'table' =<span class="entity"><span>&amp;</span>gt;</span> null, 'token' =<span class="entity"><span>&amp;</span>gt;</span> $_SESSION[COOKIENAME . 'token']), '[<span class="entity"><span>&amp;</span>amp;</span>darr;]', '', $lang['backup']);
<span id="line4283"></span>
<span id="line4284"></span> if ($i <span class="entity"><span>&amp;</span>lt;</span> sizeof($databases))
<span id="line4285"></span> echo <span class="entity"><span>&amp;</span>quot;</span><span class="entity"><span>&amp;</span>lt;</span>br/<span class="entity"><span>&amp;</span>gt;</span><span class="entity"><span>&amp;</span>quot;</span>;
<span id="line4286"></span> }
<span id="line4287"></span> } else //there are a lot of databases - show a drop down menu
<span id="line4288"></span> {
<span id="line4289"></span> echo $params-<span class="entity"><span>&amp;</span>gt;</span>getForm(array('table' =<span class="entity"><span>&amp;</span>gt;</span> null), 'get');
<span id="line4290"></span> echo <span class="entity"><span>&amp;</span>quot;</span><span class="entity"><span>&amp;</span>lt;</span>select name='database' onchange='this.form.submit()'<span class="entity"><span>&amp;</span>gt;</span><span class="entity"><span>&amp;</span>quot;</span>;
<span id="line4291"></span> foreach ($databases as $database) {
<span id="line4292"></span> $perms_string = htmlencode('[' . ($database['readable'] ? 'r' : ' ') . ($database['writable'] <span class="entity"><span>&amp;</span>amp;</span><span class="entity"><span>&amp;</span>amp;</span> $database['writable_dir'] ? 'w' : ' ') . '] ');
<span id="line4293"></span> if ($database == $currentDB)
<span id="line4294"></span> echo <span class="entity"><span>&amp;</span>quot;</span><span class="entity"><span>&amp;</span>lt;</span>option value='<span class="entity"><span>&amp;</span>quot;</span> . htmlencode($database['path']) . <span class="entity"><span>&amp;</span>quot;</span>' selected='selected'<span class="entity"><span>&amp;</span>gt;</span><span class="entity"><span>&amp;</span>quot;</span> . $perms_string . htmlencode($database['name']) . <span class="entity"><span>&amp;</span>quot;</span><span class="entity"><span>&amp;</span>lt;</span>/option<span class="entity"><span>&amp;</span>gt;</span><span class="entity"><span>&amp;</span>quot;</span>;
<span id="line4295"></span> else
<span id="line4296"></span> echo <span class="entity"><span>&amp;</span>quot;</span><span class="entity"><span>&amp;</span>lt;</span>option value='<span class="entity"><span>&amp;</span>quot;</span> . htmlencode($database['path']) . <span class="entity"><span>&amp;</span>quot;</span>'<span class="entity"><span>&amp;</span>gt;</span><span class="entity"><span>&amp;</span>quot;</span> . $perms_string . htmlencode($database['name']) . <span class="entity"><span>&amp;</span>quot;</span><span class="entity"><span>&amp;</span>lt;</span>/option<span class="entity"><span>&amp;</span>gt;</span><span class="entity"><span>&amp;</span>quot;</span>;
<span id="line4297"></span> }
<span id="line4298"></span> echo <span class="entity"><span>&amp;</span>quot;</span><span class="entity"><span>&amp;</span>lt;</span>/select<span class="entity"><span>&amp;</span>gt;</span><span class="entity"><span>&amp;</span>quot;</span>;
<span id="line4299"></span> echo <span class="entity"><span>&amp;</span>quot;</span><span class="entity"><span>&amp;</span>lt;</span>noscript<span class="entity"><span>&amp;</span>gt;</span><span class="entity"><span>&amp;</span>lt;</span>input type='submit' value='<span class="entity"><span>&amp;</span>quot;</span> . $lang['go'] . <span class="entity"><span>&amp;</span>quot;</span>' class='btn'<span class="entity"><span>&amp;</span>gt;</span><span class="entity"><span>&amp;</span>lt;</span>/noscript<span class="entity"><span>&amp;</span>gt;</span><span class="entity"><span>&amp;</span>quot;</span>;
<span id="line4300"></span> echo <span class="entity"><span>&amp;</span>quot;</span><span class="entity"><span>&amp;</span>lt;</span>/form<span class="entity"><span>&amp;</span>gt;</span><span class="entity"><span>&amp;</span>quot;</span>;
<span id="line4301"></span> }
<span id="line4302"></span> echo <span class="entity"><span>&amp;</span>quot;</span><span class="entity"><span>&amp;</span>lt;</span>/fieldset<span class="entity"><span>&amp;</span>gt;</span><span class="entity"><span>&amp;</span>quot;</span>;
<span id="line4303"></span> }
<span id="line4304"></span>
<span id="line4305"></span> public function __destruct()
<span id="line4306"></span> {
<span id="line4307"></span> if ($this-<span class="entity"><span>&amp;</span>gt;</span>db)
<span id="line4308"></span> $this-<span class="entity"><span>&amp;</span>gt;</span>close();
<span id="line4309"></span> }
<span id="line4310"></span>
<span id="line4311"></span> //get the exact PHP extension being used for SQLite
<span id="line4312"></span> public function getType()
<span id="line4313"></span> {
<span id="line4314"></span> return $this-<span class="entity"><span>&amp;</span>gt;</span>type;
<span id="line4315"></span> }
<span id="line4316"></span>
<span id="line4317"></span> // get the version of the SQLite library
<span id="line4318"></span> public function getSQLiteVersion()
<span id="line4319"></span> {
<span id="line4320"></span> $queryVersion = $this-<span class="entity"><span>&amp;</span>gt;</span>select(<span class="entity"><span>&amp;</span>quot;</span>SELECT sqlite_version() AS sqlite_version<span class="entity"><span>&amp;</span>quot;</span>);
<span id="line4321"></span> return $queryVersion['sqlite_version'];
<span id="line4322"></span> }
<span id="line4323"></span>
<span id="line4324"></span> //get the name of the database
<span id="line4325"></span> public function getName()
<span id="line4326"></span> {
<span id="line4327"></span> return $this-<span class="entity"><span>&amp;</span>gt;</span>data[<span class="entity"><span>&amp;</span>quot;</span>name<span class="entity"><span>&amp;</span>quot;</span>];
<span id="line4328"></span> }
<span id="line4329"></span>
<span id="line4330"></span> //get the filename of the database
<span id="line4331"></span> public function getPath()
<span id="line4332"></span> {
<span id="line4333"></span> return $this-<span class="entity"><span>&amp;</span>gt;</span>data[<span class="entity"><span>&amp;</span>quot;</span>path<span class="entity"><span>&amp;</span>quot;</span>];
<span id="line4334"></span> }
<span id="line4335"></span>
<span id="line4336"></span> //is the db-file writable?
<span id="line4337"></span> public function isWritable()
<span id="line4338"></span> {
<span id="line4339"></span> return $this-<span class="entity"><span>&amp;</span>gt;</span>data[<span class="entity"><span>&amp;</span>quot;</span>writable<span class="entity"><span>&amp;</span>quot;</span>];
<span id="line4340"></span> }
<span id="line4341"></span>
<span id="line4342"></span> //is the db-folder writable?
<span id="line4343"></span> public function isDirWritable()
<span id="line4344"></span> {
<span id="line4345"></span> return $this-<span class="entity"><span>&amp;</span>gt;</span>data[<span class="entity"><span>&amp;</span>quot;</span>writable_dir<span class="entity"><span>&amp;</span>quot;</span>];
<span id="line4346"></span> }
<span id="line4347"></span>
<span id="line4348"></span> //get the version of the database
<span id="line4349"></span> public function getVersion()
<span id="line4350"></span> {
<span id="line4351"></span> if (file_exists($this-<span class="entity"><span>&amp;</span>gt;</span>data['path'])) //make sure file exists before getting its contents
<span id="line4352"></span> {
<span id="line4353"></span> $content = strtolower(file_get_contents($this-<span class="entity"><span>&amp;</span>gt;</span>data['path'], NULL, NULL, 0, 40)); //get the first 40 characters of the database file
<span id="line4354"></span> $p = strpos($content, <span class="entity"><span>&amp;</span>quot;</span>** this file contains an sqlite 2<span class="entity"><span>&amp;</span>quot;</span>); //this text is at the beginning of every SQLite2 database
<span id="line4355"></span> if ($p !== false) //the text is found - this is version 2
<span id="line4356"></span> return 2;
<span id="line4357"></span> else
<span id="line4358"></span> return 3;
<span id="line4359"></span> } else //return -1 to indicate that it does not exist and needs to be created
<span id="line4360"></span> {
<span id="line4361"></span> return -1;
<span id="line4362"></span> }
<span id="line4363"></span> }
<span id="line4364"></span>
<span id="line4365"></span> //get the size of the database (in KiB)
<span id="line4366"></span> public function getSize()
<span id="line4367"></span> {
<span id="line4368"></span> return round(filesize($this-<span class="entity"><span>&amp;</span>gt;</span>data[<span class="entity"><span>&amp;</span>quot;</span>path<span class="entity"><span>&amp;</span>quot;</span>]) * 0.0009765625, 1);
<span id="line4369"></span> }
<span id="line4370"></span>
<span id="line4371"></span> //get the last modified time of database
<span id="line4372"></span> public function getDate()
<span id="line4373"></span> {
<span id="line4374"></span> global $lang;
<span id="line4375"></span> return date($lang['date_format'], filemtime($this-<span class="entity"><span>&amp;</span>gt;</span>data['path']));
<span id="line4376"></span> }
<span id="line4377"></span>
<span id="line4378"></span> //get number of affected rows from last query
<span id="line4379"></span> public function getAffectedRows()
<span id="line4380"></span> {
<span id="line4381"></span> if ($this-<span class="entity"><span>&amp;</span>gt;</span>type == <span class="entity"><span>&amp;</span>quot;</span>PDO<span class="entity"><span>&amp;</span>quot;</span>)
<span id="line4382"></span> if (!is_object($this-<span class="entity"><span>&amp;</span>gt;</span>lastResult))
<span id="line4383"></span> // in case it was an alter table statement, there is no lastResult object
<span id="line4384"></span> return 0;
<span id="line4385"></span> else
<span id="line4386"></span> return $this-<span class="entity"><span>&amp;</span>gt;</span>lastResult-<span class="entity"><span>&amp;</span>gt;</span>rowCount();
<span id="line4387"></span> else if ($this-<span class="entity"><span>&amp;</span>gt;</span>type == <span class="entity"><span>&amp;</span>quot;</span>SQLite3<span class="entity"><span>&amp;</span>quot;</span>)
<span id="line4388"></span> return $this-<span class="entity"><span>&amp;</span>gt;</span>db-<span class="entity"><span>&amp;</span>gt;</span>changes();
<span id="line4389"></span> else if ($this-<span class="entity"><span>&amp;</span>gt;</span>type == <span class="entity"><span>&amp;</span>quot;</span>SQLiteDatabase<span class="entity"><span>&amp;</span>quot;</span>)
<span id="line4390"></span> return $this-<span class="entity"><span>&amp;</span>gt;</span>db-<span class="entity"><span>&amp;</span>gt;</span>changes();
<span id="line4391"></span> }
<span id="line4392"></span>
<span id="line4393"></span> public function getTypeOfTable($table)
<span id="line4394"></span> {
<span id="line4395"></span> $result = $this-<span class="entity"><span>&amp;</span>gt;</span>select(<span class="entity"><span>&amp;</span>quot;</span>SELECT `type` FROM `sqlite_master` WHERE `name`=<span class="entity"><span>&amp;</span>quot;</span> . $this-<span class="entity"><span>&amp;</span>gt;</span>quote($table), 'assoc');
<span id="line4396"></span> return $result['type'];
<span id="line4397"></span> }
<span id="line4398"></span>
<span id="line4399"></span> public function getTableInfo($table)
<span id="line4400"></span> {
<span id="line4401"></span> return $this-<span class="entity"><span>&amp;</span>gt;</span>selectArray(<span class="entity"><span>&amp;</span>quot;</span>PRAGMA table_info(<span class="entity"><span>&amp;</span>quot;</span> . $this-<span class="entity"><span>&amp;</span>gt;</span>quote_id($table) . <span class="entity"><span>&amp;</span>quot;</span>)<span class="entity"><span>&amp;</span>quot;</span>);
<span id="line4402"></span> }
<span id="line4403"></span>
<span id="line4404"></span> // returns the list of tables (opt. incl. views) as
<span id="line4405"></span> // array( Tablename =<span class="entity"><span>&amp;</span>gt;</span> tableType ) with tableType being 'view' or 'table'
<span id="line4406"></span> public function getTables($alsoViews = true, $alsoInternal = false, $orderBy = 'name', $orderDirection = 'ASC')
<span id="line4407"></span> {
<span id="line4408"></span> $query = <span class="entity"><span>&amp;</span>quot;</span>SELECT name, type FROM sqlite_master <span class="entity"><span>&amp;</span>quot;</span>
<span id="line4409"></span> . <span class="entity"><span>&amp;</span>quot;</span>WHERE (type='table'<span class="entity"><span>&amp;</span>quot;</span> . ($alsoViews ? <span class="entity"><span>&amp;</span>quot;</span> OR type='view'<span class="entity"><span>&amp;</span>quot;</span> : <span class="entity"><span>&amp;</span>quot;</span><span class="entity"><span>&amp;</span>quot;</span>) . <span class="entity"><span>&amp;</span>quot;</span>) <span class="entity"><span>&amp;</span>quot;</span>
<span id="line4410"></span> . <span class="entity"><span>&amp;</span>quot;</span>AND name!='' <span class="entity"><span>&amp;</span>quot;</span> . ($alsoInternal ? <span class="entity"><span>&amp;</span>quot;</span><span class="entity"><span>&amp;</span>quot;</span> : <span class="entity"><span>&amp;</span>quot;</span> AND name NOT LIKE 'sqlite_%' <span class="entity"><span>&amp;</span>quot;</span>)
<span id="line4411"></span> . <span class="entity"><span>&amp;</span>quot;</span>ORDER BY <span class="entity"><span>&amp;</span>quot;</span> . $this-<span class="entity"><span>&amp;</span>gt;</span>quote_id($orderBy) . <span class="entity"><span>&amp;</span>quot;</span> <span class="entity"><span>&amp;</span>quot;</span> . $orderDirection;
<span id="line4412"></span> $result = $this-<span class="entity"><span>&amp;</span>gt;</span>selectArray($query);
<span id="line4413"></span> $list = array();
<span id="line4414"></span> for ($i = 0; $i <span class="entity"><span>&amp;</span>lt;</span> sizeof($result); $i++) {
<span id="line4415"></span> $list[$result[$i]['name']] = $result[$i]['type'];
<span id="line4416"></span> }
<span id="line4417"></span> return $list;
<span id="line4418"></span> }
<span id="line4419"></span>
<span id="line4420"></span> // returns an array of all tables and their columns as
<span id="line4421"></span> // array( tablename =<span class="entity"><span>&amp;</span>gt;</span> array(columName) )
<span id="line4422"></span> public function getTableDefinitions()
<span id="line4423"></span> {
<span id="line4424"></span> $tables = $this-<span class="entity"><span>&amp;</span>gt;</span>getTables(true, true);
<span id="line4425"></span> $result = array();
<span id="line4426"></span> foreach ($tables as $tableName =<span class="entity"><span>&amp;</span>gt;</span> $tableType) {
<span id="line4427"></span> $tableInfo = $this-<span class="entity"><span>&amp;</span>gt;</span>getTableInfo($tableName);
<span id="line4428"></span> $columns = array();
<span id="line4429"></span> foreach ($tableInfo as $column)
<span id="line4430"></span> $columns[] = $column['name'];
<span id="line4431"></span> $result[$tableName] = $columns;
<span id="line4432"></span> }
<span id="line4433"></span> return $result;
<span id="line4434"></span> }
<span id="line4435"></span>
<span id="line4436"></span> public function close()
<span id="line4437"></span> {
<span id="line4438"></span> if ($this-<span class="entity"><span>&amp;</span>gt;</span>type == <span class="entity"><span>&amp;</span>quot;</span>PDO<span class="entity"><span>&amp;</span>quot;</span>)
<span id="line4439"></span> $this-<span class="entity"><span>&amp;</span>gt;</span>db = NULL;
<span id="line4440"></span> else if ($this-<span class="entity"><span>&amp;</span>gt;</span>type == <span class="entity"><span>&amp;</span>quot;</span>SQLite3<span class="entity"><span>&amp;</span>quot;</span>)
<span id="line4441"></span> $this-<span class="entity"><span>&amp;</span>gt;</span>db-<span class="entity"><span>&amp;</span>gt;</span>close();
<span id="line4442"></span> else if ($this-<span class="entity"><span>&amp;</span>gt;</span>type == <span class="entity"><span>&amp;</span>quot;</span>SQLiteDatabase<span class="entity"><span>&amp;</span>quot;</span>)
<span id="line4443"></span> $this-<span class="entity"><span>&amp;</span>gt;</span>db = NULL;
<span id="line4444"></span> }
<span id="line4445"></span>
<span id="line4446"></span> public function beginTransaction()
<span id="line4447"></span> {
<span id="line4448"></span> $this-<span class="entity"><span>&amp;</span>gt;</span>query(<span class="entity"><span>&amp;</span>quot;</span>BEGIN<span class="entity"><span>&amp;</span>quot;</span>);
<span id="line4449"></span> }
<span id="line4450"></span>
<span id="line4451"></span> public function commitTransaction()
<span id="line4452"></span> {
<span id="line4453"></span> $this-<span class="entity"><span>&amp;</span>gt;</span>query(<span class="entity"><span>&amp;</span>quot;</span>COMMIT<span class="entity"><span>&amp;</span>quot;</span>);
<span id="line4454"></span> }
<span id="line4455"></span>
<span id="line4456"></span> public function rollbackTransaction()
<span id="line4457"></span> {
<span id="line4458"></span> $this-<span class="entity"><span>&amp;</span>gt;</span>query(<span class="entity"><span>&amp;</span>quot;</span>ROLLBACK<span class="entity"><span>&amp;</span>quot;</span>);
<span id="line4459"></span> }
<span id="line4460"></span>
<span id="line4461"></span> //generic query wrapper
<span id="line4462"></span> //returns false on error and the query result on success
<span id="line4463"></span> public function query($query, $ignoreAlterCase = false)
<span id="line4464"></span> {
<span id="line4465"></span> global $debug;
<span id="line4466"></span> if (strtolower(substr(ltrim($query), 0, 5)) == 'alter' <span class="entity"><span>&amp;</span>amp;</span><span class="entity"><span>&amp;</span>amp;</span> $ignoreAlterCase == false) //this query is an ALTER query - call the necessary function
<span id="line4467"></span> {
<span id="line4468"></span> preg_match(<span class="entity"><span>&amp;</span>quot;</span>/^\s*ALTER\s+TABLE\s+\<span class="entity"><span>&amp;</span>quot;</span>((?:[^\<span class="entity"><span>&amp;</span>quot;</span>]|\<span class="entity"><span>&amp;</span>quot;</span>\<span class="entity"><span>&amp;</span>quot;</span>)+)\<span class="entity"><span>&amp;</span>quot;</span>\s+(.*)$/i<span class="entity"><span>&amp;</span>quot;</span>, $query, $matches);
<span id="line4469"></span> if (!isset($matches[1]) || !isset($matches[2])) {
<span id="line4470"></span> if ($debug) echo <span class="entity"><span>&amp;</span>quot;</span><span class="entity"><span>&amp;</span>lt;</span>span title='<span class="entity"><span>&amp;</span>quot;</span> . htmlencode($query) . <span class="entity"><span>&amp;</span>quot;</span>' onclick='this.innerHTML=\<span class="entity"><span>&amp;</span>quot;</span><span class="entity"><span>&amp;</span>quot;</span> . htmlencode(str_replace('<span class="entity"><span>&amp;</span>quot;</span>', '\<span class="entity"><span>&amp;</span>quot;</span>', $query)) . <span class="entity"><span>&amp;</span>quot;</span>\<span class="entity"><span>&amp;</span>quot;</span>' style='cursor:pointer'<span class="entity"><span>&amp;</span>gt;</span>SQL?<span class="entity"><span>&amp;</span>lt;</span>/span<span class="entity"><span>&amp;</span>gt;</span><span class="entity"><span>&amp;</span>lt;</span>br /<span class="entity"><span>&amp;</span>gt;</span><span class="entity"><span>&amp;</span>quot;</span>;
<span id="line4471"></span> return false;
<span id="line4472"></span> }
<span id="line4473"></span> $tablename = str_replace('<span class="entity"><span>&amp;</span>quot;</span><span class="entity"><span>&amp;</span>quot;</span>', '<span class="entity"><span>&amp;</span>quot;</span>', $matches[1]);
<span id="line4474"></span> $alterdefs = $matches[2];
<span id="line4475"></span> if ($debug) echo <span class="entity"><span>&amp;</span>quot;</span>ALTER TABLE QUERY=(<span class="entity"><span>&amp;</span>quot;</span> . htmlencode($query) . <span class="entity"><span>&amp;</span>quot;</span>), tablename=($tablename), alterdefs=($alterdefs)<span class="entity"><span>&amp;</span>lt;</span>br /<span class="entity"><span>&amp;</span>gt;</span><span class="entity"><span>&amp;</span>quot;</span>;
<span id="line4476"></span> $result = $this-<span class="entity"><span>&amp;</span>gt;</span>alterTable($tablename, $alterdefs);
<span id="line4477"></span> } else //this query is normal - proceed as normal
<span id="line4478"></span> {
<span id="line4479"></span> $result = $this-<span class="entity"><span>&amp;</span>gt;</span>db-<span class="entity"><span>&amp;</span>gt;</span>query($query);
<span id="line4480"></span> if ($debug) echo <span class="entity"><span>&amp;</span>quot;</span><span class="entity"><span>&amp;</span>lt;</span>span title='<span class="entity"><span>&amp;</span>quot;</span> . htmlencode($query) . <span class="entity"><span>&amp;</span>quot;</span>' onclick='this.innerHTML=\<span class="entity"><span>&amp;</span>quot;</span><span class="entity"><span>&amp;</span>quot;</span> . htmlencode(str_replace('<span class="entity"><span>&amp;</span>quot;</span>', '\<span class="entity"><span>&amp;</span>quot;</span>', $query)) . <span class="entity"><span>&amp;</span>quot;</span>\<span class="entity"><span>&amp;</span>quot;</span>' style='cursor:pointer'<span class="entity"><span>&amp;</span>gt;</span>SQL?<span class="entity"><span>&amp;</span>lt;</span>/span<span class="entity"><span>&amp;</span>gt;</span><span class="entity"><span>&amp;</span>lt;</span>br /<span class="entity"><span>&amp;</span>gt;</span><span class="entity"><span>&amp;</span>quot;</span>;
<span id="line4481"></span> }
<span id="line4482"></span> if ($result === false)
<span id="line4483"></span> return false;
<span id="line4484"></span> $this-<span class="entity"><span>&amp;</span>gt;</span>lastResult = $result;
<span id="line4485"></span> return $result;
<span id="line4486"></span> }
<span id="line4487"></span>
<span id="line4488"></span> //wrapper for an INSERT and returns the ID of the inserted row
<span id="line4489"></span> public function insert($query)
<span id="line4490"></span> {
<span id="line4491"></span> $result = $this-<span class="entity"><span>&amp;</span>gt;</span>query($query);
<span id="line4492"></span> if ($this-<span class="entity"><span>&amp;</span>gt;</span>type == <span class="entity"><span>&amp;</span>quot;</span>PDO<span class="entity"><span>&amp;</span>quot;</span>)
<span id="line4493"></span> return $this-<span class="entity"><span>&amp;</span>gt;</span>db-<span class="entity"><span>&amp;</span>gt;</span>lastInsertId();
<span id="line4494"></span> else if ($this-<span class="entity"><span>&amp;</span>gt;</span>type == <span class="entity"><span>&amp;</span>quot;</span>SQLite3<span class="entity"><span>&amp;</span>quot;</span>)
<span id="line4495"></span> return $this-<span class="entity"><span>&amp;</span>gt;</span>db-<span class="entity"><span>&amp;</span>gt;</span>lastInsertRowID();
<span id="line4496"></span> else if ($this-<span class="entity"><span>&amp;</span>gt;</span>type == <span class="entity"><span>&amp;</span>quot;</span>SQLiteDatabase<span class="entity"><span>&amp;</span>quot;</span>)
<span id="line4497"></span> return $this-<span class="entity"><span>&amp;</span>gt;</span>db-<span class="entity"><span>&amp;</span>gt;</span>lastInsertRowid();
<span id="line4498"></span> }
<span id="line4499"></span>
<span id="line4500"></span> //returns an array for SELECT
<span id="line4501"></span> public function select($query, $mode = <span class="entity"><span>&amp;</span>quot;</span>both<span class="entity"><span>&amp;</span>quot;</span>)
<span id="line4502"></span> {
<span id="line4503"></span> $result = $this-<span class="entity"><span>&amp;</span>gt;</span>query($query);
<span id="line4504"></span> if (!$result) //make sure the result is valid
<span id="line4505"></span> return NULL;
<span id="line4506"></span> if ($this-<span class="entity"><span>&amp;</span>gt;</span>type == <span class="entity"><span>&amp;</span>quot;</span>PDO<span class="entity"><span>&amp;</span>quot;</span>) {
<span id="line4507"></span> if ($mode == <span class="entity"><span>&amp;</span>quot;</span>assoc<span class="entity"><span>&amp;</span>quot;</span>)
<span id="line4508"></span> $mode = PDO::FETCH_ASSOC;
<span id="line4509"></span> else if ($mode == <span class="entity"><span>&amp;</span>quot;</span>num<span class="entity"><span>&amp;</span>quot;</span>)
<span id="line4510"></span> $mode = PDO::FETCH_NUM;
<span id="line4511"></span> else
<span id="line4512"></span> $mode = PDO::FETCH_BOTH;
<span id="line4513"></span> $ret = $result-<span class="entity"><span>&amp;</span>gt;</span>fetch($mode);
<span id="line4514"></span> $result-<span class="entity"><span>&amp;</span>gt;</span>closeCursor();
<span id="line4515"></span> return $ret;
<span id="line4516"></span> } else if ($this-<span class="entity"><span>&amp;</span>gt;</span>type == <span class="entity"><span>&amp;</span>quot;</span>SQLite3<span class="entity"><span>&amp;</span>quot;</span>) {
<span id="line4517"></span> if ($mode == <span class="entity"><span>&amp;</span>quot;</span>assoc<span class="entity"><span>&amp;</span>quot;</span>)
<span id="line4518"></span> $mode = SQLITE3_ASSOC;
<span id="line4519"></span> else if ($mode == <span class="entity"><span>&amp;</span>quot;</span>num<span class="entity"><span>&amp;</span>quot;</span>)
<span id="line4520"></span> $mode = SQLITE3_NUM;
<span id="line4521"></span> else
<span id="line4522"></span> $mode = SQLITE3_BOTH;
<span id="line4523"></span> $ret = $result-<span class="entity"><span>&amp;</span>gt;</span>fetchArray($mode);
<span id="line4524"></span> $result-<span class="entity"><span>&amp;</span>gt;</span>finalize();
<span id="line4525"></span> return $ret;
<span id="line4526"></span> } else if ($this-<span class="entity"><span>&amp;</span>gt;</span>type == <span class="entity"><span>&amp;</span>quot;</span>SQLiteDatabase<span class="entity"><span>&amp;</span>quot;</span>) {
<span id="line4527"></span> if ($mode == <span class="entity"><span>&amp;</span>quot;</span>assoc<span class="entity"><span>&amp;</span>quot;</span>)
<span id="line4528"></span> $mode = SQLITE_ASSOC;
<span id="line4529"></span> else if ($mode == <span class="entity"><span>&amp;</span>quot;</span>num<span class="entity"><span>&amp;</span>quot;</span>)
<span id="line4530"></span> $mode = SQLITE_NUM;
<span id="line4531"></span> else
<span id="line4532"></span> $mode = SQLITE_BOTH;
<span id="line4533"></span> return $result-<span class="entity"><span>&amp;</span>gt;</span>fetch($mode);
<span id="line4534"></span> }
<span id="line4535"></span> }
<span id="line4536"></span>
<span id="line4537"></span> //returns an array of arrays after doing a SELECT
<span id="line4538"></span> public function selectArray($query, $mode = <span class="entity"><span>&amp;</span>quot;</span>both<span class="entity"><span>&amp;</span>quot;</span>)
<span id="line4539"></span> {
<span id="line4540"></span> $result = $this-<span class="entity"><span>&amp;</span>gt;</span>query($query);
<span id="line4541"></span> //make sure the result is valid
<span id="line4542"></span> if ($result === false || $result === NULL)
<span id="line4543"></span> return NULL; // error
<span id="line4544"></span> if (!is_object($result)) // no rows returned
<span id="line4545"></span> return array();
<span id="line4546"></span> if ($this-<span class="entity"><span>&amp;</span>gt;</span>type == <span class="entity"><span>&amp;</span>quot;</span>PDO<span class="entity"><span>&amp;</span>quot;</span>) {
<span id="line4547"></span> if ($mode == <span class="entity"><span>&amp;</span>quot;</span>assoc<span class="entity"><span>&amp;</span>quot;</span>)
<span id="line4548"></span> $mode = PDO::FETCH_ASSOC;
<span id="line4549"></span> else if ($mode == <span class="entity"><span>&amp;</span>quot;</span>num<span class="entity"><span>&amp;</span>quot;</span>)
<span id="line4550"></span> $mode = PDO::FETCH_NUM;
<span id="line4551"></span> else
<span id="line4552"></span> $mode = PDO::FETCH_BOTH;
<span id="line4553"></span> $ret = $result-<span class="entity"><span>&amp;</span>gt;</span>fetchAll($mode);
<span id="line4554"></span> $result-<span class="entity"><span>&amp;</span>gt;</span>closeCursor();
<span id="line4555"></span> return $ret;
<span id="line4556"></span> } else if ($this-<span class="entity"><span>&amp;</span>gt;</span>type == <span class="entity"><span>&amp;</span>quot;</span>SQLite3<span class="entity"><span>&amp;</span>quot;</span>) {
<span id="line4557"></span> if ($mode == <span class="entity"><span>&amp;</span>quot;</span>assoc<span class="entity"><span>&amp;</span>quot;</span>)
<span id="line4558"></span> $mode = SQLITE3_ASSOC;
<span id="line4559"></span> else if ($mode == <span class="entity"><span>&amp;</span>quot;</span>num<span class="entity"><span>&amp;</span>quot;</span>)
<span id="line4560"></span> $mode = SQLITE3_NUM;
<span id="line4561"></span> else
<span id="line4562"></span> $mode = SQLITE3_BOTH;
<span id="line4563"></span> $arr = array();
<span id="line4564"></span> $i = 0;
<span id="line4565"></span> while ($res = $result-<span class="entity"><span>&amp;</span>gt;</span>fetchArray($mode)) {
<span id="line4566"></span> $arr[$i] = $res;
<span id="line4567"></span> $i++;
<span id="line4568"></span> }
<span id="line4569"></span> $result-<span class="entity"><span>&amp;</span>gt;</span>finalize();
<span id="line4570"></span> return $arr;
<span id="line4571"></span> } else if ($this-<span class="entity"><span>&amp;</span>gt;</span>type == <span class="entity"><span>&amp;</span>quot;</span>SQLiteDatabase<span class="entity"><span>&amp;</span>quot;</span>) {
<span id="line4572"></span> if ($mode == <span class="entity"><span>&amp;</span>quot;</span>assoc<span class="entity"><span>&amp;</span>quot;</span>)
<span id="line4573"></span> $mode = SQLITE_ASSOC;
<span id="line4574"></span> else if ($mode == <span class="entity"><span>&amp;</span>quot;</span>num<span class="entity"><span>&amp;</span>quot;</span>)
<span id="line4575"></span> $mode = SQLITE_NUM;
<span id="line4576"></span> else
<span id="line4577"></span> $mode = SQLITE_BOTH;
<span id="line4578"></span> return $result-<span class="entity"><span>&amp;</span>gt;</span>fetchAll($mode);
<span id="line4579"></span> }
<span id="line4580"></span> }
<span id="line4581"></span>
<span id="line4582"></span> //returns an array of the next row in $result
<span id="line4583"></span> public function fetch($result, $mode = <span class="entity"><span>&amp;</span>quot;</span>both<span class="entity"><span>&amp;</span>quot;</span>)
<span id="line4584"></span> {
<span id="line4585"></span> //make sure the result is valid
<span id="line4586"></span> if ($result === false || $result === NULL)
<span id="line4587"></span> return NULL; // error
<span id="line4588"></span> if (!is_object($result)) // no rows returned
<span id="line4589"></span> return array();
<span id="line4590"></span> if ($this-<span class="entity"><span>&amp;</span>gt;</span>type == <span class="entity"><span>&amp;</span>quot;</span>PDO<span class="entity"><span>&amp;</span>quot;</span>) {
<span id="line4591"></span> if ($mode == <span class="entity"><span>&amp;</span>quot;</span>assoc<span class="entity"><span>&amp;</span>quot;</span>)
<span id="line4592"></span> $mode = PDO::FETCH_ASSOC;
<span id="line4593"></span> else if ($mode == <span class="entity"><span>&amp;</span>quot;</span>num<span class="entity"><span>&amp;</span>quot;</span>)
<span id="line4594"></span> $mode = PDO::FETCH_NUM;
<span id="line4595"></span> else
<span id="line4596"></span> $mode = PDO::FETCH_BOTH;
<span id="line4597"></span> return $result-<span class="entity"><span>&amp;</span>gt;</span>fetch($mode);
<span id="line4598"></span> } else if ($this-<span class="entity"><span>&amp;</span>gt;</span>type == <span class="entity"><span>&amp;</span>quot;</span>SQLite3<span class="entity"><span>&amp;</span>quot;</span>) {
<span id="line4599"></span> if ($mode == <span class="entity"><span>&amp;</span>quot;</span>assoc<span class="entity"><span>&amp;</span>quot;</span>)
<span id="line4600"></span> $mode = SQLITE3_ASSOC;
<span id="line4601"></span> else if ($mode == <span class="entity"><span>&amp;</span>quot;</span>num<span class="entity"><span>&amp;</span>quot;</span>)
<span id="line4602"></span> $mode = SQLITE3_NUM;
<span id="line4603"></span> else
<span id="line4604"></span> $mode = SQLITE3_BOTH;
<span id="line4605"></span> return $result-<span class="entity"><span>&amp;</span>gt;</span>fetchArray($mode);
<span id="line4606"></span> } else if ($this-<span class="entity"><span>&amp;</span>gt;</span>type == <span class="entity"><span>&amp;</span>quot;</span>SQLiteDatabase<span class="entity"><span>&amp;</span>quot;</span>) {
<span id="line4607"></span> if ($mode == <span class="entity"><span>&amp;</span>quot;</span>assoc<span class="entity"><span>&amp;</span>quot;</span>)
<span id="line4608"></span> $mode = SQLITE_ASSOC;
<span id="line4609"></span> else if ($mode == <span class="entity"><span>&amp;</span>quot;</span>num<span class="entity"><span>&amp;</span>quot;</span>)
<span id="line4610"></span> $mode = SQLITE_NUM;
<span id="line4611"></span> else
<span id="line4612"></span> $mode = SQLITE_BOTH;
<span id="line4613"></span> return $result-<span class="entity"><span>&amp;</span>gt;</span>fetch($mode);
<span id="line4614"></span> }
<span id="line4615"></span> }
<span id="line4616"></span>
<span id="line4617"></span> public function getColumnName($result, $colNum)
<span id="line4618"></span> {
<span id="line4619"></span> //make sure the result is valid
<span id="line4620"></span> if ($result === false || $result === NULL || !is_object($result))
<span id="line4621"></span> return <span class="entity"><span>&amp;</span>quot;</span><span class="entity"><span>&amp;</span>quot;</span>; // error or no rows returned
<span id="line4622"></span> if ($this-<span class="entity"><span>&amp;</span>gt;</span>type == <span class="entity"><span>&amp;</span>quot;</span>PDO<span class="entity"><span>&amp;</span>quot;</span>) {
<span id="line4623"></span> $meta = $result-<span class="entity"><span>&amp;</span>gt;</span>getColumnMeta($colNum);
<span id="line4624"></span> return $meta['name'];
<span id="line4625"></span> } else if ($this-<span class="entity"><span>&amp;</span>gt;</span>type == <span class="entity"><span>&amp;</span>quot;</span>SQLite3<span class="entity"><span>&amp;</span>quot;</span>) {
<span id="line4626"></span> return $result-<span class="entity"><span>&amp;</span>gt;</span>columnName($colNum);
<span id="line4627"></span> } else if ($this-<span class="entity"><span>&amp;</span>gt;</span>type == <span class="entity"><span>&amp;</span>quot;</span>SQLiteDatabase<span class="entity"><span>&amp;</span>quot;</span>) {
<span id="line4628"></span> return $result-<span class="entity"><span>&amp;</span>gt;</span>fieldName($colNum);
<span id="line4629"></span> }
<span id="line4630"></span> }
<span id="line4631"></span>
<span id="line4632"></span>
<span id="line4633"></span> // SQlite supports multiple ways of surrounding names in quotes:
<span id="line4634"></span> // single-quotes, double-quotes, backticks, square brackets.
<span id="line4635"></span> // As sqlite does not keep this strict, we also need to be flexible here.
<span id="line4636"></span> // This function generates a regex that matches any of the possibilities.
<span id="line4637"></span> private function sqlite_surroundings_preg($name, $preg_quote = true, $notAllowedCharsIfNone = <span class="entity"><span>&amp;</span>quot;</span>'\<span class="entity"><span>&amp;</span>quot;</span><span class="entity"><span>&amp;</span>quot;</span>, $notAllowedName = false)
<span id="line4638"></span> {
<span id="line4639"></span> if ($name == <span class="entity"><span>&amp;</span>quot;</span>*<span class="entity"><span>&amp;</span>quot;</span> || $name == <span class="entity"><span>&amp;</span>quot;</span>+<span class="entity"><span>&amp;</span>quot;</span>) {
<span id="line4640"></span> if ($notAllowedName !== false <span class="entity"><span>&amp;</span>amp;</span><span class="entity"><span>&amp;</span>amp;</span> $preg_quote)
<span id="line4641"></span> $notAllowedName = preg_quote($notAllowedName, <span class="entity"><span>&amp;</span>quot;</span>/<span class="entity"><span>&amp;</span>quot;</span>);
<span id="line4642"></span> // use possesive quantifiers to save memory
<span id="line4643"></span> // (There is a bug in PCRE starting in 8.13 and fixed in PCRE 8.36
<span id="line4644"></span> // why we can't use posesive quantifiers - See issue #310).
<span id="line4645"></span> if (version_compare(strstr(constant('PCRE_VERSION'), ' ', true), '8.36', '<span class="entity"><span>&amp;</span>gt;</span>=') ||
<span id="line4646"></span> version_compare(strstr(constant('PCRE_VERSION'), ' ', true), '8.12', '<span class="entity"><span>&amp;</span>lt;</span>='))
<span id="line4647"></span> $posessive = '+';
<span id="line4648"></span> else
<span id="line4649"></span> $posessive = '';
<span id="line4650"></span>
<span id="line4651"></span> $nameSingle = ($notAllowedName !== false ? <span class="entity"><span>&amp;</span>quot;</span>(?!<span class="entity"><span>&amp;</span>quot;</span> . $notAllowedName . <span class="entity"><span>&amp;</span>quot;</span>')<span class="entity"><span>&amp;</span>quot;</span> : <span class="entity"><span>&amp;</span>quot;</span><span class="entity"><span>&amp;</span>quot;</span>) . <span class="entity"><span>&amp;</span>quot;</span>(?:[^']$name+|'')$name<span class="entity"><span>&amp;</span>quot;</span> . $posessive;
<span id="line4652"></span> $nameDouble = ($notAllowedName !== false ? <span class="entity"><span>&amp;</span>quot;</span>(?!<span class="entity"><span>&amp;</span>quot;</span> . $notAllowedName . <span class="entity"><span>&amp;</span>quot;</span>\<span class="entity"><span>&amp;</span>quot;</span>)<span class="entity"><span>&amp;</span>quot;</span> : <span class="entity"><span>&amp;</span>quot;</span><span class="entity"><span>&amp;</span>quot;</span>) . <span class="entity"><span>&amp;</span>quot;</span>(?:[^\<span class="entity"><span>&amp;</span>quot;</span>]$name+|\<span class="entity"><span>&amp;</span>quot;</span>\<span class="entity"><span>&amp;</span>quot;</span>)$name<span class="entity"><span>&amp;</span>quot;</span> . $posessive;
<span id="line4653"></span> $nameBacktick = ($notAllowedName !== false ? <span class="entity"><span>&amp;</span>quot;</span>(?!<span class="entity"><span>&amp;</span>quot;</span> . $notAllowedName . <span class="entity"><span>&amp;</span>quot;</span>`)<span class="entity"><span>&amp;</span>quot;</span> : <span class="entity"><span>&amp;</span>quot;</span><span class="entity"><span>&amp;</span>quot;</span>) . <span class="entity"><span>&amp;</span>quot;</span>(?:[^`]$name+|``)$name<span class="entity"><span>&amp;</span>quot;</span> . $posessive;
<span id="line4654"></span> $nameSquare = ($notAllowedName !== false ? <span class="entity"><span>&amp;</span>quot;</span>(?!<span class="entity"><span>&amp;</span>quot;</span> . $notAllowedName . <span class="entity"><span>&amp;</span>quot;</span>\])<span class="entity"><span>&amp;</span>quot;</span> : <span class="entity"><span>&amp;</span>quot;</span><span class="entity"><span>&amp;</span>quot;</span>) . <span class="entity"><span>&amp;</span>quot;</span>(?:[^\]]$name+|\]\])$name<span class="entity"><span>&amp;</span>quot;</span> . $posessive;
<span id="line4655"></span> $nameNo = ($notAllowedName !== false ? <span class="entity"><span>&amp;</span>quot;</span>(?!<span class="entity"><span>&amp;</span>quot;</span> . $notAllowedName . <span class="entity"><span>&amp;</span>quot;</span>\s)<span class="entity"><span>&amp;</span>quot;</span> : <span class="entity"><span>&amp;</span>quot;</span><span class="entity"><span>&amp;</span>quot;</span>) . <span class="entity"><span>&amp;</span>quot;</span>[^<span class="entity"><span>&amp;</span>quot;</span> . $notAllowedCharsIfNone . <span class="entity"><span>&amp;</span>quot;</span>]$name<span class="entity"><span>&amp;</span>quot;</span>;
<span id="line4656"></span> } else {
<span id="line4657"></span> if ($preg_quote) $name = preg_quote($name, <span class="entity"><span>&amp;</span>quot;</span>/<span class="entity"><span>&amp;</span>quot;</span>);
<span id="line4658"></span>
<span id="line4659"></span> $nameSingle = str_replace(<span class="entity"><span>&amp;</span>quot;</span>'<span class="entity"><span>&amp;</span>quot;</span>, <span class="entity"><span>&amp;</span>quot;</span>''<span class="entity"><span>&amp;</span>quot;</span>, $name);
<span id="line4660"></span> $nameDouble = str_replace('<span class="entity"><span>&amp;</span>quot;</span>', '<span class="entity"><span>&amp;</span>quot;</span><span class="entity"><span>&amp;</span>quot;</span>', $name);
<span id="line4661"></span> $nameBacktick = str_replace('`', '``', $name);
<span id="line4662"></span> $nameSquare = str_replace(']', ']]', $name);
<span id="line4663"></span> $nameNo = $name;
<span id="line4664"></span> }
<span id="line4665"></span>
<span id="line4666"></span> $preg = <span class="entity"><span>&amp;</span>quot;</span>(?:'<span class="entity"><span>&amp;</span>quot;</span> . $nameSingle . <span class="entity"><span>&amp;</span>quot;</span>'|<span class="entity"><span>&amp;</span>quot;</span> . // single-quote surrounded or not in quotes (correct SQL for values/new names)
<span id="line4667"></span> $nameNo . <span class="entity"><span>&amp;</span>quot;</span>|<span class="entity"><span>&amp;</span>quot;</span> . // not surrounded (correct SQL if not containing reserved words, spaces or some special chars)
<span id="line4668"></span> <span class="entity"><span>&amp;</span>quot;</span>\<span class="entity"><span>&amp;</span>quot;</span><span class="entity"><span>&amp;</span>quot;</span> . $nameDouble . <span class="entity"><span>&amp;</span>quot;</span>\<span class="entity"><span>&amp;</span>quot;</span>|<span class="entity"><span>&amp;</span>quot;</span> . // double-quote surrounded (correct SQL for identifiers)
<span id="line4669"></span> <span class="entity"><span>&amp;</span>quot;</span>`<span class="entity"><span>&amp;</span>quot;</span> . $nameBacktick . <span class="entity"><span>&amp;</span>quot;</span>`|<span class="entity"><span>&amp;</span>quot;</span> . // backtick surrounded (MySQL-Style)
<span id="line4670"></span> <span class="entity"><span>&amp;</span>quot;</span>\[<span class="entity"><span>&amp;</span>quot;</span> . $nameSquare . <span class="entity"><span>&amp;</span>quot;</span>\])<span class="entity"><span>&amp;</span>quot;</span>; // square-bracket surrounded (MS Access/SQL server-Style)
<span id="line4671"></span> return $preg;
<span id="line4672"></span> }
<span id="line4673"></span>
<span id="line4674"></span> // Returns the last PREG error as a string, '' if no error occured
<span id="line4675"></span> private function getPregError()
<span id="line4676"></span> {
<span id="line4677"></span> $error = preg_last_error();
<span id="line4678"></span> switch ($error) {
<span id="line4679"></span> case PREG_NO_ERROR:
<span id="line4680"></span> return 'No error';
<span id="line4681"></span> case PREG_INTERNAL_ERROR:
<span id="line4682"></span> return 'There is an internal error!';
<span id="line4683"></span> case PREG_BACKTRACK_LIMIT_ERROR:
<span id="line4684"></span> return 'Backtrack limit was exhausted!';
<span id="line4685"></span> case PREG_RECURSION_LIMIT_ERROR:
<span id="line4686"></span> return 'Recursion limit was exhausted!';
<span id="line4687"></span> case PREG_BAD_UTF8_ERROR:
<span id="line4688"></span> return 'Bad UTF8 error!';
<span id="line4689"></span> // PREG_BAD_UTF8_OFFSET_ERROR is introduced in PHP 5.3.0, which is not yet required by PLA, so we use its value 5 instead so long
<span id="line4690"></span> case 5:
<span id="line4691"></span> return 'Bad UTF8 offset error!';
<span id="line4692"></span> default:
<span id="line4693"></span> return 'Unknown Error';
<span id="line4694"></span> }
<span id="line4695"></span> }
<span id="line4696"></span>
<span id="line4697"></span> // function that is called for an alter table statement in a query
<span id="line4698"></span> // code borrowed with permission from http://code.jenseng.com/db/
<span id="line4699"></span> // this has been completely debugged / rewritten by Christopher Kramer
<span id="line4700"></span> public function alterTable($table, $alterdefs)
<span id="line4701"></span> {
<span id="line4702"></span> global $debug, $lang;
<span id="line4703"></span> $this-<span class="entity"><span>&amp;</span>gt;</span>alterError = <span class="entity"><span>&amp;</span>quot;</span><span class="entity"><span>&amp;</span>quot;</span>;
<span id="line4704"></span> $errormsg = sprintf($lang['alter_failed'], htmlencode($table)) . ' - ';
<span id="line4705"></span> if ($debug) $this-<span class="entity"><span>&amp;</span>gt;</span>debugOutput .= <span class="entity"><span>&amp;</span>quot;</span>ALTER TABLE: table=($table), alterdefs=($alterdefs), PCRE version=(<span class="entity"><span>&amp;</span>quot;</span> . PCRE_VERSION . <span class="entity"><span>&amp;</span>quot;</span>)<span class="entity"><span>&amp;</span>lt;</span>hr /<span class="entity"><span>&amp;</span>gt;</span><span class="entity"><span>&amp;</span>lt;</span>br /<span class="entity"><span>&amp;</span>gt;</span><span class="entity"><span>&amp;</span>quot;</span>;
<span id="line4706"></span> if ($alterdefs != '') {
<span id="line4707"></span> $recreateQueries = array();
<span id="line4708"></span> $resultArr = $this-<span class="entity"><span>&amp;</span>gt;</span>selectArray(<span class="entity"><span>&amp;</span>quot;</span>SELECT sql,name,type FROM sqlite_master WHERE tbl_name = <span class="entity"><span>&amp;</span>quot;</span> . $this-<span class="entity"><span>&amp;</span>gt;</span>quote($table));
<span id="line4709"></span> if (sizeof($resultArr) <span class="entity"><span>&amp;</span>lt;</span> 1) {
<span id="line4710"></span> $this-<span class="entity"><span>&amp;</span>gt;</span>alterError = $errormsg . sprintf($lang['tbl_inexistent'], htmlencode($table));
<span id="line4711"></span> if ($debug) $this-<span class="entity"><span>&amp;</span>gt;</span>debugOutput .= <span class="entity"><span>&amp;</span>quot;</span>ERROR: unknown table<span class="entity"><span>&amp;</span>lt;</span>hr /<span class="entity"><span>&amp;</span>gt;</span><span class="entity"><span>&amp;</span>lt;</span>br /<span class="entity"><span>&amp;</span>gt;</span><span class="entity"><span>&amp;</span>quot;</span>;
<span id="line4712"></span> return false;
<span id="line4713"></span> }
<span id="line4714"></span> for ($i = 0; $i <span class="entity"><span>&amp;</span>lt;</span> sizeof($resultArr); $i++) {
<span id="line4715"></span> $row = $resultArr[$i];
<span id="line4716"></span> if ($row['type'] != 'table' <span class="entity"><span>&amp;</span>amp;</span><span class="entity"><span>&amp;</span>amp;</span> $row['type'] != 'view') {
<span id="line4717"></span> if ($row['sql'] != '') {
<span id="line4718"></span> // store the CREATE statements of triggers and indexes to recreate them later
<span id="line4719"></span> $recreateQueries[] = $row;
<span id="line4720"></span> if ($debug) $this-<span class="entity"><span>&amp;</span>gt;</span>debugOutput .= <span class="entity"><span>&amp;</span>quot;</span>recreate=(<span class="entity"><span>&amp;</span>quot;</span> . $row['sql'] . <span class="entity"><span>&amp;</span>quot;</span>;)<span class="entity"><span>&amp;</span>lt;</span>br /<span class="entity"><span>&amp;</span>gt;</span><span class="entity"><span>&amp;</span>quot;</span>;
<span id="line4721"></span> }
<span id="line4722"></span> } elseif ($row['type'] == 'view') // workaround to rename views
<span id="line4723"></span> {
<span id="line4724"></span> $origsql = $row['sql'];
<span id="line4725"></span> $preg_remove_create_view = <span class="entity"><span>&amp;</span>quot;</span>/^\s*+CREATE\s++VIEW\s++<span class="entity"><span>&amp;</span>quot;</span> . $this-<span class="entity"><span>&amp;</span>gt;</span>sqlite_surroundings_preg($table) . <span class="entity"><span>&amp;</span>quot;</span>\s*+(AS\s++SELECT\s++.*+)$/is<span class="entity"><span>&amp;</span>quot;</span>;
<span id="line4726"></span> $origsql_no_create = preg_replace($preg_remove_create_view, '$1', $origsql, 1);
<span id="line4727"></span> if ($debug) $this-<span class="entity"><span>&amp;</span>gt;</span>debugOutput .= <span class="entity"><span>&amp;</span>quot;</span>origsql=($origsql)<span class="entity"><span>&amp;</span>lt;</span>br /<span class="entity"><span>&amp;</span>gt;</span>preg_remove_create_table=($preg_remove_create_view)<span class="entity"><span>&amp;</span>lt;</span>br /<span class="entity"><span>&amp;</span>gt;</span><span class="entity"><span>&amp;</span>quot;</span>;
<span id="line4728"></span> preg_match(<span class="entity"><span>&amp;</span>quot;</span>/RENAME\s++TO\s++(?:\<span class="entity"><span>&amp;</span>quot;</span>((?:[^\<span class="entity"><span>&amp;</span>quot;</span>]|\<span class="entity"><span>&amp;</span>quot;</span>\<span class="entity"><span>&amp;</span>quot;</span>)+)\<span class="entity"><span>&amp;</span>quot;</span>|'((?:[^']|'')+)')/is<span class="entity"><span>&amp;</span>quot;</span>, $alterdefs, $matches);
<span id="line4729"></span> if (isset($matches[1]) <span class="entity"><span>&amp;</span>amp;</span><span class="entity"><span>&amp;</span>amp;</span> $matches[1] != '')
<span id="line4730"></span> $newname = $matches[1];
<span id="line4731"></span> elseif (isset($matches[2]) <span class="entity"><span>&amp;</span>amp;</span><span class="entity"><span>&amp;</span>amp;</span> $matches[2] != '')
<span id="line4732"></span> $newname = $matches[2];
<span id="line4733"></span> else {
<span id="line4734"></span> $this-<span class="entity"><span>&amp;</span>gt;</span>alterError = $errormsg . ' could not detect new view name. It needs to be in single or double quotes.';
<span id="line4735"></span> if ($debug) $this-<span class="entity"><span>&amp;</span>gt;</span>debugOutput .= <span class="entity"><span>&amp;</span>quot;</span>ERROR: could not detect new view name<span class="entity"><span>&amp;</span>lt;</span>hr /<span class="entity"><span>&amp;</span>gt;</span><span class="entity"><span>&amp;</span>quot;</span>;
<span id="line4736"></span> return false;
<span id="line4737"></span> }
<span id="line4738"></span> $dropoldSQL = 'DROP VIEW ' . $this-<span class="entity"><span>&amp;</span>gt;</span>quote_id($table);
<span id="line4739"></span> $createnewSQL = 'CREATE VIEW ' . $this-<span class="entity"><span>&amp;</span>gt;</span>quote_id($newname) . ' ' . $origsql_no_create;
<span id="line4740"></span> $alter_transaction = 'BEGIN; ' . $dropoldSQL . '; ' . $createnewSQL . '; ' . 'COMMIT;';
<span id="line4741"></span> if ($debug) $this-<span class="entity"><span>&amp;</span>gt;</span>debugOutput .= $alter_transaction;
<span id="line4742"></span> return $this-<span class="entity"><span>&amp;</span>gt;</span>multiQuery($alter_transaction);
<span id="line4743"></span> } else {
<span id="line4744"></span> // ALTER the table
<span id="line4745"></span> $tmpname = 't' . time();
<span id="line4746"></span> $origsql = $row['sql'];
<span id="line4747"></span> $preg_remove_create_table = <span class="entity"><span>&amp;</span>quot;</span>/^\s*+CREATE\s++TABLE\s++<span class="entity"><span>&amp;</span>quot;</span> . $this-<span class="entity"><span>&amp;</span>gt;</span>sqlite_surroundings_preg($table) . <span class="entity"><span>&amp;</span>quot;</span>\s*+(\(.*+)$/is<span class="entity"><span>&amp;</span>quot;</span>;
<span id="line4748"></span> $origsql_no_create = preg_replace($preg_remove_create_table, '$1', $origsql, 1);
<span id="line4749"></span> if ($debug) $this-<span class="entity"><span>&amp;</span>gt;</span>debugOutput .= <span class="entity"><span>&amp;</span>quot;</span>origsql=($origsql)<span class="entity"><span>&amp;</span>lt;</span>br /<span class="entity"><span>&amp;</span>gt;</span>preg_remove_create_table=($preg_remove_create_table)<span class="entity"><span>&amp;</span>lt;</span>br /<span class="entity"><span>&amp;</span>gt;</span><span class="entity"><span>&amp;</span>quot;</span>;
<span id="line4750"></span> if ($origsql_no_create == $origsql) {
<span id="line4751"></span> $this-<span class="entity"><span>&amp;</span>gt;</span>alterError = $errormsg . $lang['alter_tbl_name_not_replacable'];
<span id="line4752"></span> if ($debug) $this-<span class="entity"><span>&amp;</span>gt;</span>debugOutput .= <span class="entity"><span>&amp;</span>quot;</span>ERROR: could not get rid of CREATE TABLE<span class="entity"><span>&amp;</span>lt;</span>hr /<span class="entity"><span>&amp;</span>gt;</span><span class="entity"><span>&amp;</span>quot;</span>;
<span id="line4753"></span> return false;
<span id="line4754"></span> }
<span id="line4755"></span> $createtemptableSQL = <span class="entity"><span>&amp;</span>quot;</span>CREATE TABLE <span class="entity"><span>&amp;</span>quot;</span> . $this-<span class="entity"><span>&amp;</span>gt;</span>quote($tmpname) . <span class="entity"><span>&amp;</span>quot;</span> <span class="entity"><span>&amp;</span>quot;</span> . $origsql_no_create;
<span id="line4756"></span> if ($debug) $this-<span class="entity"><span>&amp;</span>gt;</span>debugOutput .= <span class="entity"><span>&amp;</span>quot;</span>createtemptableSQL=($createtemptableSQL)<span class="entity"><span>&amp;</span>lt;</span>br /<span class="entity"><span>&amp;</span>gt;</span><span class="entity"><span>&amp;</span>quot;</span>;
<span id="line4757"></span> $createindexsql = array();
<span id="line4758"></span> $preg_alter_part = <span class="entity"><span>&amp;</span>quot;</span>/(?:DROP(?! PRIMARY KEY)|ADD(?! PRIMARY KEY)|CHANGE|RENAME TO|ADD PRIMARY KEY|DROP PRIMARY KEY)<span class="entity"><span>&amp;</span>quot;</span> // the ALTER command
<span id="line4759"></span> . <span class="entity"><span>&amp;</span>quot;</span>(?:<span class="entity"><span>&amp;</span>quot;</span>
<span id="line4760"></span> . <span class="entity"><span>&amp;</span>quot;</span>\s+\(<span class="entity"><span>&amp;</span>quot;</span> . $this-<span class="entity"><span>&amp;</span>gt;</span>sqlite_surroundings_preg(<span class="entity"><span>&amp;</span>quot;</span>+<span class="entity"><span>&amp;</span>quot;</span>, false, <span class="entity"><span>&amp;</span>quot;</span>\<span class="entity"><span>&amp;</span>quot;</span>'\[`)<span class="entity"><span>&amp;</span>quot;</span>) . <span class="entity"><span>&amp;</span>quot;</span>+\)<span class="entity"><span>&amp;</span>quot;</span> // stuff in brackets (in case of ADD PRIMARY KEY)
<span id="line4761"></span> . <span class="entity"><span>&amp;</span>quot;</span>|<span class="entity"><span>&amp;</span>quot;</span> // or
<span id="line4762"></span> . <span class="entity"><span>&amp;</span>quot;</span>\s+<span class="entity"><span>&amp;</span>quot;</span> . $this-<span class="entity"><span>&amp;</span>gt;</span>sqlite_surroundings_preg(<span class="entity"><span>&amp;</span>quot;</span>+<span class="entity"><span>&amp;</span>quot;</span>, false, <span class="entity"><span>&amp;</span>quot;</span>,'\<span class="entity"><span>&amp;</span>quot;</span>\[`<span class="entity"><span>&amp;</span>quot;</span>) // column names and stuff like this
<span id="line4763"></span> . <span class="entity"><span>&amp;</span>quot;</span>)*/i<span class="entity"><span>&amp;</span>quot;</span>;
<span id="line4764"></span> if ($debug)
<span id="line4765"></span> $this-<span class="entity"><span>&amp;</span>gt;</span>debugOutput .= <span class="entity"><span>&amp;</span>quot;</span>preg_alter_part=(<span class="entity"><span>&amp;</span>quot;</span> . $preg_alter_part . <span class="entity"><span>&amp;</span>quot;</span>)<span class="entity"><span>&amp;</span>lt;</span>br /<span class="entity"><span>&amp;</span>gt;</span><span class="entity"><span>&amp;</span>quot;</span>;
<span id="line4766"></span> preg_match_all($preg_alter_part, $alterdefs, $matches);
<span id="line4767"></span> $defs = $matches[0];
<span id="line4768"></span>
<span id="line4769"></span> $result_oldcols = $this-<span class="entity"><span>&amp;</span>gt;</span>getTableInfo($table);
<span id="line4770"></span> $newcols = array();
<span id="line4771"></span> $coltypes = array();
<span id="line4772"></span> $primarykey = array();
<span id="line4773"></span> foreach ($result_oldcols as $column_info) {
<span id="line4774"></span> $newcols[$column_info['name']] = $column_info['name'];
<span id="line4775"></span> $coltypes[$column_info['name']] = $column_info['type'];
<span id="line4776"></span> if ($column_info['pk'])
<span id="line4777"></span> $primarykey[] = $column_info['name'];
<span id="line4778"></span> }
<span id="line4779"></span> $newcolumns = '';
<span id="line4780"></span> $oldcolumns = '';
<span id="line4781"></span> reset($newcols);
<span id="line4782"></span> while (list($key, $val) = each($newcols)) {
<span id="line4783"></span> $newcolumns .= ($newcolumns ? ', ' : '') . $this-<span class="entity"><span>&amp;</span>gt;</span>quote_id($val);
<span id="line4784"></span> $oldcolumns .= ($oldcolumns ? ', ' : '') . $this-<span class="entity"><span>&amp;</span>gt;</span>quote_id($key);
<span id="line4785"></span> }
<span id="line4786"></span> $copytotempsql = 'INSERT INTO ' . $this-<span class="entity"><span>&amp;</span>gt;</span>quote_id($tmpname) . '(' . $newcolumns . ') SELECT ' . $oldcolumns . ' FROM ' . $this-<span class="entity"><span>&amp;</span>gt;</span>quote_id($table);
<span id="line4787"></span> $dropoldsql = 'DROP TABLE ' . $this-<span class="entity"><span>&amp;</span>gt;</span>quote_id($table);
<span id="line4788"></span> $createtesttableSQL = $createtemptableSQL;
<span id="line4789"></span> if (count($defs) <span class="entity"><span>&amp;</span>lt;</span> 1) {
<span id="line4790"></span> $this-<span class="entity"><span>&amp;</span>gt;</span>alterError = $errormsg . $lang['alter_no_def'];
<span id="line4791"></span> if ($debug) $this-<span class="entity"><span>&amp;</span>gt;</span>debugOutput .= <span class="entity"><span>&amp;</span>quot;</span>ERROR: defs<span class="entity"><span>&amp;</span>amp;</span>lt;1<span class="entity"><span>&amp;</span>lt;</span>hr /<span class="entity"><span>&amp;</span>gt;</span><span class="entity"><span>&amp;</span>lt;</span>br /<span class="entity"><span>&amp;</span>gt;</span><span class="entity"><span>&amp;</span>quot;</span>;
<span id="line4792"></span> return false;
<span id="line4793"></span> }
<span id="line4794"></span> foreach ($defs as $def) {
<span id="line4795"></span> if ($debug) $this-<span class="entity"><span>&amp;</span>gt;</span>debugOutput .= <span class="entity"><span>&amp;</span>quot;</span><span class="entity"><span>&amp;</span>lt;</span>hr /<span class="entity"><span>&amp;</span>gt;</span>def=$def<span class="entity"><span>&amp;</span>lt;</span>br /<span class="entity"><span>&amp;</span>gt;</span><span class="entity"><span>&amp;</span>quot;</span>;
<span id="line4796"></span> $preg_parse_def =
<span id="line4797"></span> <span class="entity"><span>&amp;</span>quot;</span>/^(DROP(?! PRIMARY KEY)|ADD(?! PRIMARY KEY)|CHANGE|RENAME TO|ADD PRIMARY KEY|DROP PRIMARY KEY)<span class="entity"><span>&amp;</span>quot;</span> // $matches[1]: command
<span id="line4798"></span> . <span class="entity"><span>&amp;</span>quot;</span>(?:<span class="entity"><span>&amp;</span>quot;</span> // this is either
<span id="line4799"></span> . <span class="entity"><span>&amp;</span>quot;</span>(?:\s+\((.+)\)\s*$)<span class="entity"><span>&amp;</span>quot;</span> // anything in brackets (for ADD PRIMARY KEY)
<span id="line4800"></span> // then $matches[2] is what there is in brackets
<span id="line4801"></span> . <span class="entity"><span>&amp;</span>quot;</span>|<span class="entity"><span>&amp;</span>quot;</span> // OR: 
<span id="line4802"></span> . <span class="entity"><span>&amp;</span>quot;</span>(?:\s+\<span class="entity"><span>&amp;</span>quot;</span>((?:[^\<span class="entity"><span>&amp;</span>quot;</span>]|\<span class="entity"><span>&amp;</span>quot;</span>\<span class="entity"><span>&amp;</span>quot;</span>)+)\<span class="entity"><span>&amp;</span>quot;</span>|\s+'((?:[^']|'')+)')<span class="entity"><span>&amp;</span>quot;</span>// (first) column name, either in single or double quotes
<span id="line4803"></span> // in case of RENAME TO, it is the new a table name
<span id="line4804"></span> // $matches[3] will be the column/table name without the quotes if double quoted
<span id="line4805"></span> // $matches[4] will be the column/table name without the quotes if single quoted
<span id="line4806"></span> . <span class="entity"><span>&amp;</span>quot;</span>(<span class="entity"><span>&amp;</span>quot;</span> // $matches[5]: anything after the column name
<span id="line4807"></span> . <span class="entity"><span>&amp;</span>quot;</span>(?:\s+'((?:[^']|'')+)')?<span class="entity"><span>&amp;</span>quot;</span> // $matches[6] (optional): a second column name surrounded with single quotes
<span id="line4808"></span> // (the match does not contain the quotes) 
<span id="line4809"></span> . <span class="entity"><span>&amp;</span>quot;</span>\s*<span class="entity"><span>&amp;</span>quot;</span>
<span id="line4810"></span> . <span class="entity"><span>&amp;</span>quot;</span>((?:[A-Z]+\s*)+(?:\(\s*[+-]?\s*[0-9]+(?:\s*,\s*[+-]?\s*[0-9]+)?\s*\))?)?\s*<span class="entity"><span>&amp;</span>quot;</span> // $matches[7] (optional): a type name
<span id="line4811"></span> . <span class="entity"><span>&amp;</span>quot;</span>.*<span class="entity"><span>&amp;</span>quot;</span> .
<span id="line4812"></span> <span class="entity"><span>&amp;</span>quot;</span>)<span class="entity"><span>&amp;</span>quot;</span>
<span id="line4813"></span> . <span class="entity"><span>&amp;</span>quot;</span>?\s*$<span class="entity"><span>&amp;</span>quot;</span>
<span id="line4814"></span> . <span class="entity"><span>&amp;</span>quot;</span>)?\s*$/i<span class="entity"><span>&amp;</span>quot;</span>; // in case of DROP PRIMARY KEY, there is nothing after the command
<span id="line4815"></span> if ($debug) $this-<span class="entity"><span>&amp;</span>gt;</span>debugOutput .= <span class="entity"><span>&amp;</span>quot;</span>preg_parse_def=$preg_parse_def<span class="entity"><span>&amp;</span>lt;</span>br /<span class="entity"><span>&amp;</span>gt;</span><span class="entity"><span>&amp;</span>quot;</span>;
<span id="line4816"></span> $parse_def = preg_match($preg_parse_def, $def, $matches);
<span id="line4817"></span> if ($parse_def === false) {
<span id="line4818"></span> $this-<span class="entity"><span>&amp;</span>gt;</span>alterError = $errormsg . $lang['alter_parse_failed'];
<span id="line4819"></span> if ($debug) $this-<span class="entity"><span>&amp;</span>gt;</span>debugOutput .= <span class="entity"><span>&amp;</span>quot;</span>ERROR: !parse_def<span class="entity"><span>&amp;</span>lt;</span>hr /<span class="entity"><span>&amp;</span>gt;</span><span class="entity"><span>&amp;</span>lt;</span>br /<span class="entity"><span>&amp;</span>gt;</span><span class="entity"><span>&amp;</span>quot;</span>;
<span id="line4820"></span> return false;
<span id="line4821"></span> }
<span id="line4822"></span> if (!isset($matches[1])) {
<span id="line4823"></span> $this-<span class="entity"><span>&amp;</span>gt;</span>alterError = $errormsg . $lang['alter_action_not_recognized'];
<span id="line4824"></span> if ($debug) $this-<span class="entity"><span>&amp;</span>gt;</span>debugOutput .= <span class="entity"><span>&amp;</span>quot;</span>ERROR: !isset(matches[1])<span class="entity"><span>&amp;</span>lt;</span>hr /<span class="entity"><span>&amp;</span>gt;</span><span class="entity"><span>&amp;</span>lt;</span>br /<span class="entity"><span>&amp;</span>gt;</span><span class="entity"><span>&amp;</span>quot;</span>;
<span id="line4825"></span> return false;
<span id="line4826"></span> }
<span id="line4827"></span> $action = strtolower($matches[1]);
<span id="line4828"></span> if (($action == 'add' || $action == 'rename to') <span class="entity"><span>&amp;</span>amp;</span><span class="entity"><span>&amp;</span>amp;</span> isset($matches[4]) <span class="entity"><span>&amp;</span>amp;</span><span class="entity"><span>&amp;</span>amp;</span> $matches[4] != '')
<span id="line4829"></span> $column = str_replace(<span class="entity"><span>&amp;</span>quot;</span>''<span class="entity"><span>&amp;</span>quot;</span>, <span class="entity"><span>&amp;</span>quot;</span>'<span class="entity"><span>&amp;</span>quot;</span>, $matches[4]); // enclosed in ''
<span id="line4830"></span> elseif ($action == 'add primary key' <span class="entity"><span>&amp;</span>amp;</span><span class="entity"><span>&amp;</span>amp;</span> isset($matches[2]) <span class="entity"><span>&amp;</span>amp;</span><span class="entity"><span>&amp;</span>amp;</span> $matches[2] != '')
<span id="line4831"></span> $column = $matches[2];
<span id="line4832"></span> elseif ($action == 'drop primary key')
<span id="line4833"></span> $column = ''; // DROP PRIMARY KEY has no column definition
<span id="line4834"></span> elseif (isset($matches[3]) <span class="entity"><span>&amp;</span>amp;</span><span class="entity"><span>&amp;</span>amp;</span> $matches[3] != '')
<span id="line4835"></span> $column = str_replace('<span class="entity"><span>&amp;</span>quot;</span><span class="entity"><span>&amp;</span>quot;</span>', '<span class="entity"><span>&amp;</span>quot;</span>', $matches[3]); // enclosed in <span class="entity"><span>&amp;</span>quot;</span><span class="entity"><span>&amp;</span>quot;</span>
<span id="line4836"></span> else
<span id="line4837"></span> $column = '';
<span id="line4838"></span>
<span id="line4839"></span> $column_escaped = str_replace(<span class="entity"><span>&amp;</span>quot;</span>'<span class="entity"><span>&amp;</span>quot;</span>, <span class="entity"><span>&amp;</span>quot;</span>''<span class="entity"><span>&amp;</span>quot;</span>, $column);
<span id="line4840"></span>
<span id="line4841"></span> if ($debug) $this-<span class="entity"><span>&amp;</span>gt;</span>debugOutput .= <span class="entity"><span>&amp;</span>quot;</span>action=($action), column=($column), column_escaped=($column_escaped)<span class="entity"><span>&amp;</span>lt;</span>br /<span class="entity"><span>&amp;</span>gt;</span><span class="entity"><span>&amp;</span>quot;</span>;
<span id="line4842"></span>
<span id="line4843"></span> /* we build a regex that devides the CREATE TABLE statement parts:
<span id="line4844"></span>  Part example Group Explanation
<span id="line4845"></span>  1. CREATE TABLE t... ( $1
<span id="line4846"></span>  2. 'col1' ..., 'col2' ..., 'colN' ..., $3 (with col1-colN being columns that are not changed and listed before the col to change)
<span id="line4847"></span>  3. 'colX' ..., (with colX being the column to change/drop)
<span id="line4848"></span>  4. 'colX+1' ..., ..., 'colK') $5 (with colX+1-colK being columns after the column to change/drop)
<span id="line4849"></span> */
<span id="line4850"></span> $preg_create_table = <span class="entity"><span>&amp;</span>quot;</span>\s*+(CREATE\s++TABLE\s++<span class="entity"><span>&amp;</span>quot;</span> . preg_quote($this-<span class="entity"><span>&amp;</span>gt;</span>quote($tmpname), <span class="entity"><span>&amp;</span>quot;</span>/<span class="entity"><span>&amp;</span>quot;</span>) . <span class="entity"><span>&amp;</span>quot;</span>\s*+\()<span class="entity"><span>&amp;</span>quot;</span>; // This is group $1 (keep unchanged)
<span id="line4851"></span> $preg_column_definiton = <span class="entity"><span>&amp;</span>quot;</span>\s*+<span class="entity"><span>&amp;</span>quot;</span> . $this-<span class="entity"><span>&amp;</span>gt;</span>sqlite_surroundings_preg(<span class="entity"><span>&amp;</span>quot;</span>+<span class="entity"><span>&amp;</span>quot;</span>, true, <span class="entity"><span>&amp;</span>quot;</span> '\<span class="entity"><span>&amp;</span>quot;</span>\[`,<span class="entity"><span>&amp;</span>quot;</span>, $column) . <span class="entity"><span>&amp;</span>quot;</span>(?:\s*+<span class="entity"><span>&amp;</span>quot;</span> . $this-<span class="entity"><span>&amp;</span>gt;</span>sqlite_surroundings_preg(<span class="entity"><span>&amp;</span>quot;</span>*<span class="entity"><span>&amp;</span>quot;</span>, false, <span class="entity"><span>&amp;</span>quot;</span>'\<span class="entity"><span>&amp;</span>quot;</span>,`\[ <span class="entity"><span>&amp;</span>quot;</span>) . <span class="entity"><span>&amp;</span>quot;</span>)++<span class="entity"><span>&amp;</span>quot;</span>; // catches a complete column definition, even if it is
<span id="line4852"></span> // 'column' TEXT NOT NULL DEFAULT 'we have a comma, here and a double ''quote!'
<span id="line4853"></span> // this definition does NOT match columns with the column name $column
<span id="line4854"></span> if ($debug) $this-<span class="entity"><span>&amp;</span>gt;</span>debugOutput .= <span class="entity"><span>&amp;</span>quot;</span>preg_column_definition=(<span class="entity"><span>&amp;</span>quot;</span> . $preg_column_definiton . <span class="entity"><span>&amp;</span>quot;</span>)<span class="entity"><span>&amp;</span>lt;</span>br /<span class="entity"><span>&amp;</span>gt;</span><span class="entity"><span>&amp;</span>quot;</span>;
<span id="line4855"></span> $preg_columns_before = // columns before the one changed/dropped (keep)
<span id="line4856"></span> <span class="entity"><span>&amp;</span>quot;</span>(?:<span class="entity"><span>&amp;</span>quot;</span> .
<span id="line4857"></span> <span class="entity"><span>&amp;</span>quot;</span>(<span class="entity"><span>&amp;</span>quot;</span> . // group $2. Keep this one unchanged!
<span id="line4858"></span> <span class="entity"><span>&amp;</span>quot;</span>(?:<span class="entity"><span>&amp;</span>quot;</span> .
<span id="line4859"></span> <span class="entity"><span>&amp;</span>quot;</span>$preg_column_definiton,\s*+<span class="entity"><span>&amp;</span>quot;</span> . // column definition + comma
<span id="line4860"></span> <span class="entity"><span>&amp;</span>quot;</span>)*<span class="entity"><span>&amp;</span>quot;</span> . // there might be any number of such columns here
<span id="line4861"></span> $preg_column_definiton . // last column definition 
<span id="line4862"></span> <span class="entity"><span>&amp;</span>quot;</span>)<span class="entity"><span>&amp;</span>quot;</span> . // end of group $2
<span id="line4863"></span> <span class="entity"><span>&amp;</span>quot;</span>,\s*+<span class="entity"><span>&amp;</span>quot;</span> // the last comma of the last column before the column to change. Do not keep it!
<span id="line4864"></span> . <span class="entity"><span>&amp;</span>quot;</span>)?<span class="entity"><span>&amp;</span>quot;</span>; // there might be no columns before
<span id="line4865"></span> if ($debug) $this-<span class="entity"><span>&amp;</span>gt;</span>debugOutput .= <span class="entity"><span>&amp;</span>quot;</span>preg_columns_before=(<span class="entity"><span>&amp;</span>quot;</span> . $preg_columns_before . <span class="entity"><span>&amp;</span>quot;</span>)<span class="entity"><span>&amp;</span>lt;</span>br /<span class="entity"><span>&amp;</span>gt;</span><span class="entity"><span>&amp;</span>quot;</span>;
<span id="line4866"></span> $preg_columns_after = <span class="entity"><span>&amp;</span>quot;</span>(,\s*(.+))?<span class="entity"><span>&amp;</span>quot;</span>; // the columns after the column to drop. This is group $3 (drop) or $4(change) (keep!)
<span id="line4867"></span> // we could remove the comma using $6 instead of $5, but then we might have no comma at all.
<span id="line4868"></span> // Keeping it leaves a problem if we drop the first column, so we fix that case in another regex.
<span id="line4869"></span> $table_new = $table;
<span id="line4870"></span>
<span id="line4871"></span> switch ($action) {
<span id="line4872"></span> case 'add':
<span id="line4873"></span> if ($column == '') {
<span id="line4874"></span> $this-<span class="entity"><span>&amp;</span>gt;</span>alterError = $errormsg . ' (add) - ' . $lang['alter_no_add_col'];
<span id="line4875"></span> return false;
<span id="line4876"></span> }
<span id="line4877"></span> $new_col_definition = <span class="entity"><span>&amp;</span>quot;</span>'$column_escaped' <span class="entity"><span>&amp;</span>quot;</span> . (isset($matches[5]) ? $matches[5] : '');
<span id="line4878"></span> $preg_pattern_add = <span class="entity"><span>&amp;</span>quot;</span>/^<span class="entity"><span>&amp;</span>quot;</span> . $preg_create_table . // the CREATE TABLE statement ($1)
<span id="line4879"></span> <span class="entity"><span>&amp;</span>quot;</span>((?:(?!,\s*(?:PRIMARY\s+KEY\s*\(|CONSTRAINT\s|UNIQUE\s*\(|CHECK\s*\(|FOREIGN\s+KEY\s*\()).)*)<span class="entity"><span>&amp;</span>quot;</span> . // column definitions ($2)
<span id="line4880"></span> <span class="entity"><span>&amp;</span>quot;</span>(.*)\\)\s*$/si<span class="entity"><span>&amp;</span>quot;</span>; // table-constraints like PRIMARY KEY(a,b) ($3) and the closing bracket
<span id="line4881"></span> // append the column definiton in the CREATE TABLE statement
<span id="line4882"></span> $newSQL = preg_replace($preg_pattern_add, '$1$2, ' . strtr($new_col_definition, array('\\' =<span class="entity"><span>&amp;</span>gt;</span> '\\\\', '$' =<span class="entity"><span>&amp;</span>gt;</span> '\$')) . ' $3', $createtesttableSQL) . ')';
<span id="line4883"></span> $preg_error = $this-<span class="entity"><span>&amp;</span>gt;</span>getPregError();
<span id="line4884"></span> if ($debug) {
<span id="line4885"></span> $this-<span class="entity"><span>&amp;</span>gt;</span>debugOutput .= $createtesttableSQL . <span class="entity"><span>&amp;</span>quot;</span><span class="entity"><span>&amp;</span>lt;</span>hr /<span class="entity"><span>&amp;</span>gt;</span><span class="entity"><span>&amp;</span>lt;</span>br /<span class="entity"><span>&amp;</span>gt;</span><span class="entity"><span>&amp;</span>quot;</span>;
<span id="line4886"></span> $this-<span class="entity"><span>&amp;</span>gt;</span>debugOutput .= $newSQL . <span class="entity"><span>&amp;</span>quot;</span><span class="entity"><span>&amp;</span>lt;</span>hr /<span class="entity"><span>&amp;</span>gt;</span><span class="entity"><span>&amp;</span>lt;</span>br /<span class="entity"><span>&amp;</span>gt;</span><span class="entity"><span>&amp;</span>quot;</span>;
<span id="line4887"></span> $this-<span class="entity"><span>&amp;</span>gt;</span>debugOutput .= $preg_pattern_add . <span class="entity"><span>&amp;</span>quot;</span><span class="entity"><span>&amp;</span>lt;</span>hr /<span class="entity"><span>&amp;</span>gt;</span><span class="entity"><span>&amp;</span>lt;</span>br /<span class="entity"><span>&amp;</span>gt;</span><span class="entity"><span>&amp;</span>quot;</span>;
<span id="line4888"></span> }
<span id="line4889"></span> if ($newSQL == $createtesttableSQL) // pattern did not match, so column adding did not succed
<span id="line4890"></span> {
<span id="line4891"></span> $this-<span class="entity"><span>&amp;</span>gt;</span>alterError = $errormsg . ' (add) - ' . $lang['alter_pattern_mismatch'] . '. PREG ERROR: ' . $preg_error;
<span id="line4892"></span> return false;
<span id="line4893"></span> }
<span id="line4894"></span> $createtesttableSQL = $newSQL;
<span id="line4895"></span> break;
<span id="line4896"></span> case 'change':
<span id="line4897"></span> var_dump($matches);
<span id="line4898"></span> if (!isset($matches[6])) {
<span id="line4899"></span> $this-<span class="entity"><span>&amp;</span>gt;</span>alterError = $errormsg . ' (change) - ' . $lang['alter_col_not_recognized'];
<span id="line4900"></span> return false;
<span id="line4901"></span> }
<span id="line4902"></span> $new_col_name = $matches[6];
<span id="line4903"></span> if (!isset($matches[7]))
<span id="line4904"></span> $new_col_type = '';
<span id="line4905"></span> else
<span id="line4906"></span> $new_col_type = $matches[7];
<span id="line4907"></span> $new_col_definition = <span class="entity"><span>&amp;</span>quot;</span>'$new_col_name' $new_col_type<span class="entity"><span>&amp;</span>quot;</span>;
<span id="line4908"></span> $preg_column_to_change = <span class="entity"><span>&amp;</span>quot;</span>\s*<span class="entity"><span>&amp;</span>quot;</span> . $this-<span class="entity"><span>&amp;</span>gt;</span>sqlite_surroundings_preg($column) . <span class="entity"><span>&amp;</span>quot;</span>(?:\s+<span class="entity"><span>&amp;</span>quot;</span> . preg_quote($coltypes[$column]) . <span class="entity"><span>&amp;</span>quot;</span>)?(\s+(?:<span class="entity"><span>&amp;</span>quot;</span> . $this-<span class="entity"><span>&amp;</span>gt;</span>sqlite_surroundings_preg(<span class="entity"><span>&amp;</span>quot;</span>*<span class="entity"><span>&amp;</span>quot;</span>, false, <span class="entity"><span>&amp;</span>quot;</span>,'\<span class="entity"><span>&amp;</span>quot;</span>`\[<span class="entity"><span>&amp;</span>quot;</span>) . <span class="entity"><span>&amp;</span>quot;</span>)+)?<span class="entity"><span>&amp;</span>quot;</span>;
<span id="line4909"></span> // replace this part (we want to change this column)
<span id="line4910"></span> // group $3 contains the column constraints (keep!). the name <span class="entity"><span>&amp;</span>amp;</span> data type is replaced.
<span id="line4911"></span> $preg_pattern_change = <span class="entity"><span>&amp;</span>quot;</span>/^<span class="entity"><span>&amp;</span>quot;</span> . $preg_create_table . $preg_columns_before . $preg_column_to_change . $preg_columns_after . <span class="entity"><span>&amp;</span>quot;</span>\s*\\)\s*$/s<span class="entity"><span>&amp;</span>quot;</span>;
<span id="line4912"></span>
<span id="line4913"></span> // replace the column definiton in the CREATE TABLE statement
<span id="line4914"></span> $newSQL = preg_replace($preg_pattern_change, '$1$2,' . strtr($new_col_definition, array('\\' =<span class="entity"><span>&amp;</span>gt;</span> '\\\\', '$' =<span class="entity"><span>&amp;</span>gt;</span> '\$')) . '$3$4)', $createtesttableSQL);
<span id="line4915"></span> $preg_error = $this-<span class="entity"><span>&amp;</span>gt;</span>getPregError();
<span id="line4916"></span> // remove comma at the beginning if the first column is changed
<span id="line4917"></span> // probably somebody is able to put this into the first regex (using lookahead probably).
<span id="line4918"></span> $newSQL = preg_replace(<span class="entity"><span>&amp;</span>quot;</span>/^\s*(CREATE\s+TABLE\s+<span class="entity"><span>&amp;</span>quot;</span> . preg_quote($this-<span class="entity"><span>&amp;</span>gt;</span>quote($tmpname), <span class="entity"><span>&amp;</span>quot;</span>/<span class="entity"><span>&amp;</span>quot;</span>) . <span class="entity"><span>&amp;</span>quot;</span>\s+\(),\s*/<span class="entity"><span>&amp;</span>quot;</span>, '$1', $newSQL);
<span id="line4919"></span> if ($debug) {
<span id="line4920"></span> $this-<span class="entity"><span>&amp;</span>gt;</span>debugOutput .= <span class="entity"><span>&amp;</span>quot;</span>preg_column_to_change=(<span class="entity"><span>&amp;</span>quot;</span> . $preg_column_to_change . <span class="entity"><span>&amp;</span>quot;</span>)<span class="entity"><span>&amp;</span>lt;</span>hr /<span class="entity"><span>&amp;</span>gt;</span><span class="entity"><span>&amp;</span>lt;</span>br /<span class="entity"><span>&amp;</span>gt;</span><span class="entity"><span>&amp;</span>quot;</span>;
<span id="line4921"></span> $this-<span class="entity"><span>&amp;</span>gt;</span>debugOutput .= $createtesttableSQL . <span class="entity"><span>&amp;</span>quot;</span><span class="entity"><span>&amp;</span>lt;</span>hr /<span class="entity"><span>&amp;</span>gt;</span><span class="entity"><span>&amp;</span>lt;</span>br /<span class="entity"><span>&amp;</span>gt;</span><span class="entity"><span>&amp;</span>quot;</span>;
<span id="line4922"></span> $this-<span class="entity"><span>&amp;</span>gt;</span>debugOutput .= $newSQL . <span class="entity"><span>&amp;</span>quot;</span><span class="entity"><span>&amp;</span>lt;</span>hr /<span class="entity"><span>&amp;</span>gt;</span><span class="entity"><span>&amp;</span>lt;</span>br /<span class="entity"><span>&amp;</span>gt;</span><span class="entity"><span>&amp;</span>quot;</span>;
<span id="line4923"></span>
<span id="line4924"></span> $this-<span class="entity"><span>&amp;</span>gt;</span>debugOutput .= $preg_pattern_change . <span class="entity"><span>&amp;</span>quot;</span><span class="entity"><span>&amp;</span>lt;</span>hr /<span class="entity"><span>&amp;</span>gt;</span><span class="entity"><span>&amp;</span>lt;</span>br /<span class="entity"><span>&amp;</span>gt;</span><span class="entity"><span>&amp;</span>quot;</span>;
<span id="line4925"></span> }
<span id="line4926"></span> if ($newSQL == $createtesttableSQL || $newSQL == <span class="entity"><span>&amp;</span>quot;</span><span class="entity"><span>&amp;</span>quot;</span>) // pattern did not match, so column removal did not succed
<span id="line4927"></span> {
<span id="line4928"></span> $this-<span class="entity"><span>&amp;</span>gt;</span>alterError = $errormsg . ' (change) - ' . $lang['alter_pattern_mismatch'] . '. PREG ERROR: ' . $preg_error;
<span id="line4929"></span> return false;
<span id="line4930"></span> }
<span id="line4931"></span> $createtesttableSQL = $newSQL;
<span id="line4932"></span> $newcols[$column] = str_replace(<span class="entity"><span>&amp;</span>quot;</span>''<span class="entity"><span>&amp;</span>quot;</span>, <span class="entity"><span>&amp;</span>quot;</span>'<span class="entity"><span>&amp;</span>quot;</span>, $new_col_name);
<span id="line4933"></span> break;
<span id="line4934"></span> case 'drop':
<span id="line4935"></span> $preg_column_to_drop = <span class="entity"><span>&amp;</span>quot;</span>\s*<span class="entity"><span>&amp;</span>quot;</span> . $this-<span class="entity"><span>&amp;</span>gt;</span>sqlite_surroundings_preg($column) . <span class="entity"><span>&amp;</span>quot;</span>\s+(?:<span class="entity"><span>&amp;</span>quot;</span> . $this-<span class="entity"><span>&amp;</span>gt;</span>sqlite_surroundings_preg(<span class="entity"><span>&amp;</span>quot;</span>*<span class="entity"><span>&amp;</span>quot;</span>, false, <span class="entity"><span>&amp;</span>quot;</span>,'\<span class="entity"><span>&amp;</span>quot;</span>\[`<span class="entity"><span>&amp;</span>quot;</span>) . <span class="entity"><span>&amp;</span>quot;</span>)+<span class="entity"><span>&amp;</span>quot;</span>; // delete this part (we want to drop this column)
<span id="line4936"></span> $preg_pattern_drop = <span class="entity"><span>&amp;</span>quot;</span>/^<span class="entity"><span>&amp;</span>quot;</span> . $preg_create_table . $preg_columns_before . $preg_column_to_drop . $preg_columns_after . <span class="entity"><span>&amp;</span>quot;</span>\s*\\)\s*$/s<span class="entity"><span>&amp;</span>quot;</span>;
<span id="line4937"></span>
<span id="line4938"></span> // remove the column out of the CREATE TABLE statement
<span id="line4939"></span> $newSQL = preg_replace($preg_pattern_drop, '$1$2$3)', $createtesttableSQL);
<span id="line4940"></span> $preg_error = $this-<span class="entity"><span>&amp;</span>gt;</span>getPregError();
<span id="line4941"></span> // remove comma at the beginning if the first column is removed
<span id="line4942"></span> // probably somebody is able to put this into the first regex (using lookahead probably).
<span id="line4943"></span> $newSQL = preg_replace(<span class="entity"><span>&amp;</span>quot;</span>/^\s*(CREATE\s+TABLE\s+<span class="entity"><span>&amp;</span>quot;</span> . preg_quote($this-<span class="entity"><span>&amp;</span>gt;</span>quote($tmpname), <span class="entity"><span>&amp;</span>quot;</span>/<span class="entity"><span>&amp;</span>quot;</span>) . <span class="entity"><span>&amp;</span>quot;</span>\s+\(),\s*/<span class="entity"><span>&amp;</span>quot;</span>, '$1', $newSQL);
<span id="line4944"></span> if ($debug) {
<span id="line4945"></span> $this-<span class="entity"><span>&amp;</span>gt;</span>debugOutput .= $createtesttableSQL . <span class="entity"><span>&amp;</span>quot;</span><span class="entity"><span>&amp;</span>lt;</span>hr /<span class="entity"><span>&amp;</span>gt;</span><span class="entity"><span>&amp;</span>lt;</span>br /<span class="entity"><span>&amp;</span>gt;</span><span class="entity"><span>&amp;</span>quot;</span>;
<span id="line4946"></span> $this-<span class="entity"><span>&amp;</span>gt;</span>debugOutput .= $newSQL . <span class="entity"><span>&amp;</span>quot;</span><span class="entity"><span>&amp;</span>lt;</span>hr /<span class="entity"><span>&amp;</span>gt;</span><span class="entity"><span>&amp;</span>lt;</span>br /<span class="entity"><span>&amp;</span>gt;</span><span class="entity"><span>&amp;</span>quot;</span>;
<span id="line4947"></span> $this-<span class="entity"><span>&amp;</span>gt;</span>debugOutput .= $preg_pattern_drop . <span class="entity"><span>&amp;</span>quot;</span><span class="entity"><span>&amp;</span>lt;</span>hr /<span class="entity"><span>&amp;</span>gt;</span><span class="entity"><span>&amp;</span>lt;</span>br /<span class="entity"><span>&amp;</span>gt;</span><span class="entity"><span>&amp;</span>quot;</span>;
<span id="line4948"></span> }
<span id="line4949"></span> if ($newSQL == $createtesttableSQL || $newSQL == <span class="entity"><span>&amp;</span>quot;</span><span class="entity"><span>&amp;</span>quot;</span>) // pattern did not match, so column removal did not succed
<span id="line4950"></span> {
<span id="line4951"></span> $this-<span class="entity"><span>&amp;</span>gt;</span>alterError = $errormsg . ' (drop) - ' . $lang['alter_pattern_mismatch'] . '. PREG ERROR: ' . $preg_error;
<span id="line4952"></span> return false;
<span id="line4953"></span> }
<span id="line4954"></span> $createtesttableSQL = $newSQL;
<span id="line4955"></span> unset($newcols[$column]);
<span id="line4956"></span> break;
<span id="line4957"></span> case 'rename to':
<span id="line4958"></span> // don't change column definition at all
<span id="line4959"></span> $newSQL = $createtesttableSQL;
<span id="line4960"></span> // only change the name of the table
<span id="line4961"></span> $table_new = $column;
<span id="line4962"></span> break;
<span id="line4963"></span> case 'add primary key':
<span id="line4964"></span> // we want to add a primary key for the column(s) stored in $column
<span id="line4965"></span> $newSQL = preg_replace(<span class="entity"><span>&amp;</span>quot;</span>/\)\s*$/<span class="entity"><span>&amp;</span>quot;</span>, <span class="entity"><span>&amp;</span>quot;</span>, PRIMARY KEY (<span class="entity"><span>&amp;</span>quot;</span> . $column . <span class="entity"><span>&amp;</span>quot;</span>) )<span class="entity"><span>&amp;</span>quot;</span>, $createtesttableSQL);
<span id="line4966"></span> $createtesttableSQL = $newSQL;
<span id="line4967"></span> break;
<span id="line4968"></span> case 'drop primary key':
<span id="line4969"></span> // we want to drop the primary key
<span id="line4970"></span> if ($debug) $this-<span class="entity"><span>&amp;</span>gt;</span>debugOutput .= <span class="entity"><span>&amp;</span>quot;</span>DROP<span class="entity"><span>&amp;</span>quot;</span>;
<span id="line4971"></span> if (sizeof($primarykey) == 1) {
<span id="line4972"></span> // if not compound primary key, might be a column constraint -<span class="entity"><span>&amp;</span>gt;</span> try removal
<span id="line4973"></span> $column = $primarykey[0];
<span id="line4974"></span> if ($debug) $this-<span class="entity"><span>&amp;</span>gt;</span>debugOutput .= <span class="entity"><span>&amp;</span>quot;</span><span class="entity"><span>&amp;</span>lt;</span>br<span class="entity"><span>&amp;</span>gt;</span>Trying to drop column constraint for column $column <span class="entity"><span>&amp;</span>lt;</span>br<span class="entity"><span>&amp;</span>gt;</span><span class="entity"><span>&amp;</span>quot;</span>;
<span id="line4975"></span> /*
<span id="line4976"></span> TODO: This does not work yet:
<span id="line4977"></span> CREATE TABLE 't12' ('t1' INTEGER CONSTRAINT <span class="entity"><span>&amp;</span>quot;</span>bla<span class="entity"><span>&amp;</span>quot;</span> NOT NULL CONSTRAINT 'pk' PRIMARY KEY ); ALTER TABLE <span class="entity"><span>&amp;</span>quot;</span>t12<span class="entity"><span>&amp;</span>quot;</span> DROP PRIMARY KEY
<span id="line4978"></span> This does: ! !
<span id="line4979"></span> CREATE TABLE 't12' ('t1' INTEGER CONSTRAINT bla NOT NULL CONSTRAINT 'pk' PRIMARY KEY ); ALTER TABLE <span class="entity"><span>&amp;</span>quot;</span>t12<span class="entity"><span>&amp;</span>quot;</span> DROP PRIMARY KEY
<span id="line4980"></span> */
<span id="line4981"></span> $preg_column_to_change = <span class="entity"><span>&amp;</span>quot;</span>(\s*<span class="entity"><span>&amp;</span>quot;</span> . $this-<span class="entity"><span>&amp;</span>gt;</span>sqlite_surroundings_preg($column) . <span class="entity"><span>&amp;</span>quot;</span>)<span class="entity"><span>&amp;</span>quot;</span> . // column ($3)
<span id="line4982"></span> <span class="entity"><span>&amp;</span>quot;</span>(?:<span class="entity"><span>&amp;</span>quot;</span> . // opt. type and column constraints
<span id="line4983"></span> <span class="entity"><span>&amp;</span>quot;</span>(\s+(?:<span class="entity"><span>&amp;</span>quot;</span> . $this-<span class="entity"><span>&amp;</span>gt;</span>sqlite_surroundings_preg(<span class="entity"><span>&amp;</span>quot;</span>(?:[^PC,'\<span class="entity"><span>&amp;</span>quot;</span>`\[]|P(?!RIMARY\s+KEY)|<span class="entity"><span>&amp;</span>quot;</span> .
<span id="line4984"></span> <span class="entity"><span>&amp;</span>quot;</span>C(?!ONSTRAINT\s+<span class="entity"><span>&amp;</span>quot;</span> . $this-<span class="entity"><span>&amp;</span>gt;</span>sqlite_surroundings_preg(<span class="entity"><span>&amp;</span>quot;</span>+<span class="entity"><span>&amp;</span>quot;</span>, false, <span class="entity"><span>&amp;</span>quot;</span> ,'\<span class="entity"><span>&amp;</span>quot;</span>\[`<span class="entity"><span>&amp;</span>quot;</span>) . <span class="entity"><span>&amp;</span>quot;</span>\s+PRIMARY\s+KEY))<span class="entity"><span>&amp;</span>quot;</span>, false, <span class="entity"><span>&amp;</span>quot;</span>,'\<span class="entity"><span>&amp;</span>quot;</span>`\[<span class="entity"><span>&amp;</span>quot;</span>) . <span class="entity"><span>&amp;</span>quot;</span>)*)<span class="entity"><span>&amp;</span>quot;</span> . // column constraints before PRIMARY KEY ($3)
<span id="line4985"></span> // primary key constraint (remove this!):
<span id="line4986"></span> <span class="entity"><span>&amp;</span>quot;</span>(?:CONSTRAINT\s+<span class="entity"><span>&amp;</span>quot;</span> . $this-<span class="entity"><span>&amp;</span>gt;</span>sqlite_surroundings_preg(<span class="entity"><span>&amp;</span>quot;</span>+<span class="entity"><span>&amp;</span>quot;</span>, false, <span class="entity"><span>&amp;</span>quot;</span> ,'\<span class="entity"><span>&amp;</span>quot;</span>\[`<span class="entity"><span>&amp;</span>quot;</span>) . <span class="entity"><span>&amp;</span>quot;</span>\s+)?<span class="entity"><span>&amp;</span>quot;</span> .
<span id="line4987"></span> <span class="entity"><span>&amp;</span>quot;</span>PRIMARY\s+KEY<span class="entity"><span>&amp;</span>quot;</span> .
<span id="line4988"></span> <span class="entity"><span>&amp;</span>quot;</span>(?:\s+(?:ASC|DESC))?<span class="entity"><span>&amp;</span>quot;</span> .
<span id="line4989"></span> <span class="entity"><span>&amp;</span>quot;</span>(?:\s+ON\s+CONFLICT\s+(?:ROLLBACK|ABORT|FAIL|IGNORE|REPLACE))?<span class="entity"><span>&amp;</span>quot;</span> .
<span id="line4990"></span> <span class="entity"><span>&amp;</span>quot;</span>(?:\s+AUTOINCREMENT)?<span class="entity"><span>&amp;</span>quot;</span> .
<span id="line4991"></span> <span class="entity"><span>&amp;</span>quot;</span>((?:<span class="entity"><span>&amp;</span>quot;</span> . $this-<span class="entity"><span>&amp;</span>gt;</span>sqlite_surroundings_preg(<span class="entity"><span>&amp;</span>quot;</span>*<span class="entity"><span>&amp;</span>quot;</span>, false, <span class="entity"><span>&amp;</span>quot;</span>,'\<span class="entity"><span>&amp;</span>quot;</span>`\[<span class="entity"><span>&amp;</span>quot;</span>) . <span class="entity"><span>&amp;</span>quot;</span>)*)<span class="entity"><span>&amp;</span>quot;</span> . // column constraints after PRIMARY KEY ($4)
<span id="line4992"></span> <span class="entity"><span>&amp;</span>quot;</span>)<span class="entity"><span>&amp;</span>quot;</span>;
<span id="line4993"></span> // replace this part (we want to change this column)
<span id="line4994"></span> // group $3 (column) $4 (constraints before) and $5 (constraints after) contain the part to keep
<span id="line4995"></span> $preg_pattern_change = <span class="entity"><span>&amp;</span>quot;</span>/^<span class="entity"><span>&amp;</span>quot;</span> . $preg_create_table . $preg_columns_before . $preg_column_to_change . $preg_columns_after . <span class="entity"><span>&amp;</span>quot;</span>\s*\\)\s*$/si<span class="entity"><span>&amp;</span>quot;</span>;
<span id="line4996"></span>
<span id="line4997"></span> // replace the column definiton in the CREATE TABLE statement
<span id="line4998"></span> $newSQL = preg_replace($preg_pattern_change, '$1$2,$3$4$5$6)', $createtesttableSQL);
<span id="line4999"></span> // remove comma at the beginning if the first column is changed
<span id="line5000"></span> // probably somebody is able to put this into the first regex (using lookahead probably).
<span id="line5001"></span> $newSQL = preg_replace(<span class="entity"><span>&amp;</span>quot;</span>/^\s*(CREATE\s+TABLE\s+<span class="entity"><span>&amp;</span>quot;</span> . preg_quote($this-<span class="entity"><span>&amp;</span>gt;</span>quote($tmpname), <span class="entity"><span>&amp;</span>quot;</span>/<span class="entity"><span>&amp;</span>quot;</span>) . <span class="entity"><span>&amp;</span>quot;</span>\s+\(),\s*/<span class="entity"><span>&amp;</span>quot;</span>, '$1', $newSQL);
<span id="line5002"></span> if ($debug) {
<span id="line5003"></span> $this-<span class="entity"><span>&amp;</span>gt;</span>debugOutput .= <span class="entity"><span>&amp;</span>quot;</span>preg_column_to_change=(<span class="entity"><span>&amp;</span>quot;</span> . $preg_column_to_change . <span class="entity"><span>&amp;</span>quot;</span>)<span class="entity"><span>&amp;</span>lt;</span>hr /<span class="entity"><span>&amp;</span>gt;</span><span class="entity"><span>&amp;</span>lt;</span>br /<span class="entity"><span>&amp;</span>gt;</span><span class="entity"><span>&amp;</span>quot;</span>;
<span id="line5004"></span> $this-<span class="entity"><span>&amp;</span>gt;</span>debugOutput .= $createtesttableSQL . <span class="entity"><span>&amp;</span>quot;</span><span class="entity"><span>&amp;</span>lt;</span>hr /<span class="entity"><span>&amp;</span>gt;</span><span class="entity"><span>&amp;</span>lt;</span>br /<span class="entity"><span>&amp;</span>gt;</span><span class="entity"><span>&amp;</span>quot;</span>;
<span id="line5005"></span> $this-<span class="entity"><span>&amp;</span>gt;</span>debugOutput .= $newSQL . <span class="entity"><span>&amp;</span>quot;</span><span class="entity"><span>&amp;</span>lt;</span>hr /<span class="entity"><span>&amp;</span>gt;</span><span class="entity"><span>&amp;</span>lt;</span>br /<span class="entity"><span>&amp;</span>gt;</span><span class="entity"><span>&amp;</span>quot;</span>;
<span id="line5006"></span>
<span id="line5007"></span> $this-<span class="entity"><span>&amp;</span>gt;</span>debugOutput .= $preg_pattern_change . <span class="entity"><span>&amp;</span>quot;</span><span class="entity"><span>&amp;</span>lt;</span>hr /<span class="entity"><span>&amp;</span>gt;</span><span class="entity"><span>&amp;</span>lt;</span>br /<span class="entity"><span>&amp;</span>gt;</span><span class="entity"><span>&amp;</span>quot;</span>;
<span id="line5008"></span> }
<span id="line5009"></span> if ($newSQL != $createtesttableSQL <span class="entity"><span>&amp;</span>amp;</span><span class="entity"><span>&amp;</span>amp;</span> $newSQL != <span class="entity"><span>&amp;</span>quot;</span><span class="entity"><span>&amp;</span>quot;</span>) // pattern did match, so PRIMARY KEY constraint removed :)
<span id="line5010"></span> {
<span id="line5011"></span> $createtesttableSQL = $newSQL;
<span id="line5012"></span> if ($debug) $this-<span class="entity"><span>&amp;</span>gt;</span>debugOutput .= <span class="entity"><span>&amp;</span>quot;</span><span class="entity"><span>&amp;</span>lt;</span>br<span class="entity"><span>&amp;</span>gt;</span>SUCCEEDED<span class="entity"><span>&amp;</span>lt;</span>br<span class="entity"><span>&amp;</span>gt;</span><span class="entity"><span>&amp;</span>quot;</span>;
<span id="line5013"></span> } else {
<span id="line5014"></span> if ($debug) $this-<span class="entity"><span>&amp;</span>gt;</span>debugOutput .= <span class="entity"><span>&amp;</span>quot;</span>NO LUCK<span class="entity"><span>&amp;</span>quot;</span>;
<span id="line5015"></span> // TODO: try removing table constraint
<span id="line5016"></span> return false;
<span id="line5017"></span> }
<span id="line5018"></span> $createtesttableSQL = $newSQL;
<span id="line5019"></span> } else
<span id="line5020"></span> // TODO: Try removing table constraint
<span id="line5021"></span> return false;
<span id="line5022"></span>
<span id="line5023"></span> break;
<span id="line5024"></span> default:
<span id="line5025"></span> if ($debug) $this-<span class="entity"><span>&amp;</span>gt;</span>debugOutput .= 'ERROR: unknown alter operation!<span class="entity"><span>&amp;</span>lt;</span>hr /<span class="entity"><span>&amp;</span>gt;</span><span class="entity"><span>&amp;</span>lt;</span>br /<span class="entity"><span>&amp;</span>gt;</span>';
<span id="line5026"></span> $this-<span class="entity"><span>&amp;</span>gt;</span>alterError = $errormsg . $lang['alter_unknown_operation'];
<span id="line5027"></span> return false;
<span id="line5028"></span> }
<span id="line5029"></span> }
<span id="line5030"></span> $droptempsql = 'DROP TABLE ' . $this-<span class="entity"><span>&amp;</span>gt;</span>quote_id($tmpname);
<span id="line5031"></span>
<span id="line5032"></span> $createnewtableSQL = <span class="entity"><span>&amp;</span>quot;</span>CREATE TABLE <span class="entity"><span>&amp;</span>quot;</span> . $this-<span class="entity"><span>&amp;</span>gt;</span>quote($table_new) . <span class="entity"><span>&amp;</span>quot;</span> <span class="entity"><span>&amp;</span>quot;</span> . preg_replace(<span class="entity"><span>&amp;</span>quot;</span>/^\s*CREATE\s+TABLE\s+'?<span class="entity"><span>&amp;</span>quot;</span> . str_replace(<span class="entity"><span>&amp;</span>quot;</span>'<span class="entity"><span>&amp;</span>quot;</span>, <span class="entity"><span>&amp;</span>quot;</span>''<span class="entity"><span>&amp;</span>quot;</span>, preg_quote($tmpname, <span class="entity"><span>&amp;</span>quot;</span>/<span class="entity"><span>&amp;</span>quot;</span>)) . <span class="entity"><span>&amp;</span>quot;</span>'?\s+(.*)$/is<span class="entity"><span>&amp;</span>quot;</span>, '$1', $createtesttableSQL, 1);
<span id="line5033"></span>
<span id="line5034"></span> $newcolumns = '';
<span id="line5035"></span> $oldcolumns = '';
<span id="line5036"></span> reset($newcols);
<span id="line5037"></span> while (list($key, $val) = each($newcols)) {
<span id="line5038"></span> $newcolumns .= ($newcolumns ? ', ' : '') . $this-<span class="entity"><span>&amp;</span>gt;</span>quote_id($val);
<span id="line5039"></span> $oldcolumns .= ($oldcolumns ? ', ' : '') . $this-<span class="entity"><span>&amp;</span>gt;</span>quote_id($key);
<span id="line5040"></span> }
<span id="line5041"></span> $copytonewsql = 'INSERT INTO ' . $this-<span class="entity"><span>&amp;</span>gt;</span>quote_id($table_new) . '(' . $newcolumns . ') SELECT ' . $oldcolumns . ' FROM ' . $this-<span class="entity"><span>&amp;</span>gt;</span>quote_id($tmpname);
<span id="line5042"></span> }
<span id="line5043"></span> }
<span id="line5044"></span> $alter_transaction = 'BEGIN; ';
<span id="line5045"></span> $alter_transaction .= $createtemptableSQL . '; '; //create temp table
<span id="line5046"></span> $alter_transaction .= $copytotempsql . '; '; //copy to table
<span id="line5047"></span> $alter_transaction .= $dropoldsql . '; '; //drop old table
<span id="line5048"></span> $alter_transaction .= $createnewtableSQL . '; '; //recreate original table
<span id="line5049"></span> $alter_transaction .= $copytonewsql . '; '; //copy back to original table
<span id="line5050"></span> $alter_transaction .= $droptempsql . '; '; //drop temp table
<span id="line5051"></span>
<span id="line5052"></span> $preg_index = <span class="entity"><span>&amp;</span>quot;</span>/^\s*(CREATE\s+(?:UNIQUE\s+)?INDEX\s+(?:<span class="entity"><span>&amp;</span>quot;</span> . $this-<span class="entity"><span>&amp;</span>gt;</span>sqlite_surroundings_preg(<span class="entity"><span>&amp;</span>quot;</span>+<span class="entity"><span>&amp;</span>quot;</span>, false, <span class="entity"><span>&amp;</span>quot;</span> '\<span class="entity"><span>&amp;</span>quot;</span>\[`<span class="entity"><span>&amp;</span>quot;</span>) . <span class="entity"><span>&amp;</span>quot;</span>\s*)*ON\s+)(<span class="entity"><span>&amp;</span>quot;</span> . $this-<span class="entity"><span>&amp;</span>gt;</span>sqlite_surroundings_preg($table) . <span class="entity"><span>&amp;</span>quot;</span>)(\s*\((?:<span class="entity"><span>&amp;</span>quot;</span> . $this-<span class="entity"><span>&amp;</span>gt;</span>sqlite_surroundings_preg(<span class="entity"><span>&amp;</span>quot;</span>+<span class="entity"><span>&amp;</span>quot;</span>, false, <span class="entity"><span>&amp;</span>quot;</span> '\<span class="entity"><span>&amp;</span>quot;</span>\[`<span class="entity"><span>&amp;</span>quot;</span>) . <span class="entity"><span>&amp;</span>quot;</span>\s*)*\)\s*)\s*$/i<span class="entity"><span>&amp;</span>quot;</span>;
<span id="line5053"></span> foreach ($recreateQueries as $recreate_query) {
<span id="line5054"></span> if ($recreate_query['type'] == 'index') {
<span id="line5055"></span> // this is an index. We need to make sure the index is not on a column that we drop. If it is, we drop the index as well.
<span id="line5056"></span> $indexInfos = $this-<span class="entity"><span>&amp;</span>gt;</span>selectArray('PRAGMA index_info(' . $this-<span class="entity"><span>&amp;</span>gt;</span>quote_id($recreate_query['name']) . ')');
<span id="line5057"></span> foreach ($indexInfos as $indexInfo) {
<span id="line5058"></span> if (!isset($newcols[$indexInfo['name']])) {
<span id="line5059"></span> if ($debug) $this-<span class="entity"><span>&amp;</span>gt;</span>debugOutput .= 'Not recreating the following index: <span class="entity"><span>&amp;</span>lt;</span>hr /<span class="entity"><span>&amp;</span>gt;</span><span class="entity"><span>&amp;</span>lt;</span>br /<span class="entity"><span>&amp;</span>gt;</span>' . htmlencode($recreate_query['sql']) . '<span class="entity"><span>&amp;</span>lt;</span>hr /<span class="entity"><span>&amp;</span>gt;</span><span class="entity"><span>&amp;</span>lt;</span>br /<span class="entity"><span>&amp;</span>gt;</span>';
<span id="line5060"></span> // Index on a column that was dropped. Skip recreation.
<span id="line5061"></span> continue 2;
<span id="line5062"></span> }
<span id="line5063"></span> }
<span id="line5064"></span> }
<span id="line5065"></span> // TODO: In case we renamed a column on which there is an index, we need to recreate the index with the column name adjusted.
<span id="line5066"></span>
<span id="line5067"></span> // recreate triggers / indexes
<span id="line5068"></span> if ($table == $table_new) {
<span id="line5069"></span> // we had no RENAME TO, so we can recreate indexes/triggers just like the original ones
<span id="line5070"></span> $alter_transaction .= $recreate_query['sql'] . ';';
<span id="line5071"></span> } else {
<span id="line5072"></span> // we had a RENAME TO, so we need to exchange the table-name in the CREATE-SQL of triggers <span class="entity"><span>&amp;</span>amp;</span> indexes
<span id="line5073"></span> switch ($recreate_query['type']) {
<span id="line5074"></span> case 'index':
<span id="line5075"></span> $recreate_queryIndex = preg_replace($preg_index, '$1' . $this-<span class="entity"><span>&amp;</span>gt;</span>quote_id(strtr($table_new, array('\\' =<span class="entity"><span>&amp;</span>gt;</span> '\\\\', '$' =<span class="entity"><span>&amp;</span>gt;</span> '\$'))) . '$3 ', $recreate_query['sql']);
<span id="line5076"></span> if ($recreate_queryIndex != $recreate_query['sql'] <span class="entity"><span>&amp;</span>amp;</span><span class="entity"><span>&amp;</span>amp;</span> $recreate_queryIndex != NULL)
<span id="line5077"></span> $alter_transaction .= $recreate_queryIndex . ';';
<span id="line5078"></span> else {
<span id="line5079"></span> // the CREATE INDEX regex did not match. this normally should not happen
<span id="line5080"></span> if ($debug) $this-<span class="entity"><span>&amp;</span>gt;</span>debugOutput .= 'ERROR: CREATE INDEX regex did not match!?<span class="entity"><span>&amp;</span>lt;</span>hr /<span class="entity"><span>&amp;</span>gt;</span><span class="entity"><span>&amp;</span>lt;</span>br /<span class="entity"><span>&amp;</span>gt;</span>';
<span id="line5081"></span> // just try to recreate the index originally (will fail most likely)
<span id="line5082"></span> $alter_transaction .= $recreate_query['sql'] . ';';
<span id="line5083"></span> }
<span id="line5084"></span> break;
<span id="line5085"></span>
<span id="line5086"></span> case 'trigger':
<span id="line5087"></span> // TODO: IMPLEMENT
<span id="line5088"></span> $alter_transaction .= $recreate_query['sql'] . ';';
<span id="line5089"></span> break;
<span id="line5090"></span> default:
<span id="line5091"></span> if ($debug) $this-<span class="entity"><span>&amp;</span>gt;</span>debugOutput .= 'ERROR: Unknown type ' . htmlencode($recreate_query['type']) . '<span class="entity"><span>&amp;</span>lt;</span>hr /<span class="entity"><span>&amp;</span>gt;</span><span class="entity"><span>&amp;</span>lt;</span>br /<span class="entity"><span>&amp;</span>gt;</span>';
<span id="line5092"></span> $alter_transaction .= $recreate_query['sql'] . ';';
<span id="line5093"></span> }
<span id="line5094"></span> }
<span id="line5095"></span> }
<span id="line5096"></span> $alter_transaction .= 'COMMIT;';
<span id="line5097"></span> if ($debug) $this-<span class="entity"><span>&amp;</span>gt;</span>debugOutput .= $alter_transaction;
<span id="line5098"></span> return $this-<span class="entity"><span>&amp;</span>gt;</span>multiQuery($alter_transaction);
<span id="line5099"></span> }
<span id="line5100"></span> }
<span id="line5101"></span>
<span id="line5102"></span> //multiple query execution
<span id="line5103"></span> //returns true on success, false otherwise. Use getError() to fetch the error.
<span id="line5104"></span> public function multiQuery($query)
<span id="line5105"></span> {
<span id="line5106"></span> if ($this-<span class="entity"><span>&amp;</span>gt;</span>type == <span class="entity"><span>&amp;</span>quot;</span>PDO<span class="entity"><span>&amp;</span>quot;</span>)
<span id="line5107"></span> $success = $this-<span class="entity"><span>&amp;</span>gt;</span>db-<span class="entity"><span>&amp;</span>gt;</span>exec($query);
<span id="line5108"></span> else if ($this-<span class="entity"><span>&amp;</span>gt;</span>type == <span class="entity"><span>&amp;</span>quot;</span>SQLite3<span class="entity"><span>&amp;</span>quot;</span>)
<span id="line5109"></span> $success = $this-<span class="entity"><span>&amp;</span>gt;</span>db-<span class="entity"><span>&amp;</span>gt;</span>exec($query);
<span id="line5110"></span> else
<span id="line5111"></span> $success = $this-<span class="entity"><span>&amp;</span>gt;</span>db-<span class="entity"><span>&amp;</span>gt;</span>queryExec($query, $error);
<span id="line5112"></span> return $success;
<span id="line5113"></span> }
<span id="line5114"></span>
<span id="line5115"></span>
<span id="line5116"></span> // checks whether a table has a primary key
<span id="line5117"></span> public function hasPrimaryKey($table)
<span id="line5118"></span> {
<span id="line5119"></span> $table_info = $this-<span class="entity"><span>&amp;</span>gt;</span>getTableInfo($table);
<span id="line5120"></span> foreach ($table_info as $row_id =<span class="entity"><span>&amp;</span>gt;</span> $row_data) {
<span id="line5121"></span> if ($row_data['pk']) {
<span id="line5122"></span> return true;
<span id="line5123"></span> }
<span id="line5124"></span>
<span id="line5125"></span> }
<span id="line5126"></span> return false;
<span id="line5127"></span> }
<span id="line5128"></span>
<span id="line5129"></span> // Returns an array of columns by which rows can be uniquely adressed.
<span id="line5130"></span> // For tables with a rowid column, this is always array('rowid')
<span id="line5131"></span> // for tables without rowid, this is an array of the primary key columns. 
<span id="line5132"></span> public function getPrimaryKey($table)
<span id="line5133"></span> {
<span id="line5134"></span> $primary_key = array();
<span id="line5135"></span> // check if this table has a rowid
<span id="line5136"></span> $getRowID = $this-<span class="entity"><span>&amp;</span>gt;</span>select('SELECT ROWID FROM ' . $this-<span class="entity"><span>&amp;</span>gt;</span>quote_id($table) . ' LIMIT 0,1');
<span id="line5137"></span> if (isset($getRowID[0]))
<span id="line5138"></span> // it has, so we prefer addressing rows by rowid 
<span id="line5139"></span> return array('rowid');
<span id="line5140"></span> else {
<span id="line5141"></span> // the table is without rowid, so use the primary key
<span id="line5142"></span> $table_info = $this-<span class="entity"><span>&amp;</span>gt;</span>getTableInfo($table);
<span id="line5143"></span> if (is_array($table_info)) {
<span id="line5144"></span> foreach ($table_info as $row_id =<span class="entity"><span>&amp;</span>gt;</span> $row_data) {
<span id="line5145"></span> if ($row_data['pk'])
<span id="line5146"></span> $primary_key[] = $row_data['name'];
<span id="line5147"></span> }
<span id="line5148"></span> }
<span id="line5149"></span> }
<span id="line5150"></span> return $primary_key;
<span id="line5151"></span> }
<span id="line5152"></span>
<span id="line5153"></span> // selects a row by a given key $pk, which is an array of values
<span id="line5154"></span> // for the columns by which a row can be adressed (rowid or primary key)
<span id="line5155"></span> public function wherePK($table, $pk)
<span id="line5156"></span> {
<span id="line5157"></span> $where = <span class="entity"><span>&amp;</span>quot;</span><span class="entity"><span>&amp;</span>quot;</span>;
<span id="line5158"></span> $primary_key = $this-<span class="entity"><span>&amp;</span>gt;</span>getPrimaryKey($table);
<span id="line5159"></span> foreach ($primary_key as $pk_index =<span class="entity"><span>&amp;</span>gt;</span> $column) {
<span id="line5160"></span> if ($where != <span class="entity"><span>&amp;</span>quot;</span><span class="entity"><span>&amp;</span>quot;</span>)
<span id="line5161"></span> $where .= <span class="entity"><span>&amp;</span>quot;</span> AND <span class="entity"><span>&amp;</span>quot;</span>;
<span id="line5162"></span> $where .= $this-<span class="entity"><span>&amp;</span>gt;</span>quote_id($column) . ' = ';
<span id="line5163"></span> if (is_int($pk[$pk_index]) || is_float($pk[$pk_index]))
<span id="line5164"></span> $where .= $pk[$pk_index];
<span id="line5165"></span> else
<span id="line5166"></span> $where .= $this-<span class="entity"><span>&amp;</span>gt;</span>quote($pk[$pk_index]);
<span id="line5167"></span> }
<span id="line5168"></span> return $where;
<span id="line5169"></span> }
<span id="line5170"></span>
<span id="line5171"></span> //get number of rows in table
<span id="line5172"></span> public function numRows($table, $dontTakeLong = false)
<span id="line5173"></span> {
<span id="line5174"></span> // as Count(*) can be slow on huge tables without PK,
<span id="line5175"></span> // if $dontTakeLong is set and the size is <span class="entity"><span>&amp;</span>gt;</span> 2MB only count() if there is a PK
<span id="line5176"></span> if (!$dontTakeLong || $this-<span class="entity"><span>&amp;</span>gt;</span>getSize() <span class="entity"><span>&amp;</span>lt;</span>= 2000 || $this-<span class="entity"><span>&amp;</span>gt;</span>hasPrimaryKey($table)) {
<span id="line5177"></span> $result = $this-<span class="entity"><span>&amp;</span>gt;</span>select(<span class="entity"><span>&amp;</span>quot;</span>SELECT Count(*) FROM <span class="entity"><span>&amp;</span>quot;</span> . $this-<span class="entity"><span>&amp;</span>gt;</span>quote_id($table));
<span id="line5178"></span> return $result[0];
<span id="line5179"></span> } else {
<span id="line5180"></span> return '?';
<span id="line5181"></span> }
<span id="line5182"></span> }
<span id="line5183"></span>
<span id="line5184"></span> //correctly escape a string to be injected into an SQL query
<span id="line5185"></span> public function quote($value)
<span id="line5186"></span> {
<span id="line5187"></span> if ($this-<span class="entity"><span>&amp;</span>gt;</span>type == <span class="entity"><span>&amp;</span>quot;</span>PDO<span class="entity"><span>&amp;</span>quot;</span>) {
<span id="line5188"></span> // PDO quote() escapes and adds quotes
<span id="line5189"></span> return $this-<span class="entity"><span>&amp;</span>gt;</span>db-<span class="entity"><span>&amp;</span>gt;</span>quote($value);
<span id="line5190"></span> } else if ($this-<span class="entity"><span>&amp;</span>gt;</span>type == <span class="entity"><span>&amp;</span>quot;</span>SQLite3<span class="entity"><span>&amp;</span>quot;</span>) {
<span id="line5191"></span> return <span class="entity"><span>&amp;</span>quot;</span>'<span class="entity"><span>&amp;</span>quot;</span> . $this-<span class="entity"><span>&amp;</span>gt;</span>db-<span class="entity"><span>&amp;</span>gt;</span>escapeString($value) . <span class="entity"><span>&amp;</span>quot;</span>'<span class="entity"><span>&amp;</span>quot;</span>;
<span id="line5192"></span> } else {
<span id="line5193"></span> return <span class="entity"><span>&amp;</span>quot;</span>'<span class="entity"><span>&amp;</span>quot;</span> . sqlite_escape_string($value) . <span class="entity"><span>&amp;</span>quot;</span>'<span class="entity"><span>&amp;</span>quot;</span>;
<span id="line5194"></span> }
<span id="line5195"></span> }
<span id="line5196"></span>
<span id="line5197"></span> //correctly escape an identifier (column / table / trigger / index name) to be injected into an SQL query
<span id="line5198"></span> public function quote_id($value)
<span id="line5199"></span> {
<span id="line5200"></span> // double-quotes need to be escaped by doubling them
<span id="line5201"></span> $value = str_replace('<span class="entity"><span>&amp;</span>quot;</span>', '<span class="entity"><span>&amp;</span>quot;</span><span class="entity"><span>&amp;</span>quot;</span>', $value);
<span id="line5202"></span> return '<span class="entity"><span>&amp;</span>quot;</span>' . $value . '<span class="entity"><span>&amp;</span>quot;</span>';
<span id="line5203"></span> }
<span id="line5204"></span>
<span id="line5205"></span>
<span id="line5206"></span> //import sql
<span id="line5207"></span> //returns true on success, error message otherwise
<span id="line5208"></span> public function import_sql($query)
<span id="line5209"></span> {
<span id="line5210"></span> $import = $this-<span class="entity"><span>&amp;</span>gt;</span>multiQuery($query);
<span id="line5211"></span> if (!$import)
<span id="line5212"></span> return $this-<span class="entity"><span>&amp;</span>gt;</span>getError();
<span id="line5213"></span> else
<span id="line5214"></span> return true;
<span id="line5215"></span> }
<span id="line5216"></span>
<span id="line5217"></span> public function prepareQuery($query)
<span id="line5218"></span> {
<span id="line5219"></span> if ($this-<span class="entity"><span>&amp;</span>gt;</span>type == 'PDO' || $this-<span class="entity"><span>&amp;</span>gt;</span>type == 'SQLite3')
<span id="line5220"></span> return $this-<span class="entity"><span>&amp;</span>gt;</span>db-<span class="entity"><span>&amp;</span>gt;</span>prepare($query);
<span id="line5221"></span> else {
<span id="line5222"></span> // here we are in trouble, SQLiteDatabase cannot prepare statements.
<span id="line5223"></span> // we need to emulate prepare as best as we can
<span id="line5224"></span> # todo: implement this
<span id="line5225"></span> return null;
<span id="line5226"></span> }
<span id="line5227"></span> }
<span id="line5228"></span>
<span id="line5229"></span> public function bindValue($handle, $parameter, $value, $type)
<span id="line5230"></span> {
<span id="line5231"></span> if ($this-<span class="entity"><span>&amp;</span>gt;</span>type == 'SQLite3') {
<span id="line5232"></span> $types = array(
<span id="line5233"></span> 'bool' =<span class="entity"><span>&amp;</span>gt;</span> SQLITE3_INTEGER,
<span id="line5234"></span> 'int' =<span class="entity"><span>&amp;</span>gt;</span> SQLITE3_INTEGER,
<span id="line5235"></span> 'float' =<span class="entity"><span>&amp;</span>gt;</span> SQLITE3_FLOAT,
<span id="line5236"></span> 'text' =<span class="entity"><span>&amp;</span>gt;</span> SQLITE3_TEXT,
<span id="line5237"></span> 'blob' =<span class="entity"><span>&amp;</span>gt;</span> SQLITE3_BLOB,
<span id="line5238"></span> 'null' =<span class="entity"><span>&amp;</span>gt;</span> SQLITE3_NULL);
<span id="line5239"></span> if (!isset($types[$type]))
<span id="line5240"></span> $type = 'text';
<span id="line5241"></span> // there is no SQLITE_BOOL, so check value and make sure it is 0/1
<span id="line5242"></span> if ($type == 'bool') {
<span id="line5243"></span> if ($value === 1 || $value === true)
<span id="line5244"></span> $value = 1;
<span id="line5245"></span> elseif ($value === 0 || $value === false)
<span id="line5246"></span> $value = 0;
<span id="line5247"></span> else
<span id="line5248"></span> return false;
<span id="line5249"></span> }
<span id="line5250"></span> return $handle-<span class="entity"><span>&amp;</span>gt;</span>bindValue($parameter, $value, $types[$type]);
<span id="line5251"></span> }
<span id="line5252"></span> if ($this-<span class="entity"><span>&amp;</span>gt;</span>type == 'PDO') {
<span id="line5253"></span> $types = array(
<span id="line5254"></span> 'bool' =<span class="entity"><span>&amp;</span>gt;</span> PDO::PARAM_BOOL,
<span id="line5255"></span> 'int' =<span class="entity"><span>&amp;</span>gt;</span> PDO::PARAM_INT,
<span id="line5256"></span> 'float' =<span class="entity"><span>&amp;</span>gt;</span> PDO::PARAM_STR,
<span id="line5257"></span> 'text' =<span class="entity"><span>&amp;</span>gt;</span> PDO::PARAM_STR,
<span id="line5258"></span> 'blob' =<span class="entity"><span>&amp;</span>gt;</span> PDO::PARAM_LOB,
<span id="line5259"></span> 'null' =<span class="entity"><span>&amp;</span>gt;</span> PDO::PARAM_NULL);
<span id="line5260"></span> if (!isset($types[$type]))
<span id="line5261"></span> $type = 'text';
<span id="line5262"></span> // there is no PDO::PARAM_FLOAT, so we check it ourself
<span id="line5263"></span> if ($type == 'float') {
<span id="line5264"></span> if (is_numeric($value))
<span id="line5265"></span> $value = (float)$value;
<span id="line5266"></span> else
<span id="line5267"></span> return false;
<span id="line5268"></span> }
<span id="line5269"></span> return $handle-<span class="entity"><span>&amp;</span>gt;</span>bindValue($parameter, $value, $types[$type]);
<span id="line5270"></span> } else
<span id="line5271"></span> # todo: workaround
<span id="line5272"></span> return false;
<span id="line5273"></span>
<span id="line5274"></span> }
<span id="line5275"></span>
<span id="line5276"></span> public function executePrepared($handle, $fetchResult = false)
<span id="line5277"></span> {
<span id="line5278"></span> if ($this-<span class="entity"><span>&amp;</span>gt;</span>type == 'PDO') {
<span id="line5279"></span> $ok = $handle-<span class="entity"><span>&amp;</span>gt;</span>execute();
<span id="line5280"></span> if ($fetchResult <span class="entity"><span>&amp;</span>amp;</span><span class="entity"><span>&amp;</span>amp;</span> $ok) {
<span id="line5281"></span> $res = $handle-<span class="entity"><span>&amp;</span>gt;</span>fetchAll();
<span id="line5282"></span> $handle-<span class="entity"><span>&amp;</span>gt;</span>closeCursor();
<span id="line5283"></span> return $res;
<span id="line5284"></span> } else {
<span id="line5285"></span> if ($ok)
<span id="line5286"></span> $handle-<span class="entity"><span>&amp;</span>gt;</span>closeCursor();
<span id="line5287"></span> return $ok;
<span id="line5288"></span> }
<span id="line5289"></span> } elseif ($this-<span class="entity"><span>&amp;</span>gt;</span>type == 'SQLite3') {
<span id="line5290"></span> $resultset = $handle-<span class="entity"><span>&amp;</span>gt;</span>execute();
<span id="line5291"></span> if ($fetchResult <span class="entity"><span>&amp;</span>amp;</span><span class="entity"><span>&amp;</span>amp;</span> $resultset !== false) {
<span id="line5292"></span> $res = $resultset-<span class="entity"><span>&amp;</span>gt;</span>fetchArray();
<span id="line5293"></span> $resultset-<span class="entity"><span>&amp;</span>gt;</span>finalize();
<span id="line5294"></span> return $res;
<span id="line5295"></span> } else {
<span id="line5296"></span> if ($resultset !== false)
<span id="line5297"></span> $resultset-<span class="entity"><span>&amp;</span>gt;</span>finalize();
<span id="line5298"></span> if ($resultset === false)
<span id="line5299"></span> return false;
<span id="line5300"></span> else
<span id="line5301"></span> return true;
<span id="line5302"></span> }
<span id="line5303"></span> } else {
<span id="line5304"></span> #todo.
<span id="line5305"></span> return false;
<span id="line5306"></span> }
<span id="line5307"></span> }
<span id="line5308"></span>
<span id="line5309"></span> //import csv
<span id="line5310"></span> //returns true on success, error message otherwise
<span id="line5311"></span> public function import_csv($filename, $table, $field_terminate, $field_enclosed, $field_escaped, $null, $fields_in_first_row)
<span id="line5312"></span> {
<span id="line5313"></span> @set_time_limit(-1);
<span id="line5314"></span> $csv_handle = fopen($filename, 'r');
<span id="line5315"></span> $csv_insert = <span class="entity"><span>&amp;</span>quot;</span>BEGIN;\n<span class="entity"><span>&amp;</span>quot;</span>;
<span id="line5316"></span> $csv_number_of_rows = 0;
<span id="line5317"></span> // PHP requires enclosure defined, but has no problem if it was not used
<span id="line5318"></span> if ($field_enclosed == <span class="entity"><span>&amp;</span>quot;</span><span class="entity"><span>&amp;</span>quot;</span>) $field_enclosed = '<span class="entity"><span>&amp;</span>quot;</span>';
<span id="line5319"></span> // PHP requires escaper defined
<span id="line5320"></span> if ($field_escaped == <span class="entity"><span>&amp;</span>quot;</span><span class="entity"><span>&amp;</span>quot;</span>) $field_escaped = '\\';
<span id="line5321"></span> // support tab delimiters
<span id="line5322"></span> if ($field_terminate == '\t') $field_terminate = <span class="entity"><span>&amp;</span>quot;</span>\t<span class="entity"><span>&amp;</span>quot;</span>;
<span id="line5323"></span> while ($csv_handle !== false <span class="entity"><span>&amp;</span>amp;</span><span class="entity"><span>&amp;</span>amp;</span> !feof($csv_handle)) {
<span id="line5324"></span> $csv_data = fgetcsv($csv_handle, 0, $field_terminate, $field_enclosed, $field_escaped);
<span id="line5325"></span> if (is_array($csv_data) <span class="entity"><span>&amp;</span>amp;</span><span class="entity"><span>&amp;</span>amp;</span> ($csv_data[0] != NULL || count($csv_data) <span class="entity"><span>&amp;</span>gt;</span> 1)) {
<span id="line5326"></span> $csv_number_of_rows++;
<span id="line5327"></span> if ($csv_number_of_rows == 1) {
<span id="line5328"></span> if ($this-<span class="entity"><span>&amp;</span>gt;</span>getTypeOfTable($table) != <span class="entity"><span>&amp;</span>quot;</span>table<span class="entity"><span>&amp;</span>quot;</span>) {
<span id="line5329"></span> // First,Create a new table
<span id="line5330"></span> $csv_insert .= <span class="entity"><span>&amp;</span>quot;</span>CREATE TABLE <span class="entity"><span>&amp;</span>quot;</span> . $this-<span class="entity"><span>&amp;</span>gt;</span>quote($table) . <span class="entity"><span>&amp;</span>quot;</span> (<span class="entity"><span>&amp;</span>quot;</span>;
<span id="line5331"></span> $number_of_cols = count($csv_data);
<span id="line5332"></span> foreach ($csv_data as $csv_col =<span class="entity"><span>&amp;</span>gt;</span> $csv_cell) {
<span id="line5333"></span> if ($fields_in_first_row)
<span id="line5334"></span> $csv_insert .= $this-<span class="entity"><span>&amp;</span>gt;</span>quote($csv_cell);
<span id="line5335"></span> else
<span id="line5336"></span> $csv_insert .= $this-<span class="entity"><span>&amp;</span>gt;</span>quote(<span class="entity"><span>&amp;</span>quot;</span>col{$csv_col}<span class="entity"><span>&amp;</span>quot;</span>);
<span id="line5337"></span> if ($csv_col <span class="entity"><span>&amp;</span>lt;</span> $number_of_cols - 1)
<span id="line5338"></span> $csv_insert .= <span class="entity"><span>&amp;</span>quot;</span>, <span class="entity"><span>&amp;</span>quot;</span>;
<span id="line5339"></span> }
<span id="line5340"></span> $csv_insert .= <span class="entity"><span>&amp;</span>quot;</span>);<span class="entity"><span>&amp;</span>quot;</span>;
<span id="line5341"></span>
<span id="line5342"></span> } else {
<span id="line5343"></span> $number_of_cols = count($this-<span class="entity"><span>&amp;</span>gt;</span>getTableInfo($table));
<span id="line5344"></span> }
<span id="line5345"></span> if ($fields_in_first_row)
<span id="line5346"></span> continue;
<span id="line5347"></span> }
<span id="line5348"></span> $csv_insert .= <span class="entity"><span>&amp;</span>quot;</span>INSERT INTO <span class="entity"><span>&amp;</span>quot;</span> . $this-<span class="entity"><span>&amp;</span>gt;</span>quote_id($table) . <span class="entity"><span>&amp;</span>quot;</span> VALUES (<span class="entity"><span>&amp;</span>quot;</span>;
<span id="line5349"></span> for ($csv_col = 0; $csv_col <span class="entity"><span>&amp;</span>lt;</span> $number_of_cols; $csv_col++) {
<span id="line5350"></span> if (isset($csv_data[$csv_col]))
<span id="line5351"></span> $csv_cell = $csv_data[$csv_col];
<span id="line5352"></span> else
<span id="line5353"></span> $csv_cell = $null;
<span id="line5354"></span> if ($csv_cell == $null)
<span id="line5355"></span> $csv_insert .= <span class="entity"><span>&amp;</span>quot;</span>NULL<span class="entity"><span>&amp;</span>quot;</span>;
<span id="line5356"></span> else
<span id="line5357"></span> $csv_insert .= $this-<span class="entity"><span>&amp;</span>gt;</span>quote($csv_cell);
<span id="line5358"></span> if ($csv_col <span class="entity"><span>&amp;</span>lt;</span> $number_of_cols - 1)
<span id="line5359"></span> $csv_insert .= <span class="entity"><span>&amp;</span>quot;</span>,<span class="entity"><span>&amp;</span>quot;</span>;
<span id="line5360"></span> }
<span id="line5361"></span> $csv_insert .= <span class="entity"><span>&amp;</span>quot;</span>);\n<span class="entity"><span>&amp;</span>quot;</span>;
<span id="line5362"></span>
<span id="line5363"></span> if ($csv_number_of_rows % 5000 == 0) {
<span id="line5364"></span> $csv_insert .= <span class="entity"><span>&amp;</span>quot;</span>COMMIT;\nBEGIN;\n<span class="entity"><span>&amp;</span>quot;</span>;
<span id="line5365"></span> }
<span id="line5366"></span> }
<span id="line5367"></span> }
<span id="line5368"></span> if ($csv_handle === false)
<span id="line5369"></span> return <span class="entity"><span>&amp;</span>quot;</span>Error reading CSV file<span class="entity"><span>&amp;</span>quot;</span>;
<span id="line5370"></span> else {
<span id="line5371"></span> $csv_insert .= <span class="entity"><span>&amp;</span>quot;</span>COMMIT;<span class="entity"><span>&amp;</span>quot;</span>;
<span id="line5372"></span> fclose($csv_handle);
<span id="line5373"></span> $import = $this-<span class="entity"><span>&amp;</span>gt;</span>multiQuery($csv_insert);
<span id="line5374"></span> if (!$import)
<span id="line5375"></span> return $this-<span class="entity"><span>&amp;</span>gt;</span>getError();
<span id="line5376"></span> else
<span id="line5377"></span> return true;
<span id="line5378"></span> }
<span id="line5379"></span> }
<span id="line5380"></span>
<span id="line5381"></span> //export csv
<span id="line5382"></span> public function export_csv($tables, $field_terminate, $field_enclosed, $field_escaped, $null, $crlf, $fields_in_first_row)
<span id="line5383"></span> {
<span id="line5384"></span> @set_time_limit(-1);
<span id="line5385"></span> // we use \r\n if the _client_ OS is windows (as the exported file is downloaded to the client), \n otherwise
<span id="line5386"></span> $crlf = (isset($_SERVER['HTTP_USER_AGENT']) <span class="entity"><span>&amp;</span>amp;</span><span class="entity"><span>&amp;</span>amp;</span> strpos($_SERVER['HTTP_USER_AGENT'], 'Win') !== false ? <span class="entity"><span>&amp;</span>quot;</span>\r\n<span class="entity"><span>&amp;</span>quot;</span> : <span class="entity"><span>&amp;</span>quot;</span>\n<span class="entity"><span>&amp;</span>quot;</span>);
<span id="line5387"></span>
<span id="line5388"></span> $query = <span class="entity"><span>&amp;</span>quot;</span>SELECT * FROM sqlite_master WHERE type='table' or type='view' ORDER BY type DESC<span class="entity"><span>&amp;</span>quot;</span>;
<span id="line5389"></span> $result = $this-<span class="entity"><span>&amp;</span>gt;</span>selectArray($query);
<span id="line5390"></span> for ($i = 0; $i <span class="entity"><span>&amp;</span>lt;</span> sizeof($result); $i++) {
<span id="line5391"></span> $valid = false;
<span id="line5392"></span> for ($j = 0; $j <span class="entity"><span>&amp;</span>lt;</span> sizeof($tables); $j++) {
<span id="line5393"></span> if ($result[$i]['tbl_name'] == $tables[$j])
<span id="line5394"></span> $valid = true;
<span id="line5395"></span> }
<span id="line5396"></span> if ($valid) {
<span id="line5397"></span> $temp = $this-<span class="entity"><span>&amp;</span>gt;</span>getTableInfo($result[$i]['tbl_name']);
<span id="line5398"></span> $cols = array();
<span id="line5399"></span> for ($z = 0; $z <span class="entity"><span>&amp;</span>lt;</span> sizeof($temp); $z++)
<span id="line5400"></span> $cols[$z] = $temp[$z][1];
<span id="line5401"></span> if ($fields_in_first_row) {
<span id="line5402"></span> for ($z = 0; $z <span class="entity"><span>&amp;</span>lt;</span> sizeof($cols); $z++) {
<span id="line5403"></span> echo $field_enclosed . $cols[$z] . $field_enclosed;
<span id="line5404"></span> // do not terminate the last column!
<span id="line5405"></span> if ($z <span class="entity"><span>&amp;</span>lt;</span> sizeof($cols) - 1)
<span id="line5406"></span> echo $field_terminate;
<span id="line5407"></span> }
<span id="line5408"></span> echo $crlf;
<span id="line5409"></span> }
<span id="line5410"></span> $query = <span class="entity"><span>&amp;</span>quot;</span>SELECT * FROM <span class="entity"><span>&amp;</span>quot;</span> . $this-<span class="entity"><span>&amp;</span>gt;</span>quote_id($result[$i]['tbl_name']);
<span id="line5411"></span> $table_result = $this-<span class="entity"><span>&amp;</span>gt;</span>query($query);
<span id="line5412"></span> $firstRow = true;
<span id="line5413"></span> while ($row = $this-<span class="entity"><span>&amp;</span>gt;</span>fetch($table_result, <span class="entity"><span>&amp;</span>quot;</span>assoc<span class="entity"><span>&amp;</span>quot;</span>)) {
<span id="line5414"></span> if (!$firstRow)
<span id="line5415"></span> echo $crlf;
<span id="line5416"></span> else
<span id="line5417"></span> $firstRow = false;
<span id="line5418"></span>
<span id="line5419"></span> for ($y = 0; $y <span class="entity"><span>&amp;</span>lt;</span> sizeof($cols); $y++) {
<span id="line5420"></span> $cell = $row[$cols[$y]];
<span id="line5421"></span> if ($crlf) {
<span id="line5422"></span> $cell = str_replace(<span class="entity"><span>&amp;</span>quot;</span>\n<span class="entity"><span>&amp;</span>quot;</span>, <span class="entity"><span>&amp;</span>quot;</span><span class="entity"><span>&amp;</span>quot;</span>, $cell);
<span id="line5423"></span> $cell = str_replace(<span class="entity"><span>&amp;</span>quot;</span>\r<span class="entity"><span>&amp;</span>quot;</span>, <span class="entity"><span>&amp;</span>quot;</span><span class="entity"><span>&amp;</span>quot;</span>, $cell);
<span id="line5424"></span> }
<span id="line5425"></span> $cell = str_replace($field_terminate, $field_escaped . $field_terminate, $cell);
<span id="line5426"></span> $cell = str_replace($field_enclosed, $field_escaped . $field_enclosed, $cell);
<span id="line5427"></span> // do not enclose NULLs
<span id="line5428"></span> if ($cell == NULL)
<span id="line5429"></span> echo $null;
<span id="line5430"></span> else
<span id="line5431"></span> echo $field_enclosed . $cell . $field_enclosed;
<span id="line5432"></span> // do not terminate the last column!
<span id="line5433"></span> if ($y <span class="entity"><span>&amp;</span>lt;</span> sizeof($cols) - 1)
<span id="line5434"></span> echo $field_terminate;
<span id="line5435"></span> }
<span id="line5436"></span> }
<span id="line5437"></span> if ($i <span class="entity"><span>&amp;</span>lt;</span> sizeof($result) - 1)
<span id="line5438"></span> echo $crlf;
<span id="line5439"></span> }
<span id="line5440"></span> }
<span id="line5441"></span> }
<span id="line5442"></span>
<span id="line5443"></span> //export sql
<span id="line5444"></span> public function export_sql($tables, $drop, $structure, $data, $transaction, $comments)
<span id="line5445"></span> {
<span id="line5446"></span> global $lang;
<span id="line5447"></span> @set_time_limit(-1);
<span id="line5448"></span> // we use \r\n if the _client_ OS is windows (as the exported file is downloaded to the client), \n otherwise
<span id="line5449"></span> $crlf = (isset($_SERVER['HTTP_USER_AGENT']) <span class="entity"><span>&amp;</span>amp;</span><span class="entity"><span>&amp;</span>amp;</span> strpos($_SERVER['HTTP_USER_AGENT'], 'Win') !== false ? <span class="entity"><span>&amp;</span>quot;</span>\r\n<span class="entity"><span>&amp;</span>quot;</span> : <span class="entity"><span>&amp;</span>quot;</span>\n<span class="entity"><span>&amp;</span>quot;</span>);
<span id="line5450"></span>
<span id="line5451"></span> if ($comments) {
<span id="line5452"></span> echo <span class="entity"><span>&amp;</span>quot;</span>----<span class="entity"><span>&amp;</span>quot;</span> . $crlf;
<span id="line5453"></span> echo <span class="entity"><span>&amp;</span>quot;</span>-- <span class="entity"><span>&amp;</span>quot;</span> . PROJECT . <span class="entity"><span>&amp;</span>quot;</span> <span class="entity"><span>&amp;</span>quot;</span> . $lang['db_dump'] . <span class="entity"><span>&amp;</span>quot;</span> (<span class="entity"><span>&amp;</span>quot;</span> . PROJECT_URL . <span class="entity"><span>&amp;</span>quot;</span>)<span class="entity"><span>&amp;</span>quot;</span> . $crlf;
<span id="line5454"></span> echo <span class="entity"><span>&amp;</span>quot;</span>-- <span class="entity"><span>&amp;</span>quot;</span> . PROJECT . <span class="entity"><span>&amp;</span>quot;</span> <span class="entity"><span>&amp;</span>quot;</span> . $lang['ver'] . <span class="entity"><span>&amp;</span>quot;</span>: <span class="entity"><span>&amp;</span>quot;</span> . VERSION . $crlf;
<span id="line5455"></span> echo <span class="entity"><span>&amp;</span>quot;</span>-- <span class="entity"><span>&amp;</span>quot;</span> . $lang['exported'] . <span class="entity"><span>&amp;</span>quot;</span>: <span class="entity"><span>&amp;</span>quot;</span> . date($lang['date_format']) . $crlf;
<span id="line5456"></span> echo <span class="entity"><span>&amp;</span>quot;</span>-- <span class="entity"><span>&amp;</span>quot;</span> . $lang['db_f'] . <span class="entity"><span>&amp;</span>quot;</span>: <span class="entity"><span>&amp;</span>quot;</span> . $this-<span class="entity"><span>&amp;</span>gt;</span>getPath() . $crlf;
<span id="line5457"></span> echo <span class="entity"><span>&amp;</span>quot;</span>----<span class="entity"><span>&amp;</span>quot;</span> . $crlf;
<span id="line5458"></span> }
<span id="line5459"></span> $query = <span class="entity"><span>&amp;</span>quot;</span>SELECT * FROM sqlite_master WHERE type='table' OR type='index' OR type='view' OR type='trigger' ORDER BY type='trigger', type='index', type='view', type='table'<span class="entity"><span>&amp;</span>quot;</span>;
<span id="line5460"></span> $result = $this-<span class="entity"><span>&amp;</span>gt;</span>selectArray($query);
<span id="line5461"></span>
<span id="line5462"></span> if ($transaction)
<span id="line5463"></span> echo <span class="entity"><span>&amp;</span>quot;</span>BEGIN TRANSACTION;<span class="entity"><span>&amp;</span>quot;</span> . $crlf;
<span id="line5464"></span>
<span id="line5465"></span> //iterate through each table
<span id="line5466"></span> for ($i = 0; $i <span class="entity"><span>&amp;</span>lt;</span> sizeof($result); $i++) {
<span id="line5467"></span> $valid = false;
<span id="line5468"></span> for ($j = 0; $j <span class="entity"><span>&amp;</span>lt;</span> sizeof($tables); $j++) {
<span id="line5469"></span> if ($result[$i]['tbl_name'] == $tables[$j])
<span id="line5470"></span> $valid = true;
<span id="line5471"></span> }
<span id="line5472"></span> if ($valid) {
<span id="line5473"></span> if ($drop) {
<span id="line5474"></span> if ($comments) {
<span id="line5475"></span> echo <span class="entity"><span>&amp;</span>quot;</span>\r\n----<span class="entity"><span>&amp;</span>quot;</span> . $crlf;
<span id="line5476"></span> echo <span class="entity"><span>&amp;</span>quot;</span>-- <span class="entity"><span>&amp;</span>quot;</span> . $lang['drop'] . <span class="entity"><span>&amp;</span>quot;</span> <span class="entity"><span>&amp;</span>quot;</span> . $result[$i]['type'] . <span class="entity"><span>&amp;</span>quot;</span> <span class="entity"><span>&amp;</span>quot;</span> . $lang['for'] . <span class="entity"><span>&amp;</span>quot;</span> <span class="entity"><span>&amp;</span>quot;</span> . $result[$i]['name'] . $crlf;
<span id="line5477"></span> echo <span class="entity"><span>&amp;</span>quot;</span>----<span class="entity"><span>&amp;</span>quot;</span> . $crlf;
<span id="line5478"></span> }
<span id="line5479"></span> echo <span class="entity"><span>&amp;</span>quot;</span>DROP <span class="entity"><span>&amp;</span>quot;</span> . strtoupper($result[$i]['type']) . <span class="entity"><span>&amp;</span>quot;</span> IF EXISTS <span class="entity"><span>&amp;</span>quot;</span> . $this-<span class="entity"><span>&amp;</span>gt;</span>quote_id($result[$i]['name']) . <span class="entity"><span>&amp;</span>quot;</span>;<span class="entity"><span>&amp;</span>quot;</span> . $crlf;
<span id="line5480"></span> }
<span id="line5481"></span> if ($structure) {
<span id="line5482"></span> if ($comments) {
<span id="line5483"></span> echo <span class="entity"><span>&amp;</span>quot;</span>\r\n----<span class="entity"><span>&amp;</span>quot;</span> . $crlf;
<span id="line5484"></span> if ($result[$i]['type'] == <span class="entity"><span>&amp;</span>quot;</span>table<span class="entity"><span>&amp;</span>quot;</span> || $result[$i]['type'] == <span class="entity"><span>&amp;</span>quot;</span>view<span class="entity"><span>&amp;</span>quot;</span>)
<span id="line5485"></span> echo <span class="entity"><span>&amp;</span>quot;</span>-- <span class="entity"><span>&amp;</span>quot;</span> . ucfirst($result[$i]['type']) . <span class="entity"><span>&amp;</span>quot;</span> <span class="entity"><span>&amp;</span>quot;</span> . $lang['struct_for'] . <span class="entity"><span>&amp;</span>quot;</span> <span class="entity"><span>&amp;</span>quot;</span> . $result[$i]['tbl_name'] . $crlf;
<span id="line5486"></span> else // index or trigger
<span id="line5487"></span> echo <span class="entity"><span>&amp;</span>quot;</span>-- <span class="entity"><span>&amp;</span>quot;</span> . $lang['struct_for'] . <span class="entity"><span>&amp;</span>quot;</span> <span class="entity"><span>&amp;</span>quot;</span> . $result[$i]['type'] . <span class="entity"><span>&amp;</span>quot;</span> <span class="entity"><span>&amp;</span>quot;</span> . $result[$i]['name'] . <span class="entity"><span>&amp;</span>quot;</span> <span class="entity"><span>&amp;</span>quot;</span> . $lang['on_tbl'] . <span class="entity"><span>&amp;</span>quot;</span> <span class="entity"><span>&amp;</span>quot;</span> . $result[$i]['tbl_name'] . $crlf;
<span id="line5488"></span> echo <span class="entity"><span>&amp;</span>quot;</span>----<span class="entity"><span>&amp;</span>quot;</span> . $crlf;
<span id="line5489"></span> }
<span id="line5490"></span> echo $result[$i]['sql'] . <span class="entity"><span>&amp;</span>quot;</span>;<span class="entity"><span>&amp;</span>quot;</span> . $crlf;
<span id="line5491"></span> }
<span id="line5492"></span> if ($data <span class="entity"><span>&amp;</span>amp;</span><span class="entity"><span>&amp;</span>amp;</span> $result[$i]['type'] == <span class="entity"><span>&amp;</span>quot;</span>table<span class="entity"><span>&amp;</span>quot;</span>) {
<span id="line5493"></span> $query = <span class="entity"><span>&amp;</span>quot;</span>SELECT * FROM <span class="entity"><span>&amp;</span>quot;</span> . $this-<span class="entity"><span>&amp;</span>gt;</span>quote_id($result[$i]['tbl_name']);
<span id="line5494"></span> $table_result = $this-<span class="entity"><span>&amp;</span>gt;</span>query($query, <span class="entity"><span>&amp;</span>quot;</span>assoc<span class="entity"><span>&amp;</span>quot;</span>);
<span id="line5495"></span>
<span id="line5496"></span> if ($comments) {
<span id="line5497"></span> $numRows = $this-<span class="entity"><span>&amp;</span>gt;</span>numRows($result[$i]['tbl_name']);
<span id="line5498"></span> echo <span class="entity"><span>&amp;</span>quot;</span>\r\n----<span class="entity"><span>&amp;</span>quot;</span> . $crlf;
<span id="line5499"></span> echo <span class="entity"><span>&amp;</span>quot;</span>-- <span class="entity"><span>&amp;</span>quot;</span> . $lang['data_dump'] . <span class="entity"><span>&amp;</span>quot;</span> <span class="entity"><span>&amp;</span>quot;</span> . $result[$i]['tbl_name'] . <span class="entity"><span>&amp;</span>quot;</span>, <span class="entity"><span>&amp;</span>quot;</span> . sprintf($lang['total_rows'], $numRows) . $crlf;
<span id="line5500"></span> echo <span class="entity"><span>&amp;</span>quot;</span>----<span class="entity"><span>&amp;</span>quot;</span> . $crlf;
<span id="line5501"></span> }
<span id="line5502"></span> $temp = $this-<span class="entity"><span>&amp;</span>gt;</span>getTableInfo($result[$i]['tbl_name']);
<span id="line5503"></span> $cols = array();
<span id="line5504"></span> $cols_quoted = array();
<span id="line5505"></span> for ($z = 0; $z <span class="entity"><span>&amp;</span>lt;</span> sizeof($temp); $z++) {
<span id="line5506"></span> $cols[$z] = $temp[$z][1];
<span id="line5507"></span> $cols_quoted[$z] = $this-<span class="entity"><span>&amp;</span>gt;</span>quote_id($temp[$z][1]);
<span id="line5508"></span> }
<span id="line5509"></span> while ($row = $this-<span class="entity"><span>&amp;</span>gt;</span>fetch($table_result)) {
<span id="line5510"></span> $vals = array();
<span id="line5511"></span> for ($y = 0; $y <span class="entity"><span>&amp;</span>lt;</span> sizeof($cols); $y++) {
<span id="line5512"></span> if ($row[$cols[$y]] === NULL)
<span id="line5513"></span> $vals[$cols[$y]] = 'NULL';
<span id="line5514"></span> else
<span id="line5515"></span> $vals[$cols[$y]] = $this-<span class="entity"><span>&amp;</span>gt;</span>quote($row[$cols[$y]]);
<span id="line5516"></span> }
<span id="line5517"></span> echo <span class="entity"><span>&amp;</span>quot;</span>INSERT INTO <span class="entity"><span>&amp;</span>quot;</span> . $this-<span class="entity"><span>&amp;</span>gt;</span>quote_id($result[$i]['tbl_name']) . <span class="entity"><span>&amp;</span>quot;</span> (<span class="entity"><span>&amp;</span>quot;</span> . implode(<span class="entity"><span>&amp;</span>quot;</span>,<span class="entity"><span>&amp;</span>quot;</span>, $cols_quoted) . <span class="entity"><span>&amp;</span>quot;</span>) VALUES (<span class="entity"><span>&amp;</span>quot;</span> . implode(<span class="entity"><span>&amp;</span>quot;</span>,<span class="entity"><span>&amp;</span>quot;</span>, $vals) . <span class="entity"><span>&amp;</span>quot;</span>);<span class="entity"><span>&amp;</span>quot;</span> . $crlf;
<span id="line5518"></span> }
<span id="line5519"></span> }
<span id="line5520"></span> }
<span id="line5521"></span> }
<span id="line5522"></span> if ($transaction)
<span id="line5523"></span> echo <span class="entity"><span>&amp;</span>quot;</span>COMMIT;<span class="entity"><span>&amp;</span>quot;</span> . $crlf;
<span id="line5524"></span> }
<span id="line5525"></span>}
<span id="line5526"></span>
<span id="line5527"></span>class GetParameters
<span id="line5528"></span>{
<span id="line5529"></span> private $_fields;
<span id="line5530"></span>
<span id="line5531"></span> public function __construct(array $defaults = array())
<span id="line5532"></span> {
<span id="line5533"></span> $this-<span class="entity"><span>&amp;</span>gt;</span>_fields = $defaults;
<span id="line5534"></span> }
<span id="line5535"></span>
<span id="line5536"></span> public function __set($key, $value)
<span id="line5537"></span> {
<span id="line5538"></span> $this-<span class="entity"><span>&amp;</span>gt;</span>_fields[$key] = $value;
<span id="line5539"></span> }
<span id="line5540"></span>
<span id="line5541"></span> public function __isset($key)
<span id="line5542"></span> {
<span id="line5543"></span> return isset($this-<span class="entity"><span>&amp;</span>gt;</span>_fields[$key]);
<span id="line5544"></span> }
<span id="line5545"></span>
<span id="line5546"></span> public function __unset($key)
<span id="line5547"></span> {
<span id="line5548"></span> unset($this-<span class="entity"><span>&amp;</span>gt;</span>_fields[$key]);
<span id="line5549"></span> }
<span id="line5550"></span>
<span id="line5551"></span> public function __get($key)
<span id="line5552"></span> {
<span id="line5553"></span> return $this-<span class="entity"><span>&amp;</span>gt;</span>_fields[$key];
<span id="line5554"></span> }
<span id="line5555"></span>
<span id="line5556"></span> public function getURL(array $assoc = array(), $html = true, $prefix = '?')
<span id="line5557"></span> {
<span id="line5558"></span> $arg_sep = ($html ? '<span class="entity"><span>&amp;</span>amp;</span>amp;' : '<span class="entity"><span>&amp;</span>amp;</span>');
<span id="line5559"></span> return $prefix . http_build_query(array_merge($this-<span class="entity"><span>&amp;</span>gt;</span>_fields, $assoc), '', $arg_sep);
<span id="line5560"></span> }
<span id="line5561"></span>
<span id="line5562"></span> public function getLink(array $assoc = array(), $content = '[ link ]', $class = '', $title = '', $target = '')
<span id="line5563"></span> {
<span id="line5564"></span> return '<span class="entity"><span>&amp;</span>lt;</span>a href=<span class="entity"><span>&amp;</span>quot;</span>' . $this-<span class="entity"><span>&amp;</span>gt;</span>getURL($assoc) . '<span class="entity"><span>&amp;</span>quot;</span>'
<span id="line5565"></span> . ($class != '' ? ' class=<span class="entity"><span>&amp;</span>quot;</span>' . $class . '<span class="entity"><span>&amp;</span>quot;</span>' : '')
<span id="line5566"></span> . ($title != '' ? ' title=<span class="entity"><span>&amp;</span>quot;</span>' . $title . '<span class="entity"><span>&amp;</span>quot;</span>' : '')
<span id="line5567"></span> . ($target != '' ? ' target=<span class="entity"><span>&amp;</span>quot;</span>' . $target . '<span class="entity"><span>&amp;</span>quot;</span>' : '')
<span id="line5568"></span> . '<span class="entity"><span>&amp;</span>gt;</span>' . $content . '<span class="entity"><span>&amp;</span>lt;</span>/a<span class="entity"><span>&amp;</span>gt;</span>';
<span id="line5569"></span> }
<span id="line5570"></span>
<span id="line5571"></span> public function getForm(array $assoc = array(), $method = 'post', $upload = false, $name = '', $csrf = true)
<span id="line5572"></span> {
<span id="line5573"></span> $hidden = '';
<span id="line5574"></span> if ($method == 'get') {
<span id="line5575"></span> $url = '';
<span id="line5576"></span> foreach (array_merge($this-<span class="entity"><span>&amp;</span>gt;</span>_fields, $assoc) as $key =<span class="entity"><span>&amp;</span>gt;</span> $value) {
<span id="line5577"></span> if (!is_null($value))
<span id="line5578"></span> $hidden .= '<span class="entity"><span>&amp;</span>lt;</span>input type=<span class="entity"><span>&amp;</span>quot;</span>hidden<span class="entity"><span>&amp;</span>quot;</span> name=<span class="entity"><span>&amp;</span>quot;</span>' . htmlencode($key) . '<span class="entity"><span>&amp;</span>quot;</span> value=<span class="entity"><span>&amp;</span>quot;</span>' . htmlencode($value) . '<span class="entity"><span>&amp;</span>quot;</span> /<span class="entity"><span>&amp;</span>gt;</span> ';
<span id="line5579"></span> }
<span id="line5580"></span> } else
<span id="line5581"></span> $url = $this-<span class="entity"><span>&amp;</span>gt;</span>getURL($assoc);
<span id="line5582"></span>
<span id="line5583"></span> if ($csrf <span class="entity"><span>&amp;</span>amp;</span><span class="entity"><span>&amp;</span>amp;</span> $method == 'post')
<span id="line5584"></span> $hidden .= '<span class="entity"><span>&amp;</span>lt;</span>input type=<span class="entity"><span>&amp;</span>quot;</span>hidden<span class="entity"><span>&amp;</span>quot;</span> name=<span class="entity"><span>&amp;</span>quot;</span>token<span class="entity"><span>&amp;</span>quot;</span> value=<span class="entity"><span>&amp;</span>quot;</span>' . $_SESSION[COOKIENAME . 'token'] . '<span class="entity"><span>&amp;</span>quot;</span> /<span class="entity"><span>&amp;</span>gt;</span>';
<span id="line5585"></span>
<span id="line5586"></span> return <span class="entity"><span>&amp;</span>quot;</span><span class="entity"><span>&amp;</span>lt;</span>form action='<span class="entity"><span>&amp;</span>quot;</span> . $url . <span class="entity"><span>&amp;</span>quot;</span>' method='<span class="entity"><span>&amp;</span>quot;</span> . $method . <span class="entity"><span>&amp;</span>quot;</span>'<span class="entity"><span>&amp;</span>quot;</span> .
<span id="line5587"></span> ($name != '' ? <span class="entity"><span>&amp;</span>quot;</span> name='<span class="entity"><span>&amp;</span>quot;</span> . $name . <span class="entity"><span>&amp;</span>quot;</span>'<span class="entity"><span>&amp;</span>quot;</span> : '') .
<span id="line5588"></span> ($upload ? <span class="entity"><span>&amp;</span>quot;</span> enctype='multipart/form-data'<span class="entity"><span>&amp;</span>quot;</span> : '') . <span class="entity"><span>&amp;</span>quot;</span><span class="entity"><span>&amp;</span>gt;</span><span class="entity"><span>&amp;</span>quot;</span> .
<span id="line5589"></span> $hidden;
<span id="line5590"></span> }
<span id="line5591"></span>
<span id="line5592"></span> public function redirect(array $assoc = array(), $message = <span class="entity"><span>&amp;</span>quot;</span><span class="entity"><span>&amp;</span>quot;</span>)
<span id="line5593"></span> {
<span id="line5594"></span> if ($message != <span class="entity"><span>&amp;</span>quot;</span><span class="entity"><span>&amp;</span>quot;</span>) {
<span id="line5595"></span> $_SESSION[COOKIENAME . 'messages'][md5($message)] = $message;
<span id="line5596"></span> $url = $this-<span class="entity"><span>&amp;</span>gt;</span>getURL(array_merge($assoc, array('message' =<span class="entity"><span>&amp;</span>gt;</span> md5($message))), false);
<span id="line5597"></span> } else
<span id="line5598"></span> $url = $this-<span class="entity"><span>&amp;</span>gt;</span>getURL($assoc, false);
<span id="line5599"></span>
<span id="line5600"></span> $protocol = (isset($_SERVER['HTTPS']) <span class="entity"><span>&amp;</span>amp;</span><span class="entity"><span>&amp;</span>amp;</span> $_SERVER['HTTPS'] != 'off' ? 'https' : 'http');
<span id="line5601"></span>
<span id="line5602"></span> header(<span class="entity"><span>&amp;</span>quot;</span>Location: <span class="entity"><span>&amp;</span>quot;</span> . $protocol . <span class="entity"><span>&amp;</span>quot;</span>://<span class="entity"><span>&amp;</span>quot;</span> . $_SERVER['HTTP_HOST'] . $_SERVER['PHP_SELF'] . $url, true, 302);
<span id="line5603"></span> exit;
<span id="line5604"></span> }
<span id="line5605"></span>}
<span id="line5606"></span>
<span id="line5607"></span>// class Resources (issue #157)
<span id="line5608"></span>// outputs secondary files, such as css and javascript
<span id="line5609"></span>// data is stored gzipped (gzencode) and encoded (base64_encode)
<span id="line5610"></span>//
<span id="line5611"></span>class Resources
<span id="line5612"></span>{
<span id="line5613"></span>
<span id="line5614"></span> // set this to the file containing getInternalResource;
<span id="line5615"></span> // currently unused in split mode; set to __FILE__ for built PLA.
<span id="line5616"></span> public static $embedding_file = __FILE__;
<span id="line5617"></span>
<span id="line5618"></span> private static $_resources = array(
<span id="line5619"></span> 'css' =<span class="entity"><span>&amp;</span>gt;</span> array(
<span id="line5620"></span> 'mime' =<span class="entity"><span>&amp;</span>gt;</span> 'text/css',
<span id="line5621"></span> 'data' =<span class="entity"><span>&amp;</span>gt;</span> 'resources/phpliteadmin.css',
<span id="line5622"></span> ),
<span id="line5623"></span> 'javascript' =<span class="entity"><span>&amp;</span>gt;</span> array(
<span id="line5624"></span> 'mime' =<span class="entity"><span>&amp;</span>gt;</span> 'text/javascript',
<span id="line5625"></span> 'data' =<span class="entity"><span>&amp;</span>gt;</span> 'resources/phpliteadmin.js',
<span id="line5626"></span> ),
<span id="line5627"></span> 'favicon' =<span class="entity"><span>&amp;</span>gt;</span> array(
<span id="line5628"></span> 'mime' =<span class="entity"><span>&amp;</span>gt;</span> 'image/x-icon',
<span id="line5629"></span> 'data' =<span class="entity"><span>&amp;</span>gt;</span> 'resources/favicon.ico',
<span id="line5630"></span> 'base64' =<span class="entity"><span>&amp;</span>gt;</span> 'true',
<span id="line5631"></span> ),
<span id="line5632"></span> );
<span id="line5633"></span>
<span id="line5634"></span> // outputs the specified resource, if defined in this class.
<span id="line5635"></span> // the main script should do no further output after calling this function.
<span id="line5636"></span> public static function output($resource)
<span id="line5637"></span> {
<span id="line5638"></span> if (isset(self::$_resources[$resource])) {
<span id="line5639"></span> $res =<span class="entity"><span>&amp;</span>amp;</span> self::$_resources[$resource];
<span id="line5640"></span>
<span id="line5641"></span> if (function_exists('getInternalResource') <span class="entity"><span>&amp;</span>amp;</span><span class="entity"><span>&amp;</span>amp;</span> $data = getInternalResource($res['data'])) {
<span id="line5642"></span> $filename = self::$embedding_file;
<span id="line5643"></span> } else {
<span id="line5644"></span> $filename = $res['data'];
<span id="line5645"></span> }
<span id="line5646"></span>
<span id="line5647"></span> // use last-modified time as etag; etag must be quoted
<span id="line5648"></span> $etag = '<span class="entity"><span>&amp;</span>quot;</span>' . filemtime($filename) . '<span class="entity"><span>&amp;</span>quot;</span>';
<span id="line5649"></span>
<span id="line5650"></span> // check headers for matching etag; if etag hasn't changed, use the cached version
<span id="line5651"></span> if (isset($_SERVER['HTTP_IF_NONE_MATCH']) <span class="entity"><span>&amp;</span>amp;</span><span class="entity"><span>&amp;</span>amp;</span> $_SERVER['HTTP_IF_NONE_MATCH'] == $etag) {
<span id="line5652"></span> header('HTTP/1.0 304 Not Modified');
<span id="line5653"></span> return;
<span id="line5654"></span> }
<span id="line5655"></span>
<span id="line5656"></span> header('Etag: ' . $etag);
<span id="line5657"></span>
<span id="line5658"></span> // cache file for at most 30 days
<span id="line5659"></span> header('Cache-control: max-age=2592000');
<span id="line5660"></span>
<span id="line5661"></span> // output resource
<span id="line5662"></span> header('Content-type: ' . $res['mime']);
<span id="line5663"></span>
<span id="line5664"></span> if (isset($data)) {
<span id="line5665"></span> if (isset($res['base64'])) {
<span id="line5666"></span> echo base64_decode($data);
<span id="line5667"></span> } else {
<span id="line5668"></span> echo $data;
<span id="line5669"></span> }
<span id="line5670"></span> } else {
<span id="line5671"></span> readfile($filename);
<span id="line5672"></span> }
<span id="line5673"></span> }
<span id="line5674"></span> }
<span id="line5675"></span>
<span id="line5676"></span>}
<span id="line5677"></span>
<span id="line5678"></span>
<span id="line5679"></span>// returns data from internal resources, available in single-file mode
<span id="line5680"></span>function getInternalResource($res)
<span id="line5681"></span>{
<span id="line5682"></span> $resources = array('resources/phpliteadmin.css' =<span class="entity"><span>&amp;</span>gt;</span> array(0 =<span class="entity"><span>&amp;</span>gt;</span> 0, 1 =<span class="entity"><span>&amp;</span>gt;</span> 4059,), 'resources/phpliteadmin.js' =<span class="entity"><span>&amp;</span>gt;</span> array(0 =<span class="entity"><span>&amp;</span>gt;</span> 4059, 1 =<span class="entity"><span>&amp;</span>gt;</span> 4542,), 'resources/favicon.ico' =<span class="entity"><span>&amp;</span>gt;</span> array(0 =<span class="entity"><span>&amp;</span>gt;</span> 8601, 1 =<span class="entity"><span>&amp;</span>gt;</span> 1448,),);
<span id="line5683"></span>
<span id="line5684"></span> if (isset($resources[$res]) <span class="entity"><span>&amp;</span>amp;</span><span class="entity"><span>&amp;</span>amp;</span> $f = fopen(__FILE__, 'r')) {
<span id="line5685"></span> fseek($f, __COMPILER_HALT_OFFSET__ + $resources[$res][0]);
<span id="line5686"></span> $data = fread($f, $resources[$res][1]);
<span id="line5687"></span> fclose($f);
<span id="line5688"></span> return $data;
<span id="line5689"></span> }
<span id="line5690"></span> return false;
<span id="line5691"></span>}
<span id="line5692"></span>
<span id="line5693"></span>// resources embedded below, do not edit!
<span id="line5694"></span>__halt_compiler() ?<span class="entity"><span>&amp;</span>gt;</span>
<span id="line5695"></span>body{margin:0px;padding:0px;font-family:Arial,Helvetica,sans-serif;font-size:14px;color:#000;background-color:#e0ebf6;overflow:auto}.body_tbl
<span id="line5696"></span>td{padding:9px 2px 9px
<span id="line5697"></span>9px}.left_td{width:100px}a{color:#03F;text-decoration:none;cursor:pointer}a:hover{color:#06F}hr{height:1px;border:0;color:#bbb;background-color:#bbb;width:100%}h1{margin:0px;padding:5px;font-size:24px;background-color:#f3cece;text-align:center;color:#000;border-top-left-radius:5px;border-top-right-radius:5px;-moz-border-radius-topleft:5px;-moz-border-radius-topright:5px}#headerlinks{text-align:center;margin-bottom:10px;padding:5px
<span id="line5698"></span>15px;border-color:#03F;border-width:1px;border-style:solid;border-left-style:none;border-right-style:none;font-size:12px;background-color:#e0ebf6;font-weight:bold}h1
<span id="line5699"></span>#version{color:#000;font-size:16px}h1
<span id="line5700"></span>#logo{color:#000}h2{margin:0px;padding:0px;font-size:14px;margin-bottom:20px}input,select,textarea,.CodeMirror{font-family:Arial,Helvetica,sans-serif;background-color:#eaeaea;color:#03F;border-color:#03F;border-style:solid;border-width:1px;margin:5px;border-radius:5px;-moz-border-radius:5px;padding:3px}input.btn{cursor:pointer}input.btn:hover{background-color:#ccc}fieldset
<span id="line5701"></span>label{min-width:200px;display:block;float:left}fieldset{padding:15px;border-color:#03F;border-width:1px;border-style:solid;border-radius:5px;-moz-border-radius:5px;background-color:#f9f9f9}#container{padding:10px}#leftNav{min-width:250px;padding:0px;border-color:#03F;border-width:1px;border-style:solid;background-color:#FFF;padding-bottom:15px;border-radius:5px;-moz-border-radius:5px}.databaseList
<span id="line5702"></span>select{max-width:200px}.viewTable tr
<span id="line5703"></span>td{padding:1px}#loginBox{width:500px;margin-left:auto;margin-right:auto;margin-top:50px;border-color:#03F;border-width:1px;border-style:solid;background-color:#FFF;border-radius:5px;-moz-border-radius:5px}#main{border-color:#03F;border-width:1px;border-style:solid;padding:15px;background-color:#FFF;border-bottom-left-radius:5px;border-bottom-right-radius:5px;border-top-right-radius:5px;-moz-border-radius-bottomleft:5px;-moz-border-radius-bottomright:5px;-moz-border-radius-topright:5px}.td1{background-color:#f9e3e3;text-align:right;font-size:12px;padding-left:10px;padding-right:10px}.td2{background-color:#f3cece;text-align:right;font-size:12px;padding-left:10px;padding-right:10px}.tdheader{border-color:#03F;border-width:1px;border-style:solid;font-weight:bold;font-size:12px;padding-left:10px;padding-right:10px;background-color:#e0ebf6;border-radius:5px;-moz-border-radius:5px}.confirm{border-color:#03F;border-width:1px;border-style:dashed;padding:15px;background-color:#e0ebf6}.tab{display:block;padding:5px;padding-right:8px;padding-left:8px;border-color:#03F;border-width:1px;border-style:solid;margin-right:5px;float:left;border-bottom-style:none;position:relative;top:1px;padding-bottom:4px;background-color:#eaeaea;border-top-left-radius:5px;border-top-right-radius:5px;-moz-border-radius-topleft:5px;-moz-border-radius-topright:5px}.tab_pressed{display:block;padding:5px;padding-right:8px;padding-left:8px;border-color:#03F;border-width:1px;border-style:solid;margin-right:5px;float:left;border-bottom-style:none;position:relative;top:1px;background-color:#FFF;cursor:default;border-top-left-radius:5px;border-top-right-radius:5px;-moz-border-radius-topleft:5px;-moz-border-radius-topright:5px}.helpq{font-size:11px;font-weight:normal}#help_container{padding:0px;font-size:12px;margin-left:auto;margin-right:auto;background-color:#fff}.help_outer{background-color:#FFF;padding:0px;height:300px;position:relative}.help_list{padding:10px;height:auto}.headd{font-size:14px;font-weight:bold;display:block;padding:10px;background-color:#e0ebf6;border-color:#03F;border-width:1px;border-style:solid;border-left-style:none;border-right-style:none}.help_inner{padding:10px}.help_top{display:block;position:absolute;right:10px;bottom:10px}.warning,.delete,.empty,.drop,.delete_db{color:red}.sidebar_table{font-size:11px}.active_table,.active_db{text-decoration:underline}.null{color:#888}.found{background:#FF0;text-decoration:none}
<span id="line5704"></span>function initAutoincrement()
<span id="line5705"></span>{var i=0;while(document.getElementById('i'+i+'_autoincrement')!=undefined)
<span id="line5706"></span>{document.getElementById('i'+i+'_autoincrement').disabled=true;i++;}}
<span id="line5707"></span>function toggleAutoincrement(i)
<span id="line5708"></span>{var type=document.getElementById('i'+i+'_type');var primarykey=document.getElementById('i'+i+'_primarykey');var
<span id="line5709"></span>autoincrement=document.getElementById('i'+i+'_autoincrement');if(!autoincrement)return
<span id="line5710"></span>false;if(type.value=='INTEGER'<span class="entity"><span>&amp;</span>amp;</span><span class="entity"><span>&amp;</span>amp;</span>primarykey.checked)
<span id="line5711"></span>autoincrement.disabled=false;else
<span id="line5712"></span>{autoincrement.disabled=true;autoincrement.checked=false;}}
<span id="line5713"></span>function toggleNull(i)
<span id="line5714"></span>{var pk=document.getElementById('i'+i+'_primarykey');var
<span id="line5715"></span>notnull=document.getElementById('i'+i+'_notnull');if(pk.checked)
<span id="line5716"></span>{notnull.disabled=true;notnull.checked=true;}
<span id="line5717"></span>else
<span id="line5718"></span>{notnull.disabled=false;}}
<span id="line5719"></span>function checkAll(field)
<span id="line5720"></span>{var i=0;while(document.getElementById('check_'+i)!=undefined)
<span id="line5721"></span>{document.getElementById('check_'+i).checked=true;i++;}}
<span id="line5722"></span>function uncheckAll(field)
<span id="line5723"></span>{var i=0;while(document.getElementById('check_'+i)!=undefined)
<span id="line5724"></span>{document.getElementById('check_'+i).checked=false;i++;}}
<span id="line5725"></span>function changeIgnore(area,e,u)
<span id="line5726"></span>{if(area.value!=<span class="entity"><span>&amp;</span>quot;</span><span class="entity"><span>&amp;</span>quot;</span>)
<span id="line5727"></span>{if(document.getElementById(e)!=undefined)
<span id="line5728"></span>document.getElementById(e).checked=false;if(document.getElementById(u)!=undefined)
<span id="line5729"></span>document.getElementById(u).checked=false;}}
<span id="line5730"></span>function moveFields()
<span id="line5731"></span>{var fields=document.getElementById(<span class="entity"><span>&amp;</span>quot;</span>fieldcontainer<span class="entity"><span>&amp;</span>quot;</span>);var selected=[];for(var i=0;i
<span id="line5732"></span><span class="entity"><span>&amp;</span>lt;</span>fields.options.length
<span id="line5733"></span> ;i++)
<span id="line5734"></span> if(fields.options[i].selected)
<span id="line5735"></span> selected.push(fields.options[i].value);for(var i=0;i
<span id="line5736"></span><span class="entity"><span>&amp;</span>lt;</span>selected.length
<span id="line5737"></span> ;i++)
<span id="line5738"></span> {var val='<span class="entity"><span>&amp;</span>quot;</span>' +selected[i].replace(
<span id="line5739"></span>/<span class="entity"><span>&amp;</span>quot;</span>/g,'<span class="entity"><span>&amp;</span>quot;</span><span class="entity"><span>&amp;</span>quot;</span>')+'<span class="entity"><span>&amp;</span>quot;</span>';if(i
<span id="line5740"></span><span class="entity"><span>&amp;</span>lt;</span>selected.length-1
<span id="line5741"></span> )
<span id="line5742"></span> val+=', ' ;sqleditorInsertValue(val);}}
<span id="line5743"></span> function notNull(checker)
<span id="line5744"></span> {document.getElementById(checker).checked=false;}
<span id="line5745"></span> function disableText(checker,textie)
<span id="line5746"></span> {if(checker.checked)
<span id="line5747"></span> {document.getElementById(textie).value=<span class="entity"><span>&amp;</span>quot;</span><span class="entity"><span>&amp;</span>quot;</span> ;document.getElementById(textie).disabled=true;}
<span id="line5748"></span> else
<span id="line5749"></span> {document.getElementById(textie).disabled=false;}}
<span id="line5750"></span> function toggleExports(val)
<span id="line5751"></span> {document.getElementById(
<span id="line5752"></span><span class="entity"><span>&amp;</span>quot;</span>exportoptions_sql<span class="entity"><span>&amp;</span>quot;</span>).style.display=<span class="entity"><span>&amp;</span>quot;</span>none<span class="entity"><span>&amp;</span>quot;</span>;document.getElementById(<span class="entity"><span>&amp;</span>quot;</span>exportoptions_csv<span class="entity"><span>&amp;</span>quot;</span>).style.display=<span class="entity"><span>&amp;</span>quot;</span>none<span class="entity"><span>&amp;</span>quot;</span>;document.getElementById(<span class="entity"><span>&amp;</span>quot;</span>exportoptions_<span class="entity"><span>&amp;</span>quot;</span>+val).style.display=<span class="entity"><span>&amp;</span>quot;</span>block<span class="entity"><span>&amp;</span>quot;</span>;}
<span id="line5753"></span>function toggleImports(val)
<span id="line5754"></span>{document.getElementById(<span class="entity"><span>&amp;</span>quot;</span>importoptions_sql<span class="entity"><span>&amp;</span>quot;</span>).style.display=<span class="entity"><span>&amp;</span>quot;</span>none<span class="entity"><span>&amp;</span>quot;</span>;document.getElementById(<span class="entity"><span>&amp;</span>quot;</span>importoptions_csv<span class="entity"><span>&amp;</span>quot;</span>).style.display=<span class="entity"><span>&amp;</span>quot;</span>none<span class="entity"><span>&amp;</span>quot;</span>;document.getElementById(<span class="entity"><span>&amp;</span>quot;</span>importoptions_<span class="entity"><span>&amp;</span>quot;</span>+val).style.display=<span class="entity"><span>&amp;</span>quot;</span>block<span class="entity"><span>&amp;</span>quot;</span>;}
<span id="line5755"></span>function openHelp(section)
<span id="line5756"></span>{PopupCenter('?help=1#'+section,<span class="entity"><span>&amp;</span>quot;</span>Help Section<span class="entity"><span>&amp;</span>quot;</span>);}
<span id="line5757"></span>var helpsec=false;function PopupCenter(pageURL,title)
<span id="line5758"></span>{helpsec=window.open(pageURL,title,<span class="entity"><span>&amp;</span>quot;</span>toolbar=0,scrollbars=1,location=0,statusbar=0,menubar=0,resizable=0,width=400,height=300<span class="entity"><span>&amp;</span>quot;</span>);}
<span id="line5759"></span>function checkLike(srchField,selOpt)
<span id="line5760"></span>{if(selOpt==<span class="entity"><span>&amp;</span>quot;</span>LIKE%<span class="entity"><span>&amp;</span>quot;</span>){var textArea=document.getElementById(srchField);textArea.value=<span class="entity"><span>&amp;</span>quot;</span>%<span class="entity"><span>&amp;</span>quot;</span>+textArea.value+<span class="entity"><span>&amp;</span>quot;</span>%<span class="entity"><span>&amp;</span>quot;</span>;}}
<span id="line5761"></span>function createCORSRequest(method,url)
<span id="line5762"></span>{var xhr=new XMLHttpRequest();if(<span class="entity"><span>&amp;</span>quot;</span>withCredentials<span class="entity"><span>&amp;</span>quot;</span>in xhr)
<span id="line5763"></span>{xhr.open(method,url,true);}
<span id="line5764"></span>else if(typeof XDomainRequest!=<span class="entity"><span>&amp;</span>quot;</span>undefined<span class="entity"><span>&amp;</span>quot;</span>)
<span id="line5765"></span>{xhr=new XDomainRequest();xhr.open(method,url);}
<span id="line5766"></span>else
<span id="line5767"></span>{xhr=null;}
<span id="line5768"></span>return xhr;}
<span id="line5769"></span>function checkVersion(installed,url)
<span id="line5770"></span>{var xhr=createCORSRequest('GET',url);if(!xhr)
<span id="line5771"></span>return false;xhr.onload=function()
<span id="line5772"></span>{if(xhr.responseText.split(<span class="entity"><span>&amp;</span>quot;</span>\n<span class="entity"><span>&amp;</span>quot;</span>).indexOf(installed)==-1)
<span id="line5773"></span>{document.getElementById('oldVersion').style.display='inline';}};xhr.send();}
<span id="line5774"></span>var codeEditor;function sqleditor(textarea,tableDefinitions,tableDefault)
<span id="line5775"></span>{codeEditor=CodeMirror.fromTextArea(textarea,{lineNumbers:true,matchBrackets:true,indentUnit:4,lineWrapping:true,mode:<span class="entity"><span>&amp;</span>quot;</span>text/x-sqlite<span class="entity"><span>&amp;</span>quot;</span>,extraKeys:{<span class="entity"><span>&amp;</span>quot;</span>Ctrl-Space<span class="entity"><span>&amp;</span>quot;</span>:<span class="entity"><span>&amp;</span>quot;</span>autocomplete<span class="entity"><span>&amp;</span>quot;</span>},hint:CodeMirror.hint.sql,hintOptions:{completeSingle:false,completeOnSingleClick:true,defaultTable:tableDefault,tables:tableDefinitions}});codeEditor.on(<span class="entity"><span>&amp;</span>quot;</span>inputRead<span class="entity"><span>&amp;</span>quot;</span>,codemirrorAutocompleteOnInputRead);}
<span id="line5776"></span>function sqleditorSetValue(text)
<span id="line5777"></span>{codeEditor.doc.setValue(text);}
<span id="line5778"></span>function sqleditorInsertValue(text)
<span id="line5779"></span>{codeEditor.doc.replaceRange(text,codeEditor.doc.getCursor(<span class="entity"><span>&amp;</span>quot;</span>from<span class="entity"><span>&amp;</span>quot;</span>),codeEditor.doc.getCursor(<span class="entity"><span>&amp;</span>quot;</span>to<span class="entity"><span>&amp;</span>quot;</span>));}
<span id="line5780"></span>function codemirrorAutocompleteOnInputRead(instance){if(instance.state.completionActive){return;}
<span id="line5781"></span>var cur=instance.getCursor();var token=instance.getTokenAt(cur);var string='';if(token.string.match(/^[.`<span class="entity"><span>&amp;</span>quot;</span>\w@]\w*$/))
<span id="line5782"></span>{string=token.string;}
<span id="line5783"></span>if(string.length<span class="entity"><span>&amp;</span>gt;</span>0){CodeMirror.commands.autocomplete(instance);}}
<span id="line5784"></span>function checkFileSize(input)
<span id="line5785"></span>{if(input.files<span class="entity"><span>&amp;</span>amp;</span><span class="entity"><span>&amp;</span>amp;</span>input.files.length==1)
<span id="line5786"></span>{if(input.files[0].size<span class="entity"><span>&amp;</span>gt;</span>fileUploadMaxSize)
<span id="line5787"></span>{alert(fileUploadMaxSizeErrorMsg+<span class="entity"><span>&amp;</span>quot;</span>: <span class="entity"><span>&amp;</span>quot;</span>+(fileUploadMaxSize/1024/1024)+<span class="entity"><span>&amp;</span>quot;</span> MiB<span class="entity"><span>&amp;</span>quot;</span>);return false;}}
<span id="line5788"></span>return
<span id="line5789"></span>true;}AAABAAEAEBAAAAEAIAAoBAAAFgAAACgAAAAQAAAAIAAAAAEAIAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAADwoKZQAAABMAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABEMDJMAAAAdAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAASDg7BAAAASAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAETDw9CCQkJ1QUFBb4AAABjAAAAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAADgsLVgAAAO8YExP/AAAA7QAAALEAAAARAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABQNDUsAAADJGBMT/xgTE/8AAAD/AAAAuAAAAA8AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAZERE8DQoKwhgTE/8QDQ2sGBMT/xgTE/8AAAA/AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAwICHkAAAD/EQwMzQAAAMIAAAD/AAAA7gAAAGEAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAOCwtWAAAA8RgTE/8IBQW1AAAA/wAAAP8AAADlAAAAHQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA0KCsEAAAD/EQ8PzAAAAMkAAAD/AAAA/wAAAHoAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABDAAAA/xgTE/8TDw/FAAAA8gAAAP8AAADqAAAAJgAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAgAAALUAAAD/GBMT/wAAALkAAAD/AAAA/wAAAIkAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAfAAAA4wAAAP8GBgbFAAAA2QAAAP8AAADGAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAF4AAAD5AAAA/RgTE/8AAAD/AAAA0AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAQQAAAOIAAAD/AAAA/wAAAHYAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAjAAAArgAAAG4AAAAAAAAAAAAAAAAAAAAA</span><span>&lt;/<span class="end-tag">pre</span>&gt;</span><span>
<span id="line5790"></span></span><span>&lt;/<span class="end-tag">body</span>&gt;</span><span>
<span id="line5791"></span></span><span>&lt;/<span class="end-tag">html</span>&gt;</span><span></span></span></pre></body></html>